<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>nuxt-circle-ci | Nuxt.js tag items viewer</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Nuxt.js project"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/nuxt-circle-ci//favicon.ico"><base href="/nuxt-circle-ci/"><link rel="preload" href="/nuxt-circle-ci/_nuxt/8ec1328747011a81d7cc.js" as="script"><link rel="preload" href="/nuxt-circle-ci/_nuxt/fa8b5b1668aa9cd442ea.js" as="script"><link rel="preload" href="/nuxt-circle-ci/_nuxt/750c8111044767f53b05.js" as="script"><link rel="preload" href="/nuxt-circle-ci/_nuxt/d532d6b7bee7a1094843.js" as="script"><style data-vue-ssr-id="3191d5ad:0 932a8f60:0 6759f5ab:0 08845947:0 5db11919:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;-webkit-transition:width .1s,opacity .4s;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{-webkit-transition:none;transition:none}.nuxt-progress-failed{background-color:red}html{box-sizing:border-box;font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-spacing:1px}*,:after,:before{box-sizing:border-box;margin:0}.button--green{border:1px solid #3b8070;border-radius:4px;color:#3b8070;display:inline-block;padding:10px 30px;text-decoration:none}.button--green:hover{background-color:#3b8070;color:#fff}.button--grey{border:1px solid #35495e;border-radius:4px;color:#35495e;display:inline-block;margin-left:15px;padding:10px 30px;text-decoration:none}.button--grey:hover{background-color:#35495e;color:#fff}.container{min-height:100vh;padding:16px}h3{border-bottom:1px solid #e5e5e5;padding:8px 0}h3,li+li{margin:16px 0}p{margin:8px 0}.VueToNuxtLogo[data-v-125bfbff]{height:100px}hr[data-v-125bfbff]{border-top:1px solid #e5e5e5}.footer[data-v-125bfbff]{text-align:center}.VueToNuxtLogo{-webkit-animation:turn 2s linear 1s forwards;animation:turn 2s linear 1s forwards;display:inline-block;height:180px;overflow:hidden;position:relative;-webkit-transform:rotateX(180deg);transform:rotateX(180deg);width:245px}.Triangle{height:0;left:0;position:absolute;top:0;width:0}.Triangle--one{border-bottom:180px solid #41b883;border-left:105px solid transparent;border-right:105px solid transparent}.Triangle--two{border-bottom:150px solid #3b8070;border-left:87.5px solid transparent;border-right:87.5px solid transparent;top:30px}.Triangle--three,.Triangle--two{-webkit-animation:goright .5s linear 3.5s forwards;animation:goright .5s linear 3.5s forwards;left:35px}.Triangle--three{border-bottom:120px solid #35495e;border-left:70px solid transparent;border-right:70px solid transparent;top:60px}.Triangle--four{-webkit-animation:godown .5s linear 3s forwards;animation:godown .5s linear 3s forwards;border-bottom:60px solid #fff;border-left:35px solid transparent;border-right:35px solid transparent;left:70px;top:120px}@-webkit-keyframes turn{to{-webkit-transform:rotateX(0);transform:rotateX(0)}}@keyframes turn{to{-webkit-transform:rotateX(0);transform:rotateX(0)}}@-webkit-keyframes godown{to{top:180px}}@keyframes godown{to{top:180px}}@-webkit-keyframes goright{to{left:70px}}@keyframes goright{to{left:70px}}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><section class="container" data-v-125bfbff><div data-v-125bfbff><h3 data-v-125bfbff><div class="VueToNuxtLogo" data-v-125bfbff><div class="Triangle Triangle--two"></div> <div class="Triangle Triangle--one"></div> <div class="Triangle Triangle--three"></div> <div class="Triangle Triangle--four"></div></div> <span data-v-125bfbff>Nuxt.js のタグが付けられた投稿の一覧</span></h3> <ul data-v-125bfbff><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.js IE11 で syntax error が発生する場合</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/umamichi" data-v-125bfbff>
              umamichi
            </a></small></h4> <div data-v-125bfbff>## 解決法

`nuxt.config.js` (ts) に以下を追加

```javascript
  ...
  build: {
    // 特定の依存関係を Babel で変換したい場合、マッチする依存ファイル名の文字列または正規表現オブジェクトを......</div> <p data-v-125bfbff><a href="https://qiita.com/umamichi/items/e25a455bb4468ea26d32" data-v-125bfbff>https://qiita.com/umamichi/items/e25a455bb4468ea26d32</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>auth0-spa-jsをnuxt流に使ってみる</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/ainehanta" data-v-125bfbff>
              ainehanta
            </a></small></h4> <div data-v-125bfbff># はじめに

[auth0-spa-js](https://auth0.com/docs/libraries/auth0-spa-js)が7月にリリースされました。従来のJS向けSDKとして[auth0.js](https://auth0.com/docs/......</div> <p data-v-125bfbff><a href="https://qiita.com/ainehanta/items/d95e62ebeb74ddfc88cc" data-v-125bfbff>https://qiita.com/ainehanta/items/d95e62ebeb74ddfc88cc</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>GitHub Actionsを使ってnuxt.jsで作成した静的WebページをS3に自動デプロイする</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/1pp0" data-v-125bfbff>
              1pp0
            </a></small></h4> <div data-v-125bfbff># はじめに
`Nuxt.js` で作成した業務用のWebアプリを、S3の `Static website hosting` で運用しているのですが、個人メンテナンス & 更新頻度が少ないといった理由で、1.手元で `yarn generate` → 2.手動......</div> <p data-v-125bfbff><a href="https://qiita.com/1pp0/items/23c679eec04f19815e81" data-v-125bfbff>https://qiita.com/1pp0/items/23c679eec04f19815e81</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxtでモーダル実装時に背景がスクロールできてしまう時の対処法</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/taakuuyaa" data-v-125bfbff>
              taakuuyaa
            </a></small></h4> <div data-v-125bfbff># モーダルコンポーネントを作る
```vue
&lt;template>
  &lt;transition name="modal">
    &lt;div class="modal-mask" @click="closeModal">
      &lt;div class="......</div> <p data-v-125bfbff><a href="https://qiita.com/taakuuyaa/items/a6a6014dc86a44df8f15" data-v-125bfbff>https://qiita.com/taakuuyaa/items/a6a6014dc86a44df8f15</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.jsでBasic認証が設定されているサイトでもPWAの検証をする</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/ProjectEuropa" data-v-125bfbff>
              ProjectEuropa
            </a></small></h4> <div data-v-125bfbff>## Basic認証でのPWAの問題

manifest.jsonが401なります。
console.log見ると出てきます。

## 対策

manifest.jsonをBasic認証から除外する。
がもっと簡単な方法がNuxt PWA公式ドキュメントにもっ......</div> <p data-v-125bfbff><a href="https://qiita.com/ProjectEuropa/items/27987623964f31175ec9" data-v-125bfbff>https://qiita.com/ProjectEuropa/items/27987623964f31175ec9</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>【Nuxt × Firebase Functions】超入門</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/omochironn" data-v-125bfbff>
              omochironn
            </a></small></h4> <div data-v-125bfbff>## 概要
Nuxt.jsのプロジェクトで、Firebase Functionsを使用して「Hello World!」を行います！
Nuxtちょっと分かるけど、NuxtとFirebaseの組み合わせ方わからん…！ってなってる人の助けになれば…

## セットア......</div> <p data-v-125bfbff><a href="https://qiita.com/omochironn/items/5d00ab463e551e01c7c4" data-v-125bfbff>https://qiita.com/omochironn/items/5d00ab463e551e01c7c4</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.js(SSR)をLambdaで配信する【個人開発】</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/kobayashi-m42" data-v-125bfbff>
              kobayashi-m42
            </a></small></h4> <div data-v-125bfbff>## 概要
Qiitaのストックを整理するためのサービス「Mindexer(ミンデクサー)」のフロントエンドを
Vue.jsで構築したSPAのアプリケーションからNuxt.jsでSSRを行うように再構築しました。

LambdaでExpressサーバーを動かし......</div> <p data-v-125bfbff><a href="https://qiita.com/kobayashi-m42/items/fbacb46f7603e5a014d7" data-v-125bfbff>https://qiita.com/kobayashi-m42/items/fbacb46f7603e5a014d7</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.jsでTypeScript 3.7を使う</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/simochee" data-v-125bfbff>
              simochee
            </a></small></h4> <div data-v-125bfbff># はじめに

2019/11/18現在、Nuxt.jsではTypeScript 3.7を使用することはできません。

ただし、使用しているパッケージのバージョンを手動で変更すればTypeScript 3.7に対応することができるようです。

ここでは、その手......</div> <p data-v-125bfbff><a href="https://qiita.com/simochee/items/a2eca2ea8761409889be" data-v-125bfbff>https://qiita.com/simochee/items/a2eca2ea8761409889be</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.jsでVue用スライダーライブラリ Hooperを導入</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/taktakahashi" data-v-125bfbff>
              taktakahashi
            </a></small></h4> <div data-v-125bfbff># 導入の経緯

これまで弊社のRuby on Railsで製作されたプロダクトではスライダーライブラリとして`swiper.js`を用いており、新しくnuxt.jsで製作したものでも流れでswiperをvue向けに扱えるようにした`vue-awesome-s......</div> <p data-v-125bfbff><a href="https://qiita.com/taktakahashi/items/143c59c633c59755dcd6" data-v-125bfbff>https://qiita.com/taktakahashi/items/143c59c633c59755dcd6</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.jsのvue-chartjsでmomentをつかわないようにする</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/kira_puka" data-v-125bfbff>
              kira_puka
            </a></small></h4> <div data-v-125bfbff>`nuxt build --analyze`してみたら、[vue-chartjs](https://vue-chartjs.org/ja/guide/)でmomentを呼んでいた。。
時刻は使ってなかったので、削除して軽くしてみたときの備忘録


#### n......</div> <p data-v-125bfbff><a href="https://qiita.com/kira_puka/items/559b3cbedcd3ed532a92" data-v-125bfbff>https://qiita.com/kira_puka/items/559b3cbedcd3ed532a92</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Nuxt.jsでAPIのCORS対策をするとNetlifyで404エラーになる件</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/takasu_mtg" data-v-125bfbff>
              takasu_mtg
            </a></small></h4> <div data-v-125bfbff>## 概要
- Nuxt.jsでCORSエラーが発生したので、axiosのproxiy設定をした
- Netlifyにデプロイすると404エラーが発生した
- Netlifyのリダイレクトオプションを設定して解決

## Nuxtの設定

`.env`

``......</div> <p data-v-125bfbff><a href="https://qiita.com/takasu_mtg/items/9f7ef27a032710c06f61" data-v-125bfbff>https://qiita.com/takasu_mtg/items/9f7ef27a032710c06f61</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>frontendに「nuxtjs/apollo」、backendに「go+gqlgen」の組み合わせでGraphQLサービスを作る</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/sky0621" data-v-125bfbff>
              sky0621
            </a></small></h4> <div data-v-125bfbff># お題
簡易ToDoアプリ（と言っても、この記事上では単に「ToDoの新規登録」と「登録済みの全ToDoの表示」しか出来ない）を題材として、表題の組み合わせでGraphQL通信ロジックを書くとどんな感じになるかを確認してみる。
※今回はRDBを使った永続化な......</div> <p data-v-125bfbff><a href="https://qiita.com/sky0621/items/8abd445edba347e8f6f1" data-v-125bfbff>https://qiita.com/sky0621/items/8abd445edba347e8f6f1</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>これからチーム開発に参加するUIデザイナーがGitHubでの開発フローをまとめた</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/Annielovescode" data-v-125bfbff>
              Annielovescode
            </a></small></h4> <div data-v-125bfbff>##これからチーム開発に参加するUIデザイナーがGitHubでの開発フローをまとめた

##注意
- (自分用備忘録です)
- (開発初学者です)

###前提

- 環境構築が終わっていてローカルホストが立ち上がっている状態
- リモートリポジトリのclon......</div> <p data-v-125bfbff><a href="https://qiita.com/Annielovescode/items/7f6d4941ffc2ad61f580" data-v-125bfbff>https://qiita.com/Annielovescode/items/7f6d4941ffc2ad61f580</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>とあるラーメン店のWordpressサイトをNuxt.js+Firebaseで作り直した話</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/em0" data-v-125bfbff>
              em0
            </a></small></h4> <div data-v-125bfbff>
## お店と Web サイトの紹介

中華そば四つ葉
https://yotsuba628.com/

![y_soba2.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/27......</div> <p data-v-125bfbff><a href="https://qiita.com/em0/items/2ad90db529c661f363d8" data-v-125bfbff>https://qiita.com/em0/items/2ad90db529c661f363d8</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>【Nuxt.js】 Jestを使ってコンポーネントのテスト書く</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/curosuke" data-v-125bfbff>
              curosuke
            </a></small></h4> <div data-v-125bfbff>今までフロントエンドでテストケースを書いたことがありませんでしたが、とある案件で挑戦する機会があったのでやってみました

## やりたいこと
- 作成済みの Nuxt.jsアプリに、後から[Jest](https://jestjs.io/docs/ja/get......</div> <p data-v-125bfbff><a href="https://qiita.com/curosuke/items/1b623353300d52255c6c" data-v-125bfbff>https://qiita.com/curosuke/items/1b623353300d52255c6c</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>非プログラマのWindowsマシンにGit、Node.js、Nuxt.js環境を構築する手順</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/ljourm" data-v-125bfbff>
              ljourm
            </a></small></h4> <div data-v-125bfbff>デザイナー(非プログラマー)のWindowsPCにNuxt開発環境を構築してもらう必要がありましたので手順書を作りました。

# 目標

非プログラマーが非プログラマ―の操作によって開発環境を構築します。
最終的にWindowsPCでNuxt.jsのプロジェク......</div> <p data-v-125bfbff><a href="https://qiita.com/ljourm/items/ac884f5759e88dbd3492" data-v-125bfbff>https://qiita.com/ljourm/items/ac884f5759e88dbd3492</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>Amplify + Nuxt.js + Cognitoでログイン機能を実装してみた</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/respectakagikun" data-v-125bfbff>
              respectakagikun
            </a></small></h4> <div data-v-125bfbff>今回の記事は、AWS amplifyの機能の一つであるAuthenticationについての記事です。
Nuxt.jsとAmazon Cognitoによるアプリケーションにユーザーのサインアップ、サインインなどの機能を追加し、実際にログイン画面を実装していきた......</div> <p data-v-125bfbff><a href="https://qiita.com/respectakagikun/items/0b976b12ddb34f027190" data-v-125bfbff>https://qiita.com/respectakagikun/items/0b976b12ddb34f027190</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>【Nuxt】APIで取得したデータごとにページを作成する【動的ルーティング】</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/omochironn" data-v-125bfbff>
              omochironn
            </a></small></h4> <div data-v-125bfbff># 概要
APIで取得してきたデータ毎にページを作成したい！と思い色々試行錯誤した内容をまとめました。
API作成に使用したのツールは[Micro CMS](https://microcms.io/)です。別記事で使用方法を書いてあります。
[Nuxtで最近話......</div> <p data-v-125bfbff><a href="https://qiita.com/omochironn/items/5ff800ac9c21dfe29aad" data-v-125bfbff>https://qiita.com/omochironn/items/5ff800ac9c21dfe29aad</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>nuxt-childでlayoutの量産を防ぐ</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/simochee" data-v-125bfbff>
              simochee
            </a></small></h4> <div data-v-125bfbff># はじめに

この度、`nuxt-child`というコンポーネントの存在を知り、戦慄しました。

> [API: &lt;nuxt-child> コンポーネント - NuxtJS](https://ja.nuxtjs.org/api/components-nuxt......</div> <p data-v-125bfbff><a href="https://qiita.com/simochee/items/fbca7cb6c69e82484873" data-v-125bfbff>https://qiita.com/simochee/items/fbca7cb6c69e82484873</a></p></li><li data-v-125bfbff><h4 data-v-125bfbff><span data-v-125bfbff>公式ガイドで教えてくれなかったFirestoreのtransaction処理で連番IDを振る方法</span> <small data-v-125bfbff><span data-v-125bfbff>by </span> <a href="/nuxt-circle-ci/users/watsuyo_2" data-v-125bfbff>
              watsuyo_2
            </a></small></h4> <div data-v-125bfbff># 本記事の投稿動機
- Firestoreのtransaction処理実装で公式ガイドには載っていないやり方での実装が必要だったため、知識整理として投稿
- おそらく連番IDを振るという実装はFirestore的にも推奨をしていませんので、この実装を実運用す......</div> <p data-v-125bfbff><a href="https://qiita.com/watsuyo_2/items/3f59cc44cc5c60cd208c" data-v-125bfbff>https://qiita.com/watsuyo_2/items/3f59cc44cc5c60cd208c</a></p></li></ul> <hr data-v-125bfbff> <div class="footer" data-v-125bfbff><small data-v-125bfbff><a href="https://github.com/gladsy/nuxt-circle-ci" target="_blank" data-v-125bfbff>GitHub
        </a></small></div></div></section></div></div></div><script>window.__NUXT__=function(s,n,a,p,e,t,l,c,i,o,r,d,m,f,g,u,h,b,x,E,v,k,A,w,y,F,_,j,q,C,B,S,T,N,I,D,P,R,z,L,G,$,O,W,M,U,H,V,Q,K,J,Y,X,Z,ss,ns,as,ps){return{layout:"default",data:[{}],error:n,state:{items:[{rendered_body:'\n<h2>\n<span id="解決法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%95"><i class="fa fa-link"></i></a>解決法</h2>\n\n<p><code>nuxt.config.js</code> (ts) に以下を追加</p>\n\n<div class="code-frame" data-lang="javascript"><div class="highlight"><pre>  <span class="p">...</span>\n  <span class="nx">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="c1">// 特定の依存関係を Babel で変換したい場合、マッチする依存ファイル名の文字列または正規表現オブジェクトをここに書く</span>\n    <span class="nl">transpile</span><span class="p">:</span> <span class="p">[</span>\n      <span class="dl">\'</span><span class="s1">helpful-decorators</span><span class="dl">\'</span>\n    <span class="p">]</span>\n  <span class="p">}</span>\n  <span class="p">...</span>\n</pre></div></div>\n\n<p>今回は、 <code>helpful-decorators</code> というモジュール内で arrow function が使われていたことが原因だったので</p>\n\n<p><code>helpful-decorators</code> を <code>transpile</code> に追加</p>\n\n<h2>\n<span id="transpile-とは" class="fragment"></span><a href="#transpile-%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>transpile とは？</h2>\n\n<p><code>node_modules</code> 下のモジュールに事前に Babel を通す機能</p>\n\n<h2>\n<span id="それでも解決しない場合" class="fragment"></span><a href="#%E3%81%9D%E3%82%8C%E3%81%A7%E3%82%82%E8%A7%A3%E6%B1%BA%E3%81%97%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>それでも解決しない場合</h2>\n\n<p>上記の <code>transpile</code> でも解決しない場合があります</p>\n\n<p>例えば <code>is-https</code> というモジュールはソース内で、デフォルト引数を使っています</p>\n\n<p>この書き方は、 <code>transpile</code> で解決できないため （たぶんNuxtの仕様、未調査です🙏）</p>\n\n<p>モジュールを <code>node_modules</code> から import するのではなく</p>\n\n<p><code>src</code> ディレクトリ下にモジュールの <code>index.js</code> ファイルを配置し、 <code>import</code> して使うことで強制的に Typescriptコンパイラ を通すことができます</p>\n\n<p><strong>Typescriptコンパイラ はデフォルト引数を、IEで動作する記述に変更してくれる</strong> ため、IE11で動作するようになります</p>\n',body:"## 解決法\n\n`nuxt.config.js` (ts) に以下を追加\n\n```javascript\n  ...\n  build: {\n    // 特定の依存関係を Babel で変換したい場合、マッチする依存ファイル名の文字列または正規表現オブジェクトをここに書く\n    transpile: [\n      'helpful-decorators'\n    ]\n  }\n  ...\n```\n\n今回は、 `helpful-decorators` というモジュール内で arrow function が使われていたことが原因だったので\n\n`helpful-decorators` を `transpile` に追加\n\n## transpile とは？\n\n`node_modules` 下のモジュールに事前に Babel を通す機能\n\n## それでも解決しない場合\n\n上記の `transpile` でも解決しない場合があります\n\n例えば `is-https` というモジュールはソース内で、デフォルト引数を使っています\n\nこの書き方は、 `transpile` で解決できないため （たぶんNuxtの仕様、未調査です🙏）\n\nモジュールを `node_modules` から import するのではなく\n\n`src` ディレクトリ下にモジュールの `index.js` ファイルを配置し、 `import` して使うことで強制的に Typescriptコンパイラ を通すことができます\n\n**Typescriptコンパイラ はデフォルト引数を、IEで動作する記述に変更してくれる** ため、IE11で動作するようになります\n",coediting:a,comments_count:0,created_at:"2019-11-19T20:04:35+09:00",group:n,id:"e25a455bb4468ea26d32",likes_count:2,private:a,reactions_count:0,tags:[{name:"IE",versions:[]},{name:j,versions:[]},{name:e,versions:[]}],title:"Nuxt.js IE11 で syntax error が発生する場合",updated_at:"2019-11-19T20:09:25+09:00",url:"https://qiita.com/umamichi/items/e25a455bb4468ea26d32",user:{description:"Programmer Guitarist. \r\nYouTubeチャンネル登録お待ちしてます🦄",facebook_id:"masataka.umamichi",followees_count:0,followers_count:20,github_login_name:k,id:k,items_count:11,linkedin_id:s,location:"Tokyo, Japan",name:"Masataka Umamichi",organization:s,permanent_id:74703,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/74703/profile-images/1482899948",team_only:a,twitter_screen_name:"masaumamichi",website_url:"http://umamichi.com"},page_views_count:n},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p><a href="https://auth0.com/docs/libraries/auth0-spa-js" rel="nofollow noopener" target="_blank">auth0-spa-js</a>が7月にリリースされました。従来のJS向けSDKとして<a href="https://auth0.com/docs/libraries/auth0js/v9" rel="nofollow noopener" target="_blank">auth0.js</a>の代わりに、よりシンプルに認証を行うためのライブラリです。名前の通りSPA向けのライブラリで良い感じにログインしてくれます。</p>\n\n<p>2019年11月19日現在Vue用のサンプルコードは存在しているみたいです</p>\n\n<blockquote>\n<p><a href="https://auth0.com/docs/quickstart/spa/vuejs/01-login" class="autolink" rel="nofollow noopener" target="_blank">https://auth0.com/docs/quickstart/spa/vuejs/01-login</a></p>\n</blockquote>\n\n<p>ただ、このままnuxtで実装した場合generateする時にSSR関連で怒られたり、ミドルウェアでうまく使えなかったりするので辛いです。そこで、今回はnuxtウェイに乗っ取ってauth0-spa-jsを使ってみましょう。</p>\n\n<h1>\n<span id="つらみを取り除くためには" class="fragment"></span><a href="#%E3%81%A4%E3%82%89%E3%81%BF%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F%E3%81%9F%E3%82%81%E3%81%AB%E3%81%AF"><i class="fa fa-link"></i></a>つらみを取り除くためには</h1>\n\n<p>はじめにでも述べた通り、auth0-spa-jsをnuxtで使うにあたって2つの辛みがあります。</p>\n\n<ul>\n<li>generateする時に怒られる</li>\n<li>ミドルウェアで使えない</li>\n</ul>\n\n<p>それぞれの辛みを原因と解決方法を考えていきましょう。</p>\n\n<h2>\n<span id="generateする時に怒られる" class="fragment"></span><a href="#generate%E3%81%99%E3%82%8B%E6%99%82%E3%81%AB%E6%80%92%E3%82%89%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>generateする時に怒られる</h2>\n\n<p>nuxtをSPAモードで使ってる限りは問題ないです。でもせっかくnuxtを使っているのであれば、SSR的なことしたいじゃないですか。SSRしなくてもLPを一緒のプロジェクトで管理してるならLPはちゃんとクローラーに拾ってもらいたいじゃないですか。ってなるとUniversalモードを使うことになるはずです。</p>\n\n<p>しかし、サンプルコードの実装だと<code>window</code>を参照しているので怒られます。今回は<code>process.client</code>で処理を切り分けて対応します。</p>\n\n<h2>\n<span id="ミドルウェアで使えない" class="fragment"></span><a href="#%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%A7%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>ミドルウェアで使えない</h2>\n\n<p>nuxtにはルーティング中に処理を挟み込むミドルウェアという機能があります。例えば、ユーザー情報ページはログインしていないとログインページにリダイレクトするなどの処理を挟みこめるので、認証・認可と相性が良いです。</p>\n\n<p>サンプルコードの実装の場合、auth0-spa-jsのインスタンスを非同期な<code>created</code>フックで生成しています。通常のVueコンポーネントであれば非同期<code>created</code>フックを待ってくれます。今回はサンプルコード的な働きをするものをプラグインとして実装しますが、こちらも非同期プラグインとして実装すればnuxtは待ってくれます。</p>\n\n<p>問題なのは、サンプルコードが同期プラグインの中で非同期<code>created</code>フックを含むVueインスタンスを作成していることです。</p>\n\n<p>この場合、Vueインスタンス自体は即座に作成されます。このとき非同期<code>created</code>はキューに乗っているはずです。ただプラグイン自体は実行完了しているため、ミドルウェアに処理が移ります。しかし、ミドルウェアで生成したVueインスタンスの中の<code>created</code>フックで生成するインスタンスにアクセスすると<code>undefined</code>になることがあります。だって<code>created</code>フックが実行完了している保証がないですから。</p>\n\n<p>今回はログイン状態をVueインスタンスではなくVuexストアに保存して対応します。ちなみに、Vuexストアにアクセストークンは保存しちゃダメです。都度取得しましょう。auth0-spa-jsの実装を読む限りキャッシュされているようなので問題ないはずです。</p>\n\n<h1>\n<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h1>\n\n<p>いよいよ実装です。ついでにRBACも実装しちゃいましょう。<br>\nauth0側の手順は<a href="https://auth0.com/docs/quickstart/spa/vuejs/01-login" rel="nofollow noopener" target="_blank">公式サンプル</a>にしたがって準備をお願いします。</p>\n\n<h2>\n<span id="下準備" class="fragment"></span><a href="#%E4%B8%8B%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>下準備</h2>\n\n<p>nuxtプロジェクトを作成しましょう。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>npx create-nuxt-app auth0-spa-nuxt\ncreate-nuxt-app v2.11.1\n✨  Generating Nuxt.js project <span class="k">in </span>auth0-spa-nuxt\n? Project name auth0-spa-nuxt\n? Project description My geometric Nuxt.js project\n? Author name Makoto Uju\n? Choose the package manager Npm\n? Choose UI framework Vuetify.js\n? Choose custom server framework None <span class="o">(</span>Recommended<span class="o">)</span>\n? Choose Nuxt.js modules Axios\n? Choose linting tools ESLint, Prettier\n? Choose <span class="nb">test </span>framework None\n? Choose rendering mode Universal <span class="o">(</span>SSR<span class="o">)</span>\n? Choose development tools jsconfig.json <span class="o">(</span>Recommended <span class="k">for </span>VS Code<span class="o">)</span>\n</pre></div></div>\n\n<p>依存パッケージを追加します。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>npm i <span class="nt">--save</span> jwt-decode lodash.intersection lodash.merge\n<span class="nv">$ </span>npm i <span class="nt">--save-dev</span> @nuxtjs/dotenv\n</pre></div></div>\n\n<p>dotenvモジュールの初期設定をします。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">colors</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuetify/es5/util/colors</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">dotenv</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">dotenv</span><span class="dl">\'</span> <span class="c1">// dotenvロード</span>\n\n<span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">()</span> <span class="c1">// dotenv初期化</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="p">...</span>\n  <span class="na">buildModules</span><span class="p">:</span> <span class="p">[</span>\n    <span class="c1">// Doc: https://github.com/nuxt-community/eslint-module</span>\n    <span class="dl">\'</span><span class="s1">@nuxtjs/eslint-module</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="dl">\'</span><span class="s1">@nuxtjs/vuetify</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="dl">\'</span><span class="s1">@nuxtjs/dotenv</span><span class="dl">\'</span> <span class="c1">// dotenvモジュール読み込み</span>\n  <span class="p">],</span>\n  <span class="p">...</span>\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">config</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="na">fs</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">empty</span><span class="dl">\'</span> <span class="c1">// fsがないと怒られるので追加</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n\n</pre></div>\n</div>\n\n<h2>\n<span id="vuex実装" class="fragment"></span><a href="#vuex%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>Vuex実装</h2>\n\n<p>まず、Vuexを実装します。シンプルにサンプルコードの<code>data</code>と同じもの＋RBAC用に<code>permissions</code>が入ります。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">store/auth0.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">loading</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n  <span class="na">isAuthenticated</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n  <span class="na">user</span><span class="p">:</span> <span class="p">{},</span>\n  <span class="na">popupOpen</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n  <span class="na">permissions</span><span class="p">:</span> <span class="p">[]</span>\n<span class="p">})</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">setPopupOpen</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">popupOpen</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">payload</span>\n  <span class="p">},</span>\n  <span class="nx">setUser</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">payload</span>\n  <span class="p">},</span>\n  <span class="nx">setIsAuthenticated</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">payload</span>\n  <span class="p">},</span>\n  <span class="nx">setLoading</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">payload</span>\n  <span class="p">},</span>\n  <span class="nx">setPermissions</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">permissions</span> <span class="o">=</span> <span class="nx">payload</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="プラグイン実装" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>プラグイン実装</h2>\n\n<p>基本的に全てのロジックが入ります。Vueインスタンスを生成する箇所において<code>process.client</code>によって処理を分岐させます。SSR時はモックが返却されるので問題なくSSRできます。</p>\n\n<p>生成したVueインスタンスは<a href="https://ja.nuxtjs.org/guide/plugins/#%E7%B5%B1%E5%90%88%E3%81%95%E3%82%8C%E3%81%9F%E6%B3%A8%E5%85%A5" rel="nofollow noopener" target="_blank"><code>inject</code>メソッド</a>で包括的に注入します。vuexやコンテキストなどにまとめて注入してくれるので便利です。</p>\n\n<p>あと、<code>const $auth0 = await useAuth0(context.store, options)</code>で<code>store</code>を渡しています。nuxtのVueインスタンスでは<code>this.$store</code>でVuexにアクセスできるはずです。しかし、それはnuxtがいい感じに注入してくれているからできることで、今回のようにピュアなVueインスタンスを生成した場合注入されません。よって、意図的にVuexストアを渡すようにしています。</p>\n\n<p>ちなみに例外は全て呼び出し元に戻るはずです。あとでちゃんとハンドルしましょう。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">plugins/auth0.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">createAuth0Client</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@auth0/auth0-spa-js</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">jwtDecode</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">jwt-decode</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">nuxtConfig</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/nuxt.config</span><span class="dl">\'</span>\n\n<span class="c1">// eslint-disable-next-line prefer-const</span>\n<span class="kd">let</span> <span class="nx">instance</span> <span class="o">=</span> <span class="kc">null</span>\n\n<span class="kd">const</span> <span class="nx">useAuth0</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="p">{</span> <span class="nx">onRedirectCallback</span><span class="p">,</span> <span class="p">...</span><span class="nx">options</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">client</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">auth0Client</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">createAuth0Client</span><span class="p">({</span>\n        <span class="na">domain</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">domain</span><span class="p">,</span>\n        <span class="na">client_id</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">clientId</span><span class="p">,</span>\n        <span class="na">audience</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">audience</span><span class="p">,</span>\n        <span class="na">scope</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">scope</span><span class="p">,</span>\n        <span class="na">redirect_uri</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span>\n      <span class="p">})</span>\n\n      <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>\n        <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n          <span class="k">return</span> <span class="p">{</span>\n            <span class="na">auth0Client</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>\n            <span class="na">error</span><span class="p">:</span> <span class="kc">null</span>\n          <span class="p">}</span>\n        <span class="p">},</span>\n        <span class="k">async</span> <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n          <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span> <span class="o">=</span> <span class="nx">auth0Client</span>\n\n          <span class="k">if</span> <span class="p">(</span>\n            <span class="c1">// eslint-disable-next-line nuxt/no-globals-in-created</span>\n            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">\'</span><span class="s1">code=</span><span class="dl">\'</span><span class="p">)</span> <span class="o">&amp;&amp;</span>\n            <span class="c1">// eslint-disable-next-line nuxt/no-globals-in-created</span>\n            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">\'</span><span class="s1">state=</span><span class="dl">\'</span><span class="p">)</span>\n          <span class="p">)</span> <span class="p">{</span>\n            <span class="k">try</span> <span class="p">{</span>\n              <span class="kd">const</span> <span class="p">{</span> <span class="nx">appState</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleRedirectCallback</span><span class="p">()</span>\n              <span class="nx">onRedirectCallback</span><span class="p">(</span><span class="nx">appState</span><span class="p">)</span>\n            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n              <span class="k">this</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">e</span>\n            <span class="p">}</span>\n          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n            <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">()</span>\n          <span class="p">}</span>\n        <span class="p">},</span>\n        <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n          <span class="k">async</span> <span class="nx">loginWithPopup</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setPopupOpen</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>\n\n            <span class="k">try</span> <span class="p">{</span>\n              <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">loginWithPopup</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>\n            <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>\n              <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setPopupOpen</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>\n            <span class="p">}</span>\n\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setUser</span><span class="dl">\'</span><span class="p">,</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">getUser</span><span class="p">())</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setIsAuthenticated</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>\n          <span class="p">},</span>\n          <span class="nx">loginWithRedirect</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>\n            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">loginWithRedirect</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>\n          <span class="p">},</span>\n          <span class="nx">logout</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>\n            <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">logout</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setIsAuthenticated</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>\n          <span class="p">},</span>\n          <span class="nx">getTokenSilently</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>\n            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">getTokenSilently</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>\n          <span class="p">},</span>\n          <span class="k">async</span> <span class="nx">getTokenWithPopup</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setPopupOpen</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>\n\n            <span class="k">try</span> <span class="p">{</span>\n              <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">getTokenWithPopup</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>\n              <span class="k">return</span> <span class="nx">token</span>\n            <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>\n              <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setPopupOpen</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>\n            <span class="p">}</span>\n          <span class="p">},</span>\n          <span class="k">async</span> <span class="nx">handleRedirectCallback</span><span class="p">()</span> <span class="p">{</span>\n            <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">handleRedirectCallback</span><span class="p">()</span>\n\n            <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">()</span>\n\n            <span class="k">return</span> <span class="nx">result</span>\n          <span class="p">},</span>\n          <span class="k">async</span> <span class="nx">load</span><span class="p">()</span> <span class="p">{</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span>\n              <span class="dl">\'</span><span class="s1">auth0/setIsAuthenticated</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">()</span>\n            <span class="p">)</span>\n\n            <span class="kd">const</span> <span class="nx">isAuthenticated</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">getUser</span><span class="p">()</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0/setUser</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">isAuthenticated</span><span class="p">)</span>\n\n            <span class="k">if</span> <span class="p">(</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>\n              <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">auth0Client</span><span class="p">.</span><span class="nx">getTokenSilently</span><span class="p">()</span>\n              <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span>\n                <span class="dl">\'</span><span class="s1">auth0/setPermissions</span><span class="dl">\'</span><span class="p">,</span>\n                <span class="nx">jwtDecode</span><span class="p">(</span><span class="nx">token</span><span class="p">).</span><span class="nx">permissions</span> <span class="o">||</span> <span class="p">[]</span>\n              <span class="p">)</span>\n            <span class="p">}</span>\n          <span class="p">}</span>\n        <span class="p">}</span>\n      <span class="p">})</span>\n    <span class="p">}</span>\n\n    <span class="k">return</span> <span class="nx">instance</span>\n  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>\n      <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n        <span class="k">return</span> <span class="p">{</span>\n          <span class="na">auth0Client</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>\n          <span class="na">error</span><span class="p">:</span> <span class="kc">null</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n    <span class="p">})</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">inject</span><span class="p">)</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">nuxtConfig</span><span class="p">.</span><span class="nx">auth0</span><span class="p">,</span>\n    <span class="na">onRedirectCallback</span><span class="p">:</span> <span class="p">(</span><span class="nx">appState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="nx">context</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>\n        <span class="nx">appState</span> <span class="o">&amp;&amp;</span> <span class="nx">appState</span><span class="p">.</span><span class="nx">targetUrl</span>\n          <span class="p">?</span> <span class="nx">appState</span><span class="p">.</span><span class="nx">targetUrl</span>\n          <span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span>\n      <span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n\n  <span class="kd">const</span> <span class="nx">$auth0</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">useAuth0</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>\n\n  <span class="nx">inject</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">$auth0</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="ミドルウェアの実装" class="fragment"></span><a href="#%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ミドルウェアの実装</h2>\n\n<p>アクセス制御をするためにミドルウェアを実装しましょう。各ページごとに必要なパーミッションを定義したいので、クロージャにします。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">middleware/auth.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">intersection</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">lodash/intersection</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">merge</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">lodash/merge</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">protect</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">options</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">({</span> <span class="na">loginRequired</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">requiredPermissions</span><span class="p">:</span> <span class="p">[]</span> <span class="p">},</span> <span class="nx">options</span><span class="p">)</span>\n\n    <span class="k">return</span> <span class="p">({</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">redirect</span><span class="p">,</span> <span class="nx">store</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">loginRequired</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">auth0</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="p">}</span>\n\n      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">loginRequired</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">requiredPermissions</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">if</span> <span class="p">(</span>\n          <span class="nx">intersection</span><span class="p">(</span>\n            <span class="nx">options</span><span class="p">.</span><span class="nx">requiredPermissions</span><span class="p">,</span>\n            <span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">auth0</span><span class="p">.</span><span class="nx">permissions</span>\n          <span class="p">).</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">options</span><span class="p">.</span><span class="nx">requiredPermissions</span><span class="p">.</span><span class="nx">length</span>\n        <span class="p">)</span> <span class="p">{</span>\n          <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="トップページの実装" class="fragment"></span><a href="#%E3%83%88%E3%83%83%E3%83%97%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>トップページの実装</h2>\n\n<p>いよいよトップページの実装です。ログイン状態はVuexストアを見ればわかります。癖のないコードのはずなので説明はスキップします。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/index.js</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-container&gt;</span>\n    <span class="nt">&lt;v-row</span> <span class="na">justify=</span><span class="s">"center"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;v-col</span> <span class="na">cols=</span><span class="s">"12"</span> <span class="na">sm=</span><span class="s">"8"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;v-card</span> <span class="na">v-if=</span><span class="s">"isAuthenticated"</span><span class="nt">&gt;</span>\n          <span class="nt">&lt;v-card-text&gt;</span>\n            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-center py-3"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-avatar</span> <span class="na">size=</span><span class="s">"100"</span><span class="nt">&gt;</span>\n                <span class="nt">&lt;img</span> <span class="na">:src=</span><span class="s">"user.picture"</span><span class="nt">/&gt;</span>\n              <span class="nt">&lt;/v-avatar&gt;</span>\n            <span class="nt">&lt;/div&gt;</span>\n\n            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"display-1 text--primary text-center"</span><span class="nt">&gt;</span>\n              <span class="si">{{</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="si">}}</span>\n            <span class="nt">&lt;/p&gt;</span>\n\n            <span class="nt">&lt;v-simple-table&gt;</span>\n              <span class="nt">&lt;template&gt;</span>\n                <span class="nt">&lt;thead&gt;</span>\n                  <span class="nt">&lt;tr&gt;</span>\n                    <span class="nt">&lt;th</span> <span class="na">class=</span><span class="s">"text-left"</span><span class="nt">&gt;</span>Key<span class="nt">&lt;/th&gt;</span>\n                    <span class="nt">&lt;th</span> <span class="na">class=</span><span class="s">"text-left"</span><span class="nt">&gt;</span>Value<span class="nt">&lt;/th&gt;</span>\n                  <span class="nt">&lt;/tr&gt;</span>\n                <span class="nt">&lt;/thead&gt;</span>\n                <span class="nt">&lt;tbody&gt;</span>\n                  <span class="nt">&lt;tr</span> <span class="na">v-for=</span><span class="s">"(value, key) in user"</span> <span class="na">:key=</span><span class="s">"key"</span><span class="nt">&gt;</span>\n                    <span class="nt">&lt;td&gt;</span><span class="si">{{</span> <span class="nx">key</span> <span class="si">}}</span><span class="nt">&lt;/td&gt;</span>\n                    <span class="nt">&lt;td&gt;</span><span class="si">{{</span> <span class="nx">value</span> <span class="si">}}</span><span class="nt">&lt;/td&gt;</span>\n                  <span class="nt">&lt;/tr&gt;</span>\n                <span class="nt">&lt;/tbody&gt;</span>\n              <span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;/v-simple-table&gt;</span>\n          <span class="nt">&lt;/v-card-text&gt;</span>\n\n          <span class="nt">&lt;v-card-actions&gt;</span>\n            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3 mx-auto"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-btn</span> <span class="na">class=</span><span class="s">""</span> <span class="err">@</span><span class="na">click=</span><span class="s">"logout"</span><span class="nt">&gt;</span>\n                LOGOUT\n              <span class="nt">&lt;/v-btn&gt;</span>\n            <span class="nt">&lt;/div&gt;</span>\n          <span class="nt">&lt;/v-card-actions&gt;</span>\n        <span class="nt">&lt;/v-card&gt;</span>\n\n        <span class="nt">&lt;v-card</span> <span class="na">v-else</span><span class="nt">&gt;</span>\n          <span class="nt">&lt;v-card-text&gt;</span>\n            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-center"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"display-1 text--primary text-center"</span><span class="nt">&gt;</span>\n                Please login.\n              <span class="nt">&lt;/p&gt;</span>\n            <span class="nt">&lt;/div&gt;</span>\n          <span class="nt">&lt;/v-card-text&gt;</span>\n          <span class="nt">&lt;v-card-actions&gt;</span>\n            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-3 mx-auto"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-btn</span> <span class="na">class=</span><span class="s">""</span> <span class="err">@</span><span class="na">click=</span><span class="s">"login"</span><span class="nt">&gt;</span>\n                LOGIN\n              <span class="nt">&lt;/v-btn&gt;</span>\n            <span class="nt">&lt;/div&gt;</span>\n          <span class="nt">&lt;/v-card-actions&gt;</span>\n        <span class="nt">&lt;/v-card&gt;</span>\n      <span class="nt">&lt;/v-col&gt;</span>\n    <span class="nt">&lt;/v-row&gt;</span>\n  <span class="nt">&lt;/v-container&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">mapState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuex</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">mapState</span><span class="p">(</span><span class="dl">\'</span><span class="s1">auth0</span><span class="dl">\'</span><span class="p">,</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">user</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">isAuthenticated</span><span class="dl">\'</span><span class="p">])</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">login</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$auth0</span><span class="p">.</span><span class="nx">loginWithRedirect</span><span class="p">()</span>\n    <span class="p">},</span>\n    <span class="nx">logout</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$auth0</span><span class="p">.</span><span class="nx">logout</span><span class="p">({</span> <span class="na">returnTo</span><span class="p">:</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="保護されたページの実装" class="fragment"></span><a href="#%E4%BF%9D%E8%AD%B7%E3%81%95%E3%82%8C%E3%81%9F%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>保護されたページの実装</h2>\n\n<p>ログインや適切なパーミッションを必要とするページを実装します。先ほど実装したミドルウェアを呼び出し、関数を生成しています。オプションで必要なパーミッションを渡すことでRBACを実現します。</p>\n\n<p>SSR時はVuexストアが初期状態（未ログイン・パーミッションなし）なので、保護されたページに直接アクセスされても正常にリダイレクトできるはずです。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/protected.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-layout&gt;</span>\n    <span class="nt">&lt;v-flex</span> <span class="na">class=</span><span class="s">"text-center"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;v-alert</span> <span class="na">type=</span><span class="s">"warning"</span> <span class="na">icon=</span><span class="s">"mdi-lock"</span><span class="nt">&gt;</span>\n        Protected Content\n      <span class="nt">&lt;/v-alert&gt;</span>\n    <span class="nt">&lt;/v-flex&gt;</span>\n  <span class="nt">&lt;/v-layout&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">authMiddleware</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/middleware/auth</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="c1">// RBACする場合</span>\n  <span class="na">middleware</span><span class="p">:</span> <span class="nx">authMiddleware</span><span class="p">.</span><span class="nx">protect</span><span class="p">({</span>\n    <span class="na">requiredPermissions</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">sample</span><span class="dl">\'</span><span class="p">]</span>\n  <span class="p">})</span>\n  <span class="c1">// ログインのみを必要とする場合は以下のように書く</span>\n  <span class="c1">// middleware: authMiddleware.protect()</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="設定する" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>設定する</h2>\n\n<p>dotenvを使います。ちなみにauth0はaudienceを渡さないとアクセストークンがJWTで吐かれないので注意しましょう。また、<code>getTokenSilently</code>を使うので<code>offline_access</code>をスコープに設定します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="p">...</span>\n  <span class="na">auth0</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">domain</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AUTH0_DOMAIN</span><span class="p">,</span>\n    <span class="na">clientId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AUTH0_CLIENT_ID</span><span class="p">,</span>\n    <span class="na">audience</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AUTH0_AUDIENCE</span><span class="p">,</span>\n    <span class="na">scope</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AUTH0_SCOPE</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="text">\n<div class="code-lang"><span class="bold">.env</span></div>\n<div class="highlight"><pre>AUTH0_DOMAIN = "example.auth0.com"\nAUTH0_CLIENT_ID = "SAmpleCl1endId"\nAUTH0_AUDIENCE = "https://example.com"\nAUTH0_SCOPE = "offline_access"\n</pre></div>\n</div>\n\n<p>また、メニューにリンクを登録します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">layouts/default.vue</span></div>\n<div class="highlight"><pre><span class="p">...</span>\n<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">clipped</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">drawer</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">fixed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">items</span><span class="p">:</span> <span class="p">[</span>\n        <span class="p">{</span>\n          <span class="na">icon</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">mdi-apps</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Welcome</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">to</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span>\n        <span class="p">},</span>\n        <span class="p">{</span>\n          <span class="na">icon</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">mdi-chart-bubble</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Inspire</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">to</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/inspire</span><span class="dl">\'</span>\n        <span class="p">},</span>\n        <span class="p">{</span>\n          <span class="na">icon</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">mdi-lock</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Protected Content</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">to</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/protected</span><span class="dl">\'</span>\n        <span class="p">}</span>\n      <span class="p">],</span>\n      <span class="na">miniVariant</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">right</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n      <span class="na">rightDrawer</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Vuetify.js</span><span class="dl">\'</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;\n</span></pre></div>\n</div>\n\n<h1>\n<span id="実行してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実行してみる</h1>\n\n<p>実行しましょう。devサーバーを立ち上げて、localhost:3000にアクセスします。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>npm run dev\n</pre></div></div>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F9e2bcd32-ffd0-2f86-1cde-3c1779102ba4.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=67682861fa88de8c81b8f7d206938bdd" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F9e2bcd32-ffd0-2f86-1cde-3c1779102ba4.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=67682861fa88de8c81b8f7d206938bdd" alt="not-logged-in.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/9e2bcd32-ffd0-2f86-1cde-3c1779102ba4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F9e2bcd32-ffd0-2f86-1cde-3c1779102ba4.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=f5a5a21e79a2c5eda36738fe89349240 1x" loading="lazy"></a></p>\n\n<p>ログインしましょう。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F7ca50bed-8d4a-a287-a1b9-a2eb23ef75b3.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a80cd62ef8571b69d655084187c276df" target="_blank" rel="nofollow noopener"><img width="852" alt="スクリーンショット 2019-11-19 17.42.52.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F7ca50bed-8d4a-a287-a1b9-a2eb23ef75b3.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a80cd62ef8571b69d655084187c276df" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/7ca50bed-8d4a-a287-a1b9-a2eb23ef75b3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F7ca50bed-8d4a-a287-a1b9-a2eb23ef75b3.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=5168d021fc45bdb64a0a6b227040178b 1x" loading="lazy"></a></p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fc4b595c4-8d7a-5f26-385e-cd3e0cec9e3c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=781a72ff3485871ce39f4b5efe32385a" target="_blank" rel="nofollow noopener"><img width="850" alt="スクリーンショット 2019-11-19 17.41.11.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fc4b595c4-8d7a-5f26-385e-cd3e0cec9e3c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=781a72ff3485871ce39f4b5efe32385a" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/c4b595c4-8d7a-5f26-385e-cd3e0cec9e3c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fc4b595c4-8d7a-5f26-385e-cd3e0cec9e3c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=f8f8ff74c6cccc4f66ab858207bada48 1x" loading="lazy"></a></p>\n\n<p>ユーザー情報が表示されれば成功です。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F2fa88c64-c957-6f33-b8c9-9a7e3e88eb5a.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=1bbc2b6c38f6963d9292208af7f6ed7a" target="_blank" rel="nofollow noopener"><img width="851" alt="スクリーンショット 2019-11-19 17.41.23.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F2fa88c64-c957-6f33-b8c9-9a7e3e88eb5a.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=1bbc2b6c38f6963d9292208af7f6ed7a" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/2fa88c64-c957-6f33-b8c9-9a7e3e88eb5a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F2fa88c64-c957-6f33-b8c9-9a7e3e88eb5a.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=db3802b4b97d40bee89d12bc94054de1 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="rbacをためす" class="fragment"></span><a href="#rbac%E3%82%92%E3%81%9F%E3%82%81%E3%81%99"><i class="fa fa-link"></i></a>RBACをためす</h2>\n\n<p>ではRBACを確認しましょう。まず、Auth0のAPIsからRBACを有効化します。<code>Add Permissions in the Access Token</code>を忘れずに。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fbffe98cf-797d-c23e-c2ad-0ac967fe455b.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=67a3c3c9ccc926c3858c31a596035029" target="_blank" rel="nofollow noopener"><img width="869" alt="スクリーンショット 2019-11-19 17.45.43.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fbffe98cf-797d-c23e-c2ad-0ac967fe455b.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=67a3c3c9ccc926c3858c31a596035029" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/bffe98cf-797d-c23e-c2ad-0ac967fe455b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fbffe98cf-797d-c23e-c2ad-0ac967fe455b.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=523cb7dce1a3918d03df3d9b47175aa9 1x" loading="lazy"></a></p>\n\n<p>続いてPermissionsタブからパーミッションを作成します。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F15686165-b654-2791-600a-2c67d57ee968.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a830fd9b79dc14c36256eb7b7ad85164" target="_blank" rel="nofollow noopener"><img width="873" alt="スクリーンショット 2019-11-19 17.51.15.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F15686165-b654-2791-600a-2c67d57ee968.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a830fd9b79dc14c36256eb7b7ad85164" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/15686165-b654-2791-600a-2c67d57ee968.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F15686165-b654-2791-600a-2c67d57ee968.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=82cd1f0e7a3bf658603dec3a3cda3305 1x" loading="lazy"></a></p>\n\n<p>ユーザーにパーミッションを紐付けます。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F34847559-52f2-f101-8916-8b4eb30ea3fe.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a42e5844132f792cc7f1376e6fa75d1f" target="_blank" rel="nofollow noopener"><img width="868" alt="スクリーンショット 2019-11-19 17.43.20.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F34847559-52f2-f101-8916-8b4eb30ea3fe.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a42e5844132f792cc7f1376e6fa75d1f" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/34847559-52f2-f101-8916-8b4eb30ea3fe.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F34847559-52f2-f101-8916-8b4eb30ea3fe.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=1b73769216b2bef3318759275ee79dbd 1x" loading="lazy"></a></p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F34cfdf38-e9c1-7bf6-aa68-a0eee1ffae9b.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=49e2ce2d039d3b623aa61340646a53ba" target="_blank" rel="nofollow noopener"><img width="657" alt="スクリーンショット 2019-11-19 17.43.30.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F34cfdf38-e9c1-7bf6-aa68-a0eee1ffae9b.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=49e2ce2d039d3b623aa61340646a53ba" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/34cfdf38-e9c1-7bf6-aa68-a0eee1ffae9b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2F34cfdf38-e9c1-7bf6-aa68-a0eee1ffae9b.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=62cbddabc02e2e5aafb26152a4f0105f 1x" loading="lazy"></a></p>\n\n<p>それではページにアクセスしてみましょう。左端のドロワーからProtected Contentをクリックして表示されれば正常です。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fce76fee3-f1e9-45f6-0319-f55b459de3dd.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3d07a25449333540fbb23eeb8753c630" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fce76fee3-f1e9-45f6-0319-f55b459de3dd.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3d07a25449333540fbb23eeb8753c630" alt="drawer.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/ce76fee3-f1e9-45f6-0319-f55b459de3dd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fce76fee3-f1e9-45f6-0319-f55b459de3dd.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=67c16020a701eb93b184a21681ce1666 1x" loading="lazy"></a></p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fbd59d5df-3372-d0f1-b93a-dab56c4b7891.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=556de343e635448a0eed224e5fae5445" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fbd59d5df-3372-d0f1-b93a-dab56c4b7891.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=556de343e635448a0eed224e5fae5445" alt="protected.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/bd59d5df-3372-d0f1-b93a-dab56c4b7891.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F50147%2Fbd59d5df-3372-d0f1-b93a-dab56c4b7891.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=991afcca7e5871f6b944073039bb3408 1x" loading="lazy"></a></p>\n\n<p>Auth0のコンソールからパーミッションを削除するとページが表示されなくなるはずです。</p>\n\n<h1>\n<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>\n\n<p>ちなみに、nuxt公式のauthモジュールを使うとつらみを感じることなくauth0を組み込むことができます。ただ、authモジュールではトークンをlocalStorageに保存するのでイヤンと感じる方の役に立てれば幸いです。</p>\n\n<p>そのうちちゃんとモジュール化してGithubにあげます。多分。</p>\n',body:'# はじめに\n\n[auth0-spa-js](https://auth0.com/docs/libraries/auth0-spa-js)が7月にリリースされました。従来のJS向けSDKとして[auth0.js](https://auth0.com/docs/libraries/auth0js/v9)の代わりに、よりシンプルに認証を行うためのライブラリです。名前の通りSPA向けのライブラリで良い感じにログインしてくれます。\n\n2019年11月19日現在Vue用のサンプルコードは存在しているみたいです\n>https://auth0.com/docs/quickstart/spa/vuejs/01-login\n\nただ、このままnuxtで実装した場合generateする時にSSR関連で怒られたり、ミドルウェアでうまく使えなかったりするので辛いです。そこで、今回はnuxtウェイに乗っ取ってauth0-spa-jsを使ってみましょう。\n\n# つらみを取り除くためには\n\nはじめにでも述べた通り、auth0-spa-jsをnuxtで使うにあたって2つの辛みがあります。\n\n* generateする時に怒られる\n* ミドルウェアで使えない\n\nそれぞれの辛みを原因と解決方法を考えていきましょう。\n\n## generateする時に怒られる\n\nnuxtをSPAモードで使ってる限りは問題ないです。でもせっかくnuxtを使っているのであれば、SSR的なことしたいじゃないですか。SSRしなくてもLPを一緒のプロジェクトで管理してるならLPはちゃんとクローラーに拾ってもらいたいじゃないですか。ってなるとUniversalモードを使うことになるはずです。\n\nしかし、サンプルコードの実装だと`window`を参照しているので怒られます。今回は`process.client`で処理を切り分けて対応します。\n\n## ミドルウェアで使えない\n\nnuxtにはルーティング中に処理を挟み込むミドルウェアという機能があります。例えば、ユーザー情報ページはログインしていないとログインページにリダイレクトするなどの処理を挟みこめるので、認証・認可と相性が良いです。\n\nサンプルコードの実装の場合、auth0-spa-jsのインスタンスを非同期な`created`フックで生成しています。通常のVueコンポーネントであれば非同期`created`フックを待ってくれます。今回はサンプルコード的な働きをするものをプラグインとして実装しますが、こちらも非同期プラグインとして実装すればnuxtは待ってくれます。\n\n問題なのは、サンプルコードが同期プラグインの中で非同期`created`フックを含むVueインスタンスを作成していることです。\n\nこの場合、Vueインスタンス自体は即座に作成されます。このとき非同期`created`はキューに乗っているはずです。ただプラグイン自体は実行完了しているため、ミドルウェアに処理が移ります。しかし、ミドルウェアで生成したVueインスタンスの中の`created`フックで生成するインスタンスにアクセスすると`undefined`になることがあります。だって`created`フックが実行完了している保証がないですから。\n\n今回はログイン状態をVueインスタンスではなくVuexストアに保存して対応します。ちなみに、Vuexストアにアクセストークンは保存しちゃダメです。都度取得しましょう。auth0-spa-jsの実装を読む限りキャッシュされているようなので問題ないはずです。\n\n# 実装\n\nいよいよ実装です。ついでにRBACも実装しちゃいましょう。\nauth0側の手順は[公式サンプル](https://auth0.com/docs/quickstart/spa/vuejs/01-login)にしたがって準備をお願いします。\n\n## 下準備\n\nnuxtプロジェクトを作成しましょう。\n\n```shell\n$ npx create-nuxt-app auth0-spa-nuxt\ncreate-nuxt-app v2.11.1\n✨  Generating Nuxt.js project in auth0-spa-nuxt\n? Project name auth0-spa-nuxt\n? Project description My geometric Nuxt.js project\n? Author name Makoto Uju\n? Choose the package manager Npm\n? Choose UI framework Vuetify.js\n? Choose custom server framework None (Recommended)\n? Choose Nuxt.js modules Axios\n? Choose linting tools ESLint, Prettier\n? Choose test framework None\n? Choose rendering mode Universal (SSR)\n? Choose development tools jsconfig.json (Recommended for VS Code)\n```\n\n依存パッケージを追加します。\n\n```shell\n$ npm i --save jwt-decode lodash.intersection lodash.merge\n$ npm i --save-dev @nuxtjs/dotenv\n```\n\ndotenvモジュールの初期設定をします。\n\n```javascript:nuxt.config.js\nimport colors from \'vuetify/es5/util/colors\'\nimport dotenv from \'dotenv\' // dotenvロード\n\ndotenv.config() // dotenv初期化\n\nexport default {\n  ...\n  buildModules: [\n    // Doc: https://github.com/nuxt-community/eslint-module\n    \'@nuxtjs/eslint-module\',\n    \'@nuxtjs/vuetify\',\n    \'@nuxtjs/dotenv\' // dotenvモジュール読み込み\n  ],\n  ...\n  build: {\n    extend(config, ctx) {\n      config.node = {\n        fs: \'empty\' // fsがないと怒られるので追加\n      }\n    }\n  },\n}\n\n```\n\n## Vuex実装\n\nまず、Vuexを実装します。シンプルにサンプルコードの`data`と同じもの＋RBAC用に`permissions`が入ります。\n\n```javascript:store/auth0.js\nexport const state = () => ({\n  loading: true,\n  isAuthenticated: false,\n  user: {},\n  popupOpen: false,\n  permissions: []\n})\n\nexport const mutations = {\n  setPopupOpen(state, payload) {\n    state.popupOpen = !!payload\n  },\n  setUser(state, payload) {\n    state.user = payload\n  },\n  setIsAuthenticated(state, payload) {\n    state.isAuthenticated = !!payload\n  },\n  setLoading(state, payload) {\n    state.loading = !!payload\n  },\n  setPermissions(state, payload) {\n    state.permissions = payload\n  }\n}\n```\n\n## プラグイン実装\n\n基本的に全てのロジックが入ります。Vueインスタンスを生成する箇所において`process.client`によって処理を分岐させます。SSR時はモックが返却されるので問題なくSSRできます。\n\n生成したVueインスタンスは[`inject`メソッド](https://ja.nuxtjs.org/guide/plugins/#%E7%B5%B1%E5%90%88%E3%81%95%E3%82%8C%E3%81%9F%E6%B3%A8%E5%85%A5)で包括的に注入します。vuexやコンテキストなどにまとめて注入してくれるので便利です。\n\nあと、`const $auth0 = await useAuth0(context.store, options)`で`store`を渡しています。nuxtのVueインスタンスでは`this.$store`でVuexにアクセスできるはずです。しかし、それはnuxtがいい感じに注入してくれているからできることで、今回のようにピュアなVueインスタンスを生成した場合注入されません。よって、意図的にVuexストアを渡すようにしています。\n\nちなみに例外は全て呼び出し元に戻るはずです。あとでちゃんとハンドルしましょう。\n\n```javascript:plugins/auth0.js\nimport Vue from \'vue\'\nimport createAuth0Client from \'@auth0/auth0-spa-js\'\nimport jwtDecode from \'jwt-decode\'\nimport nuxtConfig from \'~/nuxt.config\'\n\n// eslint-disable-next-line prefer-const\nlet instance = null\n\nconst useAuth0 = async (store, { onRedirectCallback, ...options }) => {\n  if (process.client) {\n    if (!instance) {\n      const auth0Client = await createAuth0Client({\n        domain: options.domain,\n        client_id: options.clientId,\n        audience: options.audience,\n        scope: options.scope,\n        redirect_uri: window.location.origin\n      })\n\n      instance = new Vue({\n        data() {\n          return {\n            auth0Client: null,\n            error: null\n          }\n        },\n        async created() {\n          this.auth0Client = auth0Client\n\n          if (\n            // eslint-disable-next-line nuxt/no-globals-in-created\n            window.location.search.includes(\'code=\') &&\n            // eslint-disable-next-line nuxt/no-globals-in-created\n            window.location.search.includes(\'state=\')\n          ) {\n            try {\n              const { appState } = await this.handleRedirectCallback()\n              onRedirectCallback(appState)\n            } catch (e) {\n              this.error = e\n            }\n          } else {\n            await this.load()\n          }\n        },\n        methods: {\n          async loginWithPopup(options) {\n            store.commit(\'auth0/setPopupOpen\', true)\n\n            try {\n              await this.auth0Client.loginWithPopup(options)\n            } finally {\n              store.commit(\'auth0/setPopupOpen\', false)\n            }\n\n            store.commit(\'auth0/setUser\', await this.auth0Client.getUser())\n            store.commit(\'auth0/setIsAuthenticated\', true)\n          },\n          loginWithRedirect(options) {\n            return this.auth0Client.loginWithRedirect(options)\n          },\n          logout(options) {\n            this.auth0Client.logout(options)\n            store.commit(\'auth0/setIsAuthenticated\', false)\n          },\n          getTokenSilently(options) {\n            return this.auth0Client.auth0Client.getTokenSilently(options)\n          },\n          async getTokenWithPopup(options) {\n            store.commit(\'auth0/setPopupOpen\', true)\n\n            try {\n              const token = await this.auth0Client.getTokenWithPopup(options)\n              return token\n            } finally {\n              store.commit(\'auth0/setPopupOpen\', false)\n            }\n          },\n          async handleRedirectCallback() {\n            const result = await this.auth0Client.handleRedirectCallback()\n\n            await this.load()\n\n            return result\n          },\n          async load() {\n            store.commit(\n              \'auth0/setIsAuthenticated\',\n              await this.auth0Client.isAuthenticated()\n            )\n\n            const isAuthenticated = await this.auth0Client.getUser()\n            store.commit(\'auth0/setUser\', isAuthenticated)\n\n            if (isAuthenticated) {\n              const token = await this.auth0Client.getTokenSilently()\n              store.commit(\n                \'auth0/setPermissions\',\n                jwtDecode(token).permissions || []\n              )\n            }\n          }\n        }\n      })\n    }\n\n    return instance\n  } else {\n    return new Vue({\n      data() {\n        return {\n          auth0Client: null,\n          error: null\n        }\n      }\n    })\n  }\n}\n\nexport default async function(context, inject) {\n  const options = {\n    ...nuxtConfig.auth0,\n    onRedirectCallback: (appState) => {\n      context.app.router.push(\n        appState && appState.targetUrl\n          ? appState.targetUrl\n          : window.location.pathname\n      )\n    }\n  }\n\n  const $auth0 = await useAuth0(context.store, options)\n\n  inject(\'auth0\', $auth0)\n}\n```\n\n## ミドルウェアの実装\n\nアクセス制御をするためにミドルウェアを実装しましょう。各ページごとに必要なパーミッションを定義したいので、クロージャにします。\n\n```javascript:middleware/auth.js\nimport intersection from \'lodash/intersection\'\nimport merge from \'lodash/merge\'\n\nexport default {\n  protect(options) {\n    options = merge({ loginRequired: true, requiredPermissions: [] }, options)\n\n    return ({ app, redirect, store }) => {\n      if (options.loginRequired && !store.state.auth0.isAuthenticated) {\n        return redirect(\'/\')\n      }\n\n      if (options.loginRequired && options.requiredPermissions.length > 0) {\n        if (\n          intersection(\n            options.requiredPermissions,\n            store.state.auth0.permissions\n          ).length !== options.requiredPermissions.length\n        ) {\n          return redirect(\'/\')\n        }\n      }\n    }\n  }\n}\n```\n\n## トップページの実装\n\nいよいよトップページの実装です。ログイン状態はVuexストアを見ればわかります。癖のないコードのはずなので説明はスキップします。\n\n```vue:pages/index.js\n<template>\n  <v-container>\n    <v-row justify="center">\n      <v-col cols="12" sm="8">\n        <v-card v-if="isAuthenticated">\n          <v-card-text>\n            <div class="text-center py-3">\n              <v-avatar size="100">\n                <img :src="user.picture"/>\n              </v-avatar>\n            </div>\n\n            <p class="display-1 text--primary text-center">\n              {{ user.name }}\n            </p>\n\n            <v-simple-table>\n              <template>\n                <thead>\n                  <tr>\n                    <th class="text-left">Key</th>\n                    <th class="text-left">Value</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for="(value, key) in user" :key="key">\n                    <td>{{ key }}</td>\n                    <td>{{ value }}</td>\n                  </tr>\n                </tbody>\n              </template>\n            </v-simple-table>\n          </v-card-text>\n\n          <v-card-actions>\n            <div class="mb-3 mx-auto">\n              <v-btn class="" @click="logout">\n                LOGOUT\n              </v-btn>\n            </div>\n          </v-card-actions>\n        </v-card>\n\n        <v-card v-else>\n          <v-card-text>\n            <div class="text-center">\n              <p class="display-1 text--primary text-center">\n                Please login.\n              </p>\n            </div>\n          </v-card-text>\n          <v-card-actions>\n            <div class="mb-3 mx-auto">\n              <v-btn class="" @click="login">\n                LOGIN\n              </v-btn>\n            </div>\n          </v-card-actions>\n        </v-card>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script>\nimport { mapState } from \'vuex\'\n\nexport default {\n  computed: {\n    ...mapState(\'auth0\', [\'user\', \'isAuthenticated\'])\n  },\n  methods: {\n    login() {\n      this.$auth0.loginWithRedirect()\n    },\n    logout() {\n      this.$auth0.logout({ returnTo: location.href })\n    }\n  }\n}\n<\/script>\n```\n\n## 保護されたページの実装\n\nログインや適切なパーミッションを必要とするページを実装します。先ほど実装したミドルウェアを呼び出し、関数を生成しています。オプションで必要なパーミッションを渡すことでRBACを実現します。\n\nSSR時はVuexストアが初期状態（未ログイン・パーミッションなし）なので、保護されたページに直接アクセスされても正常にリダイレクトできるはずです。\n\n```vue:pages/protected.vue\n<template>\n  <v-layout>\n    <v-flex class="text-center">\n      <v-alert type="warning" icon="mdi-lock">\n        Protected Content\n      </v-alert>\n    </v-flex>\n  </v-layout>\n</template>\n\n<script>\nimport authMiddleware from \'~/middleware/auth\'\n\nexport default {\n  // RBACする場合\n  middleware: authMiddleware.protect({\n    requiredPermissions: [\'sample\']\n  })\n  // ログインのみを必要とする場合は以下のように書く\n  // middleware: authMiddleware.protect()\n}\n<\/script>\n```\n\n## 設定する\n\ndotenvを使います。ちなみにauth0はaudienceを渡さないとアクセストークンがJWTで吐かれないので注意しましょう。また、`getTokenSilently`を使うので`offline_access`をスコープに設定します。\n\n```javascript:nuxt.config.js\nexport default {\n  ...\n  auth0: {\n    domain: process.env.AUTH0_DOMAIN,\n    clientId: process.env.AUTH0_CLIENT_ID,\n    audience: process.env.AUTH0_AUDIENCE,\n    scope: process.env.AUTH0_SCOPE\n  }\n}\n```\n\n```text:.env\nAUTH0_DOMAIN = "example.auth0.com"\nAUTH0_CLIENT_ID = "SAmpleCl1endId"\nAUTH0_AUDIENCE = "https://example.com"\nAUTH0_SCOPE = "offline_access"\n```\n\nまた、メニューにリンクを登録します。\n\n```javascript:layouts/default.vue\n...\n<script>\nexport default {\n  data() {\n    return {\n      clipped: false,\n      drawer: false,\n      fixed: false,\n      items: [\n        {\n          icon: \'mdi-apps\',\n          title: \'Welcome\',\n          to: \'/\'\n        },\n        {\n          icon: \'mdi-chart-bubble\',\n          title: \'Inspire\',\n          to: \'/inspire\'\n        },\n        {\n          icon: \'mdi-lock\',\n          title: \'Protected Content\',\n          to: \'/protected\'\n        }\n      ],\n      miniVariant: false,\n      right: true,\n      rightDrawer: false,\n      title: \'Vuetify.js\'\n    }\n  }\n}\n<\/script>\n```\n\n# 実行してみる\n\n実行しましょう。devサーバーを立ち上げて、localhost:3000にアクセスします。\n\n```shell\n$ npm run dev\n```\n![not-logged-in.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/9e2bcd32-ffd0-2f86-1cde-3c1779102ba4.png)\n\nログインしましょう。\n\n<img width="852" alt="スクリーンショット 2019-11-19 17.42.52.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/7ca50bed-8d4a-a287-a1b9-a2eb23ef75b3.png">\n\n<img width="850" alt="スクリーンショット 2019-11-19 17.41.11.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/c4b595c4-8d7a-5f26-385e-cd3e0cec9e3c.png">\n\nユーザー情報が表示されれば成功です。\n\n<img width="851" alt="スクリーンショット 2019-11-19 17.41.23.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/2fa88c64-c957-6f33-b8c9-9a7e3e88eb5a.png">\n\n## RBACをためす\n\nではRBACを確認しましょう。まず、Auth0のAPIsからRBACを有効化します。`Add Permissions in the Access Token`を忘れずに。\n\n<img width="869" alt="スクリーンショット 2019-11-19 17.45.43.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/bffe98cf-797d-c23e-c2ad-0ac967fe455b.png">\n\n続いてPermissionsタブからパーミッションを作成します。\n\n<img width="873" alt="スクリーンショット 2019-11-19 17.51.15.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/15686165-b654-2791-600a-2c67d57ee968.png">\n\nユーザーにパーミッションを紐付けます。\n\n<img width="868" alt="スクリーンショット 2019-11-19 17.43.20.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/34847559-52f2-f101-8916-8b4eb30ea3fe.png">\n\n<img width="657" alt="スクリーンショット 2019-11-19 17.43.30.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/34cfdf38-e9c1-7bf6-aa68-a0eee1ffae9b.png">\n\nそれではページにアクセスしてみましょう。左端のドロワーからProtected Contentをクリックして表示されれば正常です。\n\n![drawer.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/ce76fee3-f1e9-45f6-0319-f55b459de3dd.png)\n\n![protected.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/50147/bd59d5df-3372-d0f1-b93a-dab56c4b7891.png)\n\nAuth0のコンソールからパーミッションを削除するとページが表示されなくなるはずです。\n\n# おわりに\n\nちなみに、nuxt公式のauthモジュールを使うとつらみを感じることなくauth0を組み込むことができます。ただ、authモジュールではトークンをlocalStorageに保存するのでイヤンと感じる方の役に立てれば幸いです。\n\n<small>そのうちちゃんとモジュール化してGithubにあげます。多分。</small>\n',coediting:a,comments_count:0,created_at:q,group:n,id:"d95e62ebeb74ddfc88cc",likes_count:4,private:a,reactions_count:0,tags:[{name:d,versions:[]},{name:l,versions:[]},{name:"Auth0",versions:[]},{name:"Vuex",versions:[]},{name:e,versions:[]}],title:"auth0-spa-jsをnuxt流に使ってみる",updated_at:q,url:"https://qiita.com/ainehanta/items/d95e62ebeb74ddfc88cc",user:{description:s,facebook_id:s,followees_count:22,followers_count:17,github_login_name:h,id:h,items_count:8,linkedin_id:s,location:s,name:"Makoto Uju",organization:s,permanent_id:50147,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/50147/profile-images/1541430935",team_only:a,twitter_screen_name:h,website_url:"http://ujyu.net"},page_views_count:n},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p><code>Nuxt.js</code> で作成した業務用のWebアプリを、S3の <code>Static website hosting</code> で運用しているのですが、個人メンテナンス &amp; 更新頻度が少ないといった理由で、1.手元で <code>yarn generate</code> → 2.手動でS3にアップロード → 3.手動で全ファイルを公開、というひどい運用をしていました。<br>\nそこで、先日正式リリースされたGithub Actionsを使って、自動デプロイの環境を整えたのでその備忘録です。<br>\n<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/f2399c6f-6fd4-fbfb-bab7-c0b41f2e5f01.gif" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/f2399c6f-6fd4-fbfb-bab7-c0b41f2e5f01.gif" alt="deploy.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/f2399c6f-6fd4-fbfb-bab7-c0b41f2e5f01.gif" loading="lazy"></a></p>\n\n<h1>\n<span id="自動デプロイの手順" class="fragment"></span><a href="#%E8%87%AA%E5%8B%95%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%AE%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>自動デプロイの手順</h1>\n\n<ol>\n<li>Githubの <code>release</code> ブランチへのプッシュをトリガーにGithub Actionsを実行</li>\n<li>\n<code>release</code> ブランチをチェックアウト</li>\n<li>\n<code>python</code> のセットアップ</li>\n<li>\n<code>awscli</code> のインストール</li>\n<li>\n<code>nuxt</code> のビルド</li>\n<li>生成ファイル <code>dist</code> をS3にコピー</li>\n<li>完了をSlackに通知</li>\n</ol>\n\n<h1>\n<span id="全体の構成" class="fragment"></span><a href="#%E5%85%A8%E4%BD%93%E3%81%AE%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>全体の構成</h1>\n\n<p>実際に使用した設定ファイルを載せ、それぞれについて簡単に説明していきます。<br>\n基本的には初期テンプレートの <code>Node.js</code> および <code>python package</code> を参考にしています。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F4fcb79b2-8c01-b852-d5f0-e66b3cb150f4.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ff26eac42e229cd39c283f7b58caba5a" target="_blank" rel="nofollow noopener"><img width="1294" alt="tempate.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F4fcb79b2-8c01-b852-d5f0-e66b3cb150f4.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ff26eac42e229cd39c283f7b58caba5a" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/4fcb79b2-8c01-b852-d5f0-e66b3cb150f4.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F4fcb79b2-8c01-b852-d5f0-e66b3cb150f4.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=8ed674c1c49be9e068c01226f1fafbd3 1x" loading="lazy"></a><br>\nまた、yamlの書き方とslackへの通知方法は下記記事を参考にさせていただきました。<br>\n参考：<a href="https://qiita.com/homines22/items/af96baa6ba51b1d59124" id="reference-b74ec879ae43a51d48b5">【GitHub】新GitHub Actionsを使ってAWS ECRにイメージをプッシュするCIを作ってみた</a><br>\n参考：<a href="https://qiita.com/homines22/items/412d4e81b24804d75205" id="reference-965af93c81996429933c">GitHub Actionsを使ってAWS Lambdaへ自動デプロイ (詳説＋デモ手順付きver)</a></p>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Auto Deploy to AWS S3</span>\n\n<span class="na">on</span><span class="pi">:</span>\n  <span class="na">push</span><span class="pi">:</span>\n    <span class="na">branches</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="s">release</span>\n\n<span class="na">jobs</span><span class="pi">:</span>\n  <span class="na">deploy</span><span class="pi">:</span>\n    <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>\n\n    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>\n\n    <span class="na">steps</span><span class="pi">:</span>\n    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>\n\n    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Python 3.7 for awscli</span>\n      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v1</span>\n      <span class="na">with</span><span class="pi">:</span>\n        <span class="na">version</span><span class="pi">:</span> <span class="s1">\'</span><span class="s">3.7\'</span>\n        <span class="na">architecture</span><span class="pi">:</span> <span class="s1">\'</span><span class="s">x64\'</span>\n\n    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install awscli</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="s">pip install --upgrade pip awscli</span>\n\n    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>\n        <span class="s">yarn install</span>\n        <span class="s">yarn generate</span>\n\n    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Copy to s3</span>\n      <span class="na">env</span><span class="pi">:</span>\n        <span class="na">AWS_ACCESS_KEY_ID</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_ACCESS_KEY_ID }}</span>\n        <span class="na">AWS_SECRET_ACCESS_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="s">aws s3 cp ./dist ${{ secrets.S3_UPLOAD_PATH }} --recursive --acl public-read</span>\n\n    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Notify to Slack</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="s">curl -X POST -H \'Content-type:application/json\' --data \'{"text":"\'"${GITHUB_REPOSITORY}"\'\\n【Deploy Success】"}\' ${{ secrets.SLACK_WEBHOOK }}</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="デプロイ手順とyamlの対応" class="fragment"></span><a href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%89%8B%E9%A0%86%E3%81%A8yaml%E3%81%AE%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>デプロイ手順とyamlの対応</h1>\n\n<h2>\n<span id="1-特定ブランチへのプッシュをトリガーにgithub-actionsを実行" class="fragment"></span><a href="#1-%E7%89%B9%E5%AE%9A%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%B8%E3%81%AE%E3%83%97%E3%83%83%E3%82%B7%E3%83%A5%E3%82%92%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E3%81%ABgithub-actions%E3%82%92%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>1. 特定ブランチへのプッシュをトリガーにGithub Actionsを実行</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre><span class="na">on</span><span class="pi">:</span>\n  <span class="na">push</span><span class="pi">:</span>\n    <span class="na">branches</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="s">release</span>\n</pre></div>\n</div>\n\n<p>push以外にも様々なトリガーを設定することができます。<br>\n参考：<a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/events-that-trigger-workflows" rel="nofollow noopener" target="_blank">Events that trigger workflows</a></p>\n\n<h2>\n<span id="2-プッシュしたブランチをチェックアウト" class="fragment"></span><a href="#2-%E3%83%97%E3%83%83%E3%82%B7%E3%83%A5%E3%81%97%E3%81%9F%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>2. プッシュしたブランチをチェックアウト</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre>    <span class="na">steps</span><span class="pi">:</span>\n    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>\n</pre></div>\n</div>\n\n<p><code>uses: actions/hogehoge</code> は公式が用意しているアクションになります。<br>\n参考：<a href="https://github.com/actions/" rel="nofollow noopener" target="_blank">GitHub Actions</a></p>\n\n<h2>\n<span id="3-pythonのセットアップ" class="fragment"></span><a href="#3-python%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>3. pythonのセットアップ</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Python 3.7 for awscli</span>\n      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v1</span>\n      <span class="na">with</span><span class="pi">:</span>\n        <span class="na">version</span><span class="pi">:</span> <span class="s1">\'</span><span class="s">3.7\'</span>\n        <span class="na">architecture</span><span class="pi">:</span> <span class="s1">\'</span><span class="s">x64\'</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="4-awscliのインストール" class="fragment"></span><a href="#4-awscli%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>4. awscliのインストール</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install awscli</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="s">pip install --upgrade pip awscli</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="5-nuxtのビルド" class="fragment"></span><a href="#5-nuxt%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89"><i class="fa fa-link"></i></a>5. nuxtのビルド</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>\n        <span class="s">yarn install</span>\n        <span class="s">yarn generate</span>\n</pre></div>\n</div>\n\n<p>複数行のコマンドは <code>run |</code> の下に続けて書くことができます。<br>\n<code>yarn generate</code> により、Webページの静的ファイルが <code>dist</code> に生成されます。</p>\n\n<h2>\n<span id="6-生成ファイルdistをs3にコピー" class="fragment"></span><a href="#6-%E7%94%9F%E6%88%90%E3%83%95%E3%82%A1%E3%82%A4%E3%83%ABdist%E3%82%92s3%E3%81%AB%E3%82%B3%E3%83%94%E3%83%BC"><i class="fa fa-link"></i></a>6. 生成ファイルdistをS3にコピー</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Copy to s3</span>\n      <span class="na">env</span><span class="pi">:</span>\n        <span class="na">AWS_ACCESS_KEY_ID</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_ACCESS_KEY_ID }}</span>\n        <span class="na">AWS_SECRET_ACCESS_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.AWS_SECRET_ACCESS_KEY }}</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="s">aws s3 cp ./dist ${{ secrets.S3_UPLOAD_PATH }} --recursive --acl public-read</span>\n</pre></div>\n</div>\n\n<p>事前に<code>awscli</code> でS3にアップロードするために必要な権限を持つユーザーを作成し、そのアクセスキーIDとシークレトキーIDを使用してアップロードします。<br>\n<code>env</code> の環境変数にそれらのキーIDを設定できますが、セキュリティ上yamlに載せるのが適切でないものについては、Githubの <code>Setting → Secrets</code> に事前に登録しておくと、 <code>${{ secrets.HOGEHOGE }}</code> で取得することができます。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F858a1e41-35a1-aeb1-7504-19e72d599ae1.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=70c0cefc6c721f756843b5e06c8dd55d" target="_blank" rel="nofollow noopener"><img width="992" alt="secrets.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F858a1e41-35a1-aeb1-7504-19e72d599ae1.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=70c0cefc6c721f756843b5e06c8dd55d" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/858a1e41-35a1-aeb1-7504-19e72d599ae1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F858a1e41-35a1-aeb1-7504-19e72d599ae1.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=30761062eee79b9900d80bbac8f1889c 1x" loading="lazy"></a><br>\nアップロードは <code>aws s3 cp</code> コマンドを実行するだけですが、そのままWebで公開できるよう <code>--acl public-read</code> オプションを追加しています。</p>\n\n<h2>\n<span id="7-完了をslackに通知" class="fragment"></span><a href="#7-%E5%AE%8C%E4%BA%86%E3%82%92slack%E3%81%AB%E9%80%9A%E7%9F%A5"><i class="fa fa-link"></i></a>7. 完了をSlackに通知</h2>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">deploy.yaml</span></div>\n<div class="highlight"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Notify to Slack</span>\n      <span class="na">run</span><span class="pi">:</span> <span class="s">curl -X POST -H \'Content-type:application/json\' --data \'{"text":"\'"${GITHUB_REPOSITORY}"\'\\n【Deploy Success】"}\' ${{ secrets.SLACK_WEBHOOK }}</span>\n</pre></div>\n</div>\n\n<p>curlで直接 <code>Incoming Webhooks</code> のURLにJSONペイロードを送信します。<br>\n通知先のチャンネルとURLはSlack側で事前に確認しておきます。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F0fc2285b-cb30-910a-909f-aeec88296fe9.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=45a2c0e373fb750a22ebedccdf04ca0f" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F0fc2285b-cb30-910a-909f-aeec88296fe9.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=45a2c0e373fb750a22ebedccdf04ca0f" alt="slack.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/0fc2285b-cb30-910a-909f-aeec88296fe9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2F0fc2285b-cb30-910a-909f-aeec88296fe9.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=44309bfc63df5f7eb81b66783f703b41 1x" loading="lazy"></a><br>\n↓通知結果↓<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2Fd5b9256a-f22b-77d2-43e7-b3a2c5658301.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=fe97d199699634731d5f0e1a28427908" target="_blank" rel="nofollow noopener"><img width="293" alt="webhock.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2Fd5b9256a-f22b-77d2-43e7-b3a2c5658301.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=fe97d199699634731d5f0e1a28427908" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/d5b9256a-f22b-77d2-43e7-b3a2c5658301.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F265206%2Fd5b9256a-f22b-77d2-43e7-b3a2c5658301.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=c0f3080378a95be9452ed30c682a7f72 1x" loading="lazy"></a></p>\n\n<p>また、通知の内容や装飾は下記記事を参考に調整すると良いと思います。<br>\n参考：<a href="https://qiita.com/ik-fib/items/b4a502d173a22b3947a0" id="reference-fc0938ba98d6aec1aec2">SlackのIncoming Webhooksを使い倒す</a></p>\n\n<h1>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>\n\n<p>Github Actionsが正式リリースされたので使ってみたところ、非常に簡単に自動デプロイの環境を整えることができました。<br>\n本記事は私が実際に使用した内容の説明のみとなりますが、今後はテストなども追加したちゃんとしたCI/CD環境を整えたらまた記事にします。</p>\n',body:'# はじめに\n`Nuxt.js` で作成した業務用のWebアプリを、S3の `Static website hosting` で運用しているのですが、個人メンテナンス & 更新頻度が少ないといった理由で、1.手元で `yarn generate` → 2.手動でS3にアップロード → 3.手動で全ファイルを公開、というひどい運用をしていました。\nそこで、先日正式リリースされたGithub Actionsを使って、自動デプロイの環境を整えたのでその備忘録です。\n![deploy.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/f2399c6f-6fd4-fbfb-bab7-c0b41f2e5f01.gif)\n\n# 自動デプロイの手順\n1. Githubの `release` ブランチへのプッシュをトリガーにGithub Actionsを実行\n2. `release` ブランチをチェックアウト\n3. `python` のセットアップ\n4. `awscli` のインストール\n5. `nuxt` のビルド\n6. 生成ファイル `dist` をS3にコピー\n7. 完了をSlackに通知\n\n# 全体の構成\n実際に使用した設定ファイルを載せ、それぞれについて簡単に説明していきます。\n基本的には初期テンプレートの `Node.js` および `python package` を参考にしています。\n<img width="1294" alt="tempate.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/4fcb79b2-8c01-b852-d5f0-e66b3cb150f4.png">\nまた、yamlの書き方とslackへの通知方法は下記記事を参考にさせていただきました。\n参考：[【GitHub】新GitHub Actionsを使ってAWS ECRにイメージをプッシュするCIを作ってみた](https://qiita.com/homines22/items/af96baa6ba51b1d59124)\n参考：[GitHub Actionsを使ってAWS Lambdaへ自動デプロイ (詳説＋デモ手順付きver)](https://qiita.com/homines22/items/412d4e81b24804d75205)\n\n```deploy.yaml\nname: Auto Deploy to AWS S3\n\non:\n  push:\n    branches:\n      - release\n\njobs:\n  deploy:\n    name: Deploy\n\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/checkout@v1\n\n    - name: Setup Python 3.7 for awscli\n      uses: actions/setup-python@v1\n      with:\n        version: \'3.7\'\n        architecture: \'x64\'\n\n    - name: Install awscli\n      run: pip install --upgrade pip awscli\n\n    - name: Build\n      run: |\n        yarn install\n        yarn generate\n\n    - name: Copy to s3\n      env:\n        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}\n        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n      run: aws s3 cp ./dist ${{ secrets.S3_UPLOAD_PATH }} --recursive --acl public-read\n\n    - name: Notify to Slack\n      run: curl -X POST -H \'Content-type:application/json\' --data \'{"text":"\'"${GITHUB_REPOSITORY}"\'\\n【Deploy Success】"}\' ${{ secrets.SLACK_WEBHOOK }}\n```\n\n# デプロイ手順とyamlの対応\n## 1. 特定ブランチへのプッシュをトリガーにGithub Actionsを実行\n```deploy.yaml\non:\n  push:\n    branches:\n      - release\n```\npush以外にも様々なトリガーを設定することができます。\n参考：[Events that trigger workflows](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/events-that-trigger-workflows)\n\n## 2. プッシュしたブランチをチェックアウト\n```deploy.yaml\n    steps:\n    - uses: actions/checkout@v1\n```\n`uses: actions/hogehoge` は公式が用意しているアクションになります。\n参考：[GitHub Actions](https://github.com/actions/)\n\n## 3. pythonのセットアップ\n```deploy.yaml\n    - name: Setup Python 3.7 for awscli\n      uses: actions/setup-python@v1\n      with:\n        version: \'3.7\'\n        architecture: \'x64\'\n```\n\n## 4. awscliのインストール\n```deploy.yaml\n    - name: Install awscli\n      run: pip install --upgrade pip awscli\n```\n\n## 5. nuxtのビルド\n```deploy.yaml\n    - name: Build\n      run: |\n        yarn install\n        yarn generate\n```\n複数行のコマンドは `run |` の下に続けて書くことができます。\n`yarn generate` により、Webページの静的ファイルが `dist` に生成されます。\n\n\n## 6. 生成ファイルdistをS3にコピー\n```deploy.yaml\n    - name: Copy to s3\n      env:\n        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}\n        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n      run: aws s3 cp ./dist ${{ secrets.S3_UPLOAD_PATH }} --recursive --acl public-read\n```\n事前に`awscli` でS3にアップロードするために必要な権限を持つユーザーを作成し、そのアクセスキーIDとシークレトキーIDを使用してアップロードします。\n`env` の環境変数にそれらのキーIDを設定できますが、セキュリティ上yamlに載せるのが適切でないものについては、Githubの `Setting → Secrets` に事前に登録しておくと、 `${{ secrets.HOGEHOGE }}` で取得することができます。\n<img width="992" alt="secrets.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/858a1e41-35a1-aeb1-7504-19e72d599ae1.png">\nアップロードは `aws s3 cp` コマンドを実行するだけですが、そのままWebで公開できるよう `--acl public-read` オプションを追加しています。\n\n## 7. 完了をSlackに通知\n```deploy.yaml\n    - name: Notify to Slack\n      run: curl -X POST -H \'Content-type:application/json\' --data \'{"text":"\'"${GITHUB_REPOSITORY}"\'\\n【Deploy Success】"}\' ${{ secrets.SLACK_WEBHOOK }}\n```\ncurlで直接 `Incoming Webhooks` のURLにJSONペイロードを送信します。\n通知先のチャンネルとURLはSlack側で事前に確認しておきます。\n![slack.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/0fc2285b-cb30-910a-909f-aeec88296fe9.png)\n↓通知結果↓\n<img width="293" alt="webhock.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/d5b9256a-f22b-77d2-43e7-b3a2c5658301.png">\n\nまた、通知の内容や装飾は下記記事を参考に調整すると良いと思います。\n参考：[SlackのIncoming Webhooksを使い倒す](https://qiita.com/ik-fib/items/b4a502d173a22b3947a0)\n\n# まとめ\nGithub Actionsが正式リリースされたので使ってみたところ、非常に簡単に自動デプロイの環境を整えることができました。\n本記事は私が実際に使用した内容の説明のみとなりますが、今後はテストなども追加したちゃんとしたCI/CD環境を整えたらまた記事にします。\n',coediting:a,comments_count:0,created_at:"2019-11-19T17:34:10+09:00",group:n,id:"23c679eec04f19815e81",likes_count:4,private:a,reactions_count:0,tags:[{name:C,versions:[]},{name:"AWS",versions:[]},{name:"Slack",versions:[]},{name:e,versions:[]},{name:"GitHubActions",versions:[]}],title:"GitHub Actionsを使ってnuxt.jsで作成した静的WebページをS3に自動デプロイする",updated_at:"2019-11-19T17:50:02+09:00",url:"https://qiita.com/1pp0/items/23c679eec04f19815e81",user:{description:s,facebook_id:s,followees_count:3,followers_count:2,github_login_name:n,id:"1pp0",items_count:4,linkedin_id:s,location:s,name:s,organization:s,permanent_id:265206,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/265206/profile-images/1565167303",team_only:a,twitter_screen_name:n,website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="モーダルコンポーネントを作る" class="fragment"></span><a href="#%E3%83%A2%E3%83%BC%E3%83%80%E3%83%AB%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>モーダルコンポーネントを作る</h1>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;transition</span> <span class="na">name=</span><span class="s">"modal"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-mask"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"closeModal"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-wrapper"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-container"</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="nt">&gt;</span>\n          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modal-contents"</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;slot&gt;&lt;/slot&gt;</span>\n          <span class="nt">&lt;/div&gt;</span>\n        <span class="nt">&lt;/div&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/transition&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">TheModal</span><span class="dl">"</span><span class="p">,</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">closeModal</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">closeModal</span><span class="dl">"</span><span class="p">);</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">style</span> <span class="na">scoped</span><span class="nt">&gt;</span>\n<span class="err">省略</span>\n<span class="nt">&lt;/</span><span class="k">style</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p>ソースコードは<a href="https://github.com/taakuuyaa/Nuxt-sample-modal/blob/master/pages/index.vue" rel="nofollow noopener" target="_blank">こちら</a></p>\n\n<p>pageコンポーネントのtemplateで以下のように呼び出し</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;TheModal</span> <span class="na">v-show=</span><span class="s">"showModal"</span> <span class="err">@</span><span class="na">closeModal=</span><span class="s">"showModal = false"</span><span class="nt">&gt;</span>\n モーダル\n<span class="nt">&lt;/TheModal&gt;</span>\n</pre></div></div>\n\n<h2>\n<span id="結果" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>結果</h2>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F288728%2F4cae0701-d9cd-a4cd-6731-f8e8b02e4cb8.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3c850210437357d1193814195278215f" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F288728%2F4cae0701-d9cd-a4cd-6731-f8e8b02e4cb8.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3c850210437357d1193814195278215f" alt="スクリーンショット 2019-11-19 15.59.08.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288728/4cae0701-d9cd-a4cd-6731-f8e8b02e4cb8.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F288728%2F4cae0701-d9cd-a4cd-6731-f8e8b02e4cb8.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=2aff6f7a1aebdc9807ac026a7c58a597 1x" loading="lazy"></a></p>\n\n<p>しかし、このままだとモーダルを表示した状態でも後をスクロールすることができてしまう。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F288728%2Fd1151218-503d-27b5-a72f-ede869483214.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=847801ed50ad48d61092ff559f4550bc" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F288728%2Fd1151218-503d-27b5-a72f-ede869483214.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=847801ed50ad48d61092ff559f4550bc" alt="スクリーンショット 2019-11-19 16.09.20.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288728/d1151218-503d-27b5-a72f-ede869483214.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F288728%2Fd1151218-503d-27b5-a72f-ede869483214.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=0c00d2bd9af99de6d9cd9acdedb37b09 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="解決方法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>解決方法</h1>\n\n<p>モーダルが表示されているときにbodyタグに以下のクラスを付与する。</p>\n\n<div class="code-frame" data-lang="css"><div class="highlight"><pre><span class="nt">modal-body</span> <span class="p">{</span>\n  <span class="nl">overflow-y</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>\n  <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<p>bodyにクラスを付与するために<strong>グローバルに読み込まれているCSS</strong>などに上のクラスを定義しておく。</p>\n\n<p>ページコンポーネントの<strong>head()</strong>に以下を設定する</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">Logo</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">~/components/Logo</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">TheModal</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">~/components/TheModal</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">Logo</span><span class="p">,</span>\n    <span class="nx">TheModal</span>\n  <span class="p">},</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">showModal</span><span class="p">:</span> <span class="kc">false</span>\n    <span class="p">};</span>\n  <span class="p">}</span>\n  <span class="c1">//　↓追加↓</span>\n  <span class="nx">head</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">bodyAttrs</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">class</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">showModal</span> <span class="p">?</span> <span class="dl">\'</span><span class="s1">modal-body</span><span class="dl">\'</span> <span class="p">:</span> <span class="dl">\'\'</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p><strong>this.showModal</strong>がtrueの時(モーダルが表示されている)にbodyタグに<br>\nmodal-bodyクラスを付与することができ背景をスクロールさせなくできます。</p>\n',body:'# モーダルコンポーネントを作る\n```vue\n<template>\n  <transition name="modal">\n    <div class="modal-mask" @click="closeModal">\n      <div class="modal-wrapper">\n        <div class="modal-container" @click.stop>\n          <div class="modal-contents">\n            <slot></slot>\n          </div>\n        </div>\n      </div>\n    </div>\n  </transition>\n</template>\n\n<script>\nexport default {\n  name: "TheModal",\n  methods: {\n    closeModal() {\n      this.$emit("closeModal");\n    }\n  }\n};\n<\/script>\n\n<style scoped>\n省略\n</style>\n```\nソースコードは[こちら](https://github.com/taakuuyaa/Nuxt-sample-modal/blob/master/pages/index.vue)\n\npageコンポーネントのtemplateで以下のように呼び出し\n\n```vue\n<TheModal v-show="showModal" @closeModal="showModal = false">\n モーダル\n</TheModal>\n```\n\n## 結果\n\n![スクリーンショット 2019-11-19 15.59.08.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288728/4cae0701-d9cd-a4cd-6731-f8e8b02e4cb8.png)\n\nしかし、このままだとモーダルを表示した状態でも後をスクロールすることができてしまう。\n\n![スクリーンショット 2019-11-19 16.09.20.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288728/d1151218-503d-27b5-a72f-ede869483214.png)\n\n\n# 解決方法\n\nモーダルが表示されているときにbodyタグに以下のクラスを付与する。\n\n```css\nmodal-body {\n  overflow-y: hidden;\n  position: fixed;\n}\n```\n\nbodyにクラスを付与するために**グローバルに読み込まれているCSS**などに上のクラスを定義しておく。\n\nページコンポーネントの**head()**に以下を設定する\n\n```vue\n<script>\nimport Logo from "~/components/Logo";\nimport TheModal from "~/components/TheModal";\n\nexport default {\n  components: {\n    Logo,\n    TheModal\n  },\n  data() {\n    return {\n      showModal: false\n    };\n  }\n  //　↓追加↓\n  head () {\n    return {\n      bodyAttrs: {\n        class: this.showModal ? \'modal-body\' : \'\'\n      }\n    }\n  },\n};\n<\/script>\n```\n**this.showModal**がtrueの時(モーダルが表示されている)にbodyタグに\nmodal-bodyクラスを付与することができ背景をスクロールさせなくできます。\n\n\n',coediting:a,comments_count:0,created_at:v,group:n,id:"a6a6014dc86a44df8f15",likes_count:1,private:a,reactions_count:0,tags:[{name:"CSS",versions:[]},{name:d,versions:[]},{name:e,versions:[]}],title:"Nuxtでモーダル実装時に背景がスクロールできてしまう時の対処法",updated_at:v,url:"https://qiita.com/taakuuyaa/items/a6a6014dc86a44df8f15",user:{description:s,facebook_id:s,followees_count:12,followers_count:9,github_login_name:y,id:y,items_count:3,linkedin_id:s,location:s,name:s,organization:s,permanent_id:288728,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288728/profile-images/1572834126",team_only:a,twitter_screen_name:"_taakuuyaa",website_url:s},page_views_count:n},{rendered_body:'\n<h2>\n<span id="basic認証でのpwaの問題" class="fragment"></span><a href="#basic%E8%AA%8D%E8%A8%BC%E3%81%A7%E3%81%AEpwa%E3%81%AE%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>Basic認証でのPWAの問題</h2>\n\n<p>manifest.jsonが401なります。<br>\nconsole.log見ると出てきます。</p>\n\n<h2>\n<span id="対策" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>対策</h2>\n\n<p>manifest.jsonをBasic認証から除外する。<br>\nがもっと簡単な方法がNuxt PWA公式ドキュメントにもっと簡単な方法が。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="p">{</span>\n  <span class="nl">manifest</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">crossorigin</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">use-credentials</span><span class="dl">\'</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p><a href="https://pwa.nuxtjs.org/modules/workbox.html#hooking-on-service-worker-registration-life-cycle" rel="nofollow noopener" target="_blank">Nuxt PWA公式ドキュメント</a>に明記してあります。</p>\n',body:"## Basic認証でのPWAの問題\n\nmanifest.jsonが401なります。\nconsole.log見ると出てきます。\n\n## 対策\n\nmanifest.jsonをBasic認証から除外する。\nがもっと簡単な方法がNuxt PWA公式ドキュメントにもっと簡単な方法が。\n\n```nuxt.config.js\n{\n  manifest: {\n    crossorigin: 'use-credentials'\n  }\n}\n```\n\n[Nuxt PWA公式ドキュメント](https://pwa.nuxtjs.org/modules/workbox.html#hooking-on-service-worker-registration-life-cycle)に明記してあります。\n\n",coediting:a,comments_count:0,created_at:"2019-11-19T15:44:00+09:00",group:n,id:"27987623964f31175ec9",likes_count:1,private:a,reactions_count:0,tags:[{name:"PWA",versions:[]},{name:e,versions:[]}],title:"Nuxt.jsでBasic認証が設定されているサイトでもPWAの検証をする",updated_at:"2019-11-20T10:34:07+09:00",url:"https://qiita.com/ProjectEuropa/items/27987623964f31175ec9",user:{description:"PHPとかJavaScriptとか",facebook_id:s,followees_count:15,followers_count:14,github_login_name:n,id:"ProjectEuropa",items_count:76,linkedin_id:s,location:"埼玉県",name:"Project Europa",organization:s,permanent_id:133718,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/133718/profile-images/1554528613",team_only:a,twitter_screen_name:"M2_m_",website_url:s},page_views_count:n},{rendered_body:'\n<h2>\n<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>\n\n<p>Nuxt.jsのプロジェクトで、Firebase Functionsを使用して「Hello World!」を行います！<br>\nNuxtちょっと分かるけど、NuxtとFirebaseの組み合わせ方わからん…！ってなってる人の助けになれば…</p>\n\n<h2>\n<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h2>\n\n<p>NuxtとFirebase Hostingのセットアップ方法については下記別記事で掲載しています。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>firebase init\n</pre></div></div>\n\n<p>の際に、firebaseの使用する機能の選択で<code>Hosting</code>だけでなく<code>Functions</code>も選択するようにしてください。<br>\n<a href="https://qiita.com/omochironn/items/27d80d5ef470cdb2baca" id="reference-2c70265c84b3bd0a39d8">『Nuxt + Firebase Hosting』で超速deploy</a></p>\n\n<h2>\n<span id="firebase-functionsの種類" class="fragment"></span><a href="#firebase-functions%E3%81%AE%E7%A8%AE%E9%A1%9E"><i class="fa fa-link"></i></a>Firebase Functionsの種類</h2>\n\n<p>Firebase Functionsは2種類あります。</p>\n\n<h3>\n<span id="アプリから呼び出す関数" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%81%8B%E3%82%89%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>アプリから呼び出す関数</h3>\n\n<p>公式リファレンス<a href="https://firebase.google.com/docs/functions/callable?hl=ja" rel="nofollow noopener" target="_blank">【アプリから関数を呼び出す】</a></p>\n\n<blockquote>\n<p>FirebaseクライアントSDKの最小バージョンとの連携によって呼び出される関数。</p>\n</blockquote>\n\n<p>簡単に言うとFirebase SDKが登録されているアプリケーションから呼び出される用の関数。<br>\n今回の記事ではこちらの関数を使っていきます。</p>\n\n<h3>\n<span id="httpリクエスト経由で呼び出す関数" class="fragment"></span><a href="#http%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E7%B5%8C%E7%94%B1%E3%81%A7%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>HTTPリクエスト経由で呼び出す関数</h3>\n\n<p>公式リファレンス<a href="https://firebase.google.com/docs/functions/http-events?hl=ja" rel="nofollow noopener" target="_blank">【HTTP リクエスト経由で関数を呼び出す】</a></p>\n\n<blockquote>\n<p>HTTP リクエストで関数をトリガーできます。</p>\n</blockquote>\n\n<p>簡単に言うと誰でもPOSTMANやcurlコマンドなどでリクエストを行えば、レスポンスが得られる関数。</p>\n\n<p>ただ、Nuxtのプロジェクトでこちらの関数を使おうとすると<code>Access-Control-Allow-Origin</code>のエラーで<br>\n悩まされる事になります。私は半日くらいこいつに時間を取られました… <img alt=":cry:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f622.png" title=":cry:" width="20" loading="lazy"> <br>\nこちらについては<a href="/qrusadorz" class="user-mention js-hovercard" title="qrusadorz" data-hovercard-target-type="user" data-hovercard-target-name="qrusadorz">@qrusadorz</a>さんが素敵な記事を書いてくださっています！ <br>\n<a href="https://qiita.com/qrusadorz/items/40234ac0b5c5c2315cad" id="reference-21b0d1858df8e33144cd">FirebaseのCloud FunctionsでCORSが~とかAccess-Control-Allow-Originが~と言われたらこれ</a></p>\n\n<h2>\n<span id="firebase-sdkの登録" class="fragment"></span><a href="#firebase-sdk%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>Firebase SDKの登録</h2>\n\n<blockquote>\n<p>よし、じゃあ『アプリから呼び出す関数』の方で実装するぞ！<br>\nあれ、でもNuxtの場合SDKの登録ってどうやって行うんだ…？</p>\n</blockquote>\n\n<p>と初歩の初歩で引っかかってしまい、探し回っているうちに下記の素敵な記事2つを発見<br>\n・<a href="https://qiita.com/potato4d/items/cfddeb8732fec63cb29c#oauth-%E3%81%A8%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AE%E6%B0%B8%E7%B6%9A%E5%8C%96" id="reference-3ab5b59aff3636843f3e">【v2対応】Nuxt.jsとFirebaseを組み合わせて爆速でWebアプリケーションを構築する</a><br>\n・<a href="https://qiita.com/redshoga/items/da5c0e247e0df314a257#2-firebase%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90" id="reference-72c135e3946caa7785c1">FirebaseとNuxt.jsを使ってユーザ認証関係を簡単に作ってみる+1ヶ月前の自分に教えたいリンク集</a></p>\n\n<blockquote>\n<p>どうやら<code>plugin</code>として登録するといいみたいだぞ <img alt=":thinking:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png" title=":thinking:" width="20" loading="lazy"> </p>\n</blockquote>\n\n<h4>\n<span id="firebasをインストール--セーブ" class="fragment"></span><a href="#firebas%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB--%E3%82%BB%E3%83%BC%E3%83%96"><i class="fa fa-link"></i></a>firebasをインストール &amp; セーブ</h4>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>npm <span class="nb">install </span>firebase <span class="nt">--save</span>\n</pre></div></div>\n\n<h4>\n<span id="pluginファイルの作成" class="fragment"></span><a href="#plugin%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>pluginファイルの作成</h4>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">~/plugins/firebase.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">firebase</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">firebase</span><span class="dl">\'</span>\n\n<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">apps</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>\n  <span class="nx">firebase</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">({</span>\n    <span class="na">apiKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">API_KEY</span><span class="dl">"</span><span class="p">,</span>\n    <span class="na">authDomain</span><span class="p">:</span> <span class="dl">"</span><span class="s2">APP_ID.firebaseapp.com</span><span class="dl">"</span><span class="p">,</span>\n    <span class="na">databaseURL</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://PROJECT_ID.firebaseio.com</span><span class="dl">"</span><span class="p">,</span>\n    <span class="na">projectId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECT_ID</span><span class="dl">"</span><span class="p">,</span>\n    <span class="na">storageBucket</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECT_ID.appspot.com</span><span class="dl">"</span><span class="p">,</span>\n    <span class="na">messagingSenderId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1234567890</span><span class="dl">"</span>\n  <span class="p">})</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">firebase</span>\n</pre></div>\n</div>\n\n<p><code>firebase.initializeApp</code>の中身はFirebaseのサイト上の、<br>\n該当のプロジェクトの設定画面で確認する事ができるので<br>\nそちらを全て貼り付ける形で問題ありません。</p>\n\n<blockquote>\n<p>参考にした記事は2つともユーザー認証系の記事だったため、今回の場合<br>\n<code>if (!firebase.apps.length)</code>の条件分岐は無くても動きます。</p>\n</blockquote>\n\n<p>これでSDKの登録が行われたプラグインを作成する事ができました！</p>\n\n<h2>\n<span id="functionの作成" class="fragment"></span><a href="#function%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>functionの作成</h2>\n\n<p>セットアップがうまくいっていればプロジェクトのルートに<code>functions</code>という<br>\nフォルダが作成されているはずです。その中にある<code>index.js</code>で関数を作成していきます。</p>\n\n<h4>\n<span id="hello-worldを返す関数の作成" class="fragment"></span><a href="#hello-world%E3%82%92%E8%BF%94%E3%81%99%E9%96%A2%E6%95%B0%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>「Hello World!」を返す関数の作成</h4>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">~/functions/index.js</span></div>\n<div class="highlight"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">firebase-functions</span><span class="dl">\'</span><span class="p">);</span>\n\n<span class="nx">exports</span><span class="p">.</span><span class="nx">helloworld</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onCall</span><span class="p">((</span><span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">return</span> <span class="dl">"</span><span class="s2">Hello World! </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>\n<span class="p">});</span>\n</pre></div>\n</div>\n\n<p>関数の作成自体はものすごく簡単ですね。<br>\n関数の詳細、<code>data</code>や<code>context</code>に何が入るか等は<a href="https://firebase.google.com/docs/functions/callable?hl=ja#write_and_deploy_the_callable_function" rel="nofollow noopener" target="_blank">公式</a>が一番わかりやすかったです。</p>\n\n<h4>\n<span id="作成した関数をdeployする" class="fragment"></span><a href="#%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E9%96%A2%E6%95%B0%E3%82%92deploy%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>作成した関数をdeployする</h4>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>firebase deploy <span class="nt">--only</span> functions\n</pre></div></div>\n\n<p>上記コマンドでfunctionsだけがdeployされます。<br>\n完了すると該当のプロジェクトのFunctionsに追加されているのが確認できるはずです！<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F185788%2Ffc0f9f4c-f781-4c82-6297-90a865bdb40d.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=0117b9c4298c2b6f962e391cdd2634c6" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F185788%2Ffc0f9f4c-f781-4c82-6297-90a865bdb40d.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=0117b9c4298c2b6f962e391cdd2634c6" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/185788/fc0f9f4c-f781-4c82-6297-90a865bdb40d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F185788%2Ffc0f9f4c-f781-4c82-6297-90a865bdb40d.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=d825beb44aab442335d90ad469194de9 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="関数を呼び出す" class="fragment"></span><a href="#%E9%96%A2%E6%95%B0%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>関数を呼び出す</h2>\n\n<p>では、さっそく関数を呼び出してみましょう。<br>\n作成した<code>~/plugin/firebase.js</code>を使用して関数を呼び出します。<br>\nplugin作成の際に参考にさせていただいた記事はどちらもauth機能の方を使用していたため<br>\nfunctionsはどうやって呼び出すんだ…？POSTの仕方は…？と悩んでしまいましたが<br>\nこれについては<a href="https://firebase.google.com/docs/functions/callable?hl=ja#call_the_function" rel="nofollow noopener" target="_blank">公式</a>で詳しく記載されていました。</p>\n\n<p><code>~/pages/index.vue</code>を下記の様に書き換えてみましょう。</p>\n\n<div class="code-frame" data-lang="vuejs">\n<div class="code-lang"><span class="bold">~/pages/index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;h1&gt;</span>Welcome!<span class="nt">&lt;/h1&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inputs"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"name"</span><span class="nt">&gt;</span>お名前は？<span class="nt">&lt;/label&gt;</span>\n      <span class="nt">&lt;input</span> <span class="na">v-model=</span><span class="s">"name"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">class=</span><span class="s">"i-name"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"send-box"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;input</span> <span class="err">@</span><span class="na">click=</span><span class="s">"helloworld"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"送信"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">firebase</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/plugins/firebase</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">name</span><span class="p">:</span> <span class="dl">\'\'</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">helloworld</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="nx">firebase</span><span class="p">.</span><span class="nx">functions</span><span class="p">().</span><span class="nx">httpsCallable</span><span class="p">(</span><span class="dl">\'</span><span class="s1">helloworld</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="nx">hello</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">})</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>\n          <span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>\n        <span class="p">})</span>\n        <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>\n        <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">style</span> <span class="na">lang=</span><span class="s">"scss"</span><span class="nt">&gt;</span>\n<span class="nt">body</span><span class="p">{</span>\n  <span class="nl">background</span><span class="p">:</span> <span class="mh">#2d3436</span><span class="p">;</span>\n  <span class="nl">color</span><span class="p">:</span> <span class="mh">#dfe6e9</span><span class="p">;</span>\n\n  <span class="nc">.container</span><span class="p">{</span>\n    <span class="nl">padding</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>\n    <span class="nt">h1</span><span class="p">{</span>\n      <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>\n    <span class="p">}</span>\n    <span class="nc">.inputs</span><span class="p">{</span>\n      <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>\n      <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>\n      <span class="nl">flex-wrap</span><span class="p">:</span> <span class="n">wrap</span><span class="p">;</span>\n      <span class="nl">padding-top</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>\n      <span class="nt">label</span><span class="p">{</span>\n        <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>\n        <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>\n        <span class="nl">padding-bottom</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>\n        <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>\n      <span class="p">}</span>\n\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">style</span><span class="nt">&gt;</span>\n\n</pre></div>\n</div>\n\n<h3>\n<span id="html部分" class="fragment"></span><a href="#html%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>HTML部分</h3>\n\n<p>html部分については簡単な説明にさせていただきます。<br>\n<code>&lt;input v-model="name" name="name" class="i-name" type="text"&gt;</code>で後述する<br>\n<code>data()</code>とバインディングを行い、そのデータを<br>\n<code>&lt;input @click="helloworld" type="button" value="送信"&gt;</code>で呼び出される関数で使用しています。</p>\n\n<h3>\n<span id="js部分" class="fragment"></span><a href="#js%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>JS部分</h3>\n\n<p><code>import firebase from \'~/plugins/firebase\'</code>で<code>plugin</code>に登録したfirebaseを読みだしています。</p>\n\n<h4>\n<span id="data" class="fragment"></span><a href="#data"><i class="fa fa-link"></i></a>data</h4>\n\n<p><code>name</code>は入力された名前が入る様になっています。</p>\n\n<h4>\n<span id="methods" class="fragment"></span><a href="#methods"><i class="fa fa-link"></i></a>methods</h4>\n\n<p>呼び出しの要となる部分です。説明はコメントアウトで記載しました。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n  <span class="c1">// 略</span>\n  <span class="nx">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">helloworld</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="c1">// pluginのfirebaseからfunctionsを呼び出し、onCallメソッドのどの関数を呼び出すか指定</span>\n      <span class="kd">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="nx">firebase</span><span class="p">.</span><span class="nx">functions</span><span class="p">().</span><span class="nx">httpsCallable</span><span class="p">(</span><span class="dl">\'</span><span class="s1">helloworld</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="c1">// 関数にdataを渡す</span>\n      <span class="nx">hello</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">})</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>\n          <span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>\n        <span class="p">})</span>\n        <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>\n        <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n  <span class="c1">// 略</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<h3>\n<span id="ローカルで呼び出してみる" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%A7%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>ローカルで呼び出してみる。</h3>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>npm run dev\n</pre></div></div>\n\n<p>でnuxtをローカルで立ち上げ、自分の名前を入れて送信すると…<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F185788%2F2515dbc1-69b2-976e-a7bc-8824bc4a56ab.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=dec8acc245de2bb009566325d30f8adf" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F185788%2F2515dbc1-69b2-976e-a7bc-8824bc4a56ab.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=dec8acc245de2bb009566325d30f8adf" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/185788/2515dbc1-69b2-976e-a7bc-8824bc4a56ab.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F185788%2F2515dbc1-69b2-976e-a7bc-8824bc4a56ab.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=ae359dcd50729a2ab55e063907816df0 1x" loading="lazy"></a></p>\n\n<blockquote>\n<p>で、できた <img alt=":sob:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f62d.png" title=":sob:" width="20" loading="lazy">！</p>\n</blockquote>\n\n<h2>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>\n\n<p>新しい便利なもの( nuxt )と新しい便利なもの( firebase )を一緒に使おうと思うと<br>\nプロの人達ならすぐわかるような事で引っかかってしまい、ドキュメントが無かったり。<br>\n便利なもの同士が競合を起こしていたり( nuxt と netlify forms など…)意外と大変だと痛感しました。<br>\nどちらもそれぞれで極めてから使用するべきだなぁ<img alt=":thought_balloon:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f4ad.png" title=":thought_balloon:" width="20" loading="lazy"></p>\n',body:'## 概要\nNuxt.jsのプロジェクトで、Firebase Functionsを使用して「Hello World!」を行います！\nNuxtちょっと分かるけど、NuxtとFirebaseの組み合わせ方わからん…！ってなってる人の助けになれば…\n\n## セットアップ\nNuxtとFirebase Hostingのセットアップ方法については下記別記事で掲載しています。\n\n```bash\nfirebase init\n```\nの際に、firebaseの使用する機能の選択で`Hosting`だけでなく`Functions`も選択するようにしてください。\n[『Nuxt + Firebase Hosting』で超速deploy](https://qiita.com/omochironn/items/27d80d5ef470cdb2baca)\n\n## Firebase Functionsの種類\nFirebase Functionsは2種類あります。\n\n### アプリから呼び出す関数\n公式リファレンス[【アプリから関数を呼び出す】](https://firebase.google.com/docs/functions/callable?hl=ja)\n> FirebaseクライアントSDKの最小バージョンとの連携によって呼び出される関数。\n\n簡単に言うとFirebase SDKが登録されているアプリケーションから呼び出される用の関数。\n今回の記事ではこちらの関数を使っていきます。\n\n### HTTPリクエスト経由で呼び出す関数\n公式リファレンス[【HTTP リクエスト経由で関数を呼び出す】](https://firebase.google.com/docs/functions/http-events?hl=ja)\n> HTTP リクエストで関数をトリガーできます。\n\n簡単に言うと誰でもPOSTMANやcurlコマンドなどでリクエストを行えば、レスポンスが得られる関数。\n\nただ、Nuxtのプロジェクトでこちらの関数を使おうとすると`Access-Control-Allow-Origin`のエラーで\n悩まされる事になります。私は半日くらいこいつに時間を取られました… :cry: \nこちらについては@qrusadorzさんが素敵な記事を書いてくださっています！ \n[FirebaseのCloud FunctionsでCORSが~とかAccess-Control-Allow-Originが~と言われたらこれ](https://qiita.com/qrusadorz/items/40234ac0b5c5c2315cad)\n\n## Firebase SDKの登録\n\n>よし、じゃあ『アプリから呼び出す関数』の方で実装するぞ！\nあれ、でもNuxtの場合SDKの登録ってどうやって行うんだ…？\n\nと初歩の初歩で引っかかってしまい、探し回っているうちに下記の素敵な記事2つを発見\n・[【v2対応】Nuxt.jsとFirebaseを組み合わせて爆速でWebアプリケーションを構築する](https://qiita.com/potato4d/items/cfddeb8732fec63cb29c#oauth-%E3%81%A8%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AE%E6%B0%B8%E7%B6%9A%E5%8C%96)\n・[FirebaseとNuxt.jsを使ってユーザ認証関係を簡単に作ってみる+1ヶ月前の自分に教えたいリンク集](https://qiita.com/redshoga/items/da5c0e247e0df314a257#2-firebase%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90)\n\n> どうやら`plugin`として登録するといいみたいだぞ :thinking: \n\n#### firebasをインストール & セーブ\n```bash\nnpm install firebase --save\n```\n\n#### pluginファイルの作成\n```js:~/plugins/firebase.js\nimport firebase from \'firebase\'\n\nif (!firebase.apps.length) {\n  firebase.initializeApp({\n    apiKey: "API_KEY",\n    authDomain: "APP_ID.firebaseapp.com",\n    databaseURL: "https://PROJECT_ID.firebaseio.com",\n    projectId: "PROJECT_ID",\n    storageBucket: "PROJECT_ID.appspot.com",\n    messagingSenderId: "1234567890"\n  })\n}\n\nexport default firebase\n```\n`firebase.initializeApp`の中身はFirebaseのサイト上の、\n該当のプロジェクトの設定画面で確認する事ができるので\nそちらを全て貼り付ける形で問題ありません。\n\n> 参考にした記事は2つともユーザー認証系の記事だったため、今回の場合\n`if (!firebase.apps.length) `の条件分岐は無くても動きます。\n\nこれでSDKの登録が行われたプラグインを作成する事ができました！\n\n## functionの作成\nセットアップがうまくいっていればプロジェクトのルートに`functions`という\nフォルダが作成されているはずです。その中にある`index.js`で関数を作成していきます。\n\n#### 「Hello World!」を返す関数の作成\n```js:~/functions/index.js\nconst functions = require(\'firebase-functions\');\n\nexports.helloworld = functions.https.onCall((data, context) => {\n  return "Hello World! " + data.name;\n});\n```\n関数の作成自体はものすごく簡単ですね。\n関数の詳細、`data`や`context`に何が入るか等は[公式](https://firebase.google.com/docs/functions/callable?hl=ja#write_and_deploy_the_callable_function)が一番わかりやすかったです。\n\n#### 作成した関数をdeployする\n```bash\nfirebase deploy --only functions\n```\n上記コマンドでfunctionsだけがdeployされます。\n完了すると該当のプロジェクトのFunctionsに追加されているのが確認できるはずです！\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/185788/fc0f9f4c-f781-4c82-6297-90a865bdb40d.png)\n\n## 関数を呼び出す\nでは、さっそく関数を呼び出してみましょう。\n作成した`~/plugin/firebase.js`を使用して関数を呼び出します。\nplugin作成の際に参考にさせていただいた記事はどちらもauth機能の方を使用していたため\nfunctionsはどうやって呼び出すんだ…？POSTの仕方は…？と悩んでしまいましたが\nこれについては[公式](https://firebase.google.com/docs/functions/callable?hl=ja#call_the_function)で詳しく記載されていました。\n\n`~/pages/index.vue`を下記の様に書き換えてみましょう。\n\n```vuejs:~/pages/index.vue\n<template>\n  <div class="container">\n    <h1>Welcome!</h1>\n    <div class="inputs">\n      <label for="name">お名前は？</label>\n      <input v-model="name" name="name" class="i-name" type="text">\n      <div class="send-box">\n        <input @click="helloworld" type="button" value="送信">\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport firebase from \'~/plugins/firebase\'\n\nexport default {\n  data () {\n    return {\n      name: \'\'\n    }\n  },\n  methods: {\n    helloworld () {\n      const hello = firebase.functions().httpsCallable(\'helloworld\')\n      hello({ name: this.name })\n        .then((result) => {\n          console.log(result)\n          alert(result.data)\n        })\n        .catch((error) => {\n          console.log(error)\n        })\n    }\n  }\n}\n<\/script>\n\n<style lang="scss">\nbody{\n  background: #2d3436;\n  color: #dfe6e9;\n\n  .container{\n    padding: 30px;\n    h1{\n      text-align: center;\n    }\n    .inputs{\n      display: flex;\n      justify-content: center;\n      flex-wrap: wrap;\n      padding-top: 20px;\n      label{\n        display: block;\n        width: 100%;\n        padding-bottom: 10px;\n        text-align: center;\n      }\n\n    }\n  }\n}\n</style>\n\n```\n\n### HTML部分\nhtml部分については簡単な説明にさせていただきます。\n`<input v-model="name" name="name" class="i-name" type="text">`で後述する\n`data()`とバインディングを行い、そのデータを\n`<input @click="helloworld" type="button" value="送信">`で呼び出される関数で使用しています。\n\n### JS部分\n`import firebase from \'~/plugins/firebase\'`で`plugin`に登録したfirebaseを読みだしています。\n\n#### data\n`name`は入力された名前が入る様になっています。\n\n#### methods\n呼び出しの要となる部分です。説明はコメントアウトで記載しました。\n\n```vue\n<script>\n  // 略\n  methods: {\n    helloworld () {\n      // pluginのfirebaseからfunctionsを呼び出し、onCallメソッドのどの関数を呼び出すか指定\n      const hello = firebase.functions().httpsCallable(\'helloworld\')\n      // 関数にdataを渡す\n      hello({ name: this.name })\n        .then((result) => {\n          console.log(result)\n          alert(result.data)\n        })\n        .catch((error) => {\n          console.log(error)\n        })\n    }\n  }\n  // 略\n<\/script>\n```\n\n### ローカルで呼び出してみる。\n```bash\nnpm run dev\n```\nでnuxtをローカルで立ち上げ、自分の名前を入れて送信すると…\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/185788/2515dbc1-69b2-976e-a7bc-8824bc4a56ab.png)\n\n> で、できた :sob:！\n\n## まとめ\n新しい便利なもの( nuxt )と新しい便利なもの( firebase )を一緒に使おうと思うと\nプロの人達ならすぐわかるような事で引っかかってしまい、ドキュメントが無かったり。\n便利なもの同士が競合を起こしていたり( nuxt と netlify forms など…)意外と大変だと痛感しました。\nどちらもそれぞれで極めてから使用するべきだなぁ:thought_balloon:\n',coediting:a,comments_count:0,created_at:"2019-11-19T13:34:15+09:00",group:n,id:"5d00ab463e551e01c7c4",likes_count:2,private:a,reactions_count:0,tags:[{name:l,versions:[]},{name:g,versions:[]},{name:e,versions:[]},{name:"FirebaseCloudFunctions",versions:[]}],title:"【Nuxt × Firebase Functions】超入門",updated_at:"2019-11-20T09:59:08+09:00",url:"https://qiita.com/omochironn/items/5d00ab463e551e01c7c4",user:{description:_,facebook_id:s,followees_count:5,followers_count:8,github_login_name:n,id:f,items_count:18,linkedin_id:s,location:B,name:s,organization:s,permanent_id:S,profile_image_url:T,team_only:a,twitter_screen_name:f,website_url:s},page_views_count:n},{rendered_body:'\n<h2>\n<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>\n\n<p>Qiitaのストックを整理するためのサービス「Mindexer(ミンデクサー)」のフロントエンドを<br>\nVue.jsで構築したSPAのアプリケーションからNuxt.jsでSSRを行うように再構築しました。</p>\n\n<p>LambdaでExpressサーバーを動かし、その上でNuxt.jsを動かしています。<br>\nこの記事では、今回の開発で得られたNuxt.jsに関するTipsやインフラ構成などについて解説していきたいと思います。</p>\n\n<p>なお、Vue.jsからの移行に関する解説は含みません。</p>\n\n<h2>\n<span id="サービスについて" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>サービスについて</h2>\n\n<p>「Mindexer(ミンデクサー)」については、こちらの記事で解説しています。<br>\nバックエンドで利用している技術についても解説していますので、合わせてご覧いただけると嬉しいです。</p>\n\n<p><a href="https://qiita.com/kobayashi-m42/items/14e137727ffda3bf79e7" id="reference-b29ff3374b74037691e1"><img alt=":link:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f517.png" title=":link:" width="20" loading="lazy"> AWS + Laravel + Vue.js でQiitaのストックを整理するサービスを作りました！【個人開発】</a><br>\n<a href="https://qiita.com/kobayashi-m42/items/ebc399df258a69b8c76b" id="reference-d51c6b19d1f22b812cba"><img alt=":link:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f517.png" title=":link:" width="20" loading="lazy"> 個人開発のインフラをEC2からFargateに置き換えました！</a></p>\n\n<h2>\n<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>\n\n<p>ソースコードは全てこちらで公開しています。</p>\n\n<p>Nuxt.js : <a href="https://github.com/nekochans/qiita-stocker-frontend" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nekochans/qiita-stocker-frontend</a><br>\nTerraform : <a href="https://github.com/nekochans/qiita-stocker-terraform" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nekochans/qiita-stocker-terraform</a></p>\n\n<h2>\n<span id="nuxtjsへの移行理由" class="fragment"></span><a href="#nuxtjs%E3%81%B8%E3%81%AE%E7%A7%BB%E8%A1%8C%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>Nuxt.jsへの移行理由</h2>\n\n<p>以下のような理由です。</p>\n\n<ul>\n<li>SSRによってページの表示速度を向上させたかった為</li>\n<li>BFF層を導入したかった為（認証部分はサーバーサイドで行ったほうが安全）</li>\n<li>Nuxtのレイアウト機能を利用したかった為</li>\n</ul>\n\n<h2>\n<span id="アーキテクチャ選定理由" class="fragment"></span><a href="#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E9%81%B8%E5%AE%9A%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>アーキテクチャ選定理由</h2>\n\n<p>Nuxt.jsを実行させる為のアーキテクチャ選定に悩みました。</p>\n\n<p>選択肢としては、AWS FargateやGAE（Google App Engine）等があります。<br>\n最初は、GAE（Google App Engine）が簡単そうだなと思ったのですが、ドメインレジストラとしてRoute53、証明書にACMを利用している関係上、このあたりの連携が複雑そうだったので止めました。</p>\n\n<p>最終的にAWS Lambda上でNuxt.jsを動作させるという選択をしました。</p>\n\n<p>理由としては下記の通りです。</p>\n\n<ul>\n<li>アクセス数が相当増えない限り、ランニングコストが安い</li>\n<li>AWS上のサービスだけで完結出来る</li>\n</ul>\n\n<p>AWS Lambda上でNuxt.jsを動作させる設定が少々複雑になったので、次項でそれを説明します。</p>\n\n<h2>\n<span id="技術要素" class="fragment"></span><a href="#%E6%8A%80%E8%A1%93%E8%A6%81%E7%B4%A0"><i class="fa fa-link"></i></a>技術要素</h2>\n\n<ul>\n<li>Nuxt.js v2.10.0</li>\n<li>Vue.js + Vuex</li>\n<li>TypeScript </li>\n<li>Serverless Framework</li>\n</ul>\n\n<h2>\n<span id="インフラ構成" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>インフラ構成</h2>\n\n<h3>\n<span id="aws-構成図" class="fragment"></span><a href="#aws-%E6%A7%8B%E6%88%90%E5%9B%B3"><i class="fa fa-link"></i></a>AWS 構成図</h3>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F206741%2F7c031409-4d36-b35b-f7f5-2cb289b80bdb.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=1a6f430c0c2fa77a698e5d153327909f" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F206741%2F7c031409-4d36-b35b-f7f5-2cb289b80bdb.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=1a6f430c0c2fa77a698e5d153327909f" alt="mindexer-nuxt.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/206741/7c031409-4d36-b35b-f7f5-2cb289b80bdb.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F206741%2F7c031409-4d36-b35b-f7f5-2cb289b80bdb.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=25664d9b8c23215e8523667353f4c718 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="フロントエンド" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>フロントエンド</h3>\n\n<p>Lambda上でExpressサーバーを動かし、その上でNuxt.jsを動かしています。</p>\n\n<p>まず、CloudFrontによって、S3とAPI Gatewayへのアクセスの振り分けを行います。<br>\n画像やJavaScriptファイルなどの静的リソースについてはS3から配信し、SSRやBFFへのアクセスはAPI Gateway経由でLambdaから配信しています。</p>\n\n<h3>\n<span id="バックエンド" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>バックエンド</h3>\n\n<p>バックエンドのAPIは、ECS Fargateで配信しています。<br>\nECS Fargateについては、こちらの記事で解説していますので、よろしければこちらをご覧ください。<br>\n<a href="https://qiita.com/kobayashi-m42/items/ebc399df258a69b8c76b">個人開発のインフラをEC2からFargateに置き換えました！</a></p>\n\n<h2>\n<span id="インフラ構築" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>インフラ構築</h2>\n\n<p>AWSのインフラ構成図に登場するリソースの構築は、少しややこしいのですが<code>Serverless Framework</code>と<code>Terraform</code>の2つによって構築しています。</p>\n\n<ul>\n<li>Serverless Framework\n\n<ul>\n<li>API Gateway</li>\n<li>Lambda</li>\n</ul>\n</li>\n<li>Terraform\n\n<ul>\n<li>CloudFront</li>\n<li>S3</li>\n</ul>\n</li>\n</ul>\n\n<p>まず、AWSのリソース説明の前に、Lambdaで動いているExpressサーバーについて解説し、その後にAWSのリソースについてみていきたいと思います。</p>\n\n<h3>\n<span id="expressサーバー" class="fragment"></span><a href="#express%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC"><i class="fa fa-link"></i></a>Expressサーバー</h3>\n\n<p>Nuxt.jsの<code>universal</code>モードを選択し、SSRを行うためにExpressサーバーを用意しています。<br>\nNuxt.jsは、Expressサーバーのミドルウェアとして使用しています。<br>\nこれに加え、ExpressサーバーではBFFの役割を担っています。</p>\n\n<h4>\n<span id="nuxtjsのrenderssr" class="fragment"></span><a href="#nuxtjs%E3%81%AErenderssr"><i class="fa fa-link"></i></a>Nuxt.jsのrender(SSR)</h4>\n\n<p><code>nuxt.render()</code>を呼ぶことで、Express上でNuxt.jsを動かしています。</p>\n\n<p><a href="https://ja.nuxtjs.org/api/nuxt-render/" rel="nofollow noopener" target="_blank">API: nuxt.render(req, res) - NuxtJS</a></p>\n\n<h4>\n<span id="bffbackends-for-frontends" class="fragment"></span><a href="#bffbackends-for-frontends"><i class="fa fa-link"></i></a>BFF(Backends For Frontends)</h4>\n\n<p>主に以下のような役割を担います。</p>\n\n<ul>\n<li>複数のWebAPIへのリクエスト処理を1つにまとめる</li>\n<li>SSR（サーバーサイドレンダリング）を行う（これはNuxtの仕組みでやってくれる）</li>\n</ul>\n\n<p>普通にサーバーサイドのコードが書ける（Express等のコードが普通に動く）ので、認証周りの処理はここで書いたほうがシンプルに書けます。</p>\n\n<p>また外部APIにアクセスする際に利用するクレデンシャル（APISecret等）もサーバーサイドの環境変数として隠蔽出来るので、セキュリティ的にも安全度が向上します。</p>\n\n<p>今回、Qiitaアカウントを利用してログインを行う部分をこのBFF上で行うように改修しました。</p>\n\n<p>補足となりますが、<code>serverMiddleware</code>を使用することで、 Nuxt.js内にExpressサーバーの処理を持たせることもできます。<br>\n<a href="https://ja.nuxtjs.org/api/configuration-servermiddleware/" rel="nofollow noopener" target="_blank">API: serverMiddleware プロパティ - NuxtJS</a></p>\n\n<h3>\n<span id="serverless" class="fragment"></span><a href="#serverless"><i class="fa fa-link"></i></a>Serverless</h3>\n\n<p>ここまで、Express上のサーバーでNuxt.jsを動かしているという解説をしてきましたが、どのようにLambda上でExpressを動かしているのかを見ていきたいと思います。</p>\n\n<h3>\n<span id="serverless-framework" class="fragment"></span><a href="#serverless-framework"><i class="fa fa-link"></i></a>Serverless Framework</h3>\n\n<p><a href="https://serverless.com/" rel="nofollow noopener" target="_blank">Serverless Framework</a>は、はServerless Applicationを構成管理デプロイするためのCLIツールです。 Serverless Frameworkを使うことで簡単にAWS Lmabdaへのデプロイを行うことができます。</p>\n\n<p>Serverless Frameworkに関する解説は下記の記事が参考になりましたので、掲載させて頂きます。<br>\n<a href="https://qiita.com/horike37/items/b295a91908fcfd4033a2" id="reference-a2b82549adc94f93e178">Serverless Frameworkの使い方まとめ</a></p>\n\n<p>今回のケースでは、以下のことを行います。</p>\n\n<ul>\n<li>LambdaとAPI Gatewayの作成</li>\n<li>Lamndaへのデプロイ</li>\n</ul>\n\n<p>LambdaでNuxt.jsを配信するためには、Lambdaを呼び出すための入り口となるAPI Gatewayが必要となります。<br>\nAPI Gateway用意して、HTTPリクエストをLambdaに送ります。</p>\n\n<p>API Gatewayの設定については、下記をご確認ください。<br>\n<a href="https://serverless.com/framework/docs/providers/aws/events/apigateway/" rel="nofollow noopener" target="_blank">Serverless Framework - AWS Lambda Events - API Gateway</a></p>\n\n<p>また、LambdaでNuxt.jsを配信するために、下記のライブラリを使用しています。</p>\n\n<ul>\n<li>aws-serverless-express</li>\n<li>serverless-plugin-warmup </li>\n</ul>\n\n<h4>\n<span id="aws-serverless-express" class="fragment"></span><a href="#aws-serverless-express"><i class="fa fa-link"></i></a>aws-serverless-express</h4>\n\n<p>AWS Labsによって提供されている<a href="https://github.com/awslabs/aws-serverless-express" rel="nofollow noopener" target="_blank">aws-serverless-express</a>を使用することで、Lambda上でExpressサーバーを動かすことができます。</p>\n\n<p><code>aws-serverless-express</code>は、API GatewayからのリクエストをNode.jsのHTTPリクエストに変換してくれるので、簡単にLambda上でExpressサーバーを動かすことができます。</p>\n\n<h4>\n<span id="serverless-plugin-warmup" class="fragment"></span><a href="#serverless-plugin-warmup"><i class="fa fa-link"></i></a>serverless-plugin-warmup</h4>\n\n<p>Lambdaのコールドスタート対策のために利用しています。<br>\n詳細については、下記の記事に詳しく記載されていますので、掲載させて頂きます。<br>\n<a href="https://qiita.com/keitakn/items/d1c524a97dc844cb02cc" id="reference-d64e423120b68964ee11">Serverless FrameworkでLambdaのコールドスタート対策を行う</a></p>\n\n<h3>\n<span id="s3cloudfront" class="fragment"></span><a href="#s3cloudfront"><i class="fa fa-link"></i></a>S3、CloudFront</h3>\n\n<p>Serverless Frameworkで作成されるAWSリソース以外については、Terraformで管理します。<br>\nVue.jsでSPA配信していた際も、インフラはバックエンド含めて全てTerraformで管理しています。<br>\nここではTerraformには触れずに、S3、CloudFrontの設定内容について解説します。</p>\n\n<p>Serverless Frameworkによって、LambdaとAPI Gatewayが作成されていることを前提とします。</p>\n\n<h4>\n<span id="s3" class="fragment"></span><a href="#s3"><i class="fa fa-link"></i></a>S3</h4>\n\n<p>画像やJavaScriptファイルなどの静的リソースを配信するためのS3バケットを用意します。</p>\n\n<p>アクセスポリシーを下記の通り設定し、CloudFrontからのアクセス(GetObject)のみを許可しています。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "",\n            "Effect": "Allow",\n            "Principal": {\n                "AWS": "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity &lt;CloudFrontのID&gt;"\n            },\n            "Action": "s3:GetObject",\n            "Resource": "arn:aws:s3:::&lt;S3バケット&gt;/*"\n        }\n    ]\n}\n</pre></div></div>\n\n<p>また、S3バケットのオブジェクトは下記のディレクトリ構成とします。(S3へのデプロイ方法の解説については省略します。)</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>├── _nuxt  # Nuxt.jsのクライアントのリソース\n└── assets # 画像などの静的リソース\n</pre></div></div>\n\n<p><code>nuxt build</code>を実行すると、<code>.nuxt/dist/client</code>にクライアントのコードが生成されます。<br>\nこのクライアントのソースコードは、CDNにアップロード可能なJavaScriptファイルになります。<br>\nCDNの設定は<code>nuxt.config.js</code>の<code>publicPath</code>で定義されます。デフォルトは<code>_nuxt</code>となっており、今回はそのまま利用するので、S3のディレクトリも上記のような構成としています。</p>\n\n<p><a href="https://ja.nuxtjs.org/api/configuration-build/#publicpath" rel="nofollow noopener" target="_blank">API: build プロパティ - NuxtJS</a></p>\n\n<h4>\n<span id="cloudfront" class="fragment"></span><a href="#cloudfront"><i class="fa fa-link"></i></a>CloudFront</h4>\n\n<p>インフラ構成の部分で、<code>CloudFrontによって、S3とAPI Gatewayへのアクセスの振り分けを行います。</code>と記載しましたが、どのような設定にしているか詳しく解説したいと思います。</p>\n\n<h5>\n<span id="origins" class="fragment"></span><a href="#origins"><i class="fa fa-link"></i></a>Origins</h5>\n\n<p>S3とApiGatewayの両方を登録しています。</p>\n\n<p><strong>S3</strong></p>\n\n<table>\n<thead>\n<tr>\n<th style="text-align: left">項目</th>\n<th style="text-align: left">　設定内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align: left">Origin Domain Name</td>\n<td style="text-align: left">静的リソースを置いているS3バケットを指定</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Path</td>\n<td style="text-align: left">設定なし</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin ID</td>\n<td style="text-align: left">任意のID</td>\n</tr>\n<tr>\n<td style="text-align: left">Restrict Bucket Access</td>\n<td style="text-align: left">No</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Custom Headers</td>\n<td style="text-align: left">設定なし</td>\n</tr>\n</tbody>\n</table>\n\n<p><code>Restrict Bucket Access</code>をNoとしているのは、S3のバケットポリシーを登録しているからです。</p>\n\n<p><strong>ApiGateway</strong></p>\n\n<table>\n<thead>\n<tr>\n<th style="text-align: left">項目</th>\n<th style="text-align: left">設定内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align: left">Origin Domain Name</td>\n<td style="text-align: left">Severless Frameworkによって作成されたAPI GatewayのAPIエンドポイントを指定</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Path</td>\n<td style="text-align: left">/<code>stage</code>(例：/dev)</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin ID</td>\n<td style="text-align: left">任意のID</td>\n</tr>\n<tr>\n<td style="text-align: left">Minimum Origin SSL Protocol</td>\n<td style="text-align: left">TLSv1.2</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Protocol Policy</td>\n<td style="text-align: left">HTTPS Only</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Response Timeout</td>\n<td style="text-align: left">任意の値</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Keep-alive Timeout</td>\n<td style="text-align: left">任意の値</td>\n</tr>\n<tr>\n<td style="text-align: left">HTTP Port</td>\n<td style="text-align: left">80</td>\n</tr>\n<tr>\n<td style="text-align: left">HTTPS Port</td>\n<td style="text-align: left">443</td>\n</tr>\n<tr>\n<td style="text-align: left">Origin Custom Headers</td>\n<td style="text-align: left">設定なし</td>\n</tr>\n</tbody>\n</table>\n\n<p><code>Origin Path</code>はServerlessFrameworkの<code>serverless.yml</code>で設置しているstageの値になります。<br>\nstageを設定しなかった場合、デフォルトは<code>dev</code>です。</p>\n\n<h5>\n<span id="behaviors" class="fragment"></span><a href="#behaviors"><i class="fa fa-link"></i></a>Behaviors</h5>\n\n<p>パスによるオリジンの振り分けの設定をします。</p>\n\n<table>\n<thead>\n<tr>\n<th style="text-align: left">precedence</th>\n<th style="text-align: left">Path Pattern</th>\n<th style="text-align: left">Origin</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align: left">0</td>\n<td style="text-align: left">_nuxt/*</td>\n<td style="text-align: left">静的リソースを置いているS3バケットを指定</td>\n</tr>\n<tr>\n<td style="text-align: left">1</td>\n<td style="text-align: left">assets/*</td>\n<td style="text-align: left">静的リソースを置いているS3バケットを指定</td>\n</tr>\n<tr>\n<td style="text-align: left">2</td>\n<td style="text-align: left">Default (*)</td>\n<td style="text-align: left">API Gatewayを指定</td>\n</tr>\n</tbody>\n</table>\n\n<p>設定の解説をすると、Nuxt.jsのクライアントのコードは<code>/_nuxt/*</code>にアクセスされます。クライアントのコードをS3にデプロイすることで、S3から配信を行います。<br>\nまた、staticなファイル(faviconなど)もS3バケットに振り分けられるように設定を行っています。<br>\nそれ以外のリクエストについては、API Gatewayへ振り分けています。</p>\n\n<p>該当するソースコードはこちらです。<br>\n<a href="https://github.com/nekochans/qiita-stocker-terraform/blob/master/modules/aws/frontend/cloudfront.tf" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nekochans/qiita-stocker-terraform/blob/master/modules/aws/frontend/cloudfront.tf</a></p>\n\n<h2>\n<span id="nuxtjs-tips" class="fragment"></span><a href="#nuxtjs-tips"><i class="fa fa-link"></i></a>Nuxt.js Tips</h2>\n\n<h3>\n<span id="ディレクトリ構成" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>ディレクトリ構成</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>├── app    # Nuxt.jsのコード\n├── server # Expressのコード\n├── nuxt.config.ts\n└── serverless.yml\n</pre></div></div>\n\n<ul>\n<li>\n<p><code>app</code>にNuxt.jsのコード、<code>server</code>にExpressのコードを置き、ビルドすると下記のような結果になるように設定しています。</p>\n\n<ul>\n<li>\n<code>/.nuxt</code>：Nuxt.jsのコード</li>\n<li>\n<code>/dist</code>：Expressのコード</li>\n</ul>\n</li>\n<li><p>画像などの静的リソースは、<code>app/static/assets</code>に置いています。<br>\nCloudFrontで、S3とAPI Gatewayへリクエストの振り分けを行っていますが、このように設定しておくことでCloudFrontの設定が簡単になります。</p></li>\n</ul>\n\n<h3>\n<span id="nuxtjs-typescript対応" class="fragment"></span><a href="#nuxtjs-typescript%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>Nuxt.js TypeScript対応</h3>\n\n<p>Nuxt.js v2.10では、TypeScriptが公式によりサポートされています。<br>\n設定は下記をご確認ください。<br>\n<a href="https://typescript.nuxtjs.org/" rel="nofollow noopener" target="_blank">Nuxt TypeScript</a></p>\n\n<p>上記のドキュメント通りの設定を行いましたが、一部エラーとなってしまった箇所があったので記載したいと思います。</p>\n\n<ul>\n<li>\n<code>@nuxt/typescript-build</code>を<code>dependencies</code>に移動</li>\n</ul>\n\n<p>CodeBuild上でビルドする際に、<code>@nuxt/typescript-build</code>が<code>devDependencies</code>に追加されているとエラーとなってしまいました。公式では、 <code>devDependencies</code> に追加するように記載されていますが、エラーを回避するために<code>dependencies</code>に移動しています。</p>\n\n<ul>\n<li>developmentモードでのビルドエラーを回避</li>\n</ul>\n\n<p>devモードでは、<code>@nuxt/builder</code>によってBuildしています。その際に、Vuexのモジュールでエラーとなってしまったので、下記の対応をしています。</p>\n\n<p>devモードの場合、<code>config.extensions</code>に<code>[ts]</code>を追加しています。</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">server/core/nuxt.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">config</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">../../nuxt.config</span><span class="dl">\'</span>\n<span class="kd">const</span> <span class="p">{</span> <span class="nx">Nuxt</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">nuxt</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="nx">config</span><span class="p">.</span><span class="nx">dev</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">production</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">dev</span><span class="p">)</span> <span class="p">{</span>\n  <span class="nx">config</span><span class="p">.</span><span class="nx">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">ts</span><span class="dl">\'</span><span class="p">]</span> <span class="c1">// 追加</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">nuxt</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Nuxt</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">config</span>\n</pre></div>\n</div>\n\n<p>これを追加しなかった場合、<code>.nuxt/store.js</code>が下記の通りになり、tsファイルで定義したVuexのモジュールが認識されずにエラーとなりました。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">.nuxt/store.js</span></div>\n<div class="highlight"><pre><span class="kd">function</span> <span class="nx">resolveStoreModules</span> <span class="p">(</span><span class="nx">moduleData</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>\n  <span class="nx">moduleData</span> <span class="o">=</span> <span class="nx">moduleData</span><span class="p">.</span><span class="k">default</span> <span class="o">||</span> <span class="nx">moduleData</span>\n  <span class="c1">// Remove store src + extension (./foo/index.js -&gt; foo/index)</span>\n  <span class="kd">const</span> <span class="nx">namespace</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\\.(</span><span class="sr">js|mjs</span><span class="se">)</span><span class="sr">$/</span><span class="p">,</span> <span class="dl">\'\'</span><span class="p">)</span>   <span class="c1">//tsが含まれない </span>\n</pre></div>\n</div>\n\n<ul>\n<li>\n<code>nuxt.ready()</code>を追加\nLambdaでNuxt.jsを動かした際に、下記の設定を追加していなかったためエラーとなっていました。\n原因は、Nuxt.js 2.5.x から、<code>new Nuxt()</code>をした後に、<code>nuxt.ready()</code>を呼ばないとサーバーがレンダリングしないようになっていたためでした。下記の対応をすることで、解消しました。</li>\n</ul>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">server/app.ts</span></div>\n<div class="highlight"><pre><span class="c1">// 変更前</span>\n<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">nuxt</span><span class="p">.</span><span class="nx">render</span><span class="p">)</span>\n\n<span class="c1">// 変更後</span>\n<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="k">await</span> <span class="nx">nuxt</span><span class="p">.</span><span class="nx">ready</span><span class="p">()</span>\n  <span class="nx">nuxt</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span>\n<span class="p">})</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="エラーページ" class="fragment"></span><a href="#%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%9A%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>エラーページ</h3>\n\n<p>エラーページの表示には2つの方法をとっています。</p>\n\n<h4>\n<span id="nuxtjsのlayoutプロパティを利用" class="fragment"></span><a href="#nuxtjs%E3%81%AElayout%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%82%92%E5%88%A9%E7%94%A8"><i class="fa fa-link"></i></a>Nuxt.jsのLayoutプロパティを利用</h4>\n\n<p><a href="https://ja.nuxtjs.org/guide/views/#%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%9A%E3%83%BC%E3%82%B8" rel="nofollow noopener" target="_blank">ビュー - NuxtJS (エラーページ)</a></p>\n\n<p>APIからエラーが返ってきた場合に表示しています。<br>\nエラーが発生した場合に、 <code>error()</code>関数を呼び出すことで、Layoutプロパティを利用したエラーページを表示しています。<br>\n<a href="https://ja.nuxtjs.org/api/context/#-code-error-code-em-function-em-" rel="nofollow noopener" target="_blank">API: コンテキスト - NuxtJS (error (Function))</a></p>\n\n<p>ページコンポーネント</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">app/pages/stocks/all.vue</span></div>\n<div class="highlight"><pre>  <span class="k">async</span> <span class="nx">fetch</span><span class="p">({</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}:</span> <span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">qiita/fetchUncategorizedStocks</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">qiita/saveDisplayCategoryId</span><span class="dl">\'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">error</span><span class="p">({</span>\n        <span class="na">statusCode</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span>\n        <span class="na">message</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span>\n      <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n</pre></div>\n</div>\n\n<p>ページコンポーネント以外</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">app/components/pages/stocks/All.vue</span></div>\n<div class="highlight"><pre>  <span class="k">async</span> <span class="nx">onClickDestroyCategory</span><span class="p">(</span><span class="nx">categoryId</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroyCategory</span><span class="p">(</span><span class="nx">categoryId</span><span class="p">)</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$nuxt</span><span class="p">.</span><span class="nx">error</span><span class="p">({</span>\n        <span class="na">statusCode</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span>\n        <span class="na">message</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span>\n      <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n</pre></div>\n</div>\n\n<h4>\n<span id="nuxtjs-によって作成されるルーティングを拡張しエラーページに遷移" class="fragment"></span><a href="#nuxtjs-%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E4%BD%9C%E6%88%90%E3%81%95%E3%82%8C%E3%82%8B%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E6%8B%A1%E5%BC%B5%E3%81%97%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E9%81%B7%E7%A7%BB"><i class="fa fa-link"></i></a>Nuxt.js によって作成されるルーティングを拡張しエラーページに遷移</h4>\n\n<p><a href="https://ja.nuxtjs.org/api/configuration-router/#extendroutes" rel="nofollow noopener" target="_blank">API: router プロパティ - NuxtJS (extendRoutes)</a></p>\n\n<p>BFFでエラーが発生した場合、<code>/error</code>に遷移し、エラーページを表示しています。</p>\n\n<p>Nuxt.js によって作成されるルーティングを拡張し、エラーページを作成。<br>\nBFFでエラーが発生した場合は、<code>/error</code>にリダイレクトし、<code>app/pages/error.vue</code>で定義したエラーページを表示しています。</p>\n\n<p><code>nuxt.config.ts</code>で定義している、routerプロパティに<code>extendRoutes</code>を追加しルーティングを拡張しています。</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">nuxt.config.ts</span></div>\n<div class="highlight"><pre>  <span class="nx">router</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">middleware</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">authCookieMiddleware</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">redirectMiddleware</span><span class="dl">\'</span><span class="p">],</span>\n    <span class="nx">extendRoutes</span><span class="p">(</span><span class="nx">routes</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">routes</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>\n        <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">original_error</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">path</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/error</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">props</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="na">component</span><span class="p">:</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">app/pages/error.vue</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n\n</pre></div>\n</div>\n\n<h3>\n<span id="middllwere" class="fragment"></span><a href="#middllwere"><i class="fa fa-link"></i></a>Middllwere</h3>\n\n<p>認証に関連する処理を行うために、Middllwereを利用しています。<br>\n<a href="https://ja.nuxtjs.org/api/pages-middleware/" rel="nofollow noopener" target="_blank">API: middleware プロパティ - NuxtJS</a></p>\n\n<ul>\n<li>authCookieMiddleware.ts：Cookieに保持している認証情報をVuexのStoreに保存する</li>\n<li>redirectMiddleware.ts：ユーザの認証状態から、必要に応じてリダイレクトする</li>\n</ul>\n\n<p>Middllwereは、<code>nuxt.config.ts</code>に下記の通り追加するだけで動作します。<br>\nここで記載した順番で、Middllwereは動作します。(<code>authCookieMiddleware</code> -&gt; <code>redirectMiddleware</code>)</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">nuxt.config.ts</span></div>\n<div class="highlight"><pre>  <span class="nx">router</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">middleware</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">authCookieMiddleware</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">redirectMiddleware</span><span class="dl">\'</span><span class="p">],</span>\n  <span class="p">}</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="あとがき" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>あとがき</h2>\n\n<p>インフラ構築からNuxt.jsのことまで解説したので、内容が盛りだくさんな記事になってしまいました。<br>\n最後まで読んで頂きありがとうございます。少しでもお役に立てれば幸いです。</p>\n\n<p>これからも、技術的に参考になるような情報を発信していきたいと思っていますので、よろしくお願いします。</p>\n\n<p>Mindexerは無料で利用できますので、多くの人に使っていただけると嬉しいです😊<br>\n<a href="https://www.mindexer.net/" rel="nofollow noopener" target="_blank"><img alt=":link:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f517.png" title=":link:" width="20" loading="lazy"> Mindexer | Qiitaのストックを整理するためのサービスです</a></p>\n\n<p>ソースコードもこちらで公開しています！<br>\nここにはMindexerのソースコード以外にもサービスのコードを公開しています！<br>\n<img alt=":link:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f517.png" title=":link:" width="20" loading="lazy"> <a href="https://github.com/nekochans" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nekochans</a></p>\n',body:"## 概要\nQiitaのストックを整理するためのサービス「Mindexer(ミンデクサー)」のフロントエンドを\nVue.jsで構築したSPAのアプリケーションからNuxt.jsでSSRを行うように再構築しました。\n\nLambdaでExpressサーバーを動かし、その上でNuxt.jsを動かしています。\nこの記事では、今回の開発で得られたNuxt.jsに関するTipsやインフラ構成などについて解説していきたいと思います。\n\nなお、Vue.jsからの移行に関する解説は含みません。\n\n## サービスについて\n「Mindexer(ミンデクサー)」については、こちらの記事で解説しています。\nバックエンドで利用している技術についても解説していますので、合わせてご覧いただけると嬉しいです。\n\n[:link: AWS + Laravel + Vue.js でQiitaのストックを整理するサービスを作りました！【個人開発】](https://qiita.com/kobayashi-m42/items/14e137727ffda3bf79e7)\n[:link: 個人開発のインフラをEC2からFargateに置き換えました！](https://qiita.com/kobayashi-m42/items/ebc399df258a69b8c76b)\n\n## ソースコード\nソースコードは全てこちらで公開しています。\n\nNuxt.js : https://github.com/nekochans/qiita-stocker-frontend\nTerraform : https://github.com/nekochans/qiita-stocker-terraform\n\n## Nuxt.jsへの移行理由\n以下のような理由です。\n\n- SSRによってページの表示速度を向上させたかった為\n- BFF層を導入したかった為（認証部分はサーバーサイドで行ったほうが安全）\n- Nuxtのレイアウト機能を利用したかった為\n\n## アーキテクチャ選定理由\nNuxt.jsを実行させる為のアーキテクチャ選定に悩みました。\n\n選択肢としては、AWS FargateやGAE（Google App Engine）等があります。\n最初は、GAE（Google App Engine）が簡単そうだなと思ったのですが、ドメインレジストラとしてRoute53、証明書にACMを利用している関係上、このあたりの連携が複雑そうだったので止めました。\n\n最終的にAWS Lambda上でNuxt.jsを動作させるという選択をしました。\n\n理由としては下記の通りです。\n\n- アクセス数が相当増えない限り、ランニングコストが安い\n- AWS上のサービスだけで完結出来る\n\nAWS Lambda上でNuxt.jsを動作させる設定が少々複雑になったので、次項でそれを説明します。\n\n## 技術要素\n- Nuxt.js v2.10.0\n- Vue.js + Vuex\n- TypeScript \n- Serverless Framework\n\n## インフラ構成\n### AWS 構成図\n![mindexer-nuxt.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/206741/7c031409-4d36-b35b-f7f5-2cb289b80bdb.png)\n\n### フロントエンド\nLambda上でExpressサーバーを動かし、その上でNuxt.jsを動かしています。\n\nまず、CloudFrontによって、S3とAPI Gatewayへのアクセスの振り分けを行います。\n画像やJavaScriptファイルなどの静的リソースについてはS3から配信し、SSRやBFFへのアクセスはAPI Gateway経由でLambdaから配信しています。\n\n### バックエンド\nバックエンドのAPIは、ECS Fargateで配信しています。\nECS Fargateについては、こちらの記事で解説していますので、よろしければこちらをご覧ください。\n[個人開発のインフラをEC2からFargateに置き換えました！](https://qiita.com/kobayashi-m42/items/ebc399df258a69b8c76b)\n\n## インフラ構築\n\nAWSのインフラ構成図に登場するリソースの構築は、少しややこしいのですが`Serverless Framework`と`Terraform`の2つによって構築しています。\n\n- Serverless Framework\n  - API Gateway\n  - Lambda\n- Terraform\n  - CloudFront\n  - S3\n\nまず、AWSのリソース説明の前に、Lambdaで動いているExpressサーバーについて解説し、その後にAWSのリソースについてみていきたいと思います。\n\n### Expressサーバー\nNuxt.jsの`universal`モードを選択し、SSRを行うためにExpressサーバーを用意しています。\nNuxt.jsは、Expressサーバーのミドルウェアとして使用しています。\nこれに加え、ExpressサーバーではBFFの役割を担っています。\n\n#### Nuxt.jsのrender(SSR)\n`nuxt.render()`を呼ぶことで、Express上でNuxt.jsを動かしています。\n\n[API: nuxt.render(req, res) - NuxtJS](https://ja.nuxtjs.org/api/nuxt-render/)\n\n#### BFF(Backends For Frontends)\n主に以下のような役割を担います。\n\n- 複数のWebAPIへのリクエスト処理を1つにまとめる\n- SSR（サーバーサイドレンダリング）を行う（これはNuxtの仕組みでやってくれる）\n\n普通にサーバーサイドのコードが書ける（Express等のコードが普通に動く）ので、認証周りの処理はここで書いたほうがシンプルに書けます。\n\nまた外部APIにアクセスする際に利用するクレデンシャル（APISecret等）もサーバーサイドの環境変数として隠蔽出来るので、セキュリティ的にも安全度が向上します。\n\n今回、Qiitaアカウントを利用してログインを行う部分をこのBFF上で行うように改修しました。\n\n補足となりますが、`serverMiddleware`を使用することで、 Nuxt.js内にExpressサーバーの処理を持たせることもできます。\n[API: serverMiddleware プロパティ - NuxtJS](https://ja.nuxtjs.org/api/configuration-servermiddleware/)\n\n### Serverless\nここまで、Express上のサーバーでNuxt.jsを動かしているという解説をしてきましたが、どのようにLambda上でExpressを動かしているのかを見ていきたいと思います。\n\n### Serverless Framework\n[Serverless Framework](https://serverless.com/)は、はServerless Applicationを構成管理デプロイするためのCLIツールです。 Serverless Frameworkを使うことで簡単にAWS Lmabdaへのデプロイを行うことができます。\n\n\nServerless Frameworkに関する解説は下記の記事が参考になりましたので、掲載させて頂きます。\n[Serverless Frameworkの使い方まとめ](https://qiita.com/horike37/items/b295a91908fcfd4033a2)\n\n今回のケースでは、以下のことを行います。\n\n- LambdaとAPI Gatewayの作成\n- Lamndaへのデプロイ\n\nLambdaでNuxt.jsを配信するためには、Lambdaを呼び出すための入り口となるAPI Gatewayが必要となります。\nAPI Gateway用意して、HTTPリクエストをLambdaに送ります。\n\nAPI Gatewayの設定については、下記をご確認ください。\n[Serverless Framework - AWS Lambda Events - API Gateway](https://serverless.com/framework/docs/providers/aws/events/apigateway/)\n\nまた、LambdaでNuxt.jsを配信するために、下記のライブラリを使用しています。\n\n- aws-serverless-express\n- serverless-plugin-warmup \n\n#### aws-serverless-express\nAWS Labsによって提供されている[aws-serverless-express](https://github.com/awslabs/aws-serverless-express)を使用することで、Lambda上でExpressサーバーを動かすことができます。\n\n`aws-serverless-express`は、API GatewayからのリクエストをNode.jsのHTTPリクエストに変換してくれるので、簡単にLambda上でExpressサーバーを動かすことができます。\n\n#### serverless-plugin-warmup \nLambdaのコールドスタート対策のために利用しています。\n詳細については、下記の記事に詳しく記載されていますので、掲載させて頂きます。\n[Serverless FrameworkでLambdaのコールドスタート対策を行う](https://qiita.com/keitakn/items/d1c524a97dc844cb02cc)\n\n### S3、CloudFront\nServerless Frameworkで作成されるAWSリソース以外については、Terraformで管理します。\nVue.jsでSPA配信していた際も、インフラはバックエンド含めて全てTerraformで管理しています。\nここではTerraformには触れずに、S3、CloudFrontの設定内容について解説します。\n\nServerless Frameworkによって、LambdaとAPI Gatewayが作成されていることを前提とします。\n\n#### S3\n画像やJavaScriptファイルなどの静的リソースを配信するためのS3バケットを用意します。\n\nアクセスポリシーを下記の通り設定し、CloudFrontからのアクセス(GetObject)のみを許可しています。\n\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity <CloudFrontのID>\"\n            },\n            \"Action\": \"s3:GetObject\",\n            \"Resource\": \"arn:aws:s3:::<S3バケット>/*\"\n        }\n    ]\n}\n```\n\nまた、S3バケットのオブジェクトは下記のディレクトリ構成とします。(S3へのデプロイ方法の解説については省略します。)\n\n```\n├── _nuxt  # Nuxt.jsのクライアントのリソース\n└── assets # \b画像などの静的リソース\n```\n\n`nuxt build`を実行すると、`.nuxt/dist/client`にクライアントのコードが生成されます。\nこのクライアントのソースコードは、CDNにアップロード可能なJavaScriptファイルになります。\nCDNの設定は`nuxt.config.js`の`publicPath`で定義されます。デフォルトは`_nuxt`となっており、今回はそのまま利用するので、S3のディレクトリも上記のような構成としています。\n\n[API: build プロパティ - NuxtJS](https://ja.nuxtjs.org/api/configuration-build/#publicpath)\n\n#### CloudFront\n\nインフラ構成の部分で、`CloudFrontによって、S3とAPI Gatewayへのアクセスの振り分けを行います。`と記載しましたが、どのような設定にしているか詳しく解説したいと思います。\n\n##### Origins\nS3とApiGatewayの両方を登録しています。\n\n**S3**\n\n|項目|　設定内容|\n|:------------------|:------------------|\n|Origin Domain Name|静的リソースを置いているS3バケットを指定|\n|Origin Path|設定なし|\n|Origin ID|任意のID|\n|Restrict Bucket Access|No|\n|Origin Custom Headers|設定なし|\n\n`Restrict Bucket Access`をNoとしているのは、S3のバケットポリシーを登録しているからです。\n\n**ApiGateway**\n\n|項目|設定内容|\n|:------------------|:------------------|\n|Origin Domain Name|Severless Frameworkによって作成されたAPI GatewayのAPIエンドポイントを指定|\n|Origin Path|/`stage`(例：/dev)|\n|Origin ID|任意のID|\n|Minimum Origin SSL Protocol|TLSv1.2|\n|Origin Protocol Policy|HTTPS Only|\n|Origin Response Timeout|任意の値|\n|Origin Keep-alive Timeout|任意の値|\n|HTTP Port|80|\n|HTTPS Port|443|\n|Origin Custom Headers|設定なし|\n\n`Origin Path`はServerlessFrameworkの`serverless.yml`で設置しているstageの値になります。\nstageを設定しなかった場合、デフォルトは`dev`です。\n\n##### Behaviors\nパスによるオリジンの振り分けの設定をします。\n\n|precedence| Path Pattern | Origin |\n|:------------------|:------------------|:------------------|\n|0|_nuxt/*|静的リソースを置いているS3バケットを指定|\n|1|assets/*|静的リソースを置いているS3バケットを指定|\n|2|Default (*)|API Gatewayを指定|\n\n設定の解説をすると、Nuxt.jsのクライアントのコードは`/_nuxt/*`にアクセスされます。クライアントのコードをS3にデプロイすることで、S3から配信を行います。\nまた、staticなファイル(faviconなど)もS3バケットに振り分けられるように設定を行っています。\nそれ以外のリクエストについては、API Gatewayへ振り分けています。\n\n該当するソースコードはこちらです。\nhttps://github.com/nekochans/qiita-stocker-terraform/blob/master/modules/aws/frontend/cloudfront.tf\n\n## Nuxt.js Tips\n### ディレクトリ構成\n```\n├── app    # Nuxt.jsのコード\n├── server # \bExpressのコード\n├── nuxt.config.ts\n└── serverless.yml\n```\n\n- `app`にNuxt.jsのコード、`server`にExpressのコードを置き、ビルドすると下記のような結果になるように設定しています。\n  - `/.nuxt`：Nuxt.jsのコード\n  - `/dist`：Expressのコード\n\n- 画像などの静的リソースは、`app/static/assets`に置いています。\nCloudFrontで、S3とAPI Gatewayへリクエストの振り分けを行っていますが、このように設定しておくことでCloudFrontの設定が簡単になります。\n\n### Nuxt.js TypeScript対応\n\nNuxt.js v2.10では、TypeScriptが公式によりサポートされています。\n設定は下記をご確認ください。\n[Nuxt TypeScript](https://typescript.nuxtjs.org/)\n\n上記のドキュメント通りの設定を行いましたが、一部エラーとなってしまった箇所があったので記載したいと思います。\n\n- `@nuxt/typescript-build`を`dependencies`に移動\n\nCodeBuild上でビルドする際に、`@nuxt/typescript-build`が`devDependencies`に追加されているとエラーとなってしまいました。公式では、 `devDependencies` に追加するように記載されていますが、エラーを回避するために`dependencies`に移動しています。\n\n- developmentモードでのビルドエラーを回避\n\ndevモードでは、`@nuxt/builder`によってBuildしています。その際に、Vuexのモジュールでエラーとなってしまったので、下記の対応をしています。\n\ndevモードの場合、`config.extensions`に`[ts]`を追加しています。\n\n```typescript:server/core/nuxt.ts\nimport config from '../../nuxt.config'\nconst { Nuxt } = require('nuxt')\n\nconfig.dev = !(process.env.NODE_ENV === 'production')\n\nif (config.dev) {\n  config.extensions = ['ts'] // 追加\n}\n\nexport const nuxt = new Nuxt(config)\n\nexport default config\n```\n\nこれを追加しなかった場合、`.nuxt/store.js`が下記の通りになり、tsファイルで定義したVuexのモジュールが認識されずにエラーとなりました。\n\n```javascript:.nuxt/store.js\nfunction resolveStoreModules (moduleData, filename) {\n  moduleData = moduleData.default || moduleData\n  // Remove store src + extension (./foo/index.js -> foo/index)\n  const namespace = filename.replace(/\\.(js|mjs)$/, '')   //tsが含まれない \n```\n\n- `nuxt.ready()`を追加\nLambdaでNuxt.jsを動かした際に、下記の設定を追加していなかったためエラーとなっていました。\n原因は、Nuxt.js 2.5.x から、`new Nuxt()`をした後に、`nuxt.ready()`を呼ばないとサーバーがレンダリングしないようになっていたためでした。下記の対応をすることで、解消しました。\n\n```typescript:server/app.ts\n// 変更前\napp.use(nuxt.render)\n\n// 変更後\napp.use(async (req, res, next) => {\n  await nuxt.ready()\n  nuxt.render(req, res, next)\n})\n```\n\n### エラーページ\nエラーページの表示には2つの方法をとっています。\n\n#### Nuxt.jsのLayoutプロパティを利用\n\n[ビュー - NuxtJS (エラーページ)](https://ja.nuxtjs.org/guide/views/#%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%9A%E3%83%BC%E3%82%B8)\n\nAPIからエラーが返ってきた場合に表示しています。\nエラーが発生した場合に、 `error()`関数を呼び出すことで、Layoutプロパティを利用したエラーページを表示しています。\n[API: コンテキスト - NuxtJS (error (Function))](https://ja.nuxtjs.org/api/context/#-code-error-code-em-function-em-)\n\nページコンポーネント\n\n```typescript:app/pages/stocks/all.vue\n  async fetch({ store, error }: Context) {\n    try {\n      await store.dispatch('qiita/fetchUncategorizedStocks')\n      await store.dispatch('qiita/saveDisplayCategoryId', 0)\n    } catch (e) {\n      error({\n        statusCode: e.code,\n        message: e.message\n      })\n    }\n  }\n```\n\nページコンポーネント以外\n\n```typescript:app/components/pages/stocks/All.vue\n  async onClickDestroyCategory(categoryId: number) {\n    try {\n      await this.destroyCategory(categoryId)\n    } catch (error) {\n      return this.$nuxt.error({\n        statusCode: error.code,\n        message: error.message\n      })\n    }\n  }\n```\n\n#### Nuxt.js によって作成されるルーティングを拡張しエラーページに遷移\n\n[API: router プロパティ - NuxtJS (extendRoutes)](https://ja.nuxtjs.org/api/configuration-router/#extendroutes)\n\nBFFでエラーが発生した場合、`/error`に遷移し、エラーページを表示しています。\n\nNuxt.js によって作成されるルーティングを拡張し、エラーページを作成。\nBFFでエラーが発生した場合は、`/error`にリダイレクトし、`app/pages/error.vue`で定義したエラーページを表示しています。\n\n`nuxt.config.ts`で定義している、routerプロパティに`extendRoutes`を追加しルーティングを拡張しています。\n\n```typescript:nuxt.config.ts\n  router: {\n    middleware: ['authCookieMiddleware', 'redirectMiddleware'],\n    extendRoutes(routes: any, resolve) {\n      routes.push({\n        name: 'original_error',\n        path: '/error',\n        props: true,\n        component: resolve(__dirname, 'app/pages/error.vue')\n      })\n    }\n  },\n\n```\n\n### Middllwere\n\n認証に関連する処理を行うために、Middllwereを利用しています。\n[API: middleware プロパティ - NuxtJS](https://ja.nuxtjs.org/api/pages-middleware/)\n\n- authCookieMiddleware.ts：Cookieに保持している認証情報をVuexのStoreに保存する\n- redirectMiddleware.ts：ユーザの認証状態から、必要に応じてリダイレクトする\n\nMiddllwereは、`nuxt.config.ts`に下記の通り追加するだけで動作します。\nここで記載した順番で、Middllwereは動作します。(`authCookieMiddleware` -> `redirectMiddleware`)\n\n```typescript:nuxt.config.ts\n  router: {\n    middleware: ['authCookieMiddleware', 'redirectMiddleware'],\n  }\n```\n\n## あとがき\nインフラ構築からNuxt.jsのことまで解説したので、内容が盛りだくさんな記事になってしまいました。\n最後まで読んで頂きありがとうございます。少しでもお役に立てれば幸いです。\n\nこれからも、技術的に参考になるような情報を発信していきたいと思っていますので、よろしくお願いします。\n\nMindexerは無料で利用できますので、多くの人に使っていただけると嬉しいです😊\n[:link: Mindexer | Qiitaのストックを整理するためのサービスです](https://www.mindexer.net/)\n\nソースコードもこちらで公開しています！\nここにはMindexerのソースコード以外にもサービスのコードを公開しています！\n:link: https://github.com/nekochans\n",coediting:a,comments_count:0,created_at:N,group:n,id:"fbacb46f7603e5a014d7",likes_count:43,private:a,reactions_count:0,tags:[{name:"AWS",versions:[]},{name:"lambda",versions:[]},{name:"serverless",versions:[]},{name:"個人開発",versions:[]},{name:e,versions:[]}],title:"Nuxt.js(SSR)をLambdaで配信する【個人開発】",updated_at:N,url:"https://qiita.com/kobayashi-m42/items/fbacb46f7603e5a014d7",user:{description:"フリーランスのWEBエンジニアです。AWS /Docker /Go /Laravel /Vue.js",facebook_id:s,followees_count:17,followers_count:37,github_login_name:x,id:x,items_count:22,linkedin_id:s,location:s,name:x,organization:s,permanent_id:206741,profile_image_url:"https://avatars3.githubusercontent.com/u/32682645?v=4",team_only:a,twitter_screen_name:"kobayashi_m42",website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>2019/11/18現在、Nuxt.jsではTypeScript 3.7を使用することはできません。</p>\n\n<p>ただし、使用しているパッケージのバージョンを手動で変更すればTypeScript 3.7に対応することができるようです。</p>\n\n<p>ここでは、その手順をご紹介します。</p>\n\n<h1>\n<span id="開発環境での設定" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>開発環境での設定</h1>\n\n<h2>\n<span id="パッケージのバージョンアップ" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>パッケージのバージョンアップ</h2>\n\n<p>手動で以下のパッケージをバージョンアップします。</p>\n\n<ul>\n<li><code>@nuxt/typescript-runtime</code></li>\n<li><code>@nuxt/typescript-build</code></li>\n<li><code>ts-node</code></li>\n<li><code>ts-loader</code></li>\n<li><code>typescript</code></li>\n</ul>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span class="nv">$ </span>yarn add <span class="s2">"@nuxt/typescript-build@^0.3.4"</span>\n<span class="nv">$ </span>yarn add <span class="nt">-D</span> <span class="se">\\</span>\n  <span class="s2">"@nuxt/typescript-runtime@^0.2.4"</span> <span class="se">\\</span>\n  <span class="s2">"ts-node@^8.5.0"</span> <span class="se">\\</span>\n  <span class="s2">"ts-loader@^6.2.1"</span> <span class="se">\\</span>\n  <span class="s2">"typescript@^3.7.2"</span>\n</pre></div></div>\n\n<h2>\n<span id="babelプラグインの追加" class="fragment"></span><a href="#babel%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>Babelプラグインの追加</h2>\n\n<p>TypeScript 3.7から追加された文法上の新機能である <code>Optional Chaining</code> と <code>Nullish Coalescing</code> はそのままでは実行することができません。</p>\n\n<ul>\n<li><code>@babel/plugin-proposal-nullish-coalescing-operator</code></li>\n<li><code>@babel/plugin-proposal-optional-chaining</code></li>\n</ul>\n\n<p>そのため、Babelプラグインを追加してトランスパイルされるようにします。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre>yarn add <span class="nt">-D</span> <span class="se">\\</span>\n  @babel/plugin-proposal-nullish-coalescing-operator <span class="se">\\</span>\n  @babel/plugin-proposal-optional-chaining\n</pre></div></div>\n\n<p>これら２つのプラグインをBabelの設定に追加します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="c1">// nuxt.config.ts</span>\n<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">Configuration</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">babel</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>\n        <span class="dl">\'</span><span class="s1">@babel/plugin-proposal-nullish-coalescing-operator</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="dl">\'</span><span class="s1">@babel/plugin-proposal-optional-chaining</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="p">],</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n\n<span class="nx">moodule</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>\n</pre></div></div>\n\n<p>以上で、TypeScript 3.7を使ってNuxtアプリがビルドできるようになりました 🎊</p>\n\n<h1>\n<span id="vscodeでの設定" class="fragment"></span><a href="#vscode%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>VSCodeでの設定</h1>\n\n<p>VSCodeでTypeScript 3.7を用いたVueアプリの開発を行うためには少し設定が必要です。</p>\n\n<h2>\n<span id="tsファイル" class="fragment"></span><a href="#ts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a><code>.ts</code>ファイル</h2>\n\n<p><code>.ts</code>ファイルの場合は、右下のTypeScriptバージョンを<code>3.6.3</code>から<code>ワークスペースのバージョン (3.7.2)</code>に変更すればTypeScript 3.7の新機能でもエラーが発生しなくなります。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F73594c50-bdf8-3fcd-1905-98888e9ac927.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=63217785bf353a38830722f736c013ab" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F73594c50-bdf8-3fcd-1905-98888e9ac927.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=63217785bf353a38830722f736c013ab" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/73594c50-bdf8-3fcd-1905-98888e9ac927.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F73594c50-bdf8-3fcd-1905-98888e9ac927.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=6226902d6a52d85c59dfad6e0ffc81b4 1x" loading="lazy"></a></p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fdd155965-7c53-5c05-31f6-b36688665a16.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=16becdbde0f86f8902da67f393a186ca" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fdd155965-7c53-5c05-31f6-b36688665a16.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=16becdbde0f86f8902da67f393a186ca" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/dd155965-7c53-5c05-31f6-b36688665a16.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fdd155965-7c53-5c05-31f6-b36688665a16.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=fc0511e7d143cf8c48aab9d8366e182e 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="vueファイル" class="fragment"></span><a href="#vue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a><code>.vue</code>ファイル</h2>\n\n<p><code>.vue</code>ファイルの場合はVeturの設定を変更する必要があります。</p>\n\n<p><code>vetur.useWorkspaceDependencies</code>にチェックを入れると、ワークスペースのTypeScriptをVeturが参照するため、<code>3.7.2</code>の新機能を使用できるようになります。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fd938f538-21dd-9c12-0865-b3375ead9f80.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=39b45c539f5d2fd254871d598b7af0ea" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fd938f538-21dd-9c12-0865-b3375ead9f80.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=39b45c539f5d2fd254871d598b7af0ea" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/d938f538-21dd-9c12-0865-b3375ead9f80.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fd938f538-21dd-9c12-0865-b3375ead9f80.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=5bc4d238c6c2fa170fe2652c6be74584 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<ul>\n<li><a href="https://github.com/nuxt/typescript/issues/185" rel="nofollow noopener" target="_blank">TypeScript 3.7 support · Issue #185 · nuxt/typescript</a></li>\n<li><a href="https://dev.classmethod.jp/client-side/typescript-3-7-2-release/#toc-visual-studio-codevs-code" rel="nofollow noopener" target="_blank">TypeScript 3.7.2がリリースされました！Optional ChainingやNullish Coalescingをさっそく使ってみた ｜ Developers.IO</a></li>\n<li><a href="https://qiita.com/ibara1454/items/10d6091858db106e717b" id="reference-a060d80a0159b16fb7df">VeturにTypeScript3.7のOptional Chainingを適用してみる - Qiita</a></li>\n</ul>\n',body:'# はじめに\n\n2019/11/18現在、Nuxt.jsではTypeScript 3.7を使用することはできません。\n\nただし、使用しているパッケージのバージョンを手動で変更すればTypeScript 3.7に対応することができるようです。\n\nここでは、その手順をご紹介します。\n\n# 開発環境での設定\n\n## パッケージのバージョンアップ\n\n手動で以下のパッケージをバージョンアップします。\n\n* `@nuxt/typescript-runtime`\n* `@nuxt/typescript-build`\n* `ts-node`\n* `ts-loader`\n* `typescript`\n\n```sh\n$ yarn add "@nuxt/typescript-build@^0.3.4"\n$ yarn add -D \\\n  "@nuxt/typescript-runtime@^0.2.4" \\\n  "ts-node@^8.5.0" \\\n  "ts-loader@^6.2.1" \\\n  "typescript@^3.7.2"\n```\n\n## Babelプラグインの追加\n\nTypeScript 3.7から追加された文法上の新機能である `Optional Chaining` と `Nullish Coalescing` はそのままでは実行することができません。\n\n* `@babel/plugin-proposal-nullish-coalescing-operator`\n* `@babel/plugin-proposal-optional-chaining`\n\nそのため、Babelプラグインを追加してトランスパイルされるようにします。\n\n```sh\nyarn add -D \\\n  @babel/plugin-proposal-nullish-coalescing-operator \\\n  @babel/plugin-proposal-optional-chaining\n```\n\nこれら２つのプラグインをBabelの設定に追加します。\n\n```ts\n// nuxt.config.ts\nconst config: Configuration = {\n  build: {\n    babel: {\n      plugins: [\n        \'@babel/plugin-proposal-nullish-coalescing-operator\',\n        \'@babel/plugin-proposal-optional-chaining\',\n      ],\n    },\n  },\n};\n\nmoodule.exports = config;\n```\n\n以上で、TypeScript 3.7を使ってNuxtアプリがビルドできるようになりました 🎊\n\n# VSCodeでの設定\n\nVSCodeでTypeScript 3.7を用いたVueアプリの開発を行うためには少し設定が必要です。\n\n## `.ts`ファイル\n\n`.ts`ファイルの場合は、右下のTypeScriptバージョンを`3.6.3`から`ワークスペースのバージョン (3.7.2)`に変更すればTypeScript 3.7の新機能でもエラーが発生しなくなります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/73594c50-bdf8-3fcd-1905-98888e9ac927.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/dd155965-7c53-5c05-31f6-b36688665a16.png)\n\n## `.vue`ファイル\n\n`.vue`ファイルの場合はVeturの設定を変更する必要があります。\n\n`vetur.useWorkspaceDependencies`にチェックを入れると、ワークスペースのTypeScriptをVeturが参照するため、`3.7.2`の新機能を使用できるようになります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/d938f538-21dd-9c12-0865-b3375ead9f80.png)\n\n# 参考\n\n* [TypeScript 3.7 support · Issue #185 · nuxt/typescript](https://github.com/nuxt/typescript/issues/185)\n* [TypeScript 3.7.2がリリースされました！Optional ChainingやNullish Coalescingをさっそく使ってみた ｜ Developers.IO](https://dev.classmethod.jp/client-side/typescript-3-7-2-release/#toc-visual-studio-codevs-code)\n* [VeturにTypeScript3.7のOptional Chainingを適用してみる - Qiita](https://qiita.com/ibara1454/items/10d6091858db106e717b)\n',coediting:a,comments_count:0,created_at:"2019-11-18T11:53:08+09:00",group:n,id:"a2eca2ea8761409889be",likes_count:3,private:a,reactions_count:0,tags:[{name:j,versions:[]},{name:e,versions:[]}],title:"Nuxt.jsでTypeScript 3.7を使う",updated_at:"2019-11-18T17:41:09+09:00",url:"https://qiita.com/simochee/items/a2eca2ea8761409889be",user:{description:D,facebook_id:s,followees_count:9,followers_count:16,github_login_name:R,id:z,items_count:29,linkedin_id:s,location:G,name:s,organization:s,permanent_id:$,profile_image_url:O,team_only:a,twitter_screen_name:W,website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="導入の経緯" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E3%81%AE%E7%B5%8C%E7%B7%AF"><i class="fa fa-link"></i></a>導入の経緯</h1>\n\n<p>これまで弊社のRuby on Railsで製作されたプロダクトではスライダーライブラリとして<code>swiper.js</code>を用いており、新しくnuxt.jsで製作したものでも流れでswiperをvue向けに扱えるようにした<code>vue-awesome-swiper</code>を用いてきました。しかし、最近になってページスピードを詰めていくとvue-awesome-swiperにはいくつも欠点が見つかりました。</p>\n\n<ul>\n<li>Globallyにしかswiperをimportすることができない</li>\n<li>SSRに対応していない</li>\n<li>ファイルサイズが大きい</li>\n<li>やりたいことによってはbackground-imageで画像を表示するしかなく画像のlazyloadingなどができない</li>\n</ul>\n\n<p>これらの問題を受け、当初はvue-awesome-swiperをいじって解決することや、生のswiperに書き換えることを考えましたが、少し探してみたらvue向けに作られた<code>Hooper</code>という優秀なライブラリを発見したため、こちらに鞍替えすることにしました。そこで導入手順などを簡単に記載します。</p>\n\n<h1>\n<span id="hooperの何がいいか" class="fragment"></span><a href="#hooper%E3%81%AE%E4%BD%95%E3%81%8C%E3%81%84%E3%81%84%E3%81%8B"><i class="fa fa-link"></i></a>Hooperの何がいいか</h1>\n\n<ul>\n<li>単なるComponentとしてimportすればすぐに使えて導入が非常に簡単</li>\n<li>SSR対応</li>\n<li>swiper.jsよりもかなりファイルサイズが小さい</li>\n<li>infinite loop, thumbnail pagination, responsive designなど様々なカスタマイズが可能</li>\n</ul>\n\n<p>vueでよく用いられるスライダーライブラリとして他に<code>vue-carousel</code>がありましたが、そちらはinfinite loopが実現できなかったため今回は採用を見送りました。</p>\n\n<h1>\n<span id="hooperの欠点" class="fragment"></span><a href="#hooper%E3%81%AE%E6%AC%A0%E7%82%B9"><i class="fa fa-link"></i></a>Hooperの欠点</h1>\n\n<ul>\n<li>新しすぎて情報が少ない</li>\n</ul>\n\n<p>GitHubを見る限り公開されてから一年も経っていないようです。これから導入事例と共に情報が増えていくことを期待しています。</p>\n\n<ul>\n<li>swiperほどたくさんの機能を備えていない</li>\n</ul>\n\n<p>今回実現したいことを実装するのには充分な機能を備えていましたが、超リッチなスライダーを作りたいときにはswiperの方がやれることは多いです。しかし発火するイベントを拾ってきて独自の動きを作ればある程度はHooperで対応できると思います。</p>\n\n<h1>\n<span id="hooper導入方法" class="fragment"></span><a href="#hooper%E5%B0%8E%E5%85%A5%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>Hooper導入方法</h1>\n\n<p>今回はNuxt.jsのプロジェクトに導入しましたがvueで動いていれば同様の方法でどんなプロジェクトにも導入できるはずです。</p>\n\n<h2>\n<span id="packagejsonにhooperを追加インストール" class="fragment"></span><a href="#packagejson%E3%81%ABhooper%E3%82%92%E8%BF%BD%E5%8A%A0%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>package.jsonにHooperを追加、インストール</h2>\n\n<p><code>yarn add</code>でも<code>npm install</code>でもなんでもいいです</p>\n\n<div class="code-frame" data-lang="json"><div class="highlight"><pre><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="nl">"hooper"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.3.4"</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div></div>\n\n<h2>\n<span id="vue-component内でimportする" class="fragment"></span><a href="#vue-component%E5%86%85%E3%81%A7import%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Vue Component内でimportする</h2>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Hooper</span><span class="p">,</span> \n         <span class="nx">Slide</span><span class="p">,</span>\n         <span class="nx">Pagination</span> <span class="k">as</span> <span class="nx">HooperPagination</span><span class="p">,</span> <span class="c1">// ページネーションが必要なときにimport</span>\n         <span class="nx">Navigation</span> <span class="k">as</span> <span class="nx">HooperNavigation</span>  <span class="c1">// 左右のナビゲーションが必要なときにimport</span>\n        <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">hooper</span><span class="dl">\'</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">Hooper</span><span class="p">,</span>\n    <span class="nx">Slide</span><span class="p">,</span>\n    <span class="nx">HooperPagination</span><span class="p">,</span>\n    <span class="nx">HooperNavigation</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p>これだけで準備が整います。</p>\n\n<h1>\n<span id="使用方法" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>使用方法</h1>\n\n<p><a href="https://baianat.github.io/hooper/examples.html#default-example" rel="nofollow noopener" target="_blank">公式の実装例</a>に様々なスライダーの例が掲載されています。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;hooper&gt;</span>\n    <span class="nt">&lt;slide&gt;</span>\n      slide 1\n    <span class="nt">&lt;/slide&gt;</span>\n    <span class="nt">&lt;slide&gt;</span>\n      slide 2\n    <span class="nt">&lt;/slide&gt;</span>\n    <span class="nt">&lt;slide&gt;</span>\n      slide 3\n    <span class="nt">&lt;/slide&gt;</span>\n    <span class="nt">&lt;slide&gt;</span>\n      slide 4\n    <span class="nt">&lt;/slide&gt;</span>\n    <span class="nt">&lt;slide&gt;</span>\n      slide 5\n    <span class="nt">&lt;/slide&gt;</span>\n    <span class="nt">&lt;slide&gt;</span>\n      slide 6\n    <span class="nt">&lt;/slide&gt;</span>\n    <span class="nt">&lt;hooper-pagination</span> <span class="na">slot=</span><span class="s">"hooper-addons"</span><span class="nt">&gt;&lt;/hooper-pagination&gt;</span>\n  <span class="nt">&lt;/hooper&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p><a href="https://gyazo.com/8f80393e02e3fab86718c64d00640565" rel="nofollow noopener" target="_blank"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.gyazo.com%2F8f80393e02e3fab86718c64d00640565.gif?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=15f2a867ca11ccb88e33ab40fc1af9cf" alt="Image from Gyazo" data-canonical-src="https://i.gyazo.com/8f80393e02e3fab86718c64d00640565.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.gyazo.com%2F8f80393e02e3fab86718c64d00640565.gif?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=041a7ff2c971ebe7aeb3e48d30fd6a65 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h1>\n\n<p>スライドスピードやページごとに表示する要素の個数を変更したい場合には<code>hooper</code>Componentにそれぞれのoptionのpropsを渡すか、<code>settings</code>にオプションをまとめたobjectを渡します</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;hooper</span> <span class="na">:settings=</span><span class="s">"hooperSettings"</span><span class="nt">&gt;&lt;/hooper&gt;</span>\n  または\n　<span class="nt">&lt;hooper</span> <span class="na">:items-to-show=</span><span class="s">"1"</span> <span class="na">:center-mode=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/hooper&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="c1">// 省略</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">hooperSettings</span><span class="p">:</span> <span class="p">{</span> \n        <span class="na">itemsToShow</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// 1ページに表示したい要素の個数</span>\n        <span class="na">centerMode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 現在の要素を中央に表示するか</span>\n        <span class="na">breakpoints</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// breakpointを用いたいときはsettingsでまとめないとうまく渡せない</span>\n          <span class="mi">480</span><span class="p">:</span> <span class="p">{</span>\n            <span class="na">itemsToShow</span><span class="p">:</span> <span class="mf">1.75</span> <span class="c1">// 小数点以下の値も指定できる</span>\n          <span class="p">},</span>\n          <span class="mi">640</span><span class="p">:</span> <span class="p">{</span>\n            <span class="na">itemsToShow</span><span class="p">:</span> <span class="mf">2.3</span>\n          <span class="p">}</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p>設定について詳しく知りたい場合は<a href="https://baianat.github.io/hooper/api.html" rel="nofollow noopener" target="_blank">公式のAPIガイド</a>をご覧ください</p>\n\n<h1>\n<span id="swiperからの移行で少し詰まったところ-breakpoint指定" class="fragment"></span><a href="#swiper%E3%81%8B%E3%82%89%E3%81%AE%E7%A7%BB%E8%A1%8C%E3%81%A7%E5%B0%91%E3%81%97%E8%A9%B0%E3%81%BE%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D-breakpoint%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>swiperからの移行で少し詰まったところ breakpoint指定</h1>\n\n<p>上記の例でbreakpointを指定してwidthごとにoptionを切り替えましたが、この時の指定方法がswiperと違って少し戸惑いました。</p>\n\n<p>hooperでは上記のように指定すると幅が</p>\n\n<ul>\n<li>0~480px =&gt; 1要素</li>\n<li>480~640px =&gt; 1.75要素</li>\n<li>640px~ =&gt; 2.3要素</li>\n</ul>\n\n<p>のようにoptionが切り替わります。swiperとは真逆の指定方法なので最初少し詰まりました。</p>\n\n<h1>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>\n\n<p>Hooperの導入方法と使用例を簡単にですがご紹介しました。最近ページスピードをかなり重視するようになってきているので、このような軽量で扱いやすいライブラリは非常におすすめできると思います。</p>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<p>Hooper 公式 <a href="https://baianat.github.io/hooper/" class="autolink" rel="nofollow noopener" target="_blank">https://baianat.github.io/hooper/</a></p>\n',body:'# 導入の経緯\n\nこれまで弊社のRuby on Railsで製作されたプロダクトではスライダーライブラリとして`swiper.js`を用いており、新しくnuxt.jsで製作したものでも流れでswiperをvue向けに扱えるようにした`vue-awesome-swiper`を用いてきました。しかし、最近になってページスピードを詰めていくとvue-awesome-swiperにはいくつも欠点が見つかりました。\n\n- Globallyにしかswiperをimportすることができない\n- SSRに対応していない\n- ファイルサイズが大きい\n- やりたいことによってはbackground-imageで画像を表示するしかなく画像のlazyloadingなどができない\n\nこれらの問題を受け、当初はvue-awesome-swiperをいじって解決することや、生のswiperに書き換えることを考えましたが、少し探してみたらvue向けに作られた`Hooper`という優秀なライブラリを発見したため、こちらに鞍替えすることにしました。そこで導入手順などを簡単に記載します。\n\n# Hooperの何がいいか\n\n- 単なるComponentとしてimportすればすぐに使えて導入が非常に簡単\n- SSR対応\n- swiper.jsよりもかなりファイルサイズが小さい\n- infinite loop, thumbnail pagination, responsive designなど様々なカスタマイズが可能\n\n\bvueでよく用いられるスライダーライブラリとして他に`vue-carousel`がありましたが、そちらはinfinite loopが実現できなかったため今回は採用を見送りました。\n\n# Hooperの欠点\n\n- 新しすぎて情報が少ない\n\nGitHubを見る限り公開されてから一年も経っていないようです。これから導入事例と共に情報が増えていくことを期待しています。\n\n- swiperほどたくさんの機能を備えていない\n\n今回実現したいことを実装するのには充分な機能を備えていましたが、超リッチなスライダーを作りたいときにはswiperの方がやれることは多いです。しかし発火するイベントを拾ってきて独自の動きを作ればある程度はHooperで対応できると思います。\n\n# Hooper導入方法\n\n今回はNuxt.jsのプロジェクトに導入しましたがvueで動いていれば同様の方法でどんなプロジェクトにも導入できるはずです。\n\n## package.jsonにHooperを追加、インストール\n\n\b`yarn add`でも`npm install`でもなんでもいいです\n\n```json\n"dependencies": {\n  "hooper": "^0.3.4"\n}\n```\n\n## Vue Component内でimportする\n\n```vue\n<script>\nimport { Hooper, \n         Slide,\n         Pagination as HooperPagination, // ページネーションが必要なときにimport\n         Navigation as HooperNavigation  // 左右のナビゲーションが必要なときにimport\n        } from \'hooper\'\nexport default {\n  components: {\n    Hooper,\n    Slide,\n    HooperPagination,\n    HooperNavigation\n  }\n}\n<\/script>\n```\n\nこれだけで準備が整います。\n\n# 使用方法\n\n[公式の実装例](https://baianat.github.io/hooper/examples.html#default-example)に様々なスライダーの例が掲載されています。\n\n```vue\n<template>\n  <hooper>\n    <slide>\n      slide 1\n    </slide>\n    <slide>\n      slide 2\n    </slide>\n    <slide>\n      slide 3\n    </slide>\n    <slide>\n      slide 4\n    </slide>\n    <slide>\n      slide 5\n    </slide>\n    <slide>\n      slide 6\n    </slide>\n    <hooper-pagination slot="hooper-addons"></hooper-pagination>\n  </hooper>\n</template>\n```\n[![Image from Gyazo](https://i.gyazo.com/8f80393e02e3fab86718c64d00640565.gif)](https://gyazo.com/8f80393e02e3fab86718c64d00640565)\n\n# 設定\n\nスライドスピードやページごとに表示する\b要素の個数を変更したい場合には`hooper`Componentにそれぞれのoptionのpropsを渡すか、`settings`にオプションをまとめたobjectを渡します\n\n```vue\n<template>\n  <hooper :settings="hooperSettings"></hooper>\n  または\n　<hooper :items-to-show="1" :center-mode="true"></hooper>\n</template>\n\n<script>\nexport default {\n  // 省略\n  data() {\n    return {\n      hooperSettings: { \n        itemsToShow: 1, // 1ページに表示したい要素の個数\n        centerMode: true, // 現在の要素を中央に表示するか\n        breakpoints: { // breakpointを用いたいときはsettingsでまとめないとうまく渡せない\n          480: {\n            itemsToShow: 1.75 // 小数点以下の値も指定できる\n          },\n          640: {\n            itemsToShow: 2.3\n          }\n        }\n      }\n    }\n  }\n}\n<\/script>\n```\n\n設定について詳しく知りたい場合は[公式のAPIガイド](https://baianat.github.io/hooper/api.html)をご覧ください\n\n# swiperからの移行で少し詰まったところ breakpoint指定\n\n上記の例でbreakpointを指定してwidthごとにoptionを切り替えましたが、この時の指定方法がswiperと違って少し戸惑いました。\n\nhooperでは上記のように指定すると幅が\n\n- 0~480px => 1要素\n- 480~640px => 1.75要素\n- 640px~ => 2.3要素\n\nのようにoptionが切り替わります。swiperとは真逆の指定方法なので最初少し詰まりました。\n\n# まとめ\n\nHooperの導入方法と使用例を簡単にですがご紹介しました。最近ページスピードをかなり重視するようになってきているので、このような軽量で扱いやすいライブラリは非常におすすめできると思います。\n\n# 参考\nHooper 公式 https://baianat.github.io/hooper/\n',coediting:a,comments_count:0,created_at:"2019-11-17T16:21:15+09:00",group:n,id:"143c59c633c59755dcd6",likes_count:4,private:a,reactions_count:0,tags:[{name:l,versions:[]},{name:e,versions:[]},{name:"hooper",versions:[]}],title:"Nuxt.jsでVue用スライダーライブラリ Hooperを導入",updated_at:"2019-11-18T18:14:17+09:00",url:"https://qiita.com/taktakahashi/items/143c59c633c59755dcd6",user:{description:"株式会社Mosty Place メディア開発エンジニア\r\ncorporate site: https://mostyplace.co.jp/",facebook_id:s,followees_count:5,followers_count:3,github_login_name:M,id:M,items_count:1,linkedin_id:s,location:s,name:"高橋 拓也",organization:"株式会社Mosty Place",permanent_id:142891,profile_image_url:"https://avatars.githubusercontent.com/u/22367223?v=3",team_only:a,twitter_screen_name:n,website_url:s},page_views_count:n},{rendered_body:'<p><code>nuxt build --analyze</code>してみたら、<a href="https://vue-chartjs.org/ja/guide/" rel="nofollow noopener" target="_blank">vue-chartjs</a>でmomentを呼んでいた。。<br>\n時刻は使ってなかったので、削除して軽くしてみたときの備忘録</p>\n\n<h4>\n<span id="nuxtconfigtsのexternalsを使えばok" class="fragment"></span><a href="#nuxtconfigts%E3%81%AEexternals%E3%82%92%E4%BD%BF%E3%81%88%E3%81%B0ok"><i class="fa fa-link"></i></a>nuxt.config.tsのexternalsを使えばOK</h4>\n\n<p>これに書いてあったのを参考に、nuxt.config.tsを設定<br>\n・ <a href="https://github.com/apertureless/vue-chartjs/issues/124" rel="nofollow noopener" target="_blank">Standalone chartjs build (don\'t include moment.js) · Issue #124 · apertureless/vue-chartjs</a></p>\n\n<div class="code-frame" data-lang="typescript"><div class="highlight"><pre><span class="k">import</span> <span class="nx">NuxtConfiguration</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nuxt/config</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">NuxtConfiguration</span> <span class="o">=</span> <span class="p">{</span>\n\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>\n      <span class="c1">// externalsにmomentを追加して、読み込まないようにする</span>\n      <span class="nx">config</span><span class="p">.</span><span class="nx">externals</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="na">moment</span><span class="p">:</span> <span class="dl">"</span><span class="s2">moment</span><span class="dl">"</span>\n      <span class="p">};</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">config</span><span class="p">;</span>\n</pre></div></div>\n\n<h4>\n<span id="resolvealiasはダメだった" class="fragment"></span><a href="#resolvealias%E3%81%AF%E3%83%80%E3%83%A1%E3%81%A0%E3%81%A3%E3%81%9F"><i class="fa fa-link"></i></a>resolve.aliasはダメだった。。</h4>\n\n<p>resolve.aliasも試したけど、こっちはダメっぽい。。</p>\n\n<div class="code-frame" data-lang="typescript"><div class="highlight"><pre><span class="k">import</span> <span class="nx">NuxtConfiguration</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nuxt/config</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">NuxtConfiguration</span> <span class="o">=</span> <span class="p">{</span>\n\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>\n      <span class="c1">// momentが含まれていないChart.jsを使うようにする</span>\n      <span class="k">if</span> <span class="p">(</span><span class="o">!!</span><span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span><span class="p">[</span><span class="dl">"</span><span class="s2">chart.js</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">chart.js/dist/Chart.js</span><span class="dl">\'</span><span class="p">;</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">config</span><span class="p">;</span>\n</pre></div></div>\n\n<p>以上!!</p>\n\n<h2>\n<span id="こんなのつくってます" class="fragment"></span><a href="#%E3%81%93%E3%82%93%E3%81%AA%E3%81%AE%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%A6%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>こんなのつくってます!!</h2>\n\n<p>積読用の読書管理アプリ 『積読ハウマッチ』をリリースしました！<br>\n<a href="https://tsundoku.site" rel="nofollow noopener" target="_blank">積読ハウマッチ</a>は、Nuxt.js+Firebaseで開発してます!</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F478782%2F572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=b10c37fb591de27ad193d02a2a4cd916" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F478782%2F572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=b10c37fb591de27ad193d02a2a4cd916" width="200" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/478782/572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F478782%2F572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=45b94a2f1d7d67faacb0af5dd56a04c1 1x" loading="lazy"></a></p>\n\n<p>もしよかったら、遊んでみてくださいヽ(=´▽`=)ﾉ</p>\n\n<p>要望・感想・アドバイスなどあれば、<br>\n公式アカウント(<a href="https://twitter.com/MemoryLoverz" rel="nofollow noopener" target="_blank">@MemoryLoverz</a>)や開発者(<a href="https://twitter.com/kira_puka" rel="nofollow noopener" target="_blank">@kira_puka</a>)まで♪</p>\n\n<h1>\n<span id="参考にしたサイト様" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%A7%98"><i class="fa fa-link"></i></a>参考にしたサイト様</h1>\n\n<ul>\n<li><a href="https://qiita.com/soutarrr7/items/1b9a46df604ed78ec747" id="reference-c808d1966f235301b261">Nuxt.jsでwebpack.configを拡張してaliasを登録する - Qiita</a></li>\n<li><a href="https://github.com/apertureless/vue-chartjs/issues/124" rel="nofollow noopener" target="_blank">Standalone chartjs build (don\'t include moment.js) · Issue #124 · apertureless/vue-chartjs</a></li>\n</ul>\n',body:'`nuxt build --analyze`してみたら、[vue-chartjs](https://vue-chartjs.org/ja/guide/)でmomentを呼んでいた。。\n時刻は使ってなかったので、削除して軽くしてみたときの備忘録\n\n\n#### nuxt.config.tsのexternalsを使えばOK\n\n\nこれに書いてあったのを参考に、nuxt.config.tsを設定\n・ [Standalone chartjs build (don\'t include moment.js) · Issue #124 · apertureless/vue-chartjs](https://github.com/apertureless/vue-chartjs/issues/124)\n\n```typescript\nimport NuxtConfiguration from "@nuxt/config";\n\nconst config: NuxtConfiguration = {\n\n  build: {\n    extend(config, ctx) {\n      // externalsにmomentを追加して、読み込まないようにする\n      config.externals = {\n        moment: "moment"\n      };\n    }\n  }\n};\n\nexport default config;\n```\n\n#### resolve.aliasはダメだった。。\n\nresolve.aliasも試したけど、こっちはダメっぽい。。\n\n```typescript\nimport NuxtConfiguration from "@nuxt/config";\n\nconst config: NuxtConfiguration = {\n\n  build: {\n    extend(config, ctx) {\n      // momentが含まれていないChart.jsを使うようにする\n      if (!!config.resolve && !!config.resolve.alias) {\n        config.resolve.alias["chart.js"] = \'chart.js/dist/Chart.js\';\n      }\n    }\n  }\n};\n\nexport default config;\n```\n\n以上!!\n\n## こんなのつくってます!!\n\n積読用の読書管理アプリ 『積読ハウマッチ』をリリースしました！\n[積読ハウマッチ](https://tsundoku.site)は、Nuxt.js+Firebaseで開発してます!\n\n<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/478782/572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png" width="200"/>\n\nもしよかったら、遊んでみてくださいヽ(=´▽`=)ﾉ\n\n要望・感想・アドバイスなどあれば、\n公式アカウント([@MemoryLoverz](https://twitter.com/MemoryLoverz))や開発者([@kira_puka](https://twitter.com/kira_puka))まで♪\n\n# 参考にしたサイト様\n- [Nuxt.jsでwebpack.configを拡張してaliasを登録する - Qiita](https://qiita.com/soutarrr7/items/1b9a46df604ed78ec747)\n- [Standalone chartjs build (don\'t include moment.js) · Issue #124 · apertureless/vue-chartjs](https://github.com/apertureless/vue-chartjs/issues/124)\n',coediting:a,comments_count:0,created_at:U,group:n,id:"559b3cbedcd3ed532a92",likes_count:6,private:a,reactions_count:0,tags:[{name:"moment.js",versions:[]},{name:l,versions:[]},{name:e,versions:[]},{name:"vue-chart.js",versions:[]}],title:"Nuxt.jsのvue-chartjsでmomentをつかわないようにする",updated_at:U,url:"https://qiita.com/kira_puka/items/559b3cbedcd3ed532a92",user:{description:"フリーのエンジニア / 今はNuxt.jsが多め / いつかFlutterをやりたい\r\n受託開発をしながら、アプリ・Webサービス・ゲームを個人開発\r\n\r\nKotlin/Python/Swift/Unity/Java/Haskell/DDD",facebook_id:s,followees_count:97,followers_count:80,github_login_name:n,id:V,items_count:32,linkedin_id:s,location:s,name:"きらぷか",organization:"めもらば - Memory Lovers -",permanent_id:478782,profile_image_url:"https://pbs.twimg.com/profile_images/1096750155057909760/J1LKysPF_bigger.png",team_only:a,twitter_screen_name:V,website_url:"https://memory-lovers.com"},page_views_count:n},{rendered_body:'\n<h2>\n<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>\n\n<ul>\n<li>Nuxt.jsでCORSエラーが発生したので、axiosのproxiy設定をした</li>\n<li>Netlifyにデプロイすると404エラーが発生した</li>\n<li>Netlifyのリダイレクトオプションを設定して解決</li>\n</ul>\n\n<h2>\n<span id="nuxtの設定" class="fragment"></span><a href="#nuxt%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Nuxtの設定</h2>\n\n<p><code>.env</code></p>\n\n<div class="code-frame" data-lang="env"><div class="highlight"><pre>BASE_API_URL="http://localhost"\nBASE_CACHE_URL="http://localhost"\n</pre></div></div>\n\n<p><code>nuxt.config.js</code></p>\n\n<div class="code-frame" data-lang="javascript"><div class="highlight"><pre>\n<span class="kd">const</span> <span class="nx">baseApiUrl</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BASE_API_URL</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">http://localhost</span><span class="dl">"</span><span class="p">;</span>\n<span class="kd">const</span> <span class="nx">baseCacheiUrl</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BASE_CACHE_URL</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">http://localhost</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n<span class="p">...</span>\n  <span class="cm">/*\n   ** Axios module configuration\n   */</span>\n  <span class="na">axios</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="na">proxy</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="na">debug</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">},</span>\n  <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">/caches/</span><span class="dl">"</span><span class="p">:</span> <span class="nx">baseCacheiUrl</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">/game/</span><span class="dl">"</span><span class="p">:</span> <span class="nx">baseApiUrl</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">/common/</span><span class="dl">"</span><span class="p">:</span> <span class="nx">baseApiUrl</span>\n  <span class="p">},</span>\n</pre></div></div>\n\n<h2>\n<span id="nuxtの設定-1" class="fragment"></span><a href="#nuxt%E3%81%AE%E8%A8%AD%E5%AE%9A-1"><i class="fa fa-link"></i></a>Nuxtの設定</h2>\n\n<p>ローカル環境で動作検証<br>\n正常にAPI通信できている模様</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2Fc1ef7995-3ec9-6356-0246-44f7518be855.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=8a99ed88fe411a2caf7da503219d6ae9" target="_blank" rel="nofollow noopener"><img width="1233" alt="スクリーンショット 2019-11-16 19.44.08.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2Fc1ef7995-3ec9-6356-0246-44f7518be855.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=8a99ed88fe411a2caf7da503219d6ae9" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167604/c1ef7995-3ec9-6356-0246-44f7518be855.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2Fc1ef7995-3ec9-6356-0246-44f7518be855.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=87fb7dd9645ded5f2e47c701546cde67 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="netlifyにデプロイ" class="fragment"></span><a href="#netlify%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4"><i class="fa fa-link"></i></a>Netlifyにデプロイ</h2>\n\n<p>動かない<br>\nAPIのレスポンスは200が返っているが、404ページのDOMが返却されている模様</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2Fcc58bc73-c5c2-37b3-4113-05a51d807689.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=104cbf2e850af548d7e3f219416871db" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2Fcc58bc73-c5c2-37b3-4113-05a51d807689.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=104cbf2e850af548d7e3f219416871db" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167604/cc58bc73-c5c2-37b3-4113-05a51d807689.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2Fcc58bc73-c5c2-37b3-4113-05a51d807689.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=0e375588c516df3d9e16885cf79f6b9a 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="対策" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>対策</h2>\n\n<p><code>static/_redirects</code></p>\n\n<p>Netlifyのリダイレクトオプションを設定<br>\n<a href="https://docs.netlify.com/routing/redirects/rewrites-proxies/#limitations" class="autolink" rel="nofollow noopener" target="_blank">https://docs.netlify.com/routing/redirects/rewrites-proxies/#limitations</a></p>\n\n<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span class="gi">+ /game/*  https://api.deckup.cards/game/:splat  200\n+ /common/*  https://api.deckup.cards/common/:splat  200\n+ /caches/*  https://cache.deckup.cards/caches/:splat  200\n</span><span class="err">/*</span>    /index.html   200\n</pre></div></div>\n\n<h2>\n<span id="結果" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>結果</h2>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2F2b289b06-c606-6328-3e66-f58248ea942c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=88820117361e50e74a4567be89fbc207" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2F2b289b06-c606-6328-3e66-f58248ea942c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=88820117361e50e74a4567be89fbc207" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167604/2b289b06-c606-6328-3e66-f58248ea942c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F167604%2F2b289b06-c606-6328-3e66-f58248ea942c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=5de8687ab9e546cd3470093ae2c8b2fb 1x" loading="lazy"></a></p>\n',body:'## 概要\n- Nuxt.jsでCORSエラーが発生したので、axiosのproxiy設定をした\n- Netlifyにデプロイすると404エラーが発生した\n- Netlifyのリダイレクトオプションを設定して解決\n\n## Nuxtの設定\n\n`.env`\n\n```env\nBASE_API_URL="http://localhost"\nBASE_CACHE_URL="http://localhost"\n```\n\n`nuxt.config.js`\n\n```javascript\n\nconst baseApiUrl = process.env.BASE_API_URL || "http://localhost";\nconst baseCacheiUrl = process.env.BASE_CACHE_URL || "http://localhost";\n\nexport default {\n...\n  /*\n   ** Axios module configuration\n   */\n  axios: {\n    credentials: true,\n    proxy: true,\n    debug: true\n  },\n  proxy: {\n    "/caches/": baseCacheiUrl,\n    "/game/": baseApiUrl,\n    "/common/": baseApiUrl\n  },\n```\n\n## Nuxtの設定\n\nローカル環境で動作検証\n正常にAPI通信できている模様\n\n<img width="1233" alt="スクリーンショット 2019-11-16 19.44.08.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167604/c1ef7995-3ec9-6356-0246-44f7518be855.png">\n\n\n## Netlifyにデプロイ\n\n動かない\nAPIのレスポンスは200が返っているが、404ページのDOMが返却されている模様\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167604/cc58bc73-c5c2-37b3-4113-05a51d807689.png)\n\n## 対策\n\n`static/_redirects`\n\nNetlifyのリダイレクトオプションを設定\nhttps://docs.netlify.com/routing/redirects/rewrites-proxies/#limitations\n\n```diff\n+ /game/*  https://api.deckup.cards/game/:splat  200\n+ /common/*  https://api.deckup.cards/common/:splat  200\n+ /caches/*  https://cache.deckup.cards/caches/:splat  200\n/*    /index.html   200\n```\n\n## 結果\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167604/2b289b06-c606-6328-3e66-f58248ea942c.png)\n\n\n\n\n',coediting:a,comments_count:0,created_at:"2019-11-16T19:54:31+09:00",group:n,id:"9f7ef27a032710c06f61",likes_count:1,private:a,reactions_count:0,tags:[{name:"CORS",versions:[]},{name:l,versions:[]},{name:"axios",versions:[]},{name:"Netlify",versions:[]},{name:e,versions:[]}],title:"Nuxt.jsでAPIのCORS対策をするとNetlifyで404エラーになる件",updated_at:"2019-11-16T19:56:41+09:00",url:"https://qiita.com/takasu_mtg/items/9f7ef27a032710c06f61",user:{description:s,facebook_id:s,followees_count:4,followers_count:1,github_login_name:"teamys-yas",id:"takasu_mtg",items_count:2,linkedin_id:s,location:"福岡",name:"Yas",organization:"株式会社ベガコーポレーション",permanent_id:167604,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/167604/profile-images/1533625802",team_only:a,twitter_screen_name:n,website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="お題" class="fragment"></span><a href="#%E3%81%8A%E9%A1%8C"><i class="fa fa-link"></i></a>お題</h1>\n\n<p>簡易ToDoアプリ（と言っても、この記事上では単に「ToDoの新規登録」と「登録済みの全ToDoの表示」しか出来ない）を題材として、表題の組み合わせでGraphQL通信ロジックを書くとどんな感じになるかを確認してみる。<br>\n※今回はRDBを使った永続化などはしないで、バックエンドからは固定値を返す。</p>\n\n<h1>\n<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h1>\n\n<p>Nuxt.jsやGoについては、個人ないし会社での開発経験があり、フロント-&gt;サーバの接続は（例えば）Axiosなど使ってRESTでやってたけど、GraphQLに変えてみたいという人が対象。<br>\nただ、「そもそもGraphQLとは？」とか「RESTと比べたメリット・デメリットは？」みたいなことは書かない。（既に記事がいっぱいある。）</p>\n\n<p>また、お題に則り最小限の構造で実装する。<br>\n巷で流行りのClean ArchitectureやDDDに即したパッケージ構成とかは考えない。<br>\nそのへんは、一度↓みたいな記事を書いた。↓でなく、もっといい記事はググればたくさん出てくる。<br>\n<a href="https://qiita.com/sky0621/items/d549dc3cc6796152b28d" id="reference-21e304d59f96b7097f0a">Clean Architecture by Golang(with Echo &amp; Gorm &amp; wire)</a></p>\n\n<h1>\n<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h1>\n\n<h2>\n<span id="-os---linuxubuntu" class="fragment"></span><a href="#-os---linuxubuntu"><i class="fa fa-link"></i></a># OS - Linux(Ubuntu)</h2>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cat /etc/os-release\nNAME="Ubuntu"\nVERSION="18.04.2 LTS (Bionic Beaver)"\n</pre></div></div>\n\n<h2>\n<span id="-フロントエンド" class="fragment"></span><a href="#-%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a># フロントエンド</h2>\n\n<h3>\n<span id="nuxtjs" class="fragment"></span><a href="#nuxtjs"><i class="fa fa-link"></i></a>Nuxt.js</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cat yarn.lock | grep "@nuxt/vue-app"\n    "@nuxt/vue-app" "2.10.2"\n</pre></div></div>\n\n<h3>\n<span id="パッケージマネージャ---yarn" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3---yarn"><i class="fa fa-link"></i></a>パッケージマネージャ - Yarn</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn -v\n1.19.1\n</pre></div></div>\n\n<h3>\n<span id="ide---webstorm" class="fragment"></span><a href="#ide---webstorm"><i class="fa fa-link"></i></a>IDE - WebStorm</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>WebStorm 2019.2.4\nBuild #WS-192.7142.35, built on October 29, 2019\n</pre></div></div>\n\n<h2>\n<span id="-バックエンド" class="fragment"></span><a href="#-%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a># バックエンド</h2>\n\n<h3>\n<span id="言語---go" class="fragment"></span><a href="#%E8%A8%80%E8%AA%9E---go"><i class="fa fa-link"></i></a>言語 - Go</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ go version\ngo version go1.13.3 linux/amd64\n</pre></div></div>\n\n<h3>\n<span id="パッケージマネージャ---go-modules" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3---go-modules"><i class="fa fa-link"></i></a>パッケージマネージャ - Go Modules</h3>\n\n<h3>\n<span id="ide---goland" class="fragment"></span><a href="#ide---goland"><i class="fa fa-link"></i></a>IDE - Goland</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>GoLand 2019.2.5\nBuild #GO-192.7142.48, built on November 8, 2019\n</pre></div></div>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<h2>\n<span id="graphql" class="fragment"></span><a href="#graphql"><i class="fa fa-link"></i></a>GraphQL</h2>\n\n<p><a href="https://graphql.org/" class="autolink" rel="nofollow noopener" target="_blank">https://graphql.org/</a></p>\n\n<h2>\n<span id="フロントエンド" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>フロントエンド</h2>\n\n<p><a href="https://www.apollographql.com/docs/" class="autolink" rel="nofollow noopener" target="_blank">https://www.apollographql.com/docs/</a></p>\n\n<h2>\n<span id="バックエンド" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>バックエンド</h2>\n\n<p><a href="https://gqlgen.com/" class="autolink" rel="nofollow noopener" target="_blank">https://gqlgen.com/</a></p>\n\n<h1>\n<span id="実践" class="fragment"></span><a href="#%E5%AE%9F%E8%B7%B5"><i class="fa fa-link"></i></a>実践</h1>\n\n<p>GitHub上に適当なリポジトリを作ってローカルにgit clone<br>\n自分の環境だとこんな感じ。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql\n</pre></div></div>\n\n<h2>\n<span id="フロントエンド-1" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89-1"><i class="fa fa-link"></i></a>フロントエンド</h2>\n\n<h3>\n<span id="create-nuxt-appコマンドを使ってフロント用のnuxtjsプロジェクトを作成" class="fragment"></span><a href="#create-nuxt-app%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E7%94%A8%E3%81%AEnuxtjs%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a><a href="https://ja.nuxtjs.org/guide/installation" rel="nofollow noopener" target="_blank">create-nuxt-app</a>コマンドを使ってフロント用のNuxt.jsプロジェクトを作成</h3>\n\n<p>ツール類の選択は以下参照。</p>\n\n<ul>\n<li>UIは<a href="https://vuetifyjs.com/en/" rel="nofollow noopener" target="_blank">Vuetify.js</a>\n</li>\n<li>SSRとSPAはどっちでもいいけどデフォのSSR</li>\n<li>今回はテストまで考えてないのでテストフレームワークは無し</li>\n<li>サーバーサイドとの接続はGraphQLなので<a href="https://axios.nuxtjs.org/" rel="nofollow noopener" target="_blank">Axios</a>などは無し</li>\n</ul>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn create nuxt-app frontend\nyarn create v1.19.1\n　　　・・・\nsuccess Installed "create-nuxt-app@2.11.1" with binaries:\n      - create-nuxt-app\n\ncreate-nuxt-app v2.11.1\n✨  Generating Nuxt.js project in frontend\n? Project name frontend\n? Project description My ace Nuxt.js project\n? Author name sky0621\n? Choose the package manager Yarn\n? Choose UI framework Vuetify.js\n? Choose custom server framework None (Recommended)\n? Choose Nuxt.js modules (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)\n? Choose linting tools ESLint, Prettier\n? Choose test framework None\n? Choose rendering mode Universal (SSR)\n? Choose development tools (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)\nyarn run v1.19.1\n$ eslint --ext .js,.vue --ignore-path .gitignore . --fix\nDone in 2.90s.\n\n🎉  Successfully created project frontend\n</pre></div></div>\n\n<p>現時点で以下のようなディレクトリ構成となっている。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql\n$\n$ tree -L 2\n.\n├── frontend\n│   ├── assets\n│   ├── components\n│   ├── layouts\n│   ├── middleware\n│   ├── node_modules\n│   ├── nuxt.config.js\n│   ├── package.json\n│   ├── pages\n│   ├── plugins\n│   ├── README.md\n│   ├── static\n│   ├── store\n│   └── yarn.lock\n└── README.md\n</pre></div></div>\n\n<p>そして、パッケージのdevDependenciesも念のため記載。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cat frontend/package.json \n{\n　　・・・\n  "dependencies": {\n    "nuxt": "^2.0.0"\n  },\n  "devDependencies": {\n    "@nuxtjs/vuetify": "^1.0.0",\n    "@nuxtjs/eslint-config": "^1.0.1",\n    "@nuxtjs/eslint-module": "^1.0.0",\n    "babel-eslint": "^10.0.1",\n    "eslint": "^6.1.0",\n    "eslint-plugin-nuxt": "&gt;=0.4.2",\n    "eslint-config-prettier": "^4.1.0",\n    "eslint-plugin-prettier": "^3.0.1",\n    "prettier": "^1.16.4"\n  }\n}\n</pre></div></div>\n\n<h3>\n<span id="nuxtjsapolloの導入" class="fragment"></span><a href="#nuxtjsapollo%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>nuxtjs/apolloの導入</h3>\n\n<h4>\n<span id="パッケージ追加" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>パッケージ追加</h4>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cd frontend/\n$\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend\n$\n$ yarn add @nuxtjs/apollo\nyarn add v1.19.1\n[1/4] Resolving packages...\n[2/4] Fetching packages...\ninfo fsevents@2.1.2: The platform "linux" is incompatible with this module.\n　　・・・\nDone in 15.54s.\n</pre></div></div>\n\n<h4>\n<span id="nuxt-configjsへ設定追記" class="fragment"></span><a href="#nuxt-configjs%E3%81%B8%E8%A8%AD%E5%AE%9A%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>nuxt-config.jsへ設定追記</h4>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ git diff frontend/nuxt.config.js\ndiff --git a/frontend/nuxt.config.js b/frontend/nuxt.config.js\nindex 25a0fe4..afc0db4 100644\n--- a/frontend/nuxt.config.js\n+++ b/frontend/nuxt.config.js\n@@ -42,7 +42,7 @@ export default {\n   /*\n    ** Nuxt.js modules\n    */\n-  modules: [],\n+  modules: [\'@nuxtjs/apollo\'],\n   /*\n    ** vuetify module configuration\n    ** https://github.com/nuxt-community/vuetify-module\n@@ -64,6 +64,18 @@ export default {\n       }\n     }\n   },\n+\n+  apollo: {\n+    clientConfigs: {\n+      default: {\n+        // Goサーバを 8080 ポートで起動する予定のため\n+        httpEndpoint: \'http://localhost:8080/\'\n+      }\n+    },\n+    // 任意だけど、これがないとGraphQL的なエラー起きた時に原因が掴みづらいため\n+    errorHandler: \'~/plugins/apollo-error-handler.js\'\n+  },\n+\n   /*\n    ** Build configuration\n    */\n</pre></div></div>\n\n<h4>\n<span id="graphqlエラーハンドリングプラグイン" class="fragment"></span><a href="#graphql%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>GraphQLエラーハンドリングプラグイン</h4>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cat frontend/plugins/apollo-error-handler.js \nexport default (error, context) =&gt; {\n  console.log(error)\n  context.error({ statusCode: 304, message: \'Server error\' })\n}\n</pre></div></div>\n\n<p>参考：<a href="https://github.com/nuxt-community/apollo-module" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nuxt-community/apollo-module</a></p>\n\n<h3>\n<span id="フロントエンド起動" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>フロントエンド起動</h3>\n\n<p>ここまででいったん起動してみる。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend\n$\n$ yarn run dev\nyarn run v1.19.1\n$ nuxt\n\n WARN  Address localhost:8080 is already in use.                                                                                                                                                                                                           11:40:12\n\nℹ Trying a random port...                                                                                                                                                                                                                                  11:40:12\n\n   ╭─────────────────────────────────────────────╮\n   │                                             │\n   │   Nuxt.js v2.10.2                           │\n   │   Running in development mode (universal)   │\n   │                                             │\n   │   Listening on: http://localhost:44171/     │\n   │                                             │\n   ╰─────────────────────────────────────────────╯\n\nℹ Preparing project for development                                                                                                                                                                                                                        11:40:13\nℹ Initial build may take a while                                                                                                                                                                                                                           11:40:13\n✔ Builder initialized                                                                                                                                                                                                                                      11:40:13\n✔ Nuxt files generated                                                                                                                                                                                                                                     11:40:13\n\n● Client █████████████████████████ building (35%) 215/225 modules 10 active\n node_modules/vuetify/dist/vuetify.js\n\n● Server █████████████████████████ building (19%) 81/81 modules 0 active\n\n\n\n ERROR  Failed to compile with 1 errors                                                                                                                                                                                                    friendly-errors 11:40:31\n\n\n ERROR  in ./plugins/apollo-error-handler.js                                                                                                                                                                                               friendly-errors 11:40:31\n\nModule Error (from ./node_modules/eslint-loader/dist/cjs.js):                                                                                                                                                                              friendly-errors 11:40:31\n\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend/plugins/apollo-error-handler.js\n  2:3  warning  Unexpected console statement  no-console\n  5:1  error    Delete `⏎`                    prettier/prettier\n\n✖ 2 problems (1 error, 1 warning)\n  1 error and 0 warnings potentially fixable with the `--fix` option.\n\n                                                                                                                                                                                                                                           friendly-errors 11:40:31\n @ ./.nuxt/apollo-module.js 93:13-57\n @ ./.nuxt/index.js\n @ ./.nuxt/client.js\n @ multi eventsource-polyfill webpack-hot-middleware/client?reload=true&amp;timeout=30000&amp;ansiColors=&amp;overlayStyles=&amp;name=client&amp;path=/__webpack_hmr/client ./.nuxt/client.js\n                                                                                                                                                                                                                                           friendly-errors 11:40:31\nℹ Waiting for file changes                                                                                                                                                                                                                                 11:40:31\nℹ Memory usage: 433 MB (RSS: 559 MB)                                                                                                                                                                                                                       11:40:31\n\n ERROR  ENOSPC: System limit for number of file watchers reached, watch \'/home/sky0621/src/github.com/sky0621/study-graphql/frontend/node_modules/@nuxt/vue-app/template/views/loading\'                                                                    11:40:31\n\n  at FSWatcher.start (internal/fs/watchers.js:165:26)\n  at Object.watch (fs.js:1329:11)\n  at createFsWatchInstance (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:118:15)\n  at setFsWatchListener (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:165:15)\n  at NodeFsHandler._watchWithNodeFs (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:330:14)\n  at NodeFsHandler._handleDir (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:551:19)\n  at runMicrotasks (&lt;anonymous&gt;)\n  at processTicksAndRejections (internal/process/task_queues.js:93:5)\n  at async NodeFsHandler._addToNodeFs (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:600:16)\n</pre></div></div>\n\n<p>怒られた。<a href="https://prettier.io/" rel="nofollow noopener" target="_blank">Prettier</a>さんチェックが入った。<br>\n言われた通り、lint fix する。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn run lint --fix\nyarn run v1.19.1\n$ eslint --ext .js,.vue --ignore-path .gitignore . --fix\n\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend/plugins/apollo-error-handler.js\n  2:3  warning  Unexpected console statement  no-console\n\n✖ 1 problem (0 errors, 1 warning)\n\nDone in 2.27s.\n</pre></div></div>\n\n<p>すると、起動できた。<br>\nなんか１件 WARN は出てるけど・・・これはエラーハンドラー内でデバッグ用にconsoleログ吐いてるからか。<br>\n本番リリース時は消すという前提でいったん無視（まあ、本番リリースしないし）。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>　　〜〜〜\n\n↻ Updated plugins/apollo-error-handler.js                                                                                                                                                                                                                  11:45:05\n\n✔ Client\n  Compiled successfully in 694.86ms\n\n✔ Server\n  Compiled successfully in 823.17ms\n\n\n WARN  Compiled with 1 warnings                                                                                                                                                                                                            friendly-errors 11:45:07\n\nModule Warning (from ./node_modules/eslint-loader/dist/cjs.js):                                                                                                                                                                            friendly-errors 11:45:07\n\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend/plugins/apollo-error-handler.js\n  2:3  warning  Unexpected console statement  no-console\n\n✖ 1 problem (0 errors, 1 warning)\n\n                                                                                                                                                                                                                                           friendly-errors 11:45:07\nYou may use special comments to disable some warnings.                                                                                                                                                                                     friendly-errors 11:45:07\nUse // eslint-disable-next-line to ignore the next line.                                                                                                                                                                                   friendly-errors 11:45:07\nUse /* eslint-disable */ to ignore all warnings in a file.                                                                                                                                                                                 friendly-errors 11:45:07\n</pre></div></div>\n\n<p>起動ログの冒頭で「 <code>http://localhost:44171/</code> 」と記載があったので、そのポートで起動チェック。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F74e1fa3c-1e41-d1e1-0574-1d25001923ff.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3a3447a781a6f40b95f25e30e2d2828b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F74e1fa3c-1e41-d1e1-0574-1d25001923ff.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3a3447a781a6f40b95f25e30e2d2828b" alt="screenshot-localhost-44171-2019.11.16-11-56-29.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/74e1fa3c-1e41-d1e1-0574-1d25001923ff.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F74e1fa3c-1e41-d1e1-0574-1d25001923ff.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=582e6021da42209218835ce92d2cb207 1x" loading="lazy"></a><br>\nうん、OK。GraphQL的なあれこれはバックエンド作ってから確認するので、フロントエンドは、ひとまずここまで。</p>\n\n<h2>\n<span id="バックエンド-1" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89-1"><i class="fa fa-link"></i></a>バックエンド</h2>\n\n<h3>\n<span id="バックエンド用ソース格納ディレクトリとgraphqlスキーマ格納ディレクトリを作成" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E7%94%A8%E3%82%BD%E3%83%BC%E3%82%B9%E6%A0%BC%E7%B4%8D%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%A8graphql%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%A0%BC%E7%B4%8D%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>バックエンド用ソース格納ディレクトリとGraphQLスキーマ格納ディレクトリを作成</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql\n$ tree -L 1\n.\n├── frontend\n└── README.md\n\n1 directory, 1 file\n$ mkdir backend\n$ tree -L 1\n.\n├── backend\n├── frontend\n└── README.md\n</pre></div></div>\n\n<h3>\n<span id="goプロジェクト初期化" class="fragment"></span><a href="#go%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>Goプロジェクト初期化</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cd backend/\n$ go mod init github.com/sky0621/study-graphql/backend\ngo: creating new go.mod: module github.com/sky0621/study-graphql/backend$ tree -L 1\n.\n└── go.mod\n\n0 directories, 1 file\n$ cat go.mod \nmodule github.com/sky0621/study-graphql/backend\n\ngo 1.13\n</pre></div></div>\n\n<h3>\n<span id="gqlgenコマンドによるスケルトン生成" class="fragment"></span><a href="#gqlgen%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B9%E3%82%B1%E3%83%AB%E3%83%88%E3%83%B3%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>gqlgenコマンドによるスケルトン生成</h3>\n\n<p>一気にいろいろなファイルが自動生成される。（GraphQLスキーマすら書いてないのにサンプルを用意してくれる）</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ go run github.com/99designs/gqlgen init\nExec "go run ./server/server.go" to start GraphQL server\n$\n$ tree -L 2\n.\n├── generated.go\n├── go.mod\n├── go.sum\n├── gqlgen.yml\n├── models_gen.go\n├── resolver.go\n├── schema.graphql\n└── server\n    └── server.go\n</pre></div></div>\n\n<h3>\n<span id="自動生成物のチェック" class="fragment"></span><a href="#%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E7%89%A9%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>自動生成物のチェック</h3>\n\n<h4>\n<span id="graphqlスキーマ" class="fragment"></span><a href="#graphql%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E"><i class="fa fa-link"></i></a>GraphQLスキーマ</h4>\n\n<div class="code-frame" data-lang="graphql">\n<div class="code-lang"><span class="bold">[schema.graphql]</span></div>\n<div class="highlight"><pre><span class="c"># GraphQL schema example</span><span class="w">\n</span><span class="c">#</span><span class="w">\n</span><span class="c"># https://gqlgen.com/getting-started/</span><span class="w">\n\n</span><span class="k">type</span><span class="w"> </span><span class="n">Todo</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!</span><span class="w">\n  </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n  </span><span class="n">done</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">!</span><span class="w">\n  </span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">!</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span><span class="k">type</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!</span><span class="w">\n  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span><span class="k">type</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="n">todos</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">Todo</span><span class="p">!]!</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span><span class="k">input</span><span class="w"> </span><span class="n">NewTodo</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n  </span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span><span class="k">type</span><span class="w"> </span><span class="n">Mutation</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="n">createTodo</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="n">NewTodo</span><span class="p">!):</span><span class="w"> </span><span class="n">Todo</span><span class="p">!</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>実は、お題を『簡易ToDoアプリ』としたのは、gqlgen がデフォルトで自動生成するスキーマが↑だからでした。<br>\ngqlgenはスキーマファーストを前提とするライブラリなので、このスキーマを元にして、初回だけ自動生成されるソースとgqlgenコマンド実行のたびに自動生成されるソースとを組み合わせて機能を実現していく。</p>\n\n<h4>\n<span id="リゾルバー" class="fragment"></span><a href="#%E3%83%AA%E3%82%BE%E3%83%AB%E3%83%90%E3%83%BC"><i class="fa fa-link"></i></a>リゾルバー</h4>\n\n<p>GraphQLスキーマで定義されたQuery（この事例だと「<code>todos: [Todo!]!</code>」（要するにToDo一覧取得））とMutation（この事例だと「<code>createTodo(input: NewTodo!): Todo!</code>」（要するにToDo新規登録））のロジックを実装するソース。<br>\n※このソースは、gqlgenコマンドによって初回だけ自動生成されるソース。（以降は、このファイルを消すか、<code>gqlgen.yml</code> の設定をいじらない限り再生成はされない。）</p>\n\n<div class="code-frame" data-lang="go">\n<div class="code-lang"><span class="bold">[resolver.go]</span></div>\n<div class="highlight"><pre><span class="k">package</span> <span class="n">backend</span>\n\n<span class="k">import</span> <span class="p">(</span>\n    <span class="s">"context"</span>\n<span class="p">)</span> <span class="c">// THIS CODE IS A STARTING POINT ONLY. IT WILL NOT BE UPDATED WITH SCHEMA CHANGES.</span>\n\n<span class="k">type</span> <span class="n">Resolver</span> <span class="k">struct</span><span class="p">{}</span>\n\n<span class="k">func</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">Resolver</span><span class="p">)</span> <span class="n">Mutation</span><span class="p">()</span> <span class="n">MutationResolver</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="o">&amp;</span><span class="n">mutationResolver</span><span class="p">{</span><span class="n">r</span><span class="p">}</span>\n<span class="p">}</span>\n<span class="k">func</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">Resolver</span><span class="p">)</span> <span class="n">Query</span><span class="p">()</span> <span class="n">QueryResolver</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="o">&amp;</span><span class="n">queryResolver</span><span class="p">{</span><span class="n">r</span><span class="p">}</span>\n<span class="p">}</span>\n\n<span class="k">type</span> <span class="n">mutationResolver</span> <span class="k">struct</span><span class="p">{</span> <span class="o">*</span><span class="n">Resolver</span> <span class="p">}</span>\n\n<span class="k">func</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">mutationResolver</span><span class="p">)</span> <span class="n">CreateTodo</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">input</span> <span class="n">NewTodo</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Todo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nb">panic</span><span class="p">(</span><span class="s">"not implemented"</span><span class="p">)</span>\n<span class="p">}</span>\n\n<span class="k">type</span> <span class="n">queryResolver</span> <span class="k">struct</span><span class="p">{</span> <span class="o">*</span><span class="n">Resolver</span> <span class="p">}</span>\n\n<span class="k">func</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">queryResolver</span><span class="p">)</span> <span class="n">Todos</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="p">([]</span><span class="o">*</span><span class="n">Todo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nb">panic</span><span class="p">(</span><span class="s">"not implemented"</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>上記の <code>panic("not implemented")</code> のところを、フロントエンドから呼ばれた時に実行したロジックに変える。<br>\nというわけで、↓のような感じで修正した。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ git diff\ndiff --git a/backend/resolver.go b/backend/resolver.go\nindex d015cbe..9bbe326 100644\n--- a/backend/resolver.go\n+++ b/backend/resolver.go\n@@ -16,11 +16,38 @@ func (r *Resolver) Query() QueryResolver {\n type mutationResolver struct{ *Resolver }\n\n func (r *mutationResolver) CreateTodo(ctx context.Context, input NewTodo) (*Todo, error) {\n-       panic("not implemented")\n+       return &amp;Todo{\n+               ID:   "todo001",\n+               Text: "部屋の掃除",\n+               Done: false,\n+               User: &amp;User{\n+                       ID:   "user001",\n+                       Name: "たろー",\n+               },\n+       },nil\n }\n\n type queryResolver struct{ *Resolver }\n\n func (r *queryResolver) Todos(ctx context.Context) ([]*Todo, error) {\n-       panic("not implemented")\n+       return []*Todo{\n+               &amp;Todo{\n+                       ID:   "todo001",\n+                       Text: "部屋の掃除",\n+                       Done: false,\n+                       User: &amp;User{\n+                               ID:   "user001",\n+                               Name: "たろー",\n+                       },\n+               },\n+               &amp;Todo{\n+                       ID:   "todo002",\n+                       Text: "買い物",\n+                       Done: true,\n+                       User: &amp;User{\n+                               ID:   "user001",\n+                               Name: "たろー",\n+                       },\n+               },\n+       },nil\n }\n</pre></div></div>\n\n<h4>\n<span id="goサーバー起動ロジック" class="fragment"></span><a href="#go%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E8%B5%B7%E5%8B%95%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>Goサーバー起動ロジック</h4>\n\n<p>gqlgenコマンドによる自動生成対象にmain関数及びWebサーバー起動ロジックも含まれている。<br>\n8080ポートで起動し、ルートパスでGraphQLのプレイグラウンドが表示されるようになっている。（もう、いたれりつくせり）</p>\n\n<div class="code-frame" data-lang="go">\n<div class="code-lang"><span class="bold">[server/server.go]</span></div>\n<div class="highlight"><pre><span class="k">package</span> <span class="n">main</span>\n\n<span class="k">import</span> <span class="p">(</span>\n    <span class="s">"log"</span>\n    <span class="s">"net/http"</span>\n    <span class="s">"os"</span>\n\n    <span class="s">"github.com/99designs/gqlgen/handler"</span>\n    <span class="s">"github.com/sky0621/study-graphql/backend"</span>\n<span class="p">)</span>\n\n<span class="k">const</span> <span class="n">defaultPort</span> <span class="o">=</span> <span class="s">"8080"</span>\n\n<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>\n    <span class="n">port</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"PORT"</span><span class="p">)</span>\n    <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>\n        <span class="n">port</span> <span class="o">=</span> <span class="n">defaultPort</span>\n    <span class="p">}</span>\n\n    <span class="n">http</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">Playground</span><span class="p">(</span><span class="s">"GraphQL playground"</span><span class="p">,</span> <span class="s">"/query"</span><span class="p">))</span>\n    <span class="n">http</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="s">"/query"</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">GraphQL</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">NewExecutableSchema</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span><span class="n">Resolvers</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">backend</span><span class="o">.</span><span class="n">Resolver</span><span class="p">{}})))</span>\n\n    <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"connect to http://localhost:%s/ for GraphQL playground"</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>\n    <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":"</span><span class="o">+</span><span class="n">port</span><span class="p">,</span> <span class="no">nil</span><span class="p">))</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="graphqlサーバー起動" class="fragment"></span><a href="#graphql%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>GraphQLサーバー起動</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/backend\n$\n$ go run server/server.go \n2019/11/16 12:33:49 connect to http://localhost:8080/ for GraphQL playground\n</pre></div></div>\n\n<p>で、ブラウザで「<code>http://localhost:8080/</code>」を開くと、こんな感じ。<br>\n左側にGraphQLサーバー宛にクエリを書く欄があるので、赤枠のように記載し、<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F30c258c7-ccfd-5f8e-fb70-69f63c17f2b5.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=d7857b401f74004c26b743c20c6aa35a" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F30c258c7-ccfd-5f8e-fb70-69f63c17f2b5.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=d7857b401f74004c26b743c20c6aa35a" alt="screenshot-localhost-8080-2019.11.16-12-37-10.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/30c258c7-ccfd-5f8e-fb70-69f63c17f2b5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F30c258c7-ccfd-5f8e-fb70-69f63c17f2b5.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=d06ce2478dc401739a6db6c6169bf45f 1x" loading="lazy"></a><br>\n真ん中の実行ボタンを押すと、<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2Fc67606b8-ccc2-9d28-a5c1-80483c84ffef.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ce8c2b73567a6628dab2e01b18436397" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2Fc67606b8-ccc2-9d28-a5c1-80483c84ffef.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ce8c2b73567a6628dab2e01b18436397" alt="screenshot-localhost-8080-2019.11.16-12-38-57.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/c67606b8-ccc2-9d28-a5c1-80483c84ffef.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2Fc67606b8-ccc2-9d28-a5c1-80483c84ffef.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=8b170aeb948d27d0b6dd1ff8e9febe59 1x" loading="lazy"></a><br>\n<code>resolver.go</code>の<code>Todos(ctx context.Context) ([]*Todo, error)</code>に実装したレスポンスが返ってくる。</p>\n\n<p>はい。こんなふうに赤枠内のようなクエリを書くプラットフォームを用意すれば、クエリの内容に応じた結果を返してくれる。<br>\nちなみに、GraphQLの凄いところは、以下のように、欲しい情報だけに絞ってクエリ書けば、それだけが結果として返ってくるというところ。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F2001ada3-3e07-d197-8c54-c248434b7b0d.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ea522fb3876d8266d6a849fe037b4d0c" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F2001ada3-3e07-d197-8c54-c248434b7b0d.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ea522fb3876d8266d6a849fe037b4d0c" alt="screenshot-localhost-8080-2019.11.16-12-43-04.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/2001ada3-3e07-d197-8c54-c248434b7b0d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F2001ada3-3e07-d197-8c54-c248434b7b0d.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=0a1afd6af64cd853ececc9dc82d2eee1 1x" loading="lazy"></a><br>\nこれが今までのRESTに対するGraphQLの大きなメリットのよう。</p>\n\n<p>ただ、今回は<code>resolver.go</code>の中で固定値を返しているので気にならないけど、RDBへ永続化することを考えると、わりとバックエンドの実装がつらくなりそうな感は出てくると思う。<br>\n実際、業務でGraphQLのフロントエンドとバックエンド両方書いているけど、情報のやり取りという点に限って言えば、バックエンドの方が圧倒的につらい。<br>\n（まあ、そのへんは、次の記事あたりでRDB接続するコードを書く予定なので、その時に）</p>\n\n<p>さて、Todo新規登録の方の確認は（クエリと一緒なので）端折りつつ、バックエンドはここまで。<br>\n最後は、フロントエンドをいじって、バックエンドのGraphQLサーバーと接続させる。</p>\n\n<h2>\n<span id="再びフロントエンド" class="fragment"></span><a href="#%E5%86%8D%E3%81%B3%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>再びフロントエンド</h2>\n\n<h3>\n<span id="apolloを使ってgraphqlサーバ接続" class="fragment"></span><a href="#apollo%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6graphql%E3%82%B5%E3%83%BC%E3%83%90%E6%8E%A5%E7%B6%9A"><i class="fa fa-link"></i></a>Apolloを使ってGraphQLサーバ接続</h3>\n\n<h4>\n<span id="queryファイルの用意" class="fragment"></span><a href="#query%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%94%A8%E6%84%8F"><i class="fa fa-link"></i></a>Queryファイルの用意</h4>\n\n<p>バックエンドでプレイグラウンドで試したように、GraphQLサーバにリクエストするにはQueryを書く必要があるので用意。<br>\n<code>apollo</code> というディレクトリを追加し、配下に構造を作って「Todo一覧取得」用のQueryファイルを格納。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend\n$\n$ tree -L 1\n.\n├── apollo\n├── assets\n├── components\n　　　・・・\n$\n$ tree -L 2 apollo/\napollo/\n└── queries\n    └── todos.gql\n$\n$ cat apollo/queries/todos.gql \nquery todos {\n  todos {\n    id\n    text\n    done\n    user {\n      id\n      name\n    }\n  }\n}\n</pre></div></div>\n\n<h4>\n<span id="フロントエンドトップページ" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%88%E3%83%83%E3%83%97%E3%83%9A%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>フロントエンドトップページ</h4>\n\n<p>開くとTodo一覧を表示するよう修正。</p>\n\n<p>フロントエンドは以下のディレクトリ構成になっている。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ tree -L 1\n.\n├── apollo\n├── assets\n├── components\n├── layouts\n├── middleware\n├── node_modules\n├── nuxt.config.js\n├── package.json\n├── pages\n├── plugins\n├── README.md\n├── static\n├── store\n└── yarn.lock\n</pre></div></div>\n\n<p>このうち、<code>pages/index.vue</code> を修正する。<br>\nまた、 <code>pages</code> から呼び出すコンポーネントとして <code>components/TodoCard.vue</code> を作成する。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">[pages/index.vue]</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;TodoCard</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">TodoCard</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/components/TodoCard.vue</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span> <span class="nx">TodoCard</span> <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>ページの方はコンポーネントを呼び出すだけだから良いでしょう。<br>\n以下のコンポーネントで、Todo一覧をApollo経由で取得している。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">[components/TodoCard.vue]</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;v-row&gt;</span>\n      <span class="nt">&lt;v-col</span> <span class="na">cols=</span><span class="s">"12"</span> <span class="na">sm=</span><span class="s">"6"</span> <span class="na">offset-sm=</span><span class="s">"3"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;v-card&gt;</span>\n          <span class="nt">&lt;v-list</span> <span class="na">two-line</span> <span class="na">subheader</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;v-list-item</span> <span class="na">v-for=</span><span class="s">"todo in todos"</span> <span class="na">:key=</span><span class="s">"todo.id"</span> <span class="na">link</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-list-item-avatar&gt;</span>\n                <span class="nt">&lt;v-icon&gt;</span>mdi-gift-outline<span class="nt">&lt;/v-icon&gt;</span>\n              <span class="nt">&lt;/v-list-item-avatar&gt;</span>\n              <span class="nt">&lt;v-list-item-content&gt;</span>\n                <span class="nt">&lt;v-list-item-title&gt;</span><span class="si">{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">text</span> <span class="si">}}</span><span class="nt">&lt;/v-list-item-title&gt;</span>\n                <span class="nt">&lt;v-list-item-subtitle&gt;</span><span class="si">{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">done</span> <span class="si">}}</span><span class="nt">&lt;/v-list-item-subtitle&gt;</span>\n              <span class="nt">&lt;/v-list-item-content&gt;</span>\n              <span class="nt">&lt;v-list-item-content&gt;</span>\n                <span class="nt">&lt;v-list-item-title&gt;</span>\n                  <span class="si">{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="si">}}</span>\n                <span class="nt">&lt;/v-list-item-title&gt;</span>\n              <span class="nt">&lt;/v-list-item-content&gt;</span>\n            <span class="nt">&lt;/v-list-item&gt;</span>\n          <span class="nt">&lt;/v-list&gt;</span>\n        <span class="nt">&lt;/v-card&gt;</span>\n      <span class="nt">&lt;/v-col&gt;</span>\n    <span class="nt">&lt;/v-row&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">todos</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/apollo/queries/todos.gql</span><span class="dl">\'</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">todos</span><span class="p">:</span> <span class="p">[]</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n\n  <span class="na">apollo</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">todos</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">prefetch</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n      <span class="na">query</span><span class="p">:</span> <span class="nx">todos</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>GraphQLサーバに問い合わせるQueryは、あらかじめ用意していた拡張子 <code>gql</code> のファイルからimportすることが出来る。</p>\n\n<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span class="k">import</span> <span class="nx">todos</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/apollo/queries/todos.gql</span><span class="dl">\'</span>\n</pre></div></div>\n\n<p><code>nuxt-config.js</code> で <code>@nuxtjs/apollo</code> をモジュールとして読み込む設定にしており、Vueファイル上で以下のように定義することでGraphQlサーバに問い合わせた結果を data に定義した <code>todos</code> に格納してくれる。</p>\n\n<div class="code-frame" data-lang="javascript"><div class="highlight"><pre>  <span class="nx">apollo</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">todos</span><span class="p">:</span> <span class="p">{</span>\n      <span class="nl">prefetch</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n      <span class="nx">query</span><span class="p">:</span> <span class="nx">todos</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n</pre></div></div>\n\n<p>一覧表示に使う Vuetify のコンポーネントは <code>v-card</code> を使うことにした。（ <code>v-data-table</code> でもよかったけど）<br>\n表示部分は上記で <code>todos</code> に取得したTODO一覧を <code>v-for</code> でぐるぐる回しつつ各項目を表示しているだけなので説明は無しで。</p>\n\n<p>あぁ、そうだ。忘れてた。GraphQLサーバのパスは「<code>/query</code>」なので<code>nuxt-config.js</code>を以下のように修正。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>diff --git a/frontend/nuxt.config.js b/frontend/nuxt.config.js\nindex afc0db4..8454218 100644\n--- a/frontend/nuxt.config.js\n+++ b/frontend/nuxt.config.js\n@@ -69,7 +69,7 @@ export default {\n     clientConfigs: {\n       default: {\n         // Goサーバを 8080 ポートで起動する予定のため\n-        httpEndpoint: \'http://localhost:8080/\'\n+        httpEndpoint: \'http://localhost:8080/query\'\n       }\n     },\n</pre></div></div>\n\n<p>で、このように実装したものをブラウザで表示してみると、↓のようになる。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F469c867c-9643-9af5-9c35-5e3bdc5b4e17.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=7e578af11278c14f50a422565944db01" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F469c867c-9643-9af5-9c35-5e3bdc5b4e17.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=7e578af11278c14f50a422565944db01" alt="screenshot-localhost-35567-2019.11.16-15-04-51.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/469c867c-9643-9af5-9c35-5e3bdc5b4e17.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F180599%2F469c867c-9643-9af5-9c35-5e3bdc5b4e17.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=1c9a196e7d9c55b3eebea0146cc07eca 1x" loading="lazy"></a><br>\nちゃんとGoのGraphQLサーバーで <code>resolver.go</code> から返すように実装した内容が表示されている。</p>\n\n<h1>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>\n\n<p>時間の都合でTodo新規登録は端折ったけど、GraphQL使ってフロントエンドとバックエンドつなぐ実装事例は出せたかな。<br>\nただ、今回のお題と作り込みレベルだとGraphQLを使うべきモチベーションは、まだ湧かないかも・・・。<br>\nフロントエンド目線からすると、１ページに一覧として複数階層構造の情報を表示する時に、これまでは階層ごとにAPIを叩いてたみたいなのがなくなって、１ページに必要な情報が一気に取ってこれて（GraphQLライブラリの恩恵で）フロントエンドで使いやすいよう構造化までしてくれるというのが嬉しいかな。<br>\nが、逆に、バックエンドは考慮しないといけないことが目白押し、かつ、GraphQL自体は仕様としては存在するものの、例えば「認証」、「ページング」など個別の具体的な実装までは規定していないので、使うライブラリ次第では自前でゴリゴリ車輪の再発明をする必要性に迫られる。<br>\n<a href="https://www.prisma.io/" rel="nofollow noopener" target="_blank">Prisma</a>のようなフレームワーク的(?)なものもあるようだけど、もうちょっとほうぼうでの実績、ナレッジが溜まってこないとプロダクションレベルで使うのは怖い。。。</p>\n\n<p>今回の全ソースは下記。<br>\n<a href="https://github.com/sky0621/study-graphql/tree/v0.1.0" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sky0621/study-graphql/tree/v0.1.0</a></p>\n',body:'# お題\n簡易ToDoアプリ（と言っても、この記事上では単に「ToDoの新規登録」と「登録済みの全ToDoの表示」しか出来ない）を題材として、表題の組み合わせでGraphQL通信ロジックを書くとどんな感じになるかを確認してみる。\n※今回はRDBを使った永続化などはしないで、バックエンドからは固定値を返す。\n\n# 前提\nNuxt.jsやGoについては、個人ないし会社での開発経験があり、フロント->サーバの接続は（例えば）Axiosなど使ってRESTでやってたけど、GraphQLに変えてみたいという人が対象。\nただ、「そもそもGraphQLとは？」とか「RESTと比べたメリット・デメリットは？」みたいなことは書かない。（既に記事がいっぱいある。）\n\nまた、お題に則り最小限の構造で実装する。\n巷で流行りのClean ArchitectureやDDDに即したパッケージ構成とかは考えない。\nそのへんは、一度↓みたいな記事を書いた。↓でなく、もっといい記事はググればたくさん出てくる。\n[Clean Architecture by Golang(with Echo & Gorm & wire)](https://qiita.com/sky0621/items/d549dc3cc6796152b28d)\n\n# 開発環境\n## # OS - Linux(Ubuntu)\n```\n$ cat /etc/os-release\nNAME="Ubuntu"\nVERSION="18.04.2 LTS (Bionic Beaver)"\n```\n\n## # フロントエンド\n### Nuxt.js\n```\n$ cat yarn.lock | grep "@nuxt/vue-app"\n    "@nuxt/vue-app" "2.10.2"\n```\n\n### パッケージマネージャ - Yarn\n```\n$ yarn -v\n1.19.1\n```\n\n### IDE - WebStorm\n```\nWebStorm 2019.2.4\nBuild #WS-192.7142.35, built on October 29, 2019\n```\n\n## # バックエンド\n### 言語 - Go\n```\n$ go version\ngo version go1.13.3 linux/amd64\n```\n\n### パッケージマネージャ - Go Modules\n\n### IDE - Goland\n```\nGoLand 2019.2.5\nBuild #GO-192.7142.48, built on November 8, 2019\n```\n\n# 参考\n## GraphQL\nhttps://graphql.org/\n\n## フロントエンド\nhttps://www.apollographql.com/docs/\n\n## バックエンド\nhttps://gqlgen.com/\n\n# 実践\nGitHub上に適当なリポジトリを作ってローカルにgit clone\n自分の環境だとこんな感じ。\n\n```\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql\n```\n\n## フロントエンド\n### [create-nuxt-app](https://ja.nuxtjs.org/guide/installation)コマンドを使ってフロント用のNuxt.jsプロジェクトを作成\nツール類の選択は以下参照。\n\n- UIは[Vuetify.js](https://vuetifyjs.com/en/)\n- SSRとSPAはどっちでもいいけどデフォのSSR\n- 今回はテストまで考えてないのでテストフレームワークは無し\n- サーバーサイドとの接続はGraphQLなので[Axios](https://axios.nuxtjs.org/)などは無し\n\n```\n$ yarn create nuxt-app frontend\nyarn create v1.19.1\n　　　・・・\nsuccess Installed "create-nuxt-app@2.11.1" with binaries:\n      - create-nuxt-app\n\ncreate-nuxt-app v2.11.1\n✨  Generating Nuxt.js project in frontend\n? Project name frontend\n? Project description My ace Nuxt.js project\n? Author name sky0621\n? Choose the package manager Yarn\n? Choose UI framework Vuetify.js\n? Choose custom server framework None (Recommended)\n? Choose Nuxt.js modules (Press <space> to select, <a> to toggle all, <i> to invert selection)\n? Choose linting tools ESLint, Prettier\n? Choose test framework None\n? Choose rendering mode Universal (SSR)\n? Choose development tools (Press <space> to select, <a> to toggle all, <i> to invert selection)\nyarn run v1.19.1\n$ eslint --ext .js,.vue --ignore-path .gitignore . --fix\nDone in 2.90s.\n\n🎉  Successfully created project frontend\n```\n\n現時点で以下のようなディレクトリ構成となっている。\n\n```\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql\n$\n$ tree -L 2\n.\n├── frontend\n│   ├── assets\n│   ├── components\n│   ├── layouts\n│   ├── middleware\n│   ├── node_modules\n│   ├── nuxt.config.js\n│   ├── package.json\n│   ├── pages\n│   ├── plugins\n│   ├── README.md\n│   ├── static\n│   ├── store\n│   └── yarn.lock\n└── README.md\n```\n\nそして、パッケージのdevDependenciesも念のため記載。\n\n```\n$ cat frontend/package.json \n{\n　　・・・\n  "dependencies": {\n    "nuxt": "^2.0.0"\n  },\n  "devDependencies": {\n    "@nuxtjs/vuetify": "^1.0.0",\n    "@nuxtjs/eslint-config": "^1.0.1",\n    "@nuxtjs/eslint-module": "^1.0.0",\n    "babel-eslint": "^10.0.1",\n    "eslint": "^6.1.0",\n    "eslint-plugin-nuxt": ">=0.4.2",\n    "eslint-config-prettier": "^4.1.0",\n    "eslint-plugin-prettier": "^3.0.1",\n    "prettier": "^1.16.4"\n  }\n}\n```\n\n### nuxtjs/apolloの導入\n#### パッケージ追加\n```\n$ cd frontend/\n$\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend\n$\n$ yarn add @nuxtjs/apollo\nyarn add v1.19.1\n[1/4] Resolving packages...\n[2/4] Fetching packages...\ninfo fsevents@2.1.2: The platform "linux" is incompatible with this module.\n　　・・・\nDone in 15.54s.\n```\n\n#### nuxt-config.jsへ設定追記\n```\n$ git diff frontend/nuxt.config.js\ndiff --git a/frontend/nuxt.config.js b/frontend/nuxt.config.js\nindex 25a0fe4..afc0db4 100644\n--- a/frontend/nuxt.config.js\n+++ b/frontend/nuxt.config.js\n@@ -42,7 +42,7 @@ export default {\n   /*\n    ** Nuxt.js modules\n    */\n-  modules: [],\n+  modules: [\'@nuxtjs/apollo\'],\n   /*\n    ** vuetify module configuration\n    ** https://github.com/nuxt-community/vuetify-module\n@@ -64,6 +64,18 @@ export default {\n       }\n     }\n   },\n+\n+  apollo: {\n+    clientConfigs: {\n+      default: {\n+        // Goサーバを 8080 ポートで起動する予定のため\n+        httpEndpoint: \'http://localhost:8080/\'\n+      }\n+    },\n+    // 任意だけど、これがないとGraphQL的なエラー起きた時に原因が掴みづらいため\n+    errorHandler: \'~/plugins/apollo-error-handler.js\'\n+  },\n+\n   /*\n    ** Build configuration\n    */\n```\n\n#### GraphQLエラーハンドリングプラグイン\n```\n$ cat frontend/plugins/apollo-error-handler.js \nexport default (error, context) => {\n  console.log(error)\n  context.error({ statusCode: 304, message: \'Server error\' })\n}\n```\n\n参考：https://github.com/nuxt-community/apollo-module\n\n### フロントエンド起動\nここまででいったん起動してみる。\n\n```\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend\n$\n$ yarn run dev\nyarn run v1.19.1\n$ nuxt\n\n WARN  Address localhost:8080 is already in use.                                                                                                                                                                                                           11:40:12\n\nℹ Trying a random port...                                                                                                                                                                                                                                  11:40:12\n\n   ╭─────────────────────────────────────────────╮\n   │                                             │\n   │   Nuxt.js v2.10.2                           │\n   │   Running in development mode (universal)   │\n   │                                             │\n   │   Listening on: http://localhost:44171/     │\n   │                                             │\n   ╰─────────────────────────────────────────────╯\n\nℹ Preparing project for development                                                                                                                                                                                                                        11:40:13\nℹ Initial build may take a while                                                                                                                                                                                                                           11:40:13\n✔ Builder initialized                                                                                                                                                                                                                                      11:40:13\n✔ Nuxt files generated                                                                                                                                                                                                                                     11:40:13\n\n● Client █████████████████████████ building (35%) 215/225 modules 10 active\n node_modules/vuetify/dist/vuetify.js\n\n● Server █████████████████████████ building (19%) 81/81 modules 0 active\n \n\n\n ERROR  Failed to compile with 1 errors                                                                                                                                                                                                    friendly-errors 11:40:31\n\n\n ERROR  in ./plugins/apollo-error-handler.js                                                                                                                                                                                               friendly-errors 11:40:31\n\nModule Error (from ./node_modules/eslint-loader/dist/cjs.js):                                                                                                                                                                              friendly-errors 11:40:31\n\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend/plugins/apollo-error-handler.js\n  2:3  warning  Unexpected console statement  no-console\n  5:1  error    Delete `⏎`                    prettier/prettier\n\n✖ 2 problems (1 error, 1 warning)\n  1 error and 0 warnings potentially fixable with the `--fix` option.\n\n                                                                                                                                                                                                                                           friendly-errors 11:40:31\n @ ./.nuxt/apollo-module.js 93:13-57\n @ ./.nuxt/index.js\n @ ./.nuxt/client.js\n @ multi eventsource-polyfill webpack-hot-middleware/client?reload=true&timeout=30000&ansiColors=&overlayStyles=&name=client&path=/__webpack_hmr/client ./.nuxt/client.js\n                                                                                                                                                                                                                                           friendly-errors 11:40:31\nℹ Waiting for file changes                                                                                                                                                                                                                                 11:40:31\nℹ Memory usage: 433 MB (RSS: 559 MB)                                                                                                                                                                                                                       11:40:31\n\n ERROR  ENOSPC: System limit for number of file watchers reached, watch \'/home/sky0621/src/github.com/sky0621/study-graphql/frontend/node_modules/@nuxt/vue-app/template/views/loading\'                                                                    11:40:31\n\n  at FSWatcher.start (internal/fs/watchers.js:165:26)\n  at Object.watch (fs.js:1329:11)\n  at createFsWatchInstance (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:118:15)\n  at setFsWatchListener (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:165:15)\n  at NodeFsHandler._watchWithNodeFs (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:330:14)\n  at NodeFsHandler._handleDir (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:551:19)\n  at runMicrotasks (<anonymous>)\n  at processTicksAndRejections (internal/process/task_queues.js:93:5)\n  at async NodeFsHandler._addToNodeFs (node_modules/@nuxt/builder/node_modules/chokidar/lib/nodefs-handler.js:600:16)\n```\n\n怒られた。[Prettier](https://prettier.io/)さんチェックが入った。\n言われた通り、lint fix する。\n\n```\n$ yarn run lint --fix\nyarn run v1.19.1\n$ eslint --ext .js,.vue --ignore-path .gitignore . --fix\n\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend/plugins/apollo-error-handler.js\n  2:3  warning  Unexpected console statement  no-console\n\n✖ 1 problem (0 errors, 1 warning)\n\nDone in 2.27s.\n```\n\nすると、起動できた。\nなんか１件 WARN は出てるけど・・・これはエラーハンドラー内でデバッグ用にconsoleログ吐いてるからか。\n本番リリース時は消すという前提でいったん無視（まあ、本番リリースしないし）。\n\n```\n　　〜〜〜\n\n↻ Updated plugins/apollo-error-handler.js                                                                                                                                                                                                                  11:45:05\n\n✔ Client\n  Compiled successfully in 694.86ms\n\n✔ Server\n  Compiled successfully in 823.17ms\n\n\n WARN  Compiled with 1 warnings                                                                                                                                                                                                            friendly-errors 11:45:07\n\nModule Warning (from ./node_modules/eslint-loader/dist/cjs.js):                                                                                                                                                                            friendly-errors 11:45:07\n\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend/plugins/apollo-error-handler.js\n  2:3  warning  Unexpected console statement  no-console\n\n✖ 1 problem (0 errors, 1 warning)\n\n                                                                                                                                                                                                                                           friendly-errors 11:45:07\nYou may use special comments to disable some warnings.                                                                                                                                                                                     friendly-errors 11:45:07\nUse // eslint-disable-next-line to ignore the next line.                                                                                                                                                                                   friendly-errors 11:45:07\nUse /* eslint-disable */ to ignore all warnings in a file.                                                                                                                                                                                 friendly-errors 11:45:07\n```\n\n起動ログの冒頭で「 `http://localhost:44171/` 」と記載があったので、そのポートで起動チェック。\n![screenshot-localhost-44171-2019.11.16-11-56-29.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/74e1fa3c-1e41-d1e1-0574-1d25001923ff.png)\nうん、OK。GraphQL的なあれこれはバックエンド作ってから確認するので、フロントエンドは、ひとまずここまで。\n\n## バックエンド\n### バックエンド用ソース格納ディレクトリとGraphQLスキーマ格納ディレクトリを作成\n```\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql\n$ tree -L 1\n.\n├── frontend\n└── README.md\n\n1 directory, 1 file\n$ mkdir backend\n$ tree -L 1\n.\n├── backend\n├── frontend\n└── README.md\n```\n\n### Goプロジェクト初期化\n```\n$ cd backend/\n$ go mod init github.com/sky0621/study-graphql/backend\ngo: creating new go.mod: module github.com/sky0621/study-graphql/backend$ tree -L 1\n.\n└── go.mod\n\n0 directories, 1 file\n$ cat go.mod \nmodule github.com/sky0621/study-graphql/backend\n\ngo 1.13\n```\n\n### gqlgenコマンドによるスケルトン生成\n一気にいろいろなファイルが自動生成される。（GraphQLスキーマすら書いてないのにサンプルを用意してくれる）\n\n```\n$ go run github.com/99designs/gqlgen init\nExec "go run ./server/server.go" to start GraphQL server\n$\n$ tree -L 2\n.\n├── generated.go\n├── go.mod\n├── go.sum\n├── gqlgen.yml\n├── models_gen.go\n├── resolver.go\n├── schema.graphql\n└── server\n    └── server.go\n```\n\n### 自動生成物のチェック\n#### GraphQLスキーマ\n```graphql:[schema.graphql]\n# GraphQL schema example\n#\n# https://gqlgen.com/getting-started/\n\ntype Todo {\n  id: ID!\n  text: String!\n  done: Boolean!\n  user: User!\n}\n\ntype User {\n  id: ID!\n  name: String!\n}\n\ntype Query {\n  todos: [Todo!]!\n}\n\ninput NewTodo {\n  text: String!\n  userId: String!\n}\n\ntype Mutation {\n  createTodo(input: NewTodo!): Todo!\n}\n```\n\n実は、お題を『簡易ToDoアプリ』としたのは、gqlgen がデフォルトで自動生成するスキーマが↑だからでした。\ngqlgenはスキーマファーストを前提とするライブラリなので、このスキーマを元にして、初回だけ自動生成されるソースとgqlgenコマンド実行のたびに自動生成されるソースとを組み合わせて機能を実現していく。\n\n#### リゾルバー\nGraphQLスキーマで定義されたQuery（この事例だと「`todos: [Todo!]!`」（要するにToDo一覧取得））とMutation（この事例だと「`createTodo(input: NewTodo!): Todo!`」（要するにToDo新規登録））のロジックを実装するソース。\n※このソースは、gqlgenコマンドによって初回だけ自動生成されるソース。（以降は、このファイルを消すか、`gqlgen.yml` の設定をいじらない限り再生成はされない。）\n\n```go:[resolver.go]\npackage backend\n\nimport (\n\t"context"\n) // THIS CODE IS A STARTING POINT ONLY. IT WILL NOT BE UPDATED WITH SCHEMA CHANGES.\n\ntype Resolver struct{}\n\nfunc (r *Resolver) Mutation() MutationResolver {\n\treturn &mutationResolver{r}\n}\nfunc (r *Resolver) Query() QueryResolver {\n\treturn &queryResolver{r}\n}\n\ntype mutationResolver struct{ *Resolver }\n\nfunc (r *mutationResolver) CreateTodo(ctx context.Context, input NewTodo) (*Todo, error) {\n\tpanic("not implemented")\n}\n\ntype queryResolver struct{ *Resolver }\n\nfunc (r *queryResolver) Todos(ctx context.Context) ([]*Todo, error) {\n\tpanic("not implemented")\n}\n```\n\n上記の `panic("not implemented")` のところを、フロントエンドから呼ばれた時に実行したロジックに変える。\nというわけで、↓のような感じで修正した。\n\n```\n$ git diff\ndiff --git a/backend/resolver.go b/backend/resolver.go\nindex d015cbe..9bbe326 100644\n--- a/backend/resolver.go\n+++ b/backend/resolver.go\n@@ -16,11 +16,38 @@ func (r *Resolver) Query() QueryResolver {\n type mutationResolver struct{ *Resolver }\n \n func (r *mutationResolver) CreateTodo(ctx context.Context, input NewTodo) (*Todo, error) {\n-       panic("not implemented")\n+       return &Todo{\n+               ID:   "todo001",\n+               Text: "部屋の掃除",\n+               Done: false,\n+               User: &User{\n+                       ID:   "user001",\n+                       Name: "たろー",\n+               },\n+       },nil\n }\n \n type queryResolver struct{ *Resolver }\n \n func (r *queryResolver) Todos(ctx context.Context) ([]*Todo, error) {\n-       panic("not implemented")\n+       return []*Todo{\n+               &Todo{\n+                       ID:   "todo001",\n+                       Text: "部屋の掃除",\n+                       Done: false,\n+                       User: &User{\n+                               ID:   "user001",\n+                               Name: "たろー",\n+                       },\n+               },\n+               &Todo{\n+                       ID:   "todo002",\n+                       Text: "買い物",\n+                       Done: true,\n+                       User: &User{\n+                               ID:   "user001",\n+                               Name: "たろー",\n+                       },\n+               },\n+       },nil\n }\n```\n\n#### Goサーバー起動ロジック\ngqlgenコマンドによる自動生成対象にmain関数及びWebサーバー起動ロジックも含まれている。\n8080ポートで起動し、ルートパスでGraphQLのプレイグラウンドが表示されるようになっている。（もう、いたれりつくせり）\n\n```go:[server/server.go]\npackage main\n\nimport (\n\t"log"\n\t"net/http"\n\t"os"\n\n\t"github.com/99designs/gqlgen/handler"\n\t"github.com/sky0621/study-graphql/backend"\n)\n\nconst defaultPort = "8080"\n\nfunc main() {\n\tport := os.Getenv("PORT")\n\tif port == "" {\n\t\tport = defaultPort\n\t}\n\n\thttp.Handle("/", handler.Playground("GraphQL playground", "/query"))\n\thttp.Handle("/query", handler.GraphQL(backend.NewExecutableSchema(backend.Config{Resolvers: &backend.Resolver{}})))\n\n\tlog.Printf("connect to http://localhost:%s/ for GraphQL playground", port)\n\tlog.Fatal(http.ListenAndServe(":"+port, nil))\n}\n```\n\n### GraphQLサーバー起動\n```\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/backend\n$\n$ go run server/server.go \n2019/11/16 12:33:49 connect to http://localhost:8080/ for GraphQL playground\n```\n\nで、ブラウザで「`http://localhost:8080/`」を開くと、こんな感じ。\n左側にGraphQLサーバー宛にクエリを書く欄があるので、赤枠のように記載し、\n![screenshot-localhost-8080-2019.11.16-12-37-10.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/30c258c7-ccfd-5f8e-fb70-69f63c17f2b5.png)\n真ん中の実行ボタンを押すと、\n![screenshot-localhost-8080-2019.11.16-12-38-57.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/c67606b8-ccc2-9d28-a5c1-80483c84ffef.png)\n`resolver.go`の`Todos(ctx context.Context) ([]*Todo, error)`に実装したレスポンスが返ってくる。\n\nはい。こんなふうに赤枠内のようなクエリを書くプラットフォームを用意すれば、クエリの内容に応じた結果を返してくれる。\nちなみに、GraphQLの凄いところは、以下のように、欲しい情報だけに絞ってクエリ書けば、それだけが結果として返ってくるというところ。\n![screenshot-localhost-8080-2019.11.16-12-43-04.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/2001ada3-3e07-d197-8c54-c248434b7b0d.png)\nこれが今までのRESTに対するGraphQLの大きなメリットのよう。\n\nただ、今回は`resolver.go`の中で固定値を返しているので気にならないけど、RDBへ永続化することを考えると、わりとバックエンドの実装がつらくなりそうな感は出てくると思う。\n実際、業務でGraphQLのフロントエンドとバックエンド両方書いているけど、情報のやり取りという点に限って言えば、バックエンドの方が圧倒的につらい。\n（まあ、そのへんは、次の記事あたりでRDB接続するコードを書く予定なので、その時に）\n\nさて、Todo新規登録の方の確認は（クエリと一緒なので）端折りつつ、バックエンドはここまで。\n最後は、フロントエンドをいじって、バックエンドのGraphQLサーバーと接続させる。\n\n## 再びフロントエンド\n### Apolloを使ってGraphQLサーバ接続\n#### Queryファイルの用意\nバックエンドでプレイグラウンドで試したように、GraphQLサーバにリクエストするにはQueryを書く必要があるので用意。\n`apollo` というディレクトリを追加し、配下に構造を作って「Todo一覧取得」用のQueryファイルを格納。\n\n```\n$ pwd\n/home/sky0621/src/github.com/sky0621/study-graphql/frontend\n$\n$ tree -L 1\n.\n├── apollo\n├── assets\n├── components\n　　　・・・\n$\n$ tree -L 2 apollo/\napollo/\n└── queries\n    └── todos.gql\n$\n$ cat apollo/queries/todos.gql \nquery todos {\n  todos {\n    id\n    text\n    done\n    user {\n      id\n      name\n    }\n  }\n}\n```\n\n#### フロントエンドトップページ\n開くとTodo一覧を表示するよう修正。\n\nフロントエンドは以下のディレクトリ構成になっている。\n\n```\n$ tree -L 1\n.\n├── apollo\n├── assets\n├── components\n├── layouts\n├── middleware\n├── node_modules\n├── nuxt.config.js\n├── package.json\n├── pages\n├── plugins\n├── README.md\n├── static\n├── store\n└── yarn.lock\n```\n\nこのうち、`pages/index.vue` を修正する。\nまた、 `pages` から呼び出すコンポーネントとして `components/TodoCard.vue` を作成する。\n\n```vue:[pages/index.vue]\n<template>\n  <div>\n    <TodoCard />\n  </div>\n</template>\n\n<script>\nimport TodoCard from \'~/components/TodoCard.vue\'\n\nexport default {\n  components: { TodoCard }\n}\n<\/script>\n```\n\nページの方はコンポーネントを呼び出すだけだから良いでしょう。\n以下のコンポーネントで、Todo一覧をApollo経由で取得している。\n\n```vue:[components/TodoCard.vue]\n<template>\n  <div>\n    <v-row>\n      <v-col cols="12" sm="6" offset-sm="3">\n        <v-card>\n          <v-list two-line subheader>\n            <v-list-item v-for="todo in todos" :key="todo.id" link>\n              <v-list-item-avatar>\n                <v-icon>mdi-gift-outline</v-icon>\n              </v-list-item-avatar>\n              <v-list-item-content>\n                <v-list-item-title>{{ todo.text }}</v-list-item-title>\n                <v-list-item-subtitle>{{ todo.done }}</v-list-item-subtitle>\n              </v-list-item-content>\n              <v-list-item-content>\n                <v-list-item-title>\n                  {{ todo.user.name }}\n                </v-list-item-title>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-card>\n      </v-col>\n    </v-row>\n  </div>\n</template>\n\n<script>\nimport todos from \'~/apollo/queries/todos.gql\'\nexport default {\n  data() {\n    return {\n      todos: []\n    }\n  },\n\n  apollo: {\n    todos: {\n      prefetch: true,\n      query: todos\n    }\n  }\n}\n<\/script>\n```\n\nGraphQLサーバに問い合わせるQueryは、あらかじめ用意していた拡張子 `gql` のファイルからimportすることが出来る。\n\n```javascript\nimport todos from \'~/apollo/queries/todos.gql\'\n```\n\n`nuxt-config.js` で `@nuxtjs/apollo` をモジュールとして読み込む設定にしており、Vueファイル上で以下のように定義することでGraphQlサーバに問い合わせた結果を data に定義した `todos` に格納してくれる。\n\n```javascript\n  apollo: {\n    todos: {\n      prefetch: true,\n      query: todos\n    }\n  }\n```\n\n一覧表示に使う Vuetify のコンポーネントは `v-card` を使うことにした。（ `v-data-table` でもよかったけど）\n表示部分は上記で `todos` に取得したTODO一覧を `v-for` でぐるぐる回しつつ各項目を表示しているだけなので説明は無しで。\n\nあぁ、そうだ。忘れてた。GraphQLサーバのパスは「`/query`」なので`nuxt-config.js`を以下のように修正。\n\n```\ndiff --git a/frontend/nuxt.config.js b/frontend/nuxt.config.js\nindex afc0db4..8454218 100644\n--- a/frontend/nuxt.config.js\n+++ b/frontend/nuxt.config.js\n@@ -69,7 +69,7 @@ export default {\n     clientConfigs: {\n       default: {\n         // Goサーバを 8080 ポートで起動する予定のため\n-        httpEndpoint: \'http://localhost:8080/\'\n+        httpEndpoint: \'http://localhost:8080/query\'\n       }\n     },\n```\n\nで、このように実装したものをブラウザで表示してみると、↓のようになる。\n![screenshot-localhost-35567-2019.11.16-15-04-51.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/180599/469c867c-9643-9af5-9c35-5e3bdc5b4e17.png)\nちゃんとGoのGraphQLサーバーで `resolver.go` から返すように実装した内容が表示されている。\n\n# まとめ\n時間の都合でTodo新規登録は端折ったけど、GraphQL使ってフロントエンドとバックエンドつなぐ実装事例は出せたかな。\nただ、今回のお題と作り込みレベルだとGraphQLを使うべきモチベーションは、まだ湧かないかも・・・。\nフロントエンド目線からすると、１ページに一覧として複数階層構造の情報を表示する時に、これまでは階層ごとにAPIを叩いてたみたいなのがなくなって、１ページに必要な情報が一気に取ってこれて（GraphQLライブラリの恩恵で）フロントエンドで使いやすいよう構造化までしてくれるというのが嬉しいかな。\nが、逆に、バックエンドは考慮しないといけないことが目白押し、かつ、GraphQL自体は仕様としては存在するものの、例えば「認証」、「ページング」など個別の具体的な実装までは規定していないので、使うライブラリ次第では自前でゴリゴリ車輪の再発明をする必要性に迫られる。\n[Prisma](https://www.prisma.io/)のようなフレームワーク的(?)なものもあるようだけど、もうちょっとほうぼうでの実績、ナレッジが溜まってこないとプロダクションレベルで使うのは怖い。。。\n\n今回の全ソースは下記。\nhttps://github.com/sky0621/study-graphql/tree/v0.1.0\n',coediting:a,comments_count:0,created_at:"2019-11-16T15:07:03+09:00",group:n,id:"8abd445edba347e8f6f1",likes_count:3,private:a,reactions_count:0,tags:[{name:"Go",versions:[]},{name:"GraphQL",versions:[]},{name:"apollo",versions:[]},{name:e,versions:[]},{name:"gqlgen",versions:[]}],title:"frontendに「nuxtjs/apollo」、backendに「go+gqlgen」の組み合わせでGraphQLサービスを作る",updated_at:"2019-11-16T15:16:42+09:00",url:"https://qiita.com/sky0621/items/8abd445edba347e8f6f1",user:{description:"https://github.com/sky0621/Curriculum-Vitae/blob/master/README.md",facebook_id:s,followees_count:8,followers_count:19,github_login_name:K,id:K,items_count:109,linkedin_id:s,location:s,name:s,organization:s,permanent_id:180599,profile_image_url:"https://avatars1.githubusercontent.com/u/15807041?v=3",team_only:a,twitter_screen_name:n,website_url:"https://github.com/sky0621"},page_views_count:n},{rendered_body:'\n<h2>\n<span id="これからチーム開発に参加するuiデザイナーがgithubでの開発フローをまとめた" class="fragment"></span><a href="#%E3%81%93%E3%82%8C%E3%81%8B%E3%82%89%E3%83%81%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA%E3%81%AB%E5%8F%82%E5%8A%A0%E3%81%99%E3%82%8Bui%E3%83%87%E3%82%B6%E3%82%A4%E3%83%8A%E3%83%BC%E3%81%8Cgithub%E3%81%A7%E3%81%AE%E9%96%8B%E7%99%BA%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%9F"><i class="fa fa-link"></i></a>これからチーム開発に参加するUIデザイナーがGitHubでの開発フローをまとめた</h2>\n\n<h2>\n<span id="注意" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>注意</h2>\n\n<ul>\n<li>(自分用備忘録です)</li>\n<li>(開発初学者です)</li>\n</ul>\n\n<h3>\n<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h3>\n\n<ul>\n<li>環境構築が終わっていてローカルホストが立ち上がっている状態</li>\n<li>リモートリポジトリのcloneがローカルに完了している</li>\n</ul>\n\n<h3>\n<span id="いつもはじめにやること" class="fragment"></span><a href="#%E3%81%84%E3%81%A4%E3%82%82%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>いつもはじめにやること</h3>\n\n<p>0-1.開発が決まったら、作業リボジトリにXDなどのデザインデータのリンクを貼った開発issue を立てる<br>\n - issue番号はメモっておき、あとでbranch名に使う</p>\n\n<p>0-2.githubに接続する<br>\n<code>$ ssh github</code></p>\n\n<p>0-3.ターミナルでcloneした作業レポジトリ(ローカル)まで移動する </p>\n\n<p>ターミナルでの操作<br>\n<code>$ cd git</code><br>\n<code>$ cd 作業リポジトリ名</code></p>\n\n<p>準備完了！</p>\n\n<h3>\n<span id="フロー" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%BC"><i class="fa fa-link"></i></a>フロー</h3>\n\n<ol>\n<li>\n<p>レビュワーがGitHubのPull requestsにrelease noteを切ってるのを確認する</p>\n\n<p>例) master from release/0.0.1</p>\n</li>\n<li>\n<p>Pull requestsの項目の一番を見る　上のvが最新のrelease note</p>\n\n<p>例) release/0.0.1</p>\n</li>\n<li>\n<p>リモートのrelease/0.0.1から最新の情報をfetchする</p>\n\n<p><code>$ git fetch origin release/0.0.1</code></p>\n</li>\n<li><p>自分が改善するissue/#番号　のbranchを切る<br>\n<code>$ git checkout -b issue/#番号</code></p></li>\n<li><p>今のbranchを確認する<br>\n<code>$ git branch</code></p></li>\n<li><p>今切ったbranchに切り替える<br>\n<code>$ git checkout issue/#番号</code></p></li>\n<li><p>コードを頑張って書き換える</p></li>\n<li><p>修正したらCommitする(Commit方法は２つある)</p></li>\n</ol>\n\n<p><strong>commit方法1</strong> </p>\n\n<blockquote>\n<p>Sourcetreeのファイルステージで変更箇所を確認しコメント欄に修正箇所を書き、にコミットボタンを押す<br>\n 　[コミットを直ちにorigin/testプッシュする]を選択すると、プッシュまで行われる。</p>\n</blockquote>\n\n<p><strong>commit方法2</strong> </p>\n\n<blockquote>\n<p>Sourcetreeのファイルステージで変更箇所を確認し、</p>\n\n<p><code>$ git commit -m "branch名" -m "コメント"</code> でcommit</p>\n</blockquote>\n\n<p>9, GitHubにPush<br>\n <code>$ git push origin branch名</code> でPushする</p>\n\n<p>10, GithubでPull request<br>\n自分が作ったbranch を　New Pull Requestする</p>\n\n<p>11, PullのURLをSlackに貼ってレビューお願いする！</p>\n\n<h3>\n<span id="pullrequestで気をつけること" class="fragment"></span><a href="#pullrequest%E3%81%A7%E6%B0%97%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>Pullrequestで気をつけること</h3>\n\n<ul>\n<li>中規模issueであればプルリクエストは小分けにする\n\n<ul>\n<li>一つのissueを自分でタスクを小分けにする</li>\n<li>小さなタスクissue#1-1をブランチを切り編集しコミット、OKをもらったら、次はまた小さなタスクissue#1-2でプルリクエストするとレビュワーに負担がかからない</li>\n<li>OKをもらったらmergeする</li>\n</ul>\n</li>\n</ul>\n\n<h3>\n<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h3>\n\n<ul>\n<li>issueのmilestone項目でフィルタリングすることで同じrelease目標のissueがわかる(リリース権限のある人が設定を行っていたら。)</li>\n<li>ブラウザチェックは ChromeとfirefoxとSafariとか現場で決まったもの</li>\n</ul>\n\n<p><strong>一緒の場所を修正作業してる人が先に変更点をmergeした場合</strong></p>\n\n<ul>\n<li><p>ローカルを新しい情報に更新する<br>\n<code>$ git pull origin  release/0.0.1</code><br>\n<code>$ merge release/0.0.1</code></p></li>\n<li><p>マージしようとしてコンフリクトした時にmergetoolで差分を確認する<br>\n<code>$ git mergetool</code><br>\n今のmasterブランチの状態と、マージ前の状態とマージしようとしているファイルの状態がわかりやすく表示されるので、差分を編集しマージする。</p></li>\n</ul>\n',body:'##これからチーム開発に参加するUIデザイナーがGitHubでの開発フローをまとめた\n\n##注意\n- (自分用備忘録です)\n- (開発初学者です)\n\n###前提\n\n- 環境構築が終わっていてローカルホストが立ち上がっている状態\n- リモートリポジトリのcloneがローカルに完了している\n\n###いつもはじめにやること\n\n\n0-1.開発が決まったら、作業リボジトリにXDなどのデザインデータのリンクを貼った開発issue を立てる\n - issue番号はメモっておき、あとでbranch名に使う\n\n0-2.githubに接続する\n`$ ssh github`\n\n\n0-3.ターミナルでcloneした作業レポジトリ(ローカル)まで移動する \n\nターミナルでの操作\n`$ cd git`\n`$ cd 作業リポジトリ名`\n\n準備完了！\n\n###フロー\n\n1. レビュワーがGitHubのPull requestsにrelease noteを切ってるのを確認する\n\n    例) master from release/0.0.1\n\n2. Pull requestsの項目の一番を見る　上のvが最新のrelease note\n\n    例) release/0.0.1\n\n\n3. リモートのrelease/0.0.1から最新の情報をfetchする\n\n    `$ git fetch origin release/0.0.1`\n\n\n4. 自分が改善するissue/#番号　のbranchを切る\n`$ git checkout -b issue/#番号`\n\n5. 今のbranchを確認する\n`$ git branch`\n\n6. 今切ったbranchに切り替える\n `$ git checkout issue/#番号`\n\n\n7. コードを頑張って書き換える\n\n\n8. 修正したらCommitする(Commit方法は２つある)\n\n**commit方法1** \n >Sourcetreeのファイルステージで変更箇所を確認しコメント欄に修正箇所を書き、にコミットボタンを押す\n 　[コミットを直ちにorigin/testプッシュする]を選択すると、プッシュまで行われる。\n\n **commit方法2** \n>Sourcetreeのファイルステージで変更箇所を確認し、\n\n >`$ git commit -m "branch名" -m "コメント"` でcommit\n\n\n9, GitHubにPush\n `$ git push origin branch名` でPushする\n\n10, GithubでPull request\n自分が作ったbranch を　New Pull Requestする\n\n11, PullのURLをSlackに貼ってレビューお願いする！\n\n\n\n###Pullrequestで気をつけること\n\n- 中規模issueであればプルリクエストは小分けにする\n   - 一つのissueを自分でタスクを小分けにする\n   - 小さなタスクissue#1-1をブランチを切り編集しコミット、OKをもらったら、次はまた小さなタスクissue#1-2でプルリクエストするとレビュワーに負担がかからない\n   - OKをもらったらmergeする\n\n\n###その他\n\n- issueのmilestone項目でフィルタリングすることで同じrelease目標のissueがわかる(リリース権限のある人が設定を行っていたら。)\n- ブラウザチェックは ChromeとfirefoxとSafariとか現場で決まったもの\n\n\n**一緒の場所を修正作業してる人が先に変更点をmergeした場合**\n\n- ローカルを新しい情報に更新する\n`$ git pull origin  release/0.0.1`\n`$ merge release/0.0.1`\n\n\n- マージしようとしてコンフリクトした時にmergetoolで差分を確認する\n`$ git mergetool`\n今のmasterブランチの状態と、マージ前の状態とマージしようとしているファイルの状態がわかりやすく表示されるので、差分を編集しマージする。\n',coediting:a,comments_count:0,created_at:"2019-11-16T03:05:27+09:00",group:n,id:"7f6d4941ffc2ad61f580",likes_count:1,private:a,reactions_count:0,tags:[{name:"Git",versions:[]},{name:Y,versions:[]},{name:C,versions:[]},{name:l,versions:[]},{name:e,versions:[]}],title:"これからチーム開発に参加するUIデザイナーがGitHubでの開発フローをまとめた",updated_at:"2019-11-16T03:59:36+09:00",url:"https://qiita.com/Annielovescode/items/7f6d4941ffc2ad61f580",user:{description:"フリーランスデザイナー｜海外向けSNS・クラウドファンディングサービス業務委託UIデザイナー｜個人開発色々手伝ってます｜開発も始めたのでVue.js Nuxt.js勉強中｜東京藝大卒/修了｜中国人留学生向け美術専門学校の講師｜素性は画家\r\n",facebook_id:"https://www.facebook.com/mizuki.takahashi.9231",followees_count:0,followers_count:0,github_login_name:n,id:X,items_count:1,linkedin_id:s,location:"日本",name:"Annie Mizuki Takahashi",organization:s,permanent_id:534010,profile_image_url:"https://pbs.twimg.com/profile_images/1188343576532414464/3Bho9_vk_bigger.jpg",team_only:a,twitter_screen_name:X,website_url:"https://twitter.com/Annielovescode"},page_views_count:n},{rendered_body:'\n<h2>\n<span id="お店と-web-サイトの紹介" class="fragment"></span><a href="#%E3%81%8A%E5%BA%97%E3%81%A8-web-%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E7%B4%B9%E4%BB%8B"><i class="fa fa-link"></i></a>お店と Web サイトの紹介</h2>\n\n<p>中華そば四つ葉<br>\n<a href="https://yotsuba628.com/" class="autolink" rel="nofollow noopener" target="_blank">https://yotsuba628.com/</a></p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F279625%2Fdc0fb51a-53fd-9326-4fdf-c3e89d95bf19.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3be51caebbebd891efbddd1308a2fdff" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F279625%2Fdc0fb51a-53fd-9326-4fdf-c3e89d95bf19.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3be51caebbebd891efbddd1308a2fdff" alt="y_soba2.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/279625/dc0fb51a-53fd-9326-4fdf-c3e89d95bf19.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F279625%2Fdc0fb51a-53fd-9326-4fdf-c3e89d95bf19.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=e802a805982d429844935dd8efdea7b2 1x" loading="lazy"></a></p>\n\n<p>ラーメンが好きならご存じの方もいらっしゃるのではないでしょうか。</p>\n\n<p>最寄駅から徒歩 90 分という衝撃のアクセスの不便さ。<br>\nにもかかわらず多数の祭事出店、テレビ出演、都内から足繁く通う芸能人もいる埼玉県川島町が誇る名店です。</p>\n\n<h2>\n<span id="経緯" class="fragment"></span><a href="#%E7%B5%8C%E7%B7%AF"><i class="fa fa-link"></i></a>経緯</h2>\n\n<p>何を隠そう私は川島町出身なのですが、学生時代に店舗に通っているうちに店長に顔を覚えてもらうことができ、Web ページの作成をさせてほしいと申し出たところ承諾を頂けて 2018 年の 3 月頃に Web ページをリリースしました。</p>\n\n<p>しかし当時の技術力不足もあり、Wordpress の入門書を写経しながらのものとなり・・・<br>\nサイズの大きい画像を多数保有しているため表示が遅く、見た目が芋臭いというなんともお粗末な状態で 1 年以上運用を続けていました。</p>\n\n<p>時がたち社会人になってからいくつかの技術的知識を付け、このお粗末な状態でも多くの閲覧者がいる現状に恥ずかしさを覚え、つい先日リニューアルを決意。約 3 日で完了することができました！(Nuxt.jsとFirebase便利すぎです)</p>\n\n<p>どのようなスケジュールで行ったか、リニューアルした点などを記録に残しておきたいと思い、今回記事を書かせていただいております。</p>\n\n<h2>\n<span id="スケジュール" class="fragment"></span><a href="#%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>スケジュール</h2>\n\n<ul>\n<li>\n<p>1 日目 現行サイトの改善したい点洗い出し</p>\n\n<ul>\n<li>表示速度の改善</li>\n<li>レイアウトの一新 など</li>\n</ul>\n</li>\n<li><p>2 日目 コーディング</p></li>\n<li><p>3 日目 確認依頼、OK が出た後新規ドメインを取得して接続。旧ドメインのリダイレクト設定</p></li>\n</ul>\n\n<h2>\n<span id="実装内容" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>実装内容</h2>\n\n<p>エックスサーバ + Wordpress ⇒ Nuxt.js + Firebase</p>\n\n<ul>\n<li>見た目</li>\n</ul>\n\n<p>Vuetify を使用しました。テンプレートそのまま使えるものが多く、非常にスピーディに開発が進められて助かりました。</p>\n\n<p>またこだわった点として写真を非常に良いものを使っています。プロのカメラマンさんに依頼して店舗側ともアポを取り、時間を取って写真を取っていただきました。</p>\n\n<ul>\n<li>機能</li>\n</ul>\n\n<p>一部紹介させていただくと、お品書きページで各メニューにお気に入り機能のようなものを実装しています。以前のページでは一方的で、今回リニューアルにあたって少しだけ閲覧者の方からリアクションを貰える仕組みを追加出来たらうれしいなと思ったのがきっかけです。</p>\n\n<p>コードの一部分はこんな感じです。<br>\n  template 部分は</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre>        <span class="nt">&lt;v-card&gt;</span>\n          <span class="nt">&lt;v-img</span> <span class="na">:src=</span><span class="s">"rcard.src"</span> <span class="na">class=</span><span class="s">"white--text align-end"</span> <span class="na">height=</span><span class="s">"300px"</span><span class="nt">&gt;&lt;/v-img&gt;</span>\n          <span class="nt">&lt;v-list-item</span> <span class="na">two-line</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;v-list-item-content&gt;</span>\n              <span class="nt">&lt;v-list-item-title</span> <span class="na">class=</span><span class="s">"subtitle"</span><span class="nt">&gt;</span>{{ rcard.title }}<span class="nt">&lt;/v-list-item-title&gt;</span>\n              <span class="nt">&lt;span&gt;</span>{{ rcard.content }}<span class="nt">&lt;/span&gt;</span>\n            <span class="nt">&lt;/v-list-item-content&gt;</span>\n          <span class="nt">&lt;/v-list-item&gt;</span>\n          <span class="nt">&lt;v-card-actions</span> <span class="na">v-if=</span><span class="s">"rcard.isFavorite"</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;v-alert</span> <span class="na">color=</span><span class="s">"pink lighten-4"</span> <span class="na">icon=</span><span class="s">"mdi-emoticon-happy"</span><span class="nt">&gt;</span>Thanks！<span class="nt">&lt;/v-alert&gt;</span>\n            <span class="nt">&lt;v-spacer&gt;&lt;/v-spacer&gt;</span>\n            <span class="nt">&lt;v-btn</span> <span class="na">icon</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-icon&gt;</span>mdi-heart<span class="nt">&lt;/v-icon&gt;</span>\n              {{ favs[index].count }}\n            <span class="nt">&lt;/v-btn&gt;</span>\n            <span class="nt">&lt;v-btn</span> <span class="na">icon</span> <span class="err">@</span><span class="na">click=</span><span class="s">"twitterShare()"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-icon&gt;</span>mdi-twitter<span class="nt">&lt;/v-icon&gt;</span>\n            <span class="nt">&lt;/v-btn&gt;</span>\n          <span class="nt">&lt;/v-card-actions&gt;</span>\n          <span class="nt">&lt;v-card-actions</span> <span class="na">v-else</span><span class="nt">&gt;</span>\n            <span class="nt">&lt;v-spacer&gt;&lt;/v-spacer&gt;</span>\n            <span class="nt">&lt;v-btn</span> <span class="na">icon</span> <span class="err">@</span><span class="na">click=</span><span class="s">"addFavoriteRamen(index, rcard.id, rcard)"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-icon&gt;</span>mdi-heart-outline<span class="nt">&lt;/v-icon&gt;</span>\n              {{ favs[index].count }}\n            <span class="nt">&lt;/v-btn&gt;</span>\n            <span class="nt">&lt;v-btn</span> <span class="na">icon</span> <span class="err">@</span><span class="na">click=</span><span class="s">"twitterShare()"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-icon&gt;</span>mdi-twitter<span class="nt">&lt;/v-icon&gt;</span>\n            <span class="nt">&lt;/v-btn&gt;</span>\n          <span class="nt">&lt;/v-card-actions&gt;</span>\n        <span class="nt">&lt;/v-card&gt;</span>\n</pre></div></div>\n\n<p>script 部分は</p>\n\n<div class="code-frame" data-lang="js"><div class="highlight"><pre>    <span class="nx">addFavoriteRamen</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">shina</span><span class="p">)</span> <span class="p">{</span>\n      <span class="kd">var</span> <span class="nx">favRef</span> <span class="o">=</span> <span class="nx">firebase</span>\n        <span class="p">.</span><span class="nx">firestore</span><span class="p">()</span>\n        <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">favorite</span><span class="dl">"</span><span class="p">)</span>\n        <span class="p">.</span><span class="nx">doc</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>\n      <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">favs</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">count</span><span class="p">;</span>\n      <span class="nx">favRef</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span>\n        <span class="na">title</span><span class="p">:</span> <span class="nx">shina</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>\n        <span class="na">src</span><span class="p">:</span> <span class="nx">shina</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span>\n        <span class="na">content</span><span class="p">:</span> <span class="nx">shina</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>\n        <span class="na">count</span><span class="p">:</span> <span class="p">(</span><span class="nx">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span>\n      <span class="p">});</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">ramencards</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">isFavorite</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>\n    <span class="p">}</span>\n</pre></div></div>\n\n<p>よくあるお気に入り機能のようにもう一度押したら解除できるように最初はしていたのですが、短時間に何度もデータを書き込まれてしまうことを懸念してこのような仕様にしました。<br>\n（※防ぐ良い方法が思いつかなかった・・・ご教授いただければ幸いです。）</p>\n\n<p>おいしそう！と感じたものがありましたらぜひクリックしてみてください。</p>\n\n<h2>\n<span id="ドメインの接続リダイレクト設定" class="fragment"></span><a href="#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%AE%E6%8E%A5%E7%B6%9A%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ドメインの接続、リダイレクト設定</h2>\n\n<p>Firebase、 エックスサーバ、 お名前ドットコムの設定部分ですが結構躓きました・・・</p>\n\n<p>時間あるときに記録しておきたいと思います。</p>\n\n<h2>\n<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>\n\n<p>最後まで見てくださりありがとうございました！</p>\n\n<p>本当においしいラーメン屋さんなのでぜひ一度行ってみてください。<br>\nWeb サイトも随時更新予定なので見て頂けたらうれしいです。</p>\n\n<h2>\n<span id="こちらも" class="fragment"></span><a href="#%E3%81%93%E3%81%A1%E3%82%89%E3%82%82"><i class="fa fa-link"></i></a>こちらも</h2>\n\n<p>JobQuest ジョブマッチングSNS風サイト<br>\n<a href="https://jquest.jp/" class="autolink" rel="nofollow noopener" target="_blank">https://jquest.jp/</a></p>\n\n<p>Vue.js + Firebaseで作ってます。宜しければご覧ください！</p>\n\n<p><a href="https://qiita.com/em0/items/44bf334575ce28bc6c47" class="autolink" id="reference-19be1fc0669b227d7060">https://qiita.com/em0/items/44bf334575ce28bc6c47</a></p>\n',body:'\n## お店と Web サイトの紹介\n\n中華そば四つ葉\nhttps://yotsuba628.com/\n\n![y_soba2.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/279625/dc0fb51a-53fd-9326-4fdf-c3e89d95bf19.jpeg)\n\n\nラーメンが好きならご存じの方もいらっしゃるのではないでしょうか。\n\n最寄駅から徒歩 90 分という衝撃のアクセスの不便さ。\nにもかかわらず多数の祭事出店、テレビ出演、都内から足繁く通う芸能人もいる埼玉県川島町が誇る名店です。\n\n## 経緯\n\n何を隠そう私は川島町出身なのですが、学生時代に店舗に通っているうちに店長に顔を覚えてもらうことができ、Web ページの作成をさせてほしいと申し出たところ承諾を頂けて 2018 年の 3 月頃に Web ページをリリースしました。\n\nしかし当時の技術力不足もあり、Wordpress の入門書を写経しながらのものとなり・・・\nサイズの大きい画像を多数保有しているため表示が遅く、見た目が芋臭いというなんともお粗末な状態で 1 年以上運用を続けていました。\n\n時がたち社会人になってからいくつかの技術的知識を付け、このお粗末な状態でも多くの閲覧者がいる現状に恥ずかしさを覚え、つい先日リニューアルを決意。約 3 日で完了することができました！(Nuxt.jsとFirebase便利すぎです)\n\nどのようなスケジュールで行ったか、リニューアルした点などを記録に残しておきたいと思い、今回記事を書かせていただいております。\n\n## スケジュール\n\n- 1 日目 現行サイトの改善したい点洗い出し\n\n  - 表示速度の改善\n  - レイアウトの一新 など\n\n- 2 日目 コーディング\n\n- 3 日目 確認依頼、OK が出た後新規ドメインを取得して接続。旧ドメインのリダイレクト設定\n\n## 実装内容\n\nエックスサーバ + Wordpress ⇒ Nuxt.js + Firebase\n\n- 見た目\n\n  Vuetify を使用しました。テンプレートそのまま使えるものが多く、非常にスピーディに開発が進められて助かりました。\n\n  またこだわった点として写真を非常に良いものを使っています。プロのカメラマンさんに依頼して店舗側ともアポを取り、時間を取って写真を取っていただきました。\n\n- 機能\n\n  一部紹介させていただくと、お品書きページで各メニューにお気に入り機能のようなものを実装しています。以前のページでは一方的で、今回リニューアルにあたって少しだけ閲覧者の方からリアクションを貰える仕組みを追加出来たらうれしいなと思ったのがきっかけです。\n\n  コードの一部分はこんな感じです。\n  template 部分は\n\n  ```vue\n        <v-card>\n          <v-img :src="rcard.src" class="white--text align-end" height="300px"></v-img>\n          <v-list-item two-line>\n            <v-list-item-content>\n              <v-list-item-title class="subtitle">{{ rcard.title }}</v-list-item-title>\n              <span>{{ rcard.content }}</span>\n            </v-list-item-content>\n          </v-list-item>\n          <v-card-actions v-if="rcard.isFavorite">\n            <v-alert color="pink lighten-4" icon="mdi-emoticon-happy">Thanks！</v-alert>\n            <v-spacer></v-spacer>\n            <v-btn icon>\n              <v-icon>mdi-heart</v-icon>\n              {{ favs[index].count }}\n            </v-btn>\n            <v-btn icon @click="twitterShare()">\n              <v-icon>mdi-twitter</v-icon>\n            </v-btn>\n          </v-card-actions>\n          <v-card-actions v-else>\n            <v-spacer></v-spacer>\n            <v-btn icon @click="addFavoriteRamen(index, rcard.id, rcard)">\n              <v-icon>mdi-heart-outline</v-icon>\n              {{ favs[index].count }}\n            </v-btn>\n            <v-btn icon @click="twitterShare()">\n              <v-icon>mdi-twitter</v-icon>\n            </v-btn>\n          </v-card-actions>\n        </v-card>\n  ```\n\n  script 部分は\n\n  ```js\n    addFavoriteRamen: function(index, id, shina) {\n      var favRef = firebase\n        .firestore()\n        .collection("favorite")\n        .doc(id);\n      var count = this.favs[index].count;\n      favRef.set({\n        title: shina.title,\n        src: shina.src,\n        content: shina.content,\n        count: (count += 1)\n      });\n      this.ramencards[index].isFavorite = true;\n    }\n  ```\n\n  よくあるお気に入り機能のようにもう一度押したら解除できるように最初はしていたのですが、短時間に何度もデータを書き込まれてしまうことを懸念してこのような仕様にしました。\n（※防ぐ良い方法が思いつかなかった・・・ご教授いただければ幸いです。）\n\n  おいしそう！と感じたものがありましたらぜひクリックしてみてください。\n\n## ドメインの接続、リダイレクト設定\n\nFirebase、 エックスサーバ、 お名前ドットコムの設定部分ですが結構躓きました・・・\n\n時間あるときに記録しておきたいと思います。\n\n## おわりに\n\n最後まで見てくださりありがとうございました！\n\n本当においしいラーメン屋さんなのでぜひ一度行ってみてください。\nWeb サイトも随時更新予定なので見て頂けたらうれしいです。\n\n## こちらも\nJobQuest ジョブマッチングSNS風サイト\nhttps://jquest.jp/\n\nVue.js + Firebaseで作ってます。宜しければご覧ください！\n\nhttps://qiita.com/em0/items/44bf334575ce28bc6c47\n',coediting:a,comments_count:12,created_at:"2019-11-15T11:58:45+09:00",group:n,id:"2ad90db529c661f363d8",likes_count:249,private:a,reactions_count:0,tags:[{name:d,versions:[]},{name:"WordPress",versions:[]},{name:l,versions:[]},{name:g,versions:[]},{name:e,versions:[]}],title:"とあるラーメン店のWordpressサイトをNuxt.js+Firebaseで作り直した話",updated_at:"2019-11-16T10:31:19+09:00",url:"https://qiita.com/em0/items/2ad90db529c661f363d8",user:{description:"半駆け出しWebAppDeveloper",facebook_id:s,followees_count:2,followers_count:11,github_login_name:n,id:"em0",items_count:2,linkedin_id:s,location:"大阪",name:s,organization:"JohnWORKS",permanent_id:279625,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/279625/profile-images/1533791949",team_only:a,twitter_screen_name:n,website_url:"https://johnworks.jp"},page_views_count:n},{rendered_body:'<p>今までフロントエンドでテストケースを書いたことがありませんでしたが、とある案件で挑戦する機会があったのでやってみました</p>\n\n<h2>\n<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h2>\n\n<ul>\n<li>作成済みの Nuxt.jsアプリに、後から<a href="https://jestjs.io/docs/ja/getting-started" rel="nofollow noopener" target="_blank">Jest</a>を導入する</li>\n<li>コンポーネントにpropsで渡した値が表示されるか確認するのテストを用意して実行する</li>\n</ul>\n\n<h2>\n<span id="事前準備" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>事前準備</h2>\n\n<h3>\n<span id="ライブラリのインストール" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ライブラリのインストール</h3>\n\n<ul>\n<li>NuxtアプリでJestを動かすために必要なライブラリが入っていない場合は導入する<br>\n(警告を消すために色々と入れましたが、全部は必要ないかもです)</li>\n</ul>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>yarn add <span class="nt">-D</span> @babel/core @nuxt/babel-preset-app @vue/test-utils babel-core babel-jest babel-preset-env jest vue-jest vue-template-compiler\n</pre></div></div>\n\n<h3>\n<span id="設定ファイルの用意" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%94%A8%E6%84%8F"><i class="fa fa-link"></i></a>設定ファイルの用意</h3>\n\n<p>Nuxtアプリのルートディレクトリ直下に用意</p>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">jest.config.js</span></div>\n<div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">transform</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">\'</span><span class="s1">^.+</span><span class="se">\\\\</span><span class="s1">.js$</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">babel-jest</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="dl">\'</span><span class="s1">.*</span><span class="se">\\\\</span><span class="s1">.(vue)$</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">vue-jest</span><span class="dl">\'</span>\n  <span class="p">},</span>\n  <span class="na">moduleNameMapper</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">\'</span><span class="s1">^@/(.*)$</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">&lt;rootDir&gt;/$1</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="dl">\'</span><span class="s1">^~/(.*)$</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">&lt;rootDir&gt;/$1</span><span class="dl">\'</span>\n  <span class="p">},</span>\n  <span class="na">moduleFileExtensions</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">js</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">json</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">]</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">.babelrc</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"presets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n    </span><span class="p">[</span><span class="s2">"env"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">\n      </span><span class="nl">"modules"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">\n    </span><span class="p">}]</span><span class="w">\n  </span><span class="p">],</span><span class="w">\n  </span><span class="nl">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n      </span><span class="nl">"presets"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n        </span><span class="p">[</span><span class="s2">"env"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">\n          </span><span class="nl">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n            </span><span class="nl">"node"</span><span class="p">:</span><span class="w"> </span><span class="s2">"current"</span><span class="w">\n          </span><span class="p">}</span><span class="w">\n        </span><span class="p">}]</span><span class="w">\n      </span><span class="p">]</span><span class="w">\n    </span><span class="p">}</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span></pre></div>\n</div>\n\n<h2>\n<span id="コンポーネント作成" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>コンポーネント作成</h2>\n\n<p>propsにtextを渡して、それを表示させるだけのシンプルなコンポーネントです</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">Button.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;nuxt-link&gt;</span>\n    <span class="si">{{</span> <span class="nx">text</span> <span class="si">}}</span>\n  <span class="nt">&lt;/nuxt-link&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">text</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="テストケース作成" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%82%B1%E3%83%BC%E3%82%B9%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>テストケース作成</h2>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">test/components/Button.spec.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">mount</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@vue/test-utils</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Button</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/components/shared/Button</span><span class="dl">\'</span>\n\n<span class="nx">describe</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Button</span><span class="dl">\'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">test</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Display text</span><span class="dl">\'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">text</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">検索する</span><span class="dl">\'</span>\n    <span class="p">}</span>\n    <span class="kd">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">mount</span><span class="p">(</span><span class="nx">Button</span><span class="p">,</span> <span class="p">{</span>\n      <span class="na">propsData</span><span class="p">:</span> <span class="nx">props</span>\n    <span class="p">})</span>\n    <span class="c1">// propsに指定したデータが正しく表示されること</span>\n    <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">props</span><span class="p">(</span><span class="dl">\'</span><span class="s1">text</span><span class="dl">\'</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>\n  <span class="p">})</span>\n<span class="p">})</span>\n\n</pre></div>\n</div>\n\n<p>今回は簡単なpropsの表示テストだけですが、追って別記事でVuexのテストサンプルも作成する予定</p>\n\n<h2>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>\n\n<ul>\n<li><a href="https://vue-test-utils.vuejs.org/ja/api/wrapper/#props" rel="nofollow noopener" target="_blank">Wrapper | Vue Test Utils</a></li>\n<li><a href="https://qiita.com/rhistoba/items/6e90e2c51e8ad1875ac0" id="reference-98e382d87d93edf1109b">Nuxt.js + JestでTodoアプリと自動テストを作成 - Qiita</a></li>\n</ul>\n',body:"今までフロントエンドでテストケースを書いたことがありませんでしたが、とある案件で挑戦する機会があったのでやってみました\n\n## やりたいこと\n- 作成済みの Nuxt.jsアプリに、後から[Jest](https://jestjs.io/docs/ja/getting-started)を導入する\n- コンポーネントにpropsで渡した値が表示されるか確認するのテストを用意して実行する\n\n## 事前準備\n\n### ライブラリのインストール\n- NuxtアプリでJestを動かすために必要なライブラリが入っていない場合は導入する  \n(警告を消すために色々と入れましたが、全部は必要ないかもです)\n\n```bash\nyarn add -D @babel/core @nuxt/babel-preset-app @vue/test-utils babel-core babel-jest babel-preset-env jest vue-jest vue-template-compiler\n```\n\n### 設定ファイルの用意\n\nNuxtアプリのルートディレクトリ直下に用意\n\n```js:jest.config.js\nmodule.exports = {\n  transform: {\n    '^.+\\\\.js$': 'babel-jest',\n    '.*\\\\.(vue)$': 'vue-jest'\n  },\n  moduleNameMapper: {\n    '^@/(.*)$': '<rootDir>/$1',\n    '^~/(.*)$': '<rootDir>/$1'\n  },\n  moduleFileExtensions: ['js', 'json', 'vue']\n}\n```\n\n```json:.babelrc\n{\n  \"presets\": [\n    [\"env\", {\n      \"modules\": false\n    }]\n  ],\n  \"env\": {\n    \"test\": {\n      \"presets\": [\n        [\"env\", {\n          \"targets\": {\n            \"node\": \"current\"\n          }\n        }]\n      ]\n    }\n  }\n}\n\n```\n\n## コンポーネント作成\n\npropsにtextを渡して、それを表示させるだけのシンプルなコンポーネントです\n\n```vue:Button.vue\n<template>\n  <nuxt-link>\n    {{ text }}\n  </nuxt-link>\n</template>\n\n<script>\nexport default {\n  props: {\n    text: {\n      type: String,\n      required: true\n    }\n  }\n}\n<\/script>\n```\n\n## テストケース作成\n```js:test/components/Button.spec.js\nimport { mount } from '@vue/test-utils'\nimport Button from '~/components/shared/Button'\n\ndescribe('Button', () => {\n  test('Display text', () => {\n    const props = {\n      text: '検索する'\n    }\n    const wrapper = mount(Button, {\n      propsData: props\n    })\n    // propsに指定したデータが正しく表示されること\n    expect(wrapper.props('text')).toBe(props.text)\n  })\n})\n\n```\n\n今回は簡単なpropsの表示テストだけですが、追って別記事でVuexのテストサンプルも作成する予定\n\n## 参考\n- [Wrapper | Vue Test Utils](https://vue-test-utils.vuejs.org/ja/api/wrapper/#props)\n- [Nuxt.js + JestでTodoアプリと自動テストを作成 - Qiita](https://qiita.com/rhistoba/items/6e90e2c51e8ad1875ac0)\n",coediting:a,comments_count:0,created_at:"2019-11-15T01:10:01+09:00",group:n,id:"1b623353300d52255c6c",likes_count:2,private:a,reactions_count:0,tags:[{name:"テスト",versions:[]},{name:l,versions:[]},{name:"YARN",versions:[]},{name:"Jest",versions:[]},{name:e,versions:[]}],title:"【Nuxt.js】 Jestを使ってコンポーネントのテスト書く",updated_at:"2019-11-15T01:11:38+09:00",url:"https://qiita.com/curosuke/items/1b623353300d52255c6c",user:{description:"株式会社モスティープレイスでエンジニアやってます",facebook_id:s,followees_count:12,followers_count:9,github_login_name:n,id:"curosuke",items_count:8,linkedin_id:s,location:s,name:s,organization:"株式会社モスティープレイス",permanent_id:165108,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/165108/profile-images/1555391057",team_only:a,twitter_screen_name:"corosuke9",website_url:s},page_views_count:n},{rendered_body:'<p>デザイナー(非プログラマー)のWindowsPCにNuxt開発環境を構築してもらう必要がありましたので手順書を作りました。</p>\n\n<h1>\n<span id="目標" class="fragment"></span><a href="#%E7%9B%AE%E6%A8%99"><i class="fa fa-link"></i></a>目標</h1>\n\n<p>非プログラマーが非プログラマ―の操作によって開発環境を構築します。<br>\n最終的にWindowsPCでNuxt.jsのプロジェクトを起動することを目標とします。</p>\n\n<h1>\n<span id="導入内容" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>導入内容</h1>\n\n<ul>\n<li>Git for Windows</li>\n<li>Tortrise Git</li>\n<li>Node.js</li>\n<li>Yarn</li>\n<li>Nuxt.js</li>\n</ul>\n\n<h1>\n<span id="事前に準備するものプログラマーが伝えておくこと" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E3%81%AB%E6%BA%96%E5%82%99%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%83%BC%E3%81%8C%E4%BC%9D%E3%81%88%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>事前に準備するもの(プログラマーが伝えておくこと)</h1>\n\n<ul>\n<li>Nuxt.jsプロジェクトを管理しているGitリポジトリのURL</li>\n<li>導入するNode.jsのバージョン(たいていLTSでOKかと思います)</li>\n<li>Nuxt.jsプロジェクトの起動・接続方法(たいてい<code>yarn dev</code>、<code>localhost:3000</code>でOKかと思います)</li>\n</ul>\n\n<h1>\n<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h1>\n\n<h2>\n<span id="gitのインストール" class="fragment"></span><a href="#git%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Gitのインストール</h2>\n\n<p>以下の記事が完璧な内容でした。<br>\n<a href="https://qiita.com/SkyLaptor/items/6347f38c8c010f4d5bd2" id="reference-747c967363560cef6746">TortoiseGitのセットアップ</a></p>\n\n<p>こちらを参照してGit for Windows、Tortrise Gitを導入してください。<br>\nGitのホスティングサービスはGitLabで解説されていますが、GitHubでもほぼ同じ手順で実施できます。</p>\n\n<p>上記の記事を参照し、最後の<code>git clone</code>まで全て進めてください。</p>\n\n<h3>\n<span id="ツールの簡易説明" class="fragment"></span><a href="#%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E7%B0%A1%E6%98%93%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>ツールの簡易説明</h3>\n\n<ul>\n<li>\n<code>Git for Windows</code>: "Git"というツールをWindows環境で使用するために導入します。</li>\n<li>\n<code>Tortrise Git</code>: GitをGUI(マウス操作)で使用できるようにするために導入します。</li>\n</ul>\n\n<h2>\n<span id="nodeのインストーラのダウンロード" class="fragment"></span><a href="#node%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%A9%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>Nodeのインストーラのダウンロード</h2>\n\n<p>以下からNodeのインストーラをダウンロードし、実行してください。<br>\n<a href="https://nodejs.org/ja/download/" rel="nofollow noopener" target="_blank">Node.js ダウンロード</a></p>\n\n<p>たくさんの選択肢があり、どれを選択したらよいか迷うかもしれません。<br>\nポイントは以下です。</p>\n\n<ul>\n<li>32bit or 64bit\n\n<ul>\n<li>\n<a href="https://www.google.com/search?q=Windows+64bit+%E7%A2%BA%E8%AA%8D" rel="nofollow noopener" target="_blank">Windows 64bit 確認</a>といったキーワードでGoogle検索し、自身のPCがどちらなのかを確認してください。</li>\n</ul>\n</li>\n<li>LTS(推奨版) or 最新版\n\n<ul>\n<li>Node.jsのバージョンをプログラマに確認してください</li>\n</ul>\n</li>\n<li>.msi or .zip\n\n<ul>\n<li>わからない場合は<code>.msi</code>でいいと思います。</li>\n</ul>\n</li>\n</ul>\n\n<p>参考までに2019年11月現在の場合、以下を選ぶ方が一番多いと思います。</p>\n\n<ul>\n<li>LTS(推奨版) (2019年11月現在はv12)</li>\n<li>Windows Installer (.msi)</li>\n<li>64bit</li>\n</ul>\n\n<h3>\n<span id="nodejsの簡易説明" class="fragment"></span><a href="#nodejs%E3%81%AE%E7%B0%A1%E6%98%93%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>Node.jsの簡易説明</h3>\n\n<p>Nuxt.jsを実行するために導入します。<br>\n「ノードジェイエス」または「ノード」と呼びます。</p>\n\n<h2>\n<span id="nodejsのインストール" class="fragment"></span><a href="#nodejs%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Node.jsのインストール</h2>\n\n<p>ダウンロードしたファイルを実行し、Node.jsをインストールしてください。<br>\n全てYesやOKで進められるので、詳細な説明は割愛します。<br>\nこちらはGitより簡単です。</p>\n\n<h2>\n<span id="コマンドプロントの起動" class="fragment"></span><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%97%E3%83%AD%E3%83%B3%E3%83%88%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>コマンドプロントの起動</h2>\n\n<p>Node.jsのコマンドを実行するためにコマンドプロンプトを開きます。<br>\n開き方は<a href="https://www.google.com/search?q=%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%97%E3%83%AD%E3%83%B3%E3%83%88%E3%80%80%E9%96%8B%E3%81%8D%E6%96%B9" rel="nofollow noopener" target="_blank">コマンドプロント　開き方</a>といったキーワードでGoogle検索して確認してください。</p>\n\n<p>コマンドプロントを開くことができたら以下のコマンドを実行してください。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行するコマンド)</span></div>\n<div class="highlight"><pre>node --version\n</pre></div>\n</div>\n\n<p>Node.jsのバージョンが表示されたら成功です。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行結果)</span></div>\n<div class="highlight"><pre>C:\\Users\\ユーザー名&gt;node --version\nv12.13.0\n</pre></div>\n</div>\n\n<h2>\n<span id="yarnのインストール" class="fragment"></span><a href="#yarn%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Yarnのインストール</h2>\n\n<p>Yarnを導入します。<br>\nコマンドプロンプトで以下を実行してください。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行するコマンド)</span></div>\n<div class="highlight"><pre>npm install -g yarn\n</pre></div>\n</div>\n\n<p>ダウンロードできたことを確認するために、以下を実行してください。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行するコマンド)</span></div>\n<div class="highlight"><pre>yarn --version\n</pre></div>\n</div>\n\n<p>Yarnのバージョンが表示されたら成功です。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行結果)</span></div>\n<div class="highlight"><pre>C:\\Users\\ユーザー名&gt;yarn --version\n1.19.1\n</pre></div>\n</div>\n\n<h3>\n<span id="yarnの簡易説明" class="fragment"></span><a href="#yarn%E3%81%AE%E7%B0%A1%E6%98%93%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>Yarnの簡易説明</h3>\n\n<p>パッケージマネージャ（必要なものを簡単にダウンロードしてくれるツール）です。<br>\nよく「同じようなツールのnpmよりも優れている」と紹介されます。</p>\n\n<h2>\n<span id="yarn-install" class="fragment"></span><a href="#yarn-install"><i class="fa fa-link"></i></a>yarn install</h2>\n\n<p>上記でYarnをインストールしました。<br>\n続いてYarnを使用して必要なパッケージをインストールします。</p>\n\n<h3>\n<span id="作業フォルダの移動" class="fragment"></span><a href="#%E4%BD%9C%E6%A5%AD%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E7%A7%BB%E5%8B%95"><i class="fa fa-link"></i></a>作業フォルダの移動</h3>\n\n<p>まず、作業フォルダを先ほど<code>git clone</code>で生成したフォルダに変更します。<br>\nパスは「<code>git clone</code>を実行したフォルダ」ではなく「<code>git clone</code>で生成されたフォルダ」という点に注意してください。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行するコマンド)</span></div>\n<div class="highlight"><pre>cd "git cloneで生成されたフォルダのパス"\n\n# もしCドライブ以外(Dドライブなど)でgit cloneした場合、以下のように`/d`も付けてください。\ncd /d D:\\\n</pre></div>\n</div>\n\n<p>または、以下の画像のようにアドレスバーに<code>cmd</code>と入力してコマンドプロンプトを起動する方法もあります。<br>\nこの場合<code>cd</code>の実行が不要になりますので、こちらの方法もおすすめです。<br>\n（コメント欄で<a href="/htsign" class="user-mention js-hovercard" title="htsign" data-hovercard-target-type="user" data-hovercard-target-name="htsign">@htsign</a>さんからで教えて頂きました。ありがとうございました）</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F231426%2F8df4d9cc-8437-c2f8-7919-9db281cfe33e.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=527aabfd0c001341a342ccbaa38262cc" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F231426%2F8df4d9cc-8437-c2f8-7919-9db281cfe33e.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=527aabfd0c001341a342ccbaa38262cc" alt="1.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/231426/8df4d9cc-8437-c2f8-7919-9db281cfe33e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F231426%2F8df4d9cc-8437-c2f8-7919-9db281cfe33e.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=45f04d2b3afccca0d8a9ccd8c648b3b2 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="yarn-installの実行" class="fragment"></span><a href="#yarn-install%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>yarn installの実行</h3>\n\n<p>そして<code>yarn install</code>を実行し、必要なパッケージを取得します。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行するコマンド)</span></div>\n<div class="highlight"><pre>yarn install\n</pre></div>\n</div>\n\n<p>最後にsuccessと表示されたら成功です。</p>\n\n<h2>\n<span id="nuxtjsの起動とアクセス" class="fragment"></span><a href="#nuxtjs%E3%81%AE%E8%B5%B7%E5%8B%95%E3%81%A8%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9"><i class="fa fa-link"></i></a>Nuxt.jsの起動とアクセス</h2>\n\n<p>最後にNuxt.jsのプロジェクトを起動し、Web画面を表示します。<br>\nコマンドプロントに<code>yarn dev</code>と入力してください。</p>\n\n<div class="code-frame" data-lang="bat(dos)">\n<div class="code-lang"><span class="bold">コマンドプロンプト(実行するコマンド)</span></div>\n<div class="highlight"><pre>yarn dev\n</pre></div>\n</div>\n\n<p>そしてブラウザのURL欄に<code>localhost:3000</code>と入力してください。<br>\n画面が表示されたら成功です。</p>\n\n<p>以上で全手順が完了です。</p>\n\n<h1>\n<span id="備考" class="fragment"></span><a href="#%E5%82%99%E8%80%83"><i class="fa fa-link"></i></a>備考</h1>\n\n<p>非プログラマ向けの手順なので、用語を雑に説明している点はご了承ください。<br>\nただ、誤った説明は書いていないつもりです。<br>\nもし誤りがありましたらご指摘頂けますと嬉しいです。</p>\n\n<p>また、環境によって差異が発生しそうな部分には"たいてい"といった言葉を付けるようにしました。<br>\n手順に詰まった場合はそのあたりをまず確認してみてください。</p>\n',body:'デザイナー(非プログラマー)のWindowsPCにNuxt開発環境を構築してもらう必要がありましたので手順書を作りました。\n\n# 目標\n\n非プログラマーが非プログラマ―の操作によって開発環境を構築します。\n最終的にWindowsPCでNuxt.jsのプロジェクトを起動することを目標とします。\n\n# 導入内容\n\n- Git for Windows\n- Tortrise Git\n- Node.js\n- Yarn\n- Nuxt.js\n\n# 事前に準備するもの(プログラマーが伝えておくこと)\n\n- Nuxt.jsプロジェクトを管理しているGitリポジトリのURL\n- 導入するNode.jsのバージョン(たいていLTSでOKかと思います)\n- Nuxt.jsプロジェクトの起動・接続方法(たいてい`yarn dev`、`localhost:3000`でOKかと思います)\n\n# 手順\n\n## Gitのインストール\n\n以下の記事が完璧な内容でした。\n[TortoiseGitのセットアップ](https://qiita.com/SkyLaptor/items/6347f38c8c010f4d5bd2)\n\nこちらを参照してGit for Windows、Tortrise Gitを導入してください。\nGitのホスティングサービスはGitLabで解説されていますが、GitHubでもほぼ同じ手順で実施できます。\n\n上記の記事を参照し、最後の`git clone`まで全て進めてください。\n\n### ツールの簡易説明\n\n- `Git for Windows`: "Git"というツールをWindows環境で使用するために導入します。\n- `Tortrise Git`: GitをGUI(マウス操作)で使用できるようにするために導入します。\n\n## Nodeのインストーラのダウンロード\n\n以下からNodeのインストーラをダウンロードし、実行してください。\n[Node.js ダウンロード](https://nodejs.org/ja/download/)\n\nたくさんの選択肢があり、どれを選択したらよいか迷うかもしれません。\nポイントは以下です。\n\n- 32bit or 64bit\n  - [Windows 64bit 確認](https://www.google.com/search?q=Windows+64bit+%E7%A2%BA%E8%AA%8D)といったキーワードでGoogle検索し、自身のPCがどちらなのかを確認してください。\n- LTS(推奨版) or 最新版\n  - Node.jsのバージョンをプログラマに確認してください\n- .msi or .zip\n  - わからない場合は`.msi`でいいと思います。\n\n参考までに2019年11月現在の場合、以下を選ぶ方が一番多いと思います。\n\n- LTS(推奨版) (2019年11月現在はv12)\n- Windows Installer (.msi)\n- 64bit\n\n### Node.jsの簡易説明\n\nNuxt.jsを実行するために導入します。\n「ノードジェイエス」または「ノード」と呼びます。\n\n## Node.jsのインストール\n\nダウンロードしたファイルを実行し、Node.jsをインストールしてください。\n全てYesやOKで進められるので、詳細な説明は割愛します。\nこちらはGitより簡単です。\n\n## コマンドプロントの起動\n\nNode.jsのコマンドを実行するためにコマンドプロンプトを開きます。\n開き方は[コマンドプロント　開き方](https://www.google.com/search?q=%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%97%E3%83%AD%E3%83%B3%E3%83%88%E3%80%80%E9%96%8B%E3%81%8D%E6%96%B9)といったキーワードでGoogle検索して確認してください。\n\nコマンドプロントを開くことができたら以下のコマンドを実行してください。\n\n```.bat(dos):コマンドプロンプト(実行するコマンド)\nnode --version\n```\n\nNode.jsのバージョンが表示されたら成功です。\n\n```.bat(dos):コマンドプロンプト(実行結果)\nC:\\Users\\ユーザー名>node --version\nv12.13.0\n```\n\n## Yarnのインストール\n\nYarnを導入します。\nコマンドプロンプトで以下を実行してください。\n\n```.bat(dos):コマンドプロンプト(実行するコマンド)\nnpm install -g yarn\n```\n\nダウンロードできたことを確認するために、以下を実行してください。\n\n```.bat(dos):コマンドプロンプト(実行するコマンド)\nyarn --version\n```\n\nYarnのバージョンが表示されたら成功です。\n\n```.bat(dos):コマンドプロンプト(実行結果)\nC:\\Users\\ユーザー名>yarn --version\n1.19.1\n```\n\n### Yarnの簡易説明\n\nパッケージマネージャ（必要なものを簡単にダウンロードしてくれるツール）です。\nよく「同じようなツールのnpmよりも優れている」と紹介されます。\n\n## yarn install\n\n上記でYarnをインストールしました。\n続いてYarnを使用して必要なパッケージをインストールします。\n\n### 作業フォルダの移動\n\nまず、作業フォルダを先ほど`git clone`で生成したフォルダに変更します。\nパスは「`git clone`を実行したフォルダ」ではなく「`git clone`で生成されたフォルダ」という点に注意してください。\n\n```.bat(dos):コマンドプロンプト(実行するコマンド)\ncd "git cloneで生成されたフォルダのパス"\n\n# もしCドライブ以外(Dドライブなど)でgit cloneした場合、以下のように`/d`も付けてください。\ncd /d D:\\\n```\n\nまたは、以下の画像のようにアドレスバーに`cmd`と入力してコマンドプロンプトを起動する方法もあります。\nこの場合`cd`の実行が不要になりますので、こちらの方法もおすすめです。\n（コメント欄で@htsignさんからで教えて頂きました。ありがとうございました）\n\n![1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/231426/8df4d9cc-8437-c2f8-7919-9db281cfe33e.png)\n\n### yarn installの実行\n\nそして`yarn install`を実行し、必要なパッケージを取得します。\n\n```.bat(dos):コマンドプロンプト(実行するコマンド)\nyarn install\n```\n\n最後にsuccessと表示されたら成功です。\n\n## Nuxt.jsの起動とアクセス\n\n最後にNuxt.jsのプロジェクトを起動し、Web画面を表示します。\nコマンドプロントに`yarn dev`と入力してください。\n\n```.bat(dos):コマンドプロンプト(実行するコマンド)\nyarn dev\n```\n\nそしてブラウザのURL欄に`localhost:3000`と入力してください。\n画面が表示されたら成功です。\n\n以上で全手順が完了です。\n\n# 備考\n\n非プログラマ向けの手順なので、用語を雑に説明している点はご了承ください。\nただ、誤った説明は書いていないつもりです。\nもし誤りがありましたらご指摘頂けますと嬉しいです。\n\nまた、環境によって差異が発生しそうな部分には"たいてい"といった言葉を付けるようにしました。\n手順に詰まった場合はそのあたりをまず確認してみてください。\n',coediting:a,comments_count:3,created_at:"2019-11-14T22:20:53+09:00",group:n,id:"ac884f5759e88dbd3492",likes_count:2,private:a,reactions_count:0,tags:[{name:"Git",versions:[]},{name:Y,versions:[]},{name:e,versions:[]}],title:"非プログラマのWindowsマシンにGit、Node.js、Nuxt.js環境を構築する手順",updated_at:"2019-11-15T20:41:19+09:00",url:"https://qiita.com/ljourm/items/ac884f5759e88dbd3492",user:{description:n,facebook_id:n,followees_count:0,followers_count:0,github_login_name:Z,id:Z,items_count:6,linkedin_id:n,location:n,name:s,organization:n,permanent_id:231426,profile_image_url:"https://avatars2.githubusercontent.com/u/22882829?v=4",team_only:a,twitter_screen_name:n,website_url:n},page_views_count:n},{rendered_body:'<p>今回の記事は、AWS amplifyの機能の一つであるAuthenticationについての記事です。<br>\nNuxt.jsとAmazon Cognitoによるアプリケーションにユーザーのサインアップ、サインインなどの機能を追加し、実際にログイン画面を実装していきたいと思います。</p>\n\n<h1>\n<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h1>\n\n<p>・Pug を使用<br>\n・コーディング規約は Nuxt.js に則って StandardJS<br>\n・Visual Studio Code <br>\n※<code>amplify init</code>によりプロジェクトが初期化されている前提のもと話を進めていきます。</p>\n\n<h1>\n<span id="cognitoの準備" class="fragment"></span><a href="#cognito%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>Cognitoの準備</h1>\n\n<p>Cognitoを使用するためにAWSサービス機能のauthを追加しましょう</p>\n\n<div class="code-frame" data-lang="shell">\n<div class="code-lang"><span class="bold">shell</span></div>\n<div class="highlight"><pre><span class="nv">$ </span>amplify add auth\n\n<span class="nv">$ </span>amplify push\n</pre></div>\n</div>\n\n<h1>\n<span id="ライブラリの追加" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>ライブラリの追加</h1>\n\n<p>Amplifyライブラリのインストールをします</p>\n\n<div class="code-frame" data-lang="shell">\n<div class="code-lang"><span class="bold">shell</span></div>\n<div class="highlight"><pre><span class="nv">$ </span>npm <span class="nb">install </span>aws-amplify <span class="nt">--save</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="ログイン画面の実装" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E7%94%BB%E9%9D%A2%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ログイン画面の実装</h1>\n\n<h2>\n<span id="amplifyライブラリを使えるようにする" class="fragment"></span><a href="#amplify%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Amplifyライブラリを使えるようにする</h2>\n\n<p>まずはAmplifyをVueで使うための設定をします。<code>plugins</code>フォルダに<code>amplify.js</code>を作り以下のようにします</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">amplify-vue.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">AmplifyModules</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">aws-amplify</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AmplifyPlugin</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">aws-amplify-vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">awsconfig</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/aws-exports</span><span class="dl">\'</span>\n<span class="nx">Amplify</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">awsconfig</span><span class="p">)</span>\n\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">AmplifyPlugin</span><span class="p">,</span> <span class="nx">AmplifyModules</span><span class="p">)</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="middlewareでのログイン判定" class="fragment"></span><a href="#middleware%E3%81%A7%E3%81%AE%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E5%88%A4%E5%AE%9A"><i class="fa fa-link"></i></a>middlewareでのログイン判定</h2>\n\n<p>ユーザーからのログインが確認できない場合の制御を書きます<br>\n<code>middleware</code>のフォルダ内に<code>auth.js</code>を作り、以下のようにします。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">auth.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Auth</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">aws-amplify</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">redirect</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Auth</span><span class="p">.</span><span class="nx">currentUserInfo</span><span class="p">()</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">userInfo</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">redirect</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/signin</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n</pre></div>\n</div>\n\n<p><code>currentUserInfo</code>メソッドは<code>Auth</code>からユーザー情報を取ってくるメソッドです。従ってログインのリクエストをユーザが送った際に、<code>userInfo</code>の中にユーザー情報が入っていないとサインインのページ(/<code>signin</code>)にリダイレクトされるようになっています</p>\n\n<h2>\n<span id="ログイン機能" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>ログイン機能</h2>\n\n<p><code>pages</code>フォルダ内に<code>signin.vue</code>を作り以下のようにします</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">signin.vue</span></div>\n<div class="highlight"><pre>\n<span class="o">&lt;</span><span class="nx">template</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">pug</span><span class="dl">"</span><span class="o">&gt;</span>\n    <span class="nx">amplify</span><span class="o">-</span><span class="nx">sign</span><span class="o">-</span><span class="nx">out</span><span class="p">(</span>\n      <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="dl">"</span><span class="s2">isLoggedIn</span><span class="dl">"</span>\n    <span class="p">)</span>\n    <span class="nx">amplify</span><span class="o">-</span><span class="nx">authenticator</span><span class="p">(</span>\n      <span class="nx">v</span><span class="o">-</span><span class="k">else</span>\n      <span class="p">:</span><span class="nx">authConfig</span><span class="o">=</span><span class="dl">"</span><span class="s2">authConfig</span><span class="dl">"</span>\n    <span class="p">)</span>\n<span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;\n</span>\n<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">isLoggedIn</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="na">authConfig</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">usernameAttributes</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">My user name</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">signUpConfig</span><span class="p">:</span> <span class="p">{</span>\n          <span class="na">header</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">My Customized Sign Up!</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">hideAllDefaults</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n          <span class="na">defaultCountryCode</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">1</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">signUpFields</span><span class="p">:</span> <span class="p">[</span>\n            <span class="p">{</span>\n              <span class="na">label</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">My user name</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">username</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n              <span class="na">displayOrder</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>\n              <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">string</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="p">{</span>\n              <span class="na">label</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Password</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">password</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n              <span class="na">displayOrder</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>\n              <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">password</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="p">{</span>\n              <span class="na">label</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Phone Number</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">phone_number</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n              <span class="na">displayOrder</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>\n              <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">string</span><span class="dl">\'</span>\n            <span class="p">}</span>\n          <span class="p">]</span>\n        <span class="p">}</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="k">async</span> <span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">currentUserInfo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$Amplify</span><span class="p">.</span><span class="nx">Auth</span><span class="p">.</span><span class="nx">currentUserInfo</span><span class="p">()</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">isLoggedIn</span> <span class="o">=</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">currentUserInfo</span><span class="p">)</span>\n\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;\n</span></pre></div>\n</div>\n\n<h3>\n<span id="authenticatorのコンポーネント" class="fragment"></span><a href="#authenticator%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>authenticatorのコンポーネント</h3>\n\n<p>Amplifyライブラリにはユーザーログイン機能に関連するコンポーネントを用意してくれています<br>\n今回使うのは<code>amplify-authenticator</code>と<code>amplify-signout</code>の2つです</p>\n\n<h4>\n<span id="amplify-authenticator" class="fragment"></span><a href="#amplify-authenticator"><i class="fa fa-link"></i></a>amplify-authenticator</h4>\n\n<p>このコンポーネントはサインアップ/サインインのフォームを用意してくれます。ユーザーがサインアップのフォームに登録情報を打ち込めば、Cognitoのユーザープールでユーザー情報を管理してくれます</p>\n\n<p>サインイン画面<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fe96c40ee-2d05-3329-d9e5-e77248c5c959.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=db93a69fa91cd206ca9f5530c8bc874f" target="_blank" rel="nofollow noopener"><img width="470" alt="スクリーンショット 2019-11-13 18.49.55.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fe96c40ee-2d05-3329-d9e5-e77248c5c959.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=db93a69fa91cd206ca9f5530c8bc874f" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/e96c40ee-2d05-3329-d9e5-e77248c5c959.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fe96c40ee-2d05-3329-d9e5-e77248c5c959.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=e7206088fd728a1bf592cfe4aa0f9273 1x" loading="lazy"></a></p>\n\n<p>サインアップ画面(サインイン画面のCreate accountを押すと表示が切り替わる)<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2F9c2fdef6-500f-135e-290a-989804215745.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ec8d0eea3e423c9aed51eed612b8abc0" target="_blank" rel="nofollow noopener"><img width="507" alt="スクリーンショット 2019-11-13 23.14.54.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2F9c2fdef6-500f-135e-290a-989804215745.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=ec8d0eea3e423c9aed51eed612b8abc0" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/9c2fdef6-500f-135e-290a-989804215745.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2F9c2fdef6-500f-135e-290a-989804215745.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=4bafcac577a58a10050ea089510f1b8e 1x" loading="lazy"></a></p>\n\n<p>サインアップの中身は簡単にカスタマイズすることができます。それは<code>data</code>の中にある<code>signUpConfig</code>で編集します</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">script</span></div>\n<div class="highlight"><pre>\n  <span class="nx">signUpConfig</span><span class="p">:</span> <span class="p">{</span>\n\n          <span class="nl">header</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">My Customized Sign Up!</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="nx">hideAllDefaults</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n          <span class="nx">defaultCountryCode</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">1</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="nx">signUpFields</span><span class="p">:</span> <span class="p">[</span>\n            <span class="p">{</span>\n              <span class="na">label</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">My user name</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">username</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n              <span class="na">displayOrder</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>\n              <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">string</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="p">{</span>\n              <span class="na">label</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Password</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">password</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n              <span class="na">displayOrder</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>\n              <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">password</span><span class="dl">\'</span>\n            <span class="p">},</span>\n            <span class="p">{</span>\n              <span class="na">label</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Phone Number</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">phone_number</span><span class="dl">\'</span><span class="p">,</span>\n              <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n              <span class="na">displayOrder</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>\n              <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">string</span><span class="dl">\'</span>\n            <span class="p">}</span>\n          <span class="p">]</span>\n        <span class="p">}</span>\n</pre></div>\n</div>\n\n<h4>\n<span id="amplify-sign-out" class="fragment"></span><a href="#amplify-sign-out"><i class="fa fa-link"></i></a>amplify-sign-out</h4>\n\n<p>サインアウトのボタンを表示してくれます。ボタンを押すとログイン画面に戻ります<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fcf4caa52-d33b-9366-9110-c27b9dfaaf00.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=338df6cdb784c09a7c37e71a098e53e5" target="_blank" rel="nofollow noopener"><img width="404" alt="スクリーンショット 2019-11-13 23.31.41.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fcf4caa52-d33b-9366-9110-c27b9dfaaf00.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=338df6cdb784c09a7c37e71a098e53e5" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/cf4caa52-d33b-9366-9110-c27b9dfaaf00.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fcf4caa52-d33b-9366-9110-c27b9dfaaf00.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=7ed67e000c178524f8046f2a0fa35620 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="プログラムの流れ" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>プログラムの流れ</h3>\n\n<p>手順を追って説明していきます。</p>\n\n<h4>\n<span id="1サインイン後" class="fragment"></span><a href="#1%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E5%BE%8C"><i class="fa fa-link"></i></a>1　サインイン後</h4>\n\n<p><code>async/await</code>を使い<code>$Amplify.Auth</code>に対し、<code>currentuserInfo()</code>メソッドにより、ユーザー情報を取得したのを確認したら、定数<code>currentuserInfo</code>に代入される</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">script</span></div>\n<div class="highlight"><pre>\n<span class="kd">const</span> <span class="nx">currentUserInfo</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$Amplify</span><span class="p">.</span><span class="nx">Auth</span><span class="p">.</span><span class="nx">currentUserInfo</span><span class="p">()</span>\n\n</pre></div>\n</div>\n\n<h4>\n<span id="2-boolean値の切り替え" class="fragment"></span><a href="#2-boolean%E5%80%A4%E3%81%AE%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88"><i class="fa fa-link"></i></a>2 Boolean値の切り替え</h4>\n\n<p>ユーザー情報が取得できている場合、サインアップとサインアウトの切り替えに用いる<code>isLoggedIn</code>のBoolean値を変更する</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">script</span></div>\n<div class="highlight"><pre>\n<span class="k">this</span><span class="p">.</span><span class="nx">isLoggedIn</span> <span class="o">=</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">currentUserInfo</span><span class="p">)</span>\n\n</pre></div>\n</div>\n\n<h4>\n<span id="3画面切り替え" class="fragment"></span><a href="#3%E7%94%BB%E9%9D%A2%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88"><i class="fa fa-link"></i></a>3　画面切り替え</h4>\n\n<p>v-ifによる条件分岐でサインアップorアウト画面の切り替えを行う</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">signin.vue</span></div>\n<div class="highlight"><pre>\n<span class="nx">amplify</span><span class="o">-</span><span class="nx">sign</span><span class="o">-</span><span class="nx">out</span><span class="p">(</span>\n      <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="dl">"</span><span class="s2">isLoggedIn</span><span class="dl">"</span>\n    <span class="p">)</span>\n    <span class="nx">amplify</span><span class="o">-</span><span class="nx">authenticator</span><span class="p">(</span>\n      <span class="nx">v</span><span class="o">-</span><span class="k">else</span>\n      <span class="p">:</span><span class="nx">authConfig</span><span class="o">=</span><span class="dl">"</span><span class="s2">authConfig</span><span class="dl">"</span>\n    <span class="p">)</span>\n\n</pre></div>\n</div>\n\n<p>以上がAmlifyライブラリを使ったログイン機能の一連の流れです!<br>\nちなみにサインアップされたユーザー情報はCognitoに以下のように管理されます<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fcdbe3ad1-82e2-06ec-196c-9b90a9477d48.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=bfcdec2b4545a05e0423b27289f25534" target="_blank" rel="nofollow noopener"><img width="1088" alt="スクリーンショット 2019-11-14 0.11.15.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fcdbe3ad1-82e2-06ec-196c-9b90a9477d48.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=bfcdec2b4545a05e0423b27289f25534" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/cdbe3ad1-82e2-06ec-196c-9b90a9477d48.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F441587%2Fcdbe3ad1-82e2-06ec-196c-9b90a9477d48.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=6d89a171ff5dd5d093629f284b44e066 1x" loading="lazy"></a></p>\n\n<p>DBを使わずコンポーネント一つで登録、管理してくれるのはとても便利ですし、技術の進歩を実感しますね！<br>\n今後も最新技術について記事を書いていこうと思います！</p>\n',body:"今回の記事は、AWS amplifyの機能の一つであるAuthenticationについての記事です。\nNuxt.jsとAmazon Cognitoによるアプリケーションにユーザーのサインアップ、サインインなどの機能を追加し、実際にログイン画面を実装していきたいと思います。\n\n#環境\n・Pug を使用\n・コーディング規約は Nuxt.js に則って StandardJS\n・Visual Studio Code \n※`amplify init`によりプロジェクトが初期化されている前提のもと話を進めていきます。\n\n# Cognitoの準備\nCognitoを使用するためにAWSサービス機能のauthを追加しましょう\n\n```shell:shell\n$ amplify add auth\n\n$ amplify push\n```\n\n# ライブラリの追加\nAmplifyライブラリのインストールをします\n\n```shell:shell\n$ npm install aws-amplify --save\n```\n\n# ログイン画面の実装\n\n## Amplifyライブラリを使えるようにする\nまずはAmplifyをVueで使うための設定をします。`plugins`フォルダに`amplify.js`を作り以下のようにします\n\n```javascript:amplify-vue.js\nimport Vue from 'vue'\nimport * as AmplifyModules from 'aws-amplify'\nimport { AmplifyPlugin } from 'aws-amplify-vue'\nimport awsconfig from '@/aws-exports'\nAmplify.configure(awsconfig)\n\nVue.use(AmplifyPlugin, AmplifyModules)\n```\n\n## middlewareでのログイン判定\n\nユーザーからのログインが確認できない場合の制御を書きます\n`middleware`のフォルダ内に`auth.js`を作り、以下のようにします。\n\n```javascript:auth.js\nimport { Auth } from 'aws-amplify'\n\nexport default async ({ redirect }) => {\n  const userInfo = await Auth.currentUserInfo()\n\n  if (!userInfo) {\n    redirect('/signin')\n  }\n}\n\n```\n`currentUserInfo`メソッドは`Auth`からユーザー情報を取ってくるメソッドです。従ってログインのリクエストをユーザが送った際に、`userInfo`の中にユーザー情報が入っていないとサインインのページ(/`signin`)にリダイレクトされるようになっています\n\n##ログイン機能\n\n`pages`フォルダ内に`signin.vue`を作り以下のようにします\n\n```javascript:signin.vue\n\n<template lang=\"pug\">\n    amplify-sign-out(\n      v-if=\"isLoggedIn\"\n    )\n    amplify-authenticator(\n      v-else\n      :authConfig=\"authConfig\"\n    )\n</template>\n\n<script>\nexport default {\n  data () {\n    return {\n      isLoggedIn: false,\n      authConfig: {\n        usernameAttributes: 'My user name',\n        signUpConfig: {\n          header: 'My Customized Sign Up!',\n          hideAllDefaults: true,\n          defaultCountryCode: '1',\n          signUpFields: [\n            {\n              label: 'My user name',\n              key: 'username',\n              required: true,\n              displayOrder: 1,\n              type: 'string'\n            },\n            {\n              label: 'Password',\n              key: 'password',\n              required: true,\n              displayOrder: 2,\n              type: 'password'\n            },\n            {\n              label: 'Phone Number',\n              key: 'phone_number',\n              required: true,\n              displayOrder: 3,\n              type: 'string'\n            }\n          ]\n        }\n      }\n    }\n  },\n  async mounted () {\n    const currentUserInfo = await this.$Amplify.Auth.currentUserInfo()\n    this.isLoggedIn = Boolean(currentUserInfo)\n\n    }\n  }\n}\n<\/script>\n```\n\n### authenticatorのコンポーネント\n\nAmplifyライブラリにはユーザーログイン機能に関連するコンポーネントを用意してくれています\n今回使うのは`amplify-authenticator`と`amplify-signout`の2つです\n\n####amplify-authenticator\n\nこのコンポーネントはサインアップ/サインインのフォームを用意してくれます。ユーザーがサインアップのフォームに登録情報を打ち込めば、Cognitoのユーザープールでユーザー情報を管理してくれます\n\nサインイン画面\n<img width=\"470\" alt=\"スクリーンショット 2019-11-13 18.49.55.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/e96c40ee-2d05-3329-d9e5-e77248c5c959.png\">\n\nサインアップ画面(サインイン画面のCreate accountを押すと表示が切り替わる)\n<img width=\"507\" alt=\"スクリーンショット 2019-11-13 23.14.54.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/9c2fdef6-500f-135e-290a-989804215745.png\">\n\nサインアップの中身は簡単にカスタマイズすることができます。それは`data`の中にある`signUpConfig`で編集します\n\n```javascript:script\n\n  signUpConfig: {\n\n          header: 'My Customized Sign Up!',\n          hideAllDefaults: true,\n          defaultCountryCode: '1',\n          signUpFields: [\n            {\n              label: 'My user name',\n              key: 'username',\n              required: true,\n              displayOrder: 1,\n              type: 'string'\n            },\n            {\n              label: 'Password',\n              key: 'password',\n              required: true,\n              displayOrder: 2,\n              type: 'password'\n            },\n            {\n              label: 'Phone Number',\n              key: 'phone_number',\n              required: true,\n              displayOrder: 3,\n              type: 'string'\n            }\n          ]\n        }\n```\n\n#### amplify-sign-out\n\nサインアウトのボタンを表示してくれます。ボタンを押すとログイン画面に戻ります\n<img width=\"404\" alt=\"スクリーンショット 2019-11-13 23.31.41.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/cf4caa52-d33b-9366-9110-c27b9dfaaf00.png\">\n\n### プログラムの流れ\n\n手順を追って説明していきます。\n\n#### 1　サインイン後\n\n`async/await`を使い`$Amplify.Auth`に対し、`currentuserInfo()`メソッドにより、ユーザー情報を取得したのを確認したら、定数`currentuserInfo`に代入される\n\n```javascript:script\n\nconst currentUserInfo = await this.$Amplify.Auth.currentUserInfo()\n\n```\n#### 2 Boolean値の切り替え\n\nユーザー情報が取得できている場合、サインアップとサインアウトの切り替えに用いる`isLoggedIn`のBoolean値を変更する\n\n```javascript:script\n\nthis.isLoggedIn = Boolean(currentUserInfo)\n\n```\n\n#### 3　画面切り替え\n\nv-ifによる条件分岐でサインアップorアウト画面の切り替えを行う\n\n```javascript:signin.vue\n\namplify-sign-out(\n      v-if=\"isLoggedIn\"\n    )\n    amplify-authenticator(\n      v-else\n      :authConfig=\"authConfig\"\n    )\n\n```\n\n以上がAmlifyライブラリを使ったログイン機能の一連の流れです!\nちなみにサインアップされたユーザー情報はCognitoに以下のように管理されます\n<img width=\"1088\" alt=\"スクリーンショット 2019-11-14 0.11.15.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/441587/cdbe3ad1-82e2-06ec-196c-9b90a9477d48.png\">\n\nDBを使わずコンポーネント一つで登録、管理してくれるのはとても便利ですし、技術の進歩を実感しますね！\n今後も最新技術について記事を書いていこうと思います！\n",coediting:a,comments_count:0,created_at:ss,group:n,id:"0b976b12ddb34f027190",likes_count:2,private:a,reactions_count:0,tags:[{name:l,versions:[]},{name:"cognito",versions:[]},{name:e,versions:[]},{name:"amplify",versions:[]}],title:"Amplify + Nuxt.js + Cognitoでログイン機能を実装してみた",updated_at:ss,url:"https://qiita.com/respectakagikun/items/0b976b12ddb34f027190",user:{description:s,facebook_id:s,followees_count:4,followers_count:3,github_login_name:n,id:ns,items_count:3,linkedin_id:s,location:s,name:"凌 遠藤",organization:s,permanent_id:441587,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/441587/4fe73d59ea2c8a66d19435e702d794588f25cea5/x_large.png?1572825085",team_only:a,twitter_screen_name:ns,website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>\n\n<p>APIで取得してきたデータ毎にページを作成したい！と思い色々試行錯誤した内容をまとめました。<br>\nAPI作成に使用したのツールは<a href="https://microcms.io/" rel="nofollow noopener" target="_blank">Micro CMS</a>です。別記事で使用方法を書いてあります。<br>\n<a href="https://qiita.com/omochironn/items/05a2b3cca6067119c88e" id="reference-d34378305d2a38aff925">Nuxtで最近話題のMicroCMSを使用してFirebaseで公開する</a></p>\n\n<p>※コードの説明は基本コメントで行ってます。</p>\n\n<h2>\n<span id="まずは公式リファレンスを読もう" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E3%81%AF%E5%85%AC%E5%BC%8F%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9%E3%82%92%E8%AA%AD%E3%82%82%E3%81%86"><i class="fa fa-link"></i></a>まずは公式リファレンスを読もう</h2>\n\n<p><a href="https://ja.nuxtjs.org/guide/routing/#%E5%8B%95%E7%9A%84%E3%81%AA%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0" rel="nofollow noopener" target="_blank">Nuxt.js 動的ルーティング</a>について公式リファレンスで記載があるので、まずはコチラを読みましょう。</p>\n\n<blockquote>\n<p>なるほどわからん<img alt=":thinking:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png" title=":thinking:" width="20" loading="lazy"> </p>\n</blockquote>\n\n<p>もう少し調べると<a href="https://www.dkrk-blog.net/vue-nuxt/nuxt-generate-routes" rel="nofollow noopener" target="_blank">素敵な記事</a>を見つけました。</p>\n\n<blockquote>\n<p>どうやらnuxt.config.jsをいじるっぽいぞ<img alt=":thinking:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png" title=":thinking:" width="20" loading="lazy"> </p>\n</blockquote>\n\n<p>という事で再度<a href="https://ja.nuxtjs.org/api/configuration-generate/" rel="nofollow noopener" target="_blank">公式リファレンス</a>を確認。<br>\nちょっとずつ分かってきたぞ。ではやってみよう。</p>\n\n<h2>\n<span id="まずはapiの作成" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E3%81%AFapi%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>まずはAPIの作成</h2>\n\n<p>MicroCMSを使用する場合であれば<a href="https://qiita.com/omochironn/items/05a2b3cca6067119c88e">Nuxtで最近話題のMicroCMSを使用してFirebaseで公開する</a><br>\nの記事の方を参考に。<br>\n実際に送られてくるデータの例としては下記の様に作成しました。<br>\n作成するサイトはお友達紹介ページです。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">get.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n    </span><span class="nl">"contents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n        </span><span class="p">{</span><span class="w">\n            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"自動登録"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"自動登録"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"自動登録"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"dir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"friends01"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"お友達01"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"mainv"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n                </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"画像URL"</span><span class="w">\n            </span><span class="p">},</span><span class="w">\n            </span><span class="nl">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;p&gt;仲良しこよしのお友達&lt;br&gt;お友達登録No.001&lt;/p&gt;"</span><span class="w">\n        </span><span class="p">},</span><span class="w">\n        </span><span class="p">{</span><span class="w">\n            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"自動登録"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"自動登録"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"自動登録"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"dir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"friends02"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"お友達02"</span><span class="p">,</span><span class="w">\n            </span><span class="nl">"mainv"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n                </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"画像URL"</span><span class="w">\n            </span><span class="p">},</span><span class="w">\n            </span><span class="nl">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;p&gt;仲良しこよしのお友達&lt;br&gt;お友達登録No.002&lt;/p&gt;"</span><span class="w">\n        </span><span class="p">}</span><span class="w">\n    </span><span class="p">]</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>使用するのは<code>dir</code>,<code>title</code>,<code>mainv</code>,<code>body</code>の4つです。</p>\n\n<h2>\n<span id="nuxtconfigjsの編集" class="fragment"></span><a href="#nuxtconfigjs%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>nuxt.config.jsの編集</h2>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="c1">// axiosをimport (※importせず$を使用した方法でも可</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">mode</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">spa</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="c1">//　～</span>\n  <span class="c1">// 中略</span>\n  <span class="c1">//　～</span>\n  <span class="na">generate</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">routes</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="c1">// 使用するAPIから情報を取得</span>\n      <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">リクエストURL</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span>\n        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">\'</span><span class="s1">X-API-KEY</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">APIキー</span><span class="dl">\'</span> <span class="p">}</span>\n      <span class="p">})</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">friends</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n            <span class="k">return</span> <span class="p">{</span>\n              <span class="na">route</span><span class="p">:</span> <span class="nx">friends</span><span class="p">.</span><span class="nx">dir</span><span class="p">,</span>  <span class="c1">// ページのurlになる部分。今回はAPI上で設定した情報を使用。</span>\n              <span class="na">payload</span><span class="p">:</span> <span class="nx">friends</span>     <span class="c1">// ページ毎に疎通を行わずに済むようpayloadに情報を渡す</span>\n            <span class="p">}</span>\n          <span class="p">})</span>\n        <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="storeの作成" class="fragment"></span><a href="#store%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>Storeの作成</h2>\n\n<p>APIで取得してきたデータを<code>state</code>として管理します。</p>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">/store/friends.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">ApiFlag</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>  <span class="c1">//APIデータ取得を行ったか否か</span>\n  <span class="na">friend</span><span class="p">:</span> <span class="dl">\'\'</span>       <span class="c1">//APIで取得してきたデータを格納</span>\n<span class="p">})</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="c1">// API疎通に成功した際にFlagを立てる</span>\n  <span class="nx">FlagChange</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">ApiFlag</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">state</span><span class="p">.</span><span class="nx">ApiFlag</span> <span class="o">=</span> <span class="kc">true</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n\n  <span class="c1">// APIで取得してきたデータを格納する</span>\n  <span class="nx">getFriends</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="nx">state</span><span class="p">.</span><span class="nx">friend</span> <span class="o">=</span> <span class="nx">res</span> <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>ページ毎にAPI疎通を行わない様に、<code>ApiFlag</code>を設置しました。</p>\n\n<blockquote>\n<p>これについては<code>payload</code>で解決しそうなものなのですが、<br>\nうまく動作しなかったのでこの仕様にしました <img alt=":cry:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f622.png" title=":cry:" width="20" loading="lazy"> </p>\n</blockquote>\n\n<h2>\n<span id="テンプレート用のvueファイルの作成" class="fragment"></span><a href="#%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E7%94%A8%E3%81%AEvue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>テンプレート用のvueファイルの作成</h2>\n\n<p>動的に作成されるページのテンプレートファイルを作成します。<br>\nアンダースコアのプレフィックスを付けたvueファイルを作成する事で定義できます。<br>\n私の場合は<code>_friends.vue</code>という名前でテンプレートを作成しました。</p>\n\n<h3>\n<span id="js部分" class="fragment"></span><a href="#js%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>JS部分</h3>\n\n<div class="code-frame" data-lang="vuejs">\n<div class="code-lang"><span class="bold">/pages/_friends.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="c1">// store</span>\n  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>\n    <span class="c1">// stateの情報を取得</span>\n    <span class="nx">ApiFlag</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">friends</span><span class="p">.</span><span class="nx">ApiFlag</span> <span class="p">},</span>\n    <span class="nx">friends</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">friends</span><span class="p">.</span><span class="nx">friend</span> <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="c1">// APIで取得してきたデータ群</span>\n      <span class="na">dir</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>    <span class="c1">// ページURL</span>\n      <span class="na">title</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>  <span class="c1">// お友達の名前</span>\n      <span class="na">mainv</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>  <span class="c1">// お友達のイメージ画像</span>\n      <span class="na">body</span><span class="p">:</span> <span class="dl">\'\'</span>    <span class="c1">// お友達の紹介文</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="k">async</span> <span class="nx">asyncData</span> <span class="p">({</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="c1">// payloadでデータを受け取った場合</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="p">{</span>\n        <span class="na">dir</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">dir</span><span class="p">,</span>\n        <span class="na">title</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>\n        <span class="na">mainv</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">mainv</span><span class="p">,</span>\n        <span class="na">body</span><span class="p">:</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">body</span>\n      <span class="p">}</span>\n    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n      <span class="c1">// payloadでデータを取得できなかった場合</span>\n      <span class="kd">let</span> <span class="nx">Dir</span>\n      <span class="kd">let</span> <span class="nx">Ftitle</span>\n      <span class="kd">let</span> <span class="nx">Fmainv</span>\n      <span class="kd">let</span> <span class="nx">Fbody</span>\n\n      <span class="c1">// API通信を行っていなかった場合</span>\n      <span class="k">if</span> <span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">friends</span><span class="p">.</span><span class="nx">ApiFlag</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">リクエストURL</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span>\n          <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">\'</span><span class="s1">X-API-KEY</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">APIキー</span><span class="dl">\'</span> <span class="p">}</span>\n        <span class="p">})</span>\n          <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n            <span class="c1">// Flagを立てて、情報をstateに格納</span>\n            <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">friends/FlagChange</span><span class="dl">\'</span><span class="p">)</span>\n            <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">friends/getFriends</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">contents</span><span class="p">)</span>\n            <span class="c1">// APIで取得してきたデータを格納　　　　</span>\n            <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">friend</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n              <span class="k">if</span> <span class="p">(</span><span class="nx">friend</span><span class="p">.</span><span class="nx">dir</span> <span class="o">===</span> <span class="nx">params</span><span class="p">.</span><span class="nx">friends</span><span class="p">)</span> <span class="p">{</span>\n                <span class="nx">Dir</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">dir</span>\n                <span class="nx">Ftitle</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">title</span>\n                <span class="nx">Fmainv</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">mainv</span>\n                <span class="nx">Fbody</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">body</span>\n              <span class="p">}</span>\n            <span class="p">})</span>\n          <span class="p">})</span>\n\n      <span class="c1">// API通信済みの場合</span>\n      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n        <span class="c1">// storeのデータを回して、現在のページのお友達情報を格納</span>\n        <span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">friends</span><span class="p">.</span><span class="nx">friend</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">friend</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="k">if</span> <span class="p">(</span><span class="nx">friend</span><span class="p">.</span><span class="nx">dir</span> <span class="o">===</span> <span class="nx">params</span><span class="p">.</span><span class="nx">friends</span><span class="p">)</span> <span class="p">{</span>\n            <span class="nx">Dir</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">dir</span>\n            <span class="nx">Ftitle</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">title</span>\n            <span class="nx">Fmainv</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">mainv</span>\n            <span class="nx">Fbody</span> <span class="o">=</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">body</span>\n          <span class="p">}</span>\n        <span class="p">})</span>\n      <span class="p">}</span>\n\n      <span class="k">return</span> <span class="p">{</span>\n        <span class="na">dir</span><span class="p">:</span> <span class="nx">Dir</span><span class="p">,</span>\n        <span class="na">title</span><span class="p">:</span> <span class="nx">Ftitle</span><span class="p">,</span>\n        <span class="na">mainv</span><span class="p">:</span> <span class="nx">Fmainv</span><span class="p">,</span>\n        <span class="na">body</span><span class="p">:</span> <span class="nx">Fbody</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="c1">// ページ遷移関数</span>\n    <span class="nx">jump</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="html部分" class="fragment"></span><a href="#html%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>HTML部分</h3>\n\n<div class="code-frame" data-lang="vuejs">\n<div class="code-lang"><span class="bold">/pages/_friends.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>\n    <span class="c">&lt;!-- 選択でページ遷移 --&gt;</span>\n    <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">"links"</span> <span class="err">@</span><span class="na">change=</span><span class="s">"jump"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;option</span> <span class="na">hidden</span><span class="nt">&gt;</span>おともだち を えらぼう！<span class="nt">&lt;/option&gt;</span>\n      <span class="nt">&lt;option</span> <span class="na">v-for=</span><span class="s">"friend of friends"</span> <span class="na">:key=</span><span class="s">"friend.id"</span> <span class="na">:value=</span><span class="s">"`./$</span>{friend.dir}`"&gt;<span class="si">{{</span> <span class="nx">friend</span><span class="p">.</span><span class="nx">title</span> <span class="si">}}</span><span class="nt">&lt;/option&gt;</span>\n    <span class="nt">&lt;/select&gt;</span>\n\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;</span>\n          <span class="c">&lt;!-- dataからお友達の名前を取得 --&gt;</span>\n          <span class="si">{{</span> <span class="nx">title</span> <span class="si">}}</span>\n        <span class="nt">&lt;/h1&gt;</span>\n        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mainv"</span><span class="nt">&gt;</span>\n          <span class="nt">&lt;img</span> <span class="na">:src=</span><span class="s">"mainv.url"</span> <span class="na">alt=</span><span class="s">"メイン画像"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;/div&gt;</span>\n        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents"</span><span class="nt">&gt;</span>\n          <span class="nt">&lt;h2&gt;</span>プロフィール<span class="nt">&lt;/h2&gt;</span>\n          <span class="nt">&lt;span</span> <span class="na">v-html=</span><span class="s">"body"</span> <span class="nt">/&gt;</span>\n        <span class="nt">&lt;/div&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h4>\n<span id="select部分" class="fragment"></span><a href="#select%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>select部分</h4>\n\n<p>APIで取得してきたデータをv-forで回して<code>option</code>を作成しています。<br>\n<code>:value</code>の書き方が特殊なので注意してください。</p>\n\n<h4>\n<span id="card部分" class="fragment"></span><a href="#card%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>card部分</h4>\n\n<p><code>titile</code> ⇒ 通常の<code>{{ }}</code>を使用して<code>&lt;h1&gt;</code>に適用<br>\n<code>mainv</code>  ⇒ <code>v-bind</code>を使用した<code>src</code>で<code>&lt;img&gt;</code>に適用<br>\n<code>body</code>  ⇒ 取得してきたhtmlタグをそのまま使用するため、<code>v-html</code>で適用</p>\n\n<p>これでAPIで取得してきたデータ分だけページが作成されるはずです！</p>\n\n<h2>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>\n\n<p>動的ルーティングはHeadlessCMSを使ったブログページ作成などで重宝しそうです。<br>\nただ、APIを使用したブログページがSEOや表示速度の面でどうなのか気になる所です。<br>\nHeadlessCMSの使用箇所としてはブログなどの情報量が多いものではなく、ページの一部のみ<br>\n簡単に変更したい場合などに使うようにするくらいが良いのだろうか…難しいところです。</p>\n',body:'# 概要\nAPIで取得してきたデータ毎にページを作成したい！と思い色々試行錯誤した内容をまとめました。\nAPI作成に使用したのツールは[Micro CMS](https://microcms.io/)です。別記事で使用方法を書いてあります。\n[Nuxtで最近話題のMicroCMSを使用してFirebaseで公開する](https://qiita.com/omochironn/items/05a2b3cca6067119c88e)\n\n※コードの説明は基本コメントで行ってます。\n\n## まずは公式リファレンスを読もう\n[Nuxt.js 動的ルーティング](https://ja.nuxtjs.org/guide/routing/#%E5%8B%95%E7%9A%84%E3%81%AA%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)について公式リファレンスで記載があるので、まずはコチラを読みましょう。\n>なるほどわからん:thinking: \n\nもう少し調べると[素敵な記事](https://www.dkrk-blog.net/vue-nuxt/nuxt-generate-routes)を見つけました。\n>どうやらnuxt.config.jsをいじるっぽいぞ:thinking: \n\nという事で再度[公式リファレンス](https://ja.nuxtjs.org/api/configuration-generate/)を確認。\nちょっとずつ分かってきたぞ。ではやってみよう。\n\n## まずはAPIの作成\nMicroCMSを使用する場合であれば[Nuxtで最近話題のMicroCMSを使用してFirebaseで公開する](https://qiita.com/omochironn/items/05a2b3cca6067119c88e)\nの記事の方を参考に。\n実際に送られてくるデータの例としては下記の様に作成しました。\n作成するサイトはお友達紹介ページです。\n\n```json:get.json\n{\n    "contents": [\n        {\n            "id": "自動登録",\n            "createdAt": "自動登録",\n            "updatedAt": "自動登録",\n            "dir": "friends01",\n            "title": "お友達01",\n            "mainv": {\n                "url": "画像URL"\n            },\n            "body": "<p>仲良しこよしのお友達<br>お友達登録No.001</p>"\n        },\n        {\n            "id": "自動登録",\n            "createdAt": "自動登録",\n            "updatedAt": "自動登録",\n            "dir": "friends02",\n            "title": "お友達02",\n            "mainv": {\n                "url": "画像URL"\n            },\n            "body": "<p>仲良しこよしのお友達<br>お友達登録No.002</p>"\n        }\n    ]\n}\n```\n使用するのは`dir`,`title`,`mainv`,`body`の4つです。\n\n\n## nuxt.config.jsの編集\n```js:nuxt.config.js\n// axiosをimport (※importせず$を使用した方法でも可\nimport axios from \'axios\'\n\nexport default {\n  mode: \'spa\',\n  //　～\n  // 中略\n  //　～\n  generate: {\n    routes () {\n      // 使用するAPIから情報を取得\n      return axios.get(\'リクエストURL\', {\n        headers: { \'X-API-KEY\': \'APIキー\' }\n      })\n        .then((res) => {\n          return res.data.contents.map((friends) => {\n            return {\n              route: friends.dir,  // ページのurlになる部分。今回はAPI上で設定した情報を使用。\n              payload: friends     // ページ毎に疎通を行わずに済むようpayloadに情報を渡す\n            }\n          })\n        })\n    }\n  }\n}\n```\n\n## Storeの作成\nAPIで取得してきたデータを`state`として管理します。\n\n```js:/store/friends.js\nexport const state = () => ({\n  ApiFlag: false,  //APIデータ取得を行ったか否か\n  friend: \'\'       //APIで取得してきたデータを格納\n})\n\nexport const mutations = {\n  // API疎通に成功した際にFlagを立てる\n  FlagChange (state) {\n    if (state.ApiFlag === false) {\n      state.ApiFlag = true\n    }\n  },\n\n  // APIで取得してきたデータを格納する\n  getFriends (state, res) { state.friend = res }\n}\n```\nページ毎にAPI疎通を行わない様に、`ApiFlag`を設置しました。\n>これについては`payload`で解決しそうなものなのですが、\nうまく動作しなかったのでこの仕様にしました :cry: \n\n## テンプレート用のvueファイルの作成\n動的に作成されるページのテンプレートファイルを作成します。\nアンダースコアのプレフィックスを付けたvueファイルを作成する事で定義できます。\n私の場合は`_friends.vue`という名前でテンプレートを作成しました。\n\n### JS部分\n```vuejs:/pages/_friends.vue\n<script>\nimport axios from \'axios\'\n\nexport default {\n  // store\n  computed: {\n    // stateの情報を取得\n    ApiFlag () { return this.$store.state.friends.ApiFlag },\n    friends () { return this.$store.state.friends.friend }\n  },\n  data () {\n    return {\n      // APIで取得してきたデータ群\n      dir: \'\',    // ページURL\n      title: \'\',  // お友達の名前\n      mainv: \'\',  // お友達のイメージ画像\n      body: \'\'    // お友達の紹介文\n    }\n  },\n  async asyncData ({ store, params, error, payload }) {\n    // payloadでデータを受け取った場合\n    if (payload) {\n      return {\n        dir: payload.dir,\n        title: payload.title,\n        mainv: payload.mainv,\n        body: payload.body\n      }\n    } else {\n      // payloadでデータを取得できなかった場合\n      let Dir\n      let Ftitle\n      let Fmainv\n      let Fbody\n\n      // API通信を行っていなかった場合\n      if (store.state.friends.ApiFlag === false) {\n        await axios.get(\'リクエストURL\', {\n          headers: { \'X-API-KEY\': \'APIキー\' }\n        })\n          .then((res) => {\n            // Flagを立てて、情報をstateに格納\n            this.$store.commit(\'friends/FlagChange\')\n            this.$store.commit(\'friends/getFriends\', res.data.contents)\n            // APIで取得してきたデータを格納　　　　\n            res.data.contents.map((friend) => {\n              if (friend.dir === params.friends) {\n                Dir = friend.dir\n                Ftitle = friend.title\n                Fmainv = friend.mainv\n                Fbody = friend.body\n              }\n            })\n          })\n\n      // API通信済みの場合\n      } else {\n        // storeのデータを回して、現在のページのお友達情報を格納\n        store.state.friends.friend.map((friend) => {\n          if (friend.dir === params.friends) {\n            Dir = friend.dir\n            Ftitle = friend.title\n            Fmainv = friend.mainv\n            Fbody = friend.body\n          }\n        })\n      }\n\n      return {\n        dir: Dir,\n        title: Ftitle,\n        mainv: Fmainv,\n        body: Fbody\n      }\n    }\n  },\n  methods: {\n    // ページ遷移関数\n    jump (e) {\n      location.href = e.target.value\n    }\n  }\n}\n<\/script>\n```\n\n### HTML部分\n```vuejs:/pages/_friends.vue\n<template>\n  <div class="container">\n    \x3c!-- 選択でページ遷移 --\x3e\n    <select class="links" @change="jump">\n      <option hidden>おともだち を えらぼう！</option>\n      <option v-for="friend of friends" :key="friend.id" :value="`./${friend.dir}`">{{ friend.title }}</option>\n    </select>\n\n    <div class="card">\n      <div class="contents">\n        <h1 class="title">\n          \x3c!-- dataからお友達の名前を取得 --\x3e\n          {{ title }}\n        </h1>\n        <div class="mainv">\n          <img :src="mainv.url" alt="メイン画像">\n        </div>\n        <div class="contents">\n          <h2>プロフィール</h2>\n          <span v-html="body" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n```\n\n#### select部分\nAPIで取得してきたデータをv-forで回して`option`を作成しています。\n`:value`の書き方が特殊なので注意してください。\n\n#### card部分\n`titile` ⇒ 通常の`{{ }}`を使用して`<h1>`に適用\n`mainv`  ⇒ `v-bind`を使用した`src`で`<img>`に適用\n`body`  ⇒ 取得してきたhtmlタグをそのまま使用するため、`v-html`で適用\n\nこれでAPIで取得してきたデータ分だけページが作成されるはずです！\n\n## まとめ\n動的ルーティングはHeadlessCMSを使ったブログページ作成などで重宝しそうです。\nただ、APIを使用したブログページがSEOや表示速度の面でどうなのか気になる所です。\nHeadlessCMSの使用箇所としてはブログなどの情報量が多いものではなく、ページの一部のみ\n簡単に変更したい場合などに使うようにするくらいが良いのだろうか…難しいところです。\n',coediting:a,comments_count:0,created_at:"2019-11-14T14:36:41+09:00",group:n,id:"5ff800ac9c21dfe29aad",likes_count:2,private:a,reactions_count:0,tags:[{name:"api",versions:[]},{name:e,versions:[]},{name:"microCMS",versions:[]}],title:"【Nuxt】APIで取得したデータごとにページを作成する【動的ルーティング】",updated_at:"2019-11-14T14:39:40+09:00",url:"https://qiita.com/omochironn/items/5ff800ac9c21dfe29aad",user:{description:_,facebook_id:s,followees_count:5,followers_count:8,github_login_name:n,id:f,items_count:18,linkedin_id:s,location:B,name:s,organization:s,permanent_id:S,profile_image_url:T,team_only:a,twitter_screen_name:f,website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>この度、<code>nuxt-child</code>というコンポーネントの存在を知り、戦慄しました。</p>\n\n<blockquote>\n<p><a href="https://ja.nuxtjs.org/api/components-nuxt-child/" rel="nofollow noopener" target="_blank">API:  コンポーネント - NuxtJS</a></p>\n</blockquote>\n\n<p>これまで、ページカテゴリの数だけレイアウトファイルを量産し、似通った初期化処理を何度も書いてしまっていました。<br>\n<strong>が、それは本来、レイアウトファイルで行うべきことではなかったのです</strong>。</p>\n\n<p>この記事では<code>nuxt-child</code>コンポーネントの使い方をご紹介します。</p>\n\n<h1>\n<span id="nested-routes" class="fragment"></span><a href="#nested-routes"><i class="fa fa-link"></i></a>Nested Routes</h1>\n\n<p>Nuxtにはネストされたルート（Nested Routes）という機能が存在します。<br>\nこれは、ページパスと同名のページコンポーネントをレイアウト相当として動作させる事ができる機能です。</p>\n\n<blockquote>\n<p><a href="https://ja.nuxtjs.org/guide/routing/#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%81%9F%E3%83%AB%E3%83%BC%E3%83%88" rel="nofollow noopener" target="_blank">ネストされたルート (ルーティング - NuxtJS)</a></p>\n</blockquote>\n\n<p>たとえば、以下のようなページ構成にするとします。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>.\n└── pages/\n    ├── product/\n    │   ├── index.vue\n    │   ├── list.vue\n    │   └── _id.vue\n    └── product.vue\n</pre></div></div>\n\n<p>有効になるルートは<code>/product</code>、<code>/product/list</code>、<code>/product/_id</code>の３つです。</p>\n\n<p>このとき、<code>pages/product.vue</code>に記述した内容は、<code>pages/product/</code>以下のすべてのページコンポーネントで有効になります。<br>\nつまり、<code>pages/product.vue</code>が<code>pages/product/</code>以下のページのレイアウトとして機能するようになります。</p>\n\n<p>また、<code>pages/product.vue</code>には実際のページを表示させる領域に<code>nuxt-child</code>コンポーネントを配置する必要があります。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="c">&lt;!-- /pages/product.vue --&gt;</span>\n<span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page-container"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;TheHeader</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;TheBreadcrumbs</span> <span class="nt">/&gt;</span>\n        <span class="c">&lt;!-- ここにページの内容が入る --&gt;</span>\n        <span class="nt">&lt;nuxt-child</span> <span class="nt">/&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/TheHeader&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n</pre></div></div>\n\n<p>このようにすれば、<code>/pages/product/</code>以下のページで共通したヘッダーとパンくずリストを表示することができます。<br>\n同様に、マイページや注文関連のページもそれぞれ異なるレイアウトで表示することができます。</p>\n\n<p>そして、レイアウトファイルはグローバルスタイルやレイアウトの定義のみとなり、量産を防ぐことができます。</p>\n\n<h1>\n<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>\n\n<p>Nuxtはディレクトリ階層ベースのルーティングシステムのため、かなりURL定義が重要になります。<br>\nNested Routesもカテゴリごとにディレクトリ分けされて初めて機能します。</p>\n\n<p>カテゴリごとにディレクトリ分けされていないようなケースではあまり有効ではありません。<br>\nそのときは諦めてレイアウトファイルを量産するなどしてください。</p>\n\n<p>それ以外に良い方法があれば教えてほしい...。</p>\n',body:'# はじめに\n\nこの度、`nuxt-child`というコンポーネントの存在を知り、戦慄しました。\n\n> [API: <nuxt-child> コンポーネント - NuxtJS](https://ja.nuxtjs.org/api/components-nuxt-child/)\n\nこれまで、ページカテゴリの数だけレイアウトファイルを量産し、似通った初期化処理を何度も書いてしまっていました。\n**が、それは本来、レイアウトファイルで行うべきことではなかったのです**。\n\nこの記事では`nuxt-child`コンポーネントの使い方をご紹介します。\n\n# Nested Routes\n\nNuxtにはネストされたルート（Nested Routes）という機能が存在します。\nこれは、ページパスと同名のページコンポーネントをレイアウト相当として動作させる事ができる機能です。\n\n> [ネストされたルート (ルーティング - NuxtJS)](https://ja.nuxtjs.org/guide/routing/#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%81%9F%E3%83%AB%E3%83%BC%E3%83%88)\n\nたとえば、以下のようなページ構成にするとします。\n\n```\n.\n└── pages/\n    ├── product/\n    │   ├── index.vue\n    │   ├── list.vue\n    │   └── _id.vue\n    └── product.vue\n```\n\n有効になるルートは`/product`、`/product/list`、`/product/_id`の３つです。\n\nこのとき、`pages/product.vue`に記述した内容は、`pages/product/`以下のすべてのページコンポーネントで有効になります。\nつまり、`pages/product.vue`が`pages/product/`以下のページのレイアウトとして機能するようになります。\n\nまた、`pages/product.vue`には実際のページを表示させる領域に`nuxt-child`コンポーネントを配置する必要があります。\n\n```html\n\x3c!-- /pages/product.vue --\x3e\n<template>\n  <div class="page-container">\n    <TheHeader class="header">\n      <div class="contents">\n        <TheBreadcrumbs />\n        \x3c!-- ここにページの内容が入る --\x3e\n        <nuxt-child />\n      </div>\n    </TheHeader>\n  </div>\n</template>\n```\n\nこのようにすれば、`/pages/product/`以下のページで共通したヘッダーとパンくずリストを表示することができます。\n同様に、マイページや注文関連のページもそれぞれ異なるレイアウトで表示することができます。\n\nそして、レイアウトファイルはグローバルスタイルやレイアウトの定義のみとなり、量産を防ぐことができます。\n\n# おわりに\n\nNuxtはディレクトリ階層ベースのルーティングシステムのため、かなりURL定義が重要になります。\nNested Routesもカテゴリごとにディレクトリ分けされて初めて機能します。\n\nカテゴリごとにディレクトリ分けされていないようなケースではあまり有効ではありません。\nそのときは諦めてレイアウトファイルを量産するなどしてください。\n\nそれ以外に良い方法があれば教えてほしい...。\n',coediting:a,comments_count:0,created_at:as,group:n,id:"fbca7cb6c69e82484873",likes_count:7,private:a,reactions_count:0,tags:[{name:e,versions:[]}],title:"nuxt-childでlayoutの量産を防ぐ",updated_at:as,url:"https://qiita.com/simochee/items/fbca7cb6c69e82484873",user:{description:D,facebook_id:s,followees_count:9,followers_count:16,github_login_name:R,id:z,items_count:29,linkedin_id:s,location:G,name:s,organization:s,permanent_id:$,profile_image_url:O,team_only:a,twitter_screen_name:W,website_url:s},page_views_count:n},{rendered_body:'\n<h1>\n<span id="本記事の投稿動機" class="fragment"></span><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E6%8A%95%E7%A8%BF%E5%8B%95%E6%A9%9F"><i class="fa fa-link"></i></a>本記事の投稿動機</h1>\n\n<ul>\n<li>Firestoreのtransaction処理実装で公式ガイドには載っていないやり方での実装が必要だったため、知識整理として投稿</li>\n<li>おそらく連番IDを振るという実装はFirestore的にも推奨をしていませんので、この実装を実運用する場合は自己責任でおねがいいたします</li>\n</ul>\n\n<h1>\n<span id="本記事の対象読者" class="fragment"></span><a href="#%E6%9C%AC%E8%A8%98%E4%BA%8B%E3%81%AE%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85"><i class="fa fa-link"></i></a>本記事の対象読者</h1>\n\n<ul>\n<li>Cloud Firestoreを使用したことがあり、Firestoreにデータ追加、更新、削除といったオペレーションの想像がつく方</li>\n<li>アンチパターンかもだけどfirestoreで連番IDを扱いたい方</li>\n<li>素直にauto-incrementを使うのが吉と分かってはいるが、連番IDを他通信と競合せずに扱いたい方</li>\n</ul>\n\n<p>※ 実装はNuxt.js×TypeScriptです。</p>\n\n<h1>\n<span id="firestoreのtransaction処理とは" class="fragment"></span><a href="#firestore%E3%81%AEtransaction%E5%87%A6%E7%90%86%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Firestoreのtransaction処理とは</h1>\n\n<ul>\n<li>1つ以上のドキュメントに対して読み書きを行う一連のオペレーション</li>\n<li>最大 500 のドキュメントに書き込みを行うことができる</li>\n</ul>\n\n<h1>\n<span id="公式ガイドでのtransaction" class="fragment"></span><a href="#%E5%85%AC%E5%BC%8F%E3%82%AC%E3%82%A4%E3%83%89%E3%81%A7%E3%81%AEtransaction"><i class="fa fa-link"></i></a>公式ガイドでのtransaction</h1>\n\n<p><a href="https://firebase.google.com/docs/firestore/manage-data/transactions?hl=ja#transactions" class="autolink" rel="nofollow noopener" target="_blank">https://firebase.google.com/docs/firestore/manage-data/transactions?hl=ja#transactions</a></p>\n\n<p>公式ガイドの例では、コレクションのドキュメントが分かっている状態で、データを取得し、一部を編集して再度更新するといったサンプルとなっています。</p>\n\n<p>また、以下の注意が必要です。</p>\n\n<blockquote>\n<ul>\n<li>読み取りオペレーションは書き込みオペレーションの前に実行する必要があります。</li>\n<li>トランザクションが読み取るドキュメントに対して同時編集が影響する場合は、トランザクションを呼び出す関数（トランザクション関数）が複数回実行されることがあります。</li>\n<li>トランザクション関数はアプリケーションの状態を直接変更してはなりません。</li>\n<li>クライアントがオフラインの場合、トランザクションは失敗します。</li>\n</ul>\n</blockquote>\n\n<h1>\n<span id="今回実装したいこと" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>今回、実装したいこと</h1>\n\n<ul>\n<li>特定のコレクション(ドキュメント名は不明)から<code>createdBy</code>を降順にし、limitをかけた上でデータを取得。</li>\n<li>そのデータのtodoId(number)に<code>1</code>を足して、連番ID(newTodoId)として新規データオブジェクトと共に追加</li>\n</ul>\n\n<p>なので、</p>\n\n<ul>\n<li>transaction処理内でデータ取得(.get)とデータ新規追加(.set)をする必要があります。</li>\n</ul>\n\n<p>※通常であれば新規のデータ追加は<code>.add</code>を使用します。transactionの場合は<code>.add</code>が用意されておらず。代わりに<code>.set</code>を使用します。<code>.set</code>は既にデータが有れば更新。無ければ新規追加となりますので注意が必要です。</p>\n\n<h1>\n<span id="transaction内でやること" class="fragment"></span><a href="#transaction%E5%86%85%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>transaction内でやること</h1>\n\n<h3>\n<span id="1-まず連番idの元となるidを取得する" class="fragment"></span><a href="#1-%E3%81%BE%E3%81%9A%E9%80%A3%E7%95%AAid%E3%81%AE%E5%85%83%E3%81%A8%E3%81%AA%E3%82%8Bid%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1. まず連番IDの元となるIDを取得する</h3>\n\n<p>transactionでは<code>読み</code>と<code>書き</code>が必須となっており、まずは<code>読み</code>から実装します。<br>\nrunTransactionメソッド内でtransactionによるオペレーションが使用できるようになります。<br>\n今回、ドキュメント名は分かっておらず、<code>orderBy</code>で降順に並び替えた後に最新の1件のみを取得します。<br>\n<code>newTodoRef</code>では空docを指定し、referenceを作ります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">addTodo</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">todo</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">)</span> <span class="p">{</span>\n  <span class="k">await</span> <span class="nx">Firestore</span><span class="p">.</span><span class="nx">runTransaction</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">todoRef</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Firestore</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="dl">\'</span><span class="s1">todos</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">newTodoRef</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todoRef</span><span class="p">.</span><span class="nx">doc</span><span class="p">()</span>\n\n    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">newTodoRef</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="c1">// 最新のtodoを1件のみ取得</span>\n      <span class="kd">const</span> <span class="nx">querySnapshot</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todoRef</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">createdAt</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="kd">get</span><span class="p">()</span>\n    <span class="p">})</span>\n  <span class="p">})</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<h3>\n<span id="2-連番idを計算する" class="fragment"></span><a href="#2-%E9%80%A3%E7%95%AAid%E3%82%92%E8%A8%88%E7%AE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2. 連番IDを計算する</h3>\n\n<p>今回の場合は、元のIDに1を足すだけです。<br>\n先に変数<code>newTodoId</code>を用意し、Promise.all内で<code>todo.todoId + 1</code>を代入します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="nx">querySnapshot</span><span class="p">)</span> <span class="p">{</span>\n  <span class="kd">let</span> <span class="nx">newTodoId</span><span class="o">!</span><span class="p">:</span> <span class="nx">number</span>\n\n  <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">querySnapshot</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">todoDoc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todoDoc</span><span class="p">.</span><span class="nx">data</span><span class="p">()</span>\n\n    <span class="c1">// 新しいnewTodoIdを作る</span>\n    <span class="nx">newTodoId</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">todoId</span> <span class="o">+</span> <span class="mi">1</span>\n  <span class="p">}))</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<h3>\n<span id="3-firestoreに書き込む" class="fragment"></span><a href="#3-firestore%E3%81%AB%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>3. Firestoreに書き込む</h3>\n\n<p>あとはデータを整形して書き込むだけです。<br>\n書き込みは<code>.add</code>ではなく、<code>.set</code>を用いることに注意が必要です。<br>\n前述の通り、<code>.set</code>は既にデータが有れば更新。無ければ新規追加となります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kd">const</span> <span class="nx">todoData</span><span class="p">:</span> <span class="nx">TodoData</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">userId</span><span class="p">:</span> <span class="nx">userId</span><span class="p">,</span>\n  <span class="na">todoId</span><span class="p">:</span> <span class="nx">newTodoId</span><span class="p">,</span>\n  <span class="na">title</span><span class="p">:</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>\n  <span class="na">content</span><span class="p">:</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">content</span>\n<span class="p">}</span>\n\n<span class="c1">// オーダーを新規追加</span>\n<span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">newTodoRef</span><span class="p">,</span> <span class="nx">todoData</span><span class="p">)</span>\n</pre></div></div>\n\n<h1>\n<span id="実際の全体コード" class="fragment"></span><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AE%E5%85%A8%E4%BD%93%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>実際の全体コード</h1>\n\n<h3>\n<span id="firestoretodots" class="fragment"></span><a href="#firestoretodots"><i class="fa fa-link"></i></a>/firestore/todo.ts</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">addTodo</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">todo</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">)</span> <span class="p">{</span>\n  <span class="k">await</span> <span class="nx">Firestore</span><span class="p">.</span><span class="nx">runTransaction</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">todoRef</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Firestore</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="dl">\'</span><span class="s1">todos</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">newTodoRef</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todoRef</span><span class="p">.</span><span class="nx">doc</span><span class="p">()</span>\n\n    <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">newTodoRef</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="c1">// 最新のtodoを1件のみ取得</span>\n      <span class="kd">const</span> <span class="nx">querySnapshot</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todoRef</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="dl">"</span><span class="s2">createdAt</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="kd">get</span><span class="p">()</span>\n\n      <span class="k">if</span><span class="p">(</span><span class="nx">querySnapshot</span><span class="p">)</span> <span class="p">{</span>\n        <span class="kd">let</span> <span class="nx">newTodoId</span><span class="o">!</span><span class="p">:</span> <span class="nx">number</span>\n\n        <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">querySnapshot</span><span class="p">.</span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">todoDoc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="kd">const</span> <span class="nx">todo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todoDoc</span><span class="p">.</span><span class="nx">data</span><span class="p">()</span>\n\n          <span class="c1">// 新しいnewTodoIdを作る</span>\n          <span class="nx">newTodoId</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">todoId</span> <span class="o">+</span> <span class="mi">1</span>\n        <span class="p">}))</span>\n\n        <span class="kd">const</span> <span class="na">todoData</span><span class="p">:</span> <span class="nx">TodoData</span> <span class="o">=</span> <span class="p">{</span>\n          <span class="na">userId</span><span class="p">:</span> <span class="nx">userId</span><span class="p">,</span>\n          <span class="na">todoId</span><span class="p">:</span> <span class="nx">newTodoId</span><span class="p">,</span>\n          <span class="na">title</span><span class="p">:</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>\n          <span class="na">content</span><span class="p">:</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">content</span>\n        <span class="p">}</span>\n\n        <span class="c1">// オーダーを新規追加</span>\n        <span class="k">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">newTodoRef</span><span class="p">,</span> <span class="nx">todoData</span><span class="p">)</span>\n      <span class="p">}</span>\n    <span class="p">})</span>\n  <span class="p">})</span>\n<span class="p">}</span>\n\n</pre></div></div>\n\n<h1>\n<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>\n\n<p>transactionに一度慣れる、Firestoreを用いたのアプリ実装の幅がぐっと広がる気がします。</p>\n\n<p>私も個人開発が趣味なのでどんどん取り入れていきたいです。</p>\n\n<p>また、Firestoreを使用しておりませんが、個人開発で「thanks-mentions」というPWAをリリースしました！</p>\n\n<p>Qiitaの記事をメンション付きで共有できるPWAとなっております。</p>\n\n<p>Qiitaの記事を共有する際は「thanks-mentions」をよろしくお願いいたします！</p>\n\n<p></p><blockquote class="twitter-tweet">\n<p>TopページにTwitterシェアボタンとPCビューの改善をした🎉<a href="https://t.co/lse1BalZSL" rel="nofollow noopener" target="_blank"></a><a href="https://t.co/lse1BalZSL" class="autolink" rel="nofollow noopener" target="_blank">https://t.co/lse1BalZSL</a><a href="https://twitter.com/hashtag/thanks_mentions?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#thanks_mentions</a><a href="https://twitter.com/hashtag/wakate_mokumoku?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#wakate_mokumoku</a></p>— ワツヨ@PWAのthanks-mentions (@watsuyo_2) <a href="https://twitter.com/watsuyo_2/status/1193031339030675456?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 9, 2019</a>\n</blockquote> <script async src="https://platform.twitter.com/widgets.js"><\/script>\n',body:'# 本記事の投稿動機\n- Firestoreのtransaction処理実装で公式ガイドには載っていないやり方での実装が必要だったため、知識整理として投稿\n- おそらく連番IDを振るという実装はFirestore的にも推奨をしていませんので、この実装を実運用する場合は自己責任でおねがいいたします\n\n# 本記事の対象読者\n- Cloud Firestoreを使用したことがあり、Firestoreにデータ追加、更新、削除といったオペレーションの想像がつく方\n- アンチパターンかもだけどfirestoreで連番IDを扱いたい方\n- 素直にauto-incrementを使うのが吉と分かってはいるが、連番IDを他通信と競合せずに扱いたい方\n\n※ 実装はNuxt.js×TypeScriptです。\n\n# Firestoreのtransaction処理とは\n- 1つ以上のドキュメントに対して読み書きを行う一連のオペレーション\n- 最大 500 のドキュメントに書き込みを行うことができる\n\n# 公式ガイドでのtransaction\nhttps://firebase.google.com/docs/firestore/manage-data/transactions?hl=ja#transactions\n\n公式ガイドの例では、コレクションのドキュメントが分かっている状態で、データを取得し、一部を編集して再度更新するといったサンプルとなっています。\n\nまた、以下の注意が必要です。\n\n> \n- 読み取りオペレーションは書き込みオペレーションの前に実行する必要があります。\n- トランザクションが読み取るドキュメントに対して同時編集が影響する場合は、トランザクションを呼び出す関数（トランザクション関数）が複数回実行されることがあります。\n- トランザクション関数はアプリケーションの状態を直接変更してはなりません。\n- クライアントがオフラインの場合、トランザクションは失敗します。\n\n# 今回、実装したいこと\n\n- 特定のコレクション(ドキュメント名は不明)から`createdBy`を降順にし、limitをかけた上でデータを取得。\n- そのデータのtodoId(number)に`1`を足して、連番ID(newTodoId)として新規データオブジェクトと共に追加\n\nなので、\n\n- transaction処理内でデータ取得(.get)とデータ新規追加(.set)をする必要があります。\n\n※通常であれば新規のデータ追加は`.add`を使用します。transactionの場合は`.add`が用意されておらず。代わりに`.set`を使用します。`.set`は既にデータが有れば更新。無ければ新規追加となりますので注意が必要です。\n\n# transaction内でやること\n### 1. まず連番IDの元となるIDを取得する\ntransactionでは`読み`と`書き`が必須となっており、まずは`読み`から実装します。\nrunTransactionメソッド内でtransactionによるオペレーションが使用できるようになります。\n今回、ドキュメント名は分かっておらず、`orderBy`で降順に並び替えた後に最新の1件のみを取得します。\n`newTodoRef`では空docを指定し、referenceを作ります。\n\n```ts\nexport async function addTodo(userId: string, todo: Todo) {\n  await Firestore.runTransaction(async (transaction) => {\n    const todoRef = await Firestore.collection(\'todos\')\n    const newTodoRef = await todoRef.doc()\n    \n    await transaction.get(newTodoRef).then(async () => {\n      // 最新のtodoを1件のみ取得\n      const querySnapshot = await todoRef.orderBy("createdAt", "desc").limit(1).get()\n    })\n  })\n}\n```\n\n### 2. 連番IDを計算する\n今回の場合は、元のIDに1を足すだけです。\n先に変数`newTodoId`を用意し、Promise.all内で`todo.todoId + 1`を代入します。\n\n```ts\nif(querySnapshot) {\n  let newTodoId!: number\n\n  await Promise.all(querySnapshot.docs.map(async (todoDoc) => {\n    const todo = await todoDoc.data()\n\n    // 新しいnewTodoIdを作る\n    newTodoId = await todo.todoId + 1\n  }))\n}\n```\n\n### 3. Firestoreに書き込む\nあとはデータを整形して書き込むだけです。\n書き込みは`.add`ではなく、`.set`を用いることに注意が必要です。\n前述の通り、`.set`は既にデータが有れば更新。無ければ新規追加となります。\n\n```ts\nconst todoData: TodoData = {\n  userId: userId,\n  todoId: newTodoId,\n  title: todo.title,\n  content: todo.content\n}\n\n// オーダーを新規追加\nawait transaction.set(newTodoRef, todoData)\n```\n\n\n# 実際の全体コード\n### /firestore/todo.ts\n```ts\nexport async function addTodo(userId: string, todo: Todo) {\n  await Firestore.runTransaction(async (transaction) => {\n    const todoRef = await Firestore.collection(\'todos\')\n    const newTodoRef = await todoRef.doc()\n\n    await transaction.get(newTodoRef).then(async () => {\n      // 最新のtodoを1件のみ取得\n      const querySnapshot = await todoRef.orderBy("createdAt", "desc").limit(1).get()\n\n      if(querySnapshot) {\n        let newTodoId!: number\n\n        await Promise.all(querySnapshot.docs.map(async (todoDoc) => {\n          const todo = await todoDoc.data()\n\n          // 新しいnewTodoIdを作る\n          newTodoId = await todo.todoId + 1\n        }))\n\n        const todoData: TodoData = {\n          userId: userId,\n          todoId: newTodoId,\n          title: todo.title,\n          content: todo.content\n        }\n\n        // オーダーを新規追加\n        await transaction.set(newTodoRef, todoData)\n      }\n    })\n  })\n}\n\n```\n\n# 最後に\ntransactionに一度慣れる、Firestoreを用いたのアプリ実装の幅がぐっと広がる気がします。\n\n私も個人開発が趣味なのでどんどん取り入れていきたいです。\n\nまた、Firestoreを使用しておりませんが、個人開発で「thanks-mentions」というPWAをリリースしました！\n\nQiitaの記事をメンション付きで共有できるPWAとなっております。\n\nQiitaの記事を共有する際は「thanks-mentions」をよろしくお願いいたします！\n\n\n<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">TopページにTwitterシェアボタンとPCビューの改善をした🎉<a href="https://t.co/lse1BalZSL">https://t.co/lse1BalZSL</a><a href="https://twitter.com/hashtag/thanks_mentions?src=hash&amp;ref_src=twsrc%5Etfw">#thanks_mentions</a><a href="https://twitter.com/hashtag/wakate_mokumoku?src=hash&amp;ref_src=twsrc%5Etfw">#wakate_mokumoku</a></p>&mdash; ワツヨ@PWAのthanks-mentions (@watsuyo_2) <a href="https://twitter.com/watsuyo_2/status/1193031339030675456?ref_src=twsrc%5Etfw">November 9, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"><\/script>\n',coediting:a,comments_count:0,created_at:ps,group:n,id:"3f59cc44cc5c60cd208c",likes_count:3,private:a,reactions_count:0,tags:[{name:d,versions:[]},{name:l,versions:[]},{name:g,versions:[]},{name:e,versions:[]},{name:"Firestore",versions:[]}],title:"公式ガイドで教えてくれなかったFirestoreのtransaction処理で連番IDを振る方法",updated_at:ps,url:"https://qiita.com/watsuyo_2/items/3f59cc44cc5c60cd208c",user:{description:s,facebook_id:s,followees_count:16,followers_count:19,github_login_name:"watsuyo",id:P,items_count:38,linkedin_id:s,location:"Tokyo",name:s,organization:"Web系",permanent_id:253605,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/253605/profile-images/1549781669",team_only:a,twitter_screen_name:P,website_url:s},page_views_count:n}],users:{},userItems:{}},serverRendered:!0}}("",null,!1,0,"nuxt.js",0,"Vue.js",0,0,0,0,"JavaScript",0,"omochironn","Firebase",0,"ainehanta",0,"kobayashi-m42",0,"2019-11-19T17:11:36+09:00","umamichi",0,0,"taakuuyaa",0,"社会人2年目ひよっこフロントエンドエンジニア\r\nメモ・社内共有用に記事を書くことが多いです","TypeScript","2019-11-19T18:27:00+09:00","GitHub","Fukui",185788,"https://qiita-image-store.s3.amazonaws.com/0/185788/profile-images/1526380513","2019-11-18T17:30:05+09:00",0,"Nuxt & TypeScript大好きマンです","watsuyo_2","tamuraryoya","simochee",0,"Chiba, Japan",127934,"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993","lollipop_onl","taktakahashi","2019-11-16T23:42:50+09:00",0,"kira_puka",0,"sky0621",0,"Node.js","Annielovescode","ljourm","2019-11-14T18:32:07+09:00","respectakagikun","2019-11-14T01:02:12+09:00","2019-11-13T19:47:59+09:00")</script><script src="/nuxt-circle-ci/_nuxt/8ec1328747011a81d7cc.js" defer></script><script src="/nuxt-circle-ci/_nuxt/d532d6b7bee7a1094843.js" defer></script><script src="/nuxt-circle-ci/_nuxt/fa8b5b1668aa9cd442ea.js" defer></script><script src="/nuxt-circle-ci/_nuxt/750c8111044767f53b05.js" defer></script>
  </body>
</html>
