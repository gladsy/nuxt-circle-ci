<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>nuxt-circle-ci | Nuxt.js tag items viewer</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Nuxt.js project"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/nuxt-circle-ci//favicon.ico"><base href="/nuxt-circle-ci/"><link rel="preload" href="/nuxt-circle-ci/_nuxt/605927d4d91740a23e44.js" as="script"><link rel="preload" href="/nuxt-circle-ci/_nuxt/fa8b5b1668aa9cd442ea.js" as="script"><link rel="preload" href="/nuxt-circle-ci/_nuxt/750c8111044767f53b05.js" as="script"><link rel="preload" href="/nuxt-circle-ci/_nuxt/b3356641dc119feec53b.js" as="script"><style data-vue-ssr-id="3191d5ad:0 932a8f60:0 6759f5ab:0 6b20bbdb:0 5db11919:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;-webkit-transition:width .1s,opacity .4s;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{-webkit-transition:none;transition:none}.nuxt-progress-failed{background-color:red}html{box-sizing:border-box;font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-spacing:1px}*,:after,:before{box-sizing:border-box;margin:0}.button--green{border:1px solid #3b8070;border-radius:4px;color:#3b8070;display:inline-block;padding:10px 30px;text-decoration:none}.button--green:hover{background-color:#3b8070;color:#fff}.button--grey{border:1px solid #35495e;border-radius:4px;color:#35495e;display:inline-block;margin-left:15px;padding:10px 30px;text-decoration:none}.button--grey:hover{background-color:#35495e;color:#fff}.container{min-height:100vh;padding:16px}h3{border-bottom:1px solid #e5e5e5;padding:8px 0}h3,li+li{margin:16px 0}p{margin:8px 0}.VueToNuxtLogo[data-v-8dc126aa]{height:100px}hr[data-v-8dc126aa]{border-top:1px solid #e5e5e5}.footer[data-v-8dc126aa]{text-align:center}.VueToNuxtLogo{-webkit-animation:turn 2s linear 1s forwards;animation:turn 2s linear 1s forwards;display:inline-block;height:180px;overflow:hidden;position:relative;-webkit-transform:rotateX(180deg);transform:rotateX(180deg);width:245px}.Triangle{height:0;left:0;position:absolute;top:0;width:0}.Triangle--one{border-bottom:180px solid #41b883;border-left:105px solid transparent;border-right:105px solid transparent}.Triangle--two{border-bottom:150px solid #3b8070;border-left:87.5px solid transparent;border-right:87.5px solid transparent;top:30px}.Triangle--three,.Triangle--two{-webkit-animation:goright .5s linear 3.5s forwards;animation:goright .5s linear 3.5s forwards;left:35px}.Triangle--three{border-bottom:120px solid #35495e;border-left:70px solid transparent;border-right:70px solid transparent;top:60px}.Triangle--four{-webkit-animation:godown .5s linear 3s forwards;animation:godown .5s linear 3s forwards;border-bottom:60px solid #fff;border-left:35px solid transparent;border-right:35px solid transparent;left:70px;top:120px}@-webkit-keyframes turn{to{-webkit-transform:rotateX(0);transform:rotateX(0)}}@keyframes turn{to{-webkit-transform:rotateX(0);transform:rotateX(0)}}@-webkit-keyframes godown{to{top:180px}}@keyframes godown{to{top:180px}}@-webkit-keyframes goright{to{left:70px}}@keyframes goright{to{left:70px}}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><section class="container" data-v-8dc126aa><div data-v-8dc126aa><h3 data-v-8dc126aa><div class="VueToNuxtLogo" data-v-8dc126aa><div class="Triangle Triangle--two"></div> <div class="Triangle Triangle--one"></div> <div class="Triangle Triangle--three"></div> <div class="Triangle Triangle--four"></div></div> <span data-v-8dc126aa>Nuxt.js のタグが付けられた投稿の一覧</span></h3> <ul data-v-8dc126aa><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>[FULL STATIC] Nuxt generate&lt;4つのアプローチまとめ></span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/basho" data-v-8dc126aa>basho</a></small></h4> <div data-v-8dc126aa>最近ContentfulとNetlify、Nuxt.jsを利用してブログを立ち上げました。

ヘッドレスCMSとNuxt generateで静的なサイトを！と思ったのですが、実際にはクライアントからのアクセスのたびにContentfulへの通信が発生していまし......</div> <p data-v-8dc126aa><a href="https://qiita.com/basho/items/ec6165b369c4b414c766" data-v-8dc126aa>https://qiita.com/basho/items/ec6165b369c4b414c766</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>PandocでMarkdownからVueのSFCを生成してみた</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/kira_puka" data-v-8dc126aa>kira_puka</a></small></h4> <div data-v-8dc126aa>以前、[FAQみたいなページをmarkdownで書けるようにしていた](https://qiita.com/kira_puka/items/68732b402b2523f4ccd7)けど、
ランタイムでコンパイルするのはやっぱり重いなと思い、
軽量化の一環で前......</div> <p data-v-8dc126aa><a href="https://qiita.com/kira_puka/items/1e68c7838f123cd1255b" data-v-8dc126aa>https://qiita.com/kira_puka/items/1e68c7838f123cd1255b</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>【Nuxt.js / Storybook】インストールとaddonの導入まで(StoriesOf APIではなく最新ver推奨のCSF記法で)</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/kamicop" data-v-8dc126aa>kamicop</a></small></h4> <div data-v-8dc126aa>新規でNuxt(Vue)のプロジェクトを立ち上げる機会があったので、初めてStorybookを導入してみました。
現在Storybookのバージョンは5.2.xですが、公式が推奨するストーリーの記述方式が**Component Story Format (CS......</div> <p data-v-8dc126aa><a href="https://qiita.com/kamicop/items/887d9dc40facaa43eed7" data-v-8dc126aa>https://qiita.com/kamicop/items/887d9dc40facaa43eed7</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt.jsで文字列からコンポーネントを描画してSSRする</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/d6ms" data-v-8dc126aa>d6ms</a></small></h4> <div data-v-8dc126aa>この記事では`"&lt;template>&lt;MyComponent />&lt;/template>"`のような文字列データを、Vueコンポーネントを正しく解釈した上で画面上に描画してSSRすることを目指します。

これを実現したい主要なモチベーションとしては、ブログ投稿......</div> <p data-v-8dc126aa><a href="https://qiita.com/d6ms/items/32ea0ac5f88f158d3e4d" data-v-8dc126aa>https://qiita.com/d6ms/items/32ea0ac5f88f158d3e4d</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt.jsでEthereumアプリ開発 - pluginでチェーンと接続する</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/aramsan" data-v-8dc126aa>aramsan</a></small></h4> <div data-v-8dc126aa># はじめに
この記事は、Nuxt.jsを使ってEtherumのブロックチェーン上で動くアプリを開発しようという人向けにはじめの一歩として書きました。EthereumはReactを使って実装する情報は多く存在するのですが、VueやNuxtでの情報はそれほど多く......</div> <p data-v-8dc126aa><a href="https://qiita.com/aramsan/items/93e35a27e6fb51a2f269" data-v-8dc126aa>https://qiita.com/aramsan/items/93e35a27e6fb51a2f269</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt.js + Heroku で環境変数が通らない時の確認事項</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/lord_sasapple" data-v-8dc126aa>lord_sasapple</a></small></h4> <div data-v-8dc126aa>heroku で環境変数がうまく通らなかったことがあったので自分用にメモ。
##1. nuxt.configに正しく env が設定されていますか？

```nuxt.config.js
  env: {
    API_KEY: process.env.AP......</div> <p data-v-8dc126aa><a href="https://qiita.com/lord_sasapple/items/6b48d95d7eb81f52909a" data-v-8dc126aa>https://qiita.com/lord_sasapple/items/6b48d95d7eb81f52909a</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>ホーム画面に追加したspaサイトで遷移すると上部にバーが出るのを消す</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/bellx2" data-v-8dc126aa>bellx2</a></small></h4> <div data-v-8dc126aa>iPadでspaで簡単なサイトを作って「ホームに画面に追加」をして疑似アプリケーション化して使っていたのですが、いつのまにか遷移すると「上部にバー」が出るようになってしまいました。「完了」を押すとバー自体は消えるのですが、せっかくの専用端末化が台無しです。とい......</div> <p data-v-8dc126aa><a href="https://qiita.com/bellx2/items/f20ce01d6aa9b1751b91" data-v-8dc126aa>https://qiita.com/bellx2/items/f20ce01d6aa9b1751b91</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt.jsに飛びつく前に~Nuxt.jsを習得するための前提技術と、その勉強方法の紹介~</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/newt0" data-v-8dc126aa>newt0</a></small></h4> <div data-v-8dc126aa>##概要
Nuxt.jsは今最も**イケてるゥ!最高にCoooooool**なWEB開発フレームワークです。巷でNuxt.jsについての記事も増えていますね。
しかし、ネット上のNuxt.jsの記事では、Nuxt.jsを始める上で前提となる前提知識の存在が省略......</div> <p data-v-8dc126aa><a href="https://qiita.com/newt0/items/763b0c228a8451c68865" data-v-8dc126aa>https://qiita.com/newt0/items/763b0c228a8451c68865</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>nuxtで作った静的ファイルをgolangのechoでホスティングする。</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/sugimotosyo" data-v-8dc126aa>sugimotosyo</a></small></h4> <div data-v-8dc126aa>
# 背景
機能の内容は言えませんが、外部ＡＰＩを利用した既存の機能の簡易版のツールを作りたい。そういった依頼が舞い込んできました。
すでにその機能は提供されていますが、画面仕様のもと多くの項目の入力が必要で、客先でさくっと処理させるには不向きでした。
そのた......</div> <p data-v-8dc126aa><a href="https://qiita.com/sugimotosyo/items/45c84f2529f721824df1" data-v-8dc126aa>https://qiita.com/sugimotosyo/items/45c84f2529f721824df1</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Vueで背景をページ毎に動的に変えたい</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/ddg171" data-v-8dc126aa>ddg171</a></small></h4> <div data-v-8dc126aa>#やる事
「画像を投稿して、投稿した画像にコメントを付けたい」
「コメントページは別ページ」
「別ページの背景を投稿画像にしたい。」
できるだけ頭を使わずにVue.js/Nuxt.jsでやっていきましょう。

#方法
##ページ内の要素をdivで包む

```......</div> <p data-v-8dc126aa><a href="https://qiita.com/ddg171/items/4343479479bef7b02719" data-v-8dc126aa>https://qiita.com/ddg171/items/4343479479bef7b02719</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>NuxtのCompositionAPIでdayjsをぶっこむ</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/flowphantom" data-v-8dc126aa>flowphantom</a></small></h4> <div data-v-8dc126aa># Composition APIはthisを潰す

1. dayjsインストール
2. pluginsにdayjsを追加
2. TypeScript用の設定
3. 使い方

## dayjsインストール

```$ yarn add dayjs```

##......</div> <p data-v-8dc126aa><a href="https://qiita.com/flowphantom/items/6d3ffa67c625b76d9f24" data-v-8dc126aa>https://qiita.com/flowphantom/items/6d3ffa67c625b76d9f24</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>SSRモードのNuxtでのFirebase認証</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/basho" data-v-8dc126aa>basho</a></small></h4> <div data-v-8dc126aa>davidroyerさんの[nuxt-ssr-firebase-auth.v2](https://github.com/davidroyer/nuxt-ssr-firebase-auth.v2)というリポジトリをベースに解説していきます。

# はじめに

こ......</div> <p data-v-8dc126aa><a href="https://qiita.com/basho/items/acd6a17bb6e2a2f7a932" data-v-8dc126aa>https://qiita.com/basho/items/acd6a17bb6e2a2f7a932</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt.jsでFirebaseUIを使ってログイン機能を作る</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/GIGU" data-v-8dc126aa>GIGU</a></small></h4> <div data-v-8dc126aa>Nuxt.jsでFirebaseUIを使ってログイン機能を作ってみました。
ソースコードはこちらにあります(https://github.com/mk422756/nuxt-firebaseui-sample) 
# FirebaseUIとは？
Firebas......</div> <p data-v-8dc126aa><a href="https://qiita.com/GIGU/items/ec171aff67bdf583cf46" data-v-8dc126aa>https://qiita.com/GIGU/items/ec171aff67bdf583cf46</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt.jsでメッセージの外出し＆国際化対応</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/sukezane" data-v-8dc126aa>sukezane</a></small></h4> <div data-v-8dc126aa># vue-i18nとnuxt-i18nがあるけど...
### &lt;font color="red">nuxt-i18n&lt;/font> を使用します
- nuxt-i18nの方が更新が活発なのでこちらを使っていこうという単純な理由です。
- もう1つ、[nux......</div> <p data-v-8dc126aa><a href="https://qiita.com/sukezane/items/4ab9f3ba19f9d0baed13" data-v-8dc126aa>https://qiita.com/sukezane/items/4ab9f3ba19f9d0baed13</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>【Nuxt.js】Dockerコンテナ上のサーバーにlocalhostでアクセスした時に出るERR_EMPTY_RESPONSEを解決する方法</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/arthur_foreign" data-v-8dc126aa>arthur_foreign</a></small></h4> <div data-v-8dc126aa>## Nuxt.jsで開発したアプリのImageからDockerコンテナを起動

前提として、`Nuxt.js`で開発したアプリのImage(`イメージ名：test`)をビルドしたこととします。

`Dockerfile`を作成して、Imageをビルドする方法......</div> <p data-v-8dc126aa><a href="https://qiita.com/arthur_foreign/items/bc87c9b66e7ea9710c6b" data-v-8dc126aa>https://qiita.com/arthur_foreign/items/bc87c9b66e7ea9710c6b</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>Nuxt TypeScript を docker-compose で構築する</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/Morero" data-v-8dc126aa>Morero</a></small></h4> <div data-v-8dc126aa># はじめに
[Nuxt TypeScript](https://typescript.nuxtjs.org/) でセットアップの手順は公式にて公開しているが、docker-composeを用いた構築の情報が少なかったので纏めてみた。

また、Ver.2.9以......</div> <p data-v-8dc126aa><a href="https://qiita.com/Morero/items/7a6abd4f9402aa345107" data-v-8dc126aa>https://qiita.com/Morero/items/7a6abd4f9402aa345107</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>【Nuxt.js】multi-stage buildが出来るDockerfileを作成してみた</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/arthur_foreign" data-v-8dc126aa>arthur_foreign</a></small></h4> <div data-v-8dc126aa>## Dockerfileのmulti-stage buildの概要

`Dockerfile`の`multi-stage build`は、「**1つのDockerfileでビルド用のImageと実行用のImageを分ける**」ということをやってくれます。

......</div> <p data-v-8dc126aa><a href="https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38" data-v-8dc126aa>https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>vue.js(Nuxt)で下にフリックして閉じられるモーダルコンポーネントを作ってみた</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/dsflon" data-v-8dc126aa>dsflon</a></small></h4> <div data-v-8dc126aa>下にフリックして閉じられるモーダルは、最近のアプリでは定番になりつつあるがwebではまだあまり見たことがなく、あったらいいのになぁ、と漠然と思ってた。
そんな折 「[【新版】UI GRAPHICS 成功事例と思想から学ぶ、これからのインターフェイスデザインとU......</div> <p data-v-8dc126aa><a href="https://qiita.com/dsflon/items/11a7cf780b3b42d10016" data-v-8dc126aa>https://qiita.com/dsflon/items/11a7cf780b3b42d10016</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>サブディレクトリ動かすNuxt.jsでもルートディレクトリの.envを読み込む</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/ProjectEuropa" data-v-8dc126aa>ProjectEuropa</a></small></h4> <div data-v-8dc126aa># 背景

Nuxt.jsをサブディレクトリで動かして、ルートディレクトリの`.env`を読もうとすると

```
WARN  No .env file found 
```

んなものないって警告でる。


## 対策

dotenvのpathを設定する。
......</div> <p data-v-8dc126aa><a href="https://qiita.com/ProjectEuropa/items/5cbb640bacaa5ff7e120" data-v-8dc126aa>https://qiita.com/ProjectEuropa/items/5cbb640bacaa5ff7e120</a></p></li><li data-v-8dc126aa><h4 data-v-8dc126aa><span data-v-8dc126aa>【Nuxt.js】Docker Imageを作成する時に出たエラーと解決方法まとめ</span> <small data-v-8dc126aa><span data-v-8dc126aa>by</span> <a href="/nuxt-circle-ci/users/arthur_foreign" data-v-8dc126aa>arthur_foreign</a></small></h4> <div data-v-8dc126aa>## Nuxt.jsでDocker Imageを作成時に出たエラーと解決方法をまとめた経緯と目的

`Nuxt.js`でアプリ開発してて、ローカルで`yarn dev`とかしたら普通にrunするのに、`docker build`でImageを作ろうとした時に、......</div> <p data-v-8dc126aa><a href="https://qiita.com/arthur_foreign/items/6a0227e6f53cc3104d74" data-v-8dc126aa>https://qiita.com/arthur_foreign/items/6a0227e6f53cc3104d74</a></p></li></ul> <hr data-v-8dc126aa> <div class="footer" data-v-8dc126aa><small data-v-8dc126aa><a href="https://github.com/gladsy/nuxt-circle-ci" target="_blank" data-v-8dc126aa>GitHub</a></small></div></div></section></div></div></div><script>window.__NUXT__=function(s,n,a,p,e,l,c,t,o,i,r,d,m,u,g,h,f,x,b,E,k,v,A,y,w,j,_,B,F,D,C,S,I,N,P,R,T,M,q,O,U,V,$,L,z,G,W,J,K,H){return{layout:"default",data:[{}],error:s,state:{items:[{rendered_body:'<p>最近ContentfulとNetlify、Nuxt.jsを利用してブログを立ち上げました。</p>\n\n<p>ヘッドレスCMSとNuxt generateで静的なサイトを！と思ったのですが、実際にはクライアントからのアクセスのたびにContentfulへの通信が発生していました。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F89564%2F115eb022-29ed-d0ec-f192-3e619169d666.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=fb48ec81cc41b4333c66fcfbe2953162" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F89564%2F115eb022-29ed-d0ec-f192-3e619169d666.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=fb48ec81cc41b4333c66fcfbe2953162" alt="Screenshot from.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89564/115eb022-29ed-d0ec-f192-3e619169d666.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F89564%2F115eb022-29ed-d0ec-f192-3e619169d666.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=1da7df309a64ea444e4b64e7374c8d02 1x" loading="lazy"></a></p>\n\n<p>理由は明らかです。<br>\nasyncDataでContentfulからのデータ取得処理を行っているからです。サーバー側だけでなく、クライアント側でも再度取得処理が実行されてしまっているのですね...。</p>\n\n<p>Contentfulの記事更新時にNetlify上で generate⇒デプロイ まで自動で行うように設定しているので、記事は常に最新です。クライアントが新着問い合わせを行う必要はありません。「不要なアクセスがあるのは気持ち悪いな〜」と思って調べてみました。</p>\n\n<h1>\n<span id="この記事のまとめ" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>この記事のまとめ</h1>\n\n<p>はじめに結論をまとめておきます。</p>\n\n<h2>\n<span id="通信を減らす無くす手法は大きく4つに分けられます" class="fragment"></span><a href="#%E9%80%9A%E4%BF%A1%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99%E7%84%A1%E3%81%8F%E3%81%99%E6%89%8B%E6%B3%95%E3%81%AF%E5%A4%A7%E3%81%8D%E3%81%8F4%E3%81%A4%E3%81%AB%E5%88%86%E3%81%91%E3%82%89%E3%82%8C%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>通信を減らす・無くす手法は大きく4つに分けられます</h2>\n\n<h3>\n<span id="anuxtserverinitで全データ取得jsonに保存" class="fragment"></span><a href="#anuxtserverinit%E3%81%A7%E5%85%A8%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97json%E3%81%AB%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>A.nuxtServerInitで全データ取得＆JSONに保存。</h3>\n\n<p>非常に直感的な手法です。完全に0にはできませんが、そこそこ減らせるはずです。個人ブログなどの場合はこれでも良いかもしれません。tagやキーワード検索などの機能が豊富なCMSも多いのですが、vueのfilterなどでリアルタイム検索すれば十分そうです。ただし、不要な通信は依然として残ります。</p>\n\n<h3>\n<span id="bwindow__nuxt__からjsonに保存" class="fragment"></span><a href="#bwindow__nuxt__%E3%81%8B%E3%82%89json%E3%81%AB%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>B.window.__NUXT__からJSONに保存。</h3>\n\n<p>nuxt generateで吐き出されたhtmlには window.__NUXT__ からはじまる箇所にJavaScriptが記載されています。また、サーバーサイドで取得したデータも含まれています。そのデータをJSONにキャッシュして利用しようという考え方です。<br>\nこちらのアプローチを取っているのは<a href="https://github.com/DreaMinder/nuxt-payload-extractor" rel="nofollow noopener" target="_blank">nuxt-payload-extractor</a>です。下記で軽く触れますが、詳しくは実装を参考ください。</p>\n\n<p>asyncDataで取得している場合はシンプルに導入できます。ただし、fetchやstore（ひとまとめにvuex）では不具合が起こる可能性があるとreadmeに記載されています。実は、full staticなgenerateはネイティブでの実装も検討されています。その1つの方策としても魅力的なようですが、課題もあるようです。</p>\n\n<h3>\n<span id="capiリクエスト時にjsonに保存" class="fragment"></span><a href="#capi%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E6%99%82%E3%81%ABjson%E3%81%AB%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>C.APIリクエスト時にJSONに保存。</h3>\n\n<p>こちらも直感的ですね。個人でのアプローチ例も多い手法です。<br>\n<a href="https://github.com/stursby/nuxt-static" rel="nofollow noopener" target="_blank">nuxt-static</a>ではプラグインとしてaxiosリクエスト時にキャッシュしています。<br>\nまた、下記で触れますがQiitaでも2例紹介されています。<br>\nトラブル時にも原因を突き止めやすそうで安心です<img alt=":smiley:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f603.png" title=":smiley:" width="20" loading="lazy"></p>\n\n<h3>\n<span id="dhtmlからjavascriptを削除" class="fragment"></span><a href="#dhtml%E3%81%8B%E3%82%89javascript%E3%82%92%E5%89%8A%E9%99%A4"><i class="fa fa-link"></i></a>D.htmlからJavaScriptを削除。</h3>\n\n<p>正反対かつド直球なアプローチ。htmlからscriptを削除してしまいます。セキュリティの観点からがきっかけですが、以下のブログ記事でcheerioを使用した方法が紹介されています。<br>\n<a href="https://ondwn.com/blog-20190718/" rel="nofollow noopener" target="_blank">Nuxt.js Generate後の＜script＞window.__NUXT__=を消したい</a></p>\n\n<h2>\n<span id="さらにパフォーマンスを求めるなら" class="fragment"></span><a href="#%E3%81%95%E3%82%89%E3%81%AB%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B%E3%81%AA%E3%82%89"><i class="fa fa-link"></i></a>さらにパフォーマンスを求めるなら</h2>\n\n<h3>\n<span id="jsonデータをキャッシュする場合abc" class="fragment"></span><a href="#json%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88abc"><i class="fa fa-link"></i></a>JSONデータをキャッシュする場合(A,B,C)</h3>\n\n<p>⇒下記Qiita記事で紹介されているように、webworkerでクライアント側にもキャッシュさせる。<br>\n<a href="https://qiita.com/miyaoka/items/9774f0250953da419a58#api%E3%82%92%E9%9D%99%E7%9A%84%E5%8C%96%E3%81%99%E3%82%8B" id="reference-83c34723125c9b1d16be">Firebase、Flamelink、Nuxt、Netlify、PWAを使ってJAMstackなブログを作る</a></p>\n\n<h3>\n<span id="htmlからjavascriptを削除する場合" class="fragment"></span><a href="#html%E3%81%8B%E3%82%89javascript%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>htmlからJavaScriptを削除する場合</h3>\n\n<p>⇒AMPの導入。</p>\n\n<p>以降ではGithub Issue、Qiita、ブログ記事の3つのソースから上記の4つの方法をもう少し詳細に紹介します。</p>\n\n<h1>\n<span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次</h1>\n\n<ul>\n<li>1.Github Issueから(generate時にJSONに保存)</li>\n<li>2.Qiitaから(generate時にJSONに保存)</li>\n<li>3.ブログ記事から(htmlからJavaScriptを削除)</li>\n</ul>\n\n<h2>\n<span id="1jsonに保存github-issueから" class="fragment"></span><a href="#1json%E3%81%AB%E4%BF%9D%E5%AD%98github-issue%E3%81%8B%E3%82%89"><i class="fa fa-link"></i></a>1.JSONに保存（Github Issueから）</h2>\n\n<p><a href="https://github.com/nuxt/rfcs/issues/22" rel="nofollow noopener" target="_blank">Full static generated mode #22</a>で静的なgenerateについて議論されています。</p>\n\n<p>別の形で解決しましたが、以前にもnuxt generateには不要なJavaScriptがあるというIssueは上がっていました。現在は上記のIssueが中心のようです。（以前のIssue:<a href="https://github.com/nuxt/nuxt.js/issues/5260" rel="nofollow noopener" target="_blank">Lots of unnecessary JavaScript in generated Nuxt static build</a>）</p>\n\n<p>Full static generated mode #22では</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>nuxt generate --full-static\n</pre></div></div>\n\n<p>という新しいオプションも提案されています。<br>\nただし、queryの処理など課題も多いようです。</p>\n\n<h3>\n<span id="issueでは個人での対処例が2つ紹介されています" class="fragment"></span><a href="#issue%E3%81%A7%E3%81%AF%E5%80%8B%E4%BA%BA%E3%81%A7%E3%81%AE%E5%AF%BE%E5%87%A6%E4%BE%8B%E3%81%8C2%E3%81%A4%E7%B4%B9%E4%BB%8B%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>Issueでは個人での対処例が2つ紹介されています。</h3>\n\n<ul>\n<li><a href="https://github.com/stursby/nuxt-static/" rel="nofollow noopener" target="_blank">stursby/nuxt-static</a></li>\n<li><a href="https://github.com/DreaMinder/nuxt-payload-extractor" rel="nofollow noopener" target="_blank">nuxt-payload-extractor</a></li>\n</ul>\n\n<p>どちらもJSONファイルにデータを保存し、</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>if(process.static &amp;&amp; process.client)\n</pre></div></div>\n\n<p>で条件分岐し、クライアントサイドでの通信であれば、JSONファイルからのフェッチに変更しています。</p>\n\n<p>仕組みは非常にシンプルなので、それぞれ簡単に紹介します。</p>\n\n<h4>\n<span id="stursbynuxt-static" class="fragment"></span><a href="#stursbynuxt-static"><i class="fa fa-link"></i></a><a href="https://github.com/stursby/nuxt-static/" rel="nofollow noopener" target="_blank">stursby/nuxt-static</a>\n</h4>\n\n<p>axiosでの通信時に条件分岐。JSONとして保存しておき、ベースURLを変更。<br>\n<a href="https://github.com/stursby/nuxt-static/blob/master/src/plugins/axios.js" rel="nofollow noopener" target="_blank">src/plugins/axios.js</a>のファイルがメインの処理部分です。以下Githubからの引用にコメントを追記したものです。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">src/plugins/axios.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n\n<span class="kd">let</span> <span class="nx">baseURL</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">https://jsonplaceholder.typicode.com</span><span class="dl">\'</span>\n\n<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">browser</span> <span class="o">&amp;&amp;</span> <span class="nx">process</span><span class="p">.</span><span class="kd">static</span><span class="p">)</span> <span class="p">{</span>\n  <span class="nx">baseURL</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">/data</span><span class="dl">\'</span>  <span class="c1">//クライアントサイドではaxiosのbaseurlを変更していますね！</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="nx">baseURL</span> <span class="p">})</span>\n\n<span class="c1">//クライアントでの実行時</span>\n<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">browser</span> <span class="o">&amp;&amp;</span> <span class="nx">process</span><span class="p">.</span><span class="kd">static</span><span class="p">)</span> <span class="p">{</span>\n  <span class="c1">//interceptorsでリクエスト前にリクエスト先のurlを書き換えています</span>\n  <span class="nx">api</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">config</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">config</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="dl">\'</span><span class="s1">.json</span><span class="dl">\'</span>\n    <span class="k">return</span> <span class="nx">config</span>\n  <span class="p">})</span>\n<span class="p">}</span>\n\n<span class="c1">//サーバーサイドでの実行時</span>\n<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">server</span> <span class="o">&amp;&amp;</span> <span class="nx">process</span><span class="p">.</span><span class="kd">static</span><span class="p">)</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">mkdirp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">mkdirp-promise</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">join</span><span class="p">,</span> <span class="nx">dirname</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">path</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">writeFileSync</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">fs</span><span class="dl">\'</span><span class="p">)</span>\n\n  <span class="nx">api</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>\n    <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>\n      <span class="c1">// Do something with response data</span>\n      <span class="c1">//envファイルで予め格納先を指定しておいて、リクエストのパス名で取得データを保存</span>\n      <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">join</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">dataDir</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="dl">\'</span><span class="s1">.json</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Save</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span>\n      <span class="k">await</span> <span class="nx">mkdirp</span><span class="p">(</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span>\n      <span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>\n      <span class="k">return</span> <span class="nx">response</span>\n    <span class="p">},</span>\n    <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>\n      <span class="c1">// Do something with response error</span>\n      <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">)</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="p">{</span> <span class="nx">api</span> <span class="p">}</span>\n</pre></div>\n</div>\n\n<h4>\n<span id="nuxt-payload-extractor" class="fragment"></span><a href="#nuxt-payload-extractor"><i class="fa fa-link"></i></a><a href="https://github.com/DreaMinder/nuxt-payload-extractor" rel="nofollow noopener" target="_blank">nuxt-payload-extractor</a>\n</h4>\n\n<p>こちらはgenerate時にデータをタイムスタンプ付きでJSONファイルに保存しています。<br>\n以下moduleから抜粋</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt-payload-extractor/lib/module.js</span></div>\n<div class="highlight"><pre><span class="c1">//略</span>\n<span class="c1">//生成されたhtmlから取得したデータが格納されている箇所を抜き出して保存</span>\n<span class="kd">let</span> <span class="nx">extractPayload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">){</span>\n  <span class="kd">let</span> <span class="nx">chunks</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">\'</span><span class="s1">&lt;script&gt;window.__NUXT__=</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="kd">let</span> <span class="nx">pre</span> <span class="o">=</span> <span class="nx">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>\n  <span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="dl">\'</span><span class="s1">&lt;/script&gt;</span><span class="dl">\'</span><span class="p">).</span><span class="nx">shift</span><span class="p">()</span>\n  <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="dl">\'</span><span class="s1">&lt;/script&gt;</span><span class="dl">\'</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">\'</span><span class="s1">&lt;/script&gt;</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="kd">let</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">route</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span> <span class="p">?</span> <span class="dl">\'\'</span> <span class="p">:</span> <span class="nx">route</span>\n\n  <span class="k">return</span> <span class="p">{</span>\n    <span class="na">html</span><span class="p">:</span> <span class="nx">pre</span> <span class="o">+</span> <span class="dl">\'</span><span class="s1">&lt;script defer src="</span><span class="dl">\'</span> <span class="o">+</span> <span class="nx">base</span> <span class="o">+</span> <span class="nx">path</span> <span class="o">+</span> <span class="dl">\'</span><span class="s1">/payload</span><span class="dl">\'</span> <span class="o">+</span> <span class="nx">timestamp</span> <span class="o">+</span> <span class="dl">\'</span><span class="s1">.js"&gt;&lt;/script&gt;</span><span class="dl">\'</span> <span class="o">+</span> <span class="nx">post</span><span class="p">,</span>\n    <span class="nx">payload</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="c1">//略</span>\n<span class="c1">//nuxt.hook</span>\n<span class="k">this</span><span class="p">.</span><span class="nx">nuxt</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="dl">\'</span><span class="s1">generate:page</span><span class="dl">\'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">page</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nuxt</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">generate</span><span class="p">.</span><span class="nx">subFolders</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">\'</span><span class="s1">generate.subFolders should be true for nuxt-payload-extractor</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="k">if</span><span class="p">(</span><span class="nx">blacklist</span> <span class="o">&amp;&amp;</span> <span class="nx">blacklist</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">route</span><span class="p">))</span> <span class="k">return</span> <span class="nx">page</span>\n    <span class="c1">//上記処理extractPayloadをgenerate時に呼び出しています</span>\n    <span class="kd">let</span> <span class="p">{</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">extractPayload</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">html</span><span class="p">,</span> <span class="nx">page</span><span class="p">.</span><span class="nx">route</span><span class="p">,</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">)</span>\n    <span class="nx">writePayload</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">page</span><span class="p">.</span><span class="nx">route</span><span class="p">,</span> <span class="nx">distDir</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">)</span>\n\n    <span class="nx">page</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span>\n\n    <span class="k">return</span> <span class="nx">page</span>\n  <span class="p">})</span>\n<span class="c1">//略</span>\n</pre></div>\n</div>\n\n<p>その後、asyncData内で処理を分岐しています。(※$payloadURLはmodule読み込み時に指定するblacklistです)</p>\n\n<p>以下nuxt-payload-extractorの<a href="https://github.com/DreaMinder/nuxt-payload-extractor/blob/master/example/pages/extracted.vue" rel="nofollow noopener" target="_blank">サンプル</a>からです。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">nuxt-payload-extractor/example/pages/extracted.vue</span></div>\n<div class="highlight"><pre>//略\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">({</span> <span class="nx">$axios</span><span class="p">,</span> <span class="nx">$payloadURL</span><span class="p">,</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}){</span>\n    <span class="k">try</span> <span class="p">{</span>\n      <span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="kd">static</span> <span class="o">&amp;&amp;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">client</span> <span class="o">&amp;&amp;</span> <span class="nx">route</span><span class="p">.</span><span class="nx">path</span> <span class="o">!==</span> <span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">){</span>\n        <span class="c1">//route.path !== \'/\' - because this route is blacklisted for nuxt-payload-extractor</span>\n        <span class="kd">let</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">$axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">$payloadURL</span><span class="p">(</span><span class="nx">route</span><span class="p">))</span>\n        <span class="k">return</span> <span class="nx">data</span>\n      <span class="p">}</span>\n      <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">$axios</span><span class="p">.</span><span class="nx">$get</span><span class="p">(</span><span class="s2">`/post.json`</span><span class="p">)</span>\n      <span class="k">return</span> <span class="p">{</span>\n        <span class="nx">post</span>\n      <span class="p">}</span>\n      <span class="c1">//Or alternative way</span>\n      <span class="c1">// let payload = {};</span>\n      <span class="c1">// if(process.static &amp;&amp; process.client &amp;&amp; route.path !== \'/\')</span>\n      <span class="c1">//   payload = await app.$axios.$get(document.location.origin + route.path + \'/payload.json\')</span>\n      <span class="c1">// else</span>\n      <span class="c1">//   payload.post = await app.$axios.$get(`/post.json`)</span>\n      <span class="c1">//</span>\n      <span class="c1">// return payload</span>\n    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n<span class="c1">//略</span>\n</pre></div>\n</div>\n\n<p>どちらも導入も簡単ですが、nuxt-payload-extractorを利用される際はreadmeの以下の注意点もご確認ください。</p>\n\n<blockquote>\n<p>Caveats<br>\nThere may be issues with vuex data requests and nested routes. Keep in mind that payload.json has not hash in its name, so it shouldn\'t be cached in browser.</p>\n</blockquote>\n\n<p>翻訳</p>\n\n<blockquote>\n<p>注意事項<br>\nvuexデータリクエストとネストされたルートに問題がある可能性があります。 payload.jsonの名前にはハッシュがないため、ブラウザーにキャッシュしないでください。</p>\n</blockquote>\n\n<p>workerでブラウザキャッシュしたい場合は次項のQiitaが参考になるかと思います。</p>\n\n<h2>\n<span id="2jsonに保存qiitaから" class="fragment"></span><a href="#2json%E3%81%AB%E4%BF%9D%E5%AD%98qiita%E3%81%8B%E3%82%89"><i class="fa fa-link"></i></a>2.JSONに保存（Qiitaから）</h2>\n\n<p>上記2つの例と同様、JSONファイルへの保存というアプローチを紹介しているQiita記事があります。</p>\n\n<ul>\n<li><a href="https://qiita.com/miyaoka/items/9774f0250953da419a58#api%E3%82%92%E9%9D%99%E7%9A%84%E5%8C%96%E3%81%99%E3%82%8B">Firebase、Flamelink、Nuxt、Netlify、PWAを使ってJAMstackなブログを作る</a></li>\n<li><a href="https://qiita.com/soichiro_nitta/items/7ca238d76072eba2ed97" id="reference-2736f80c620622d6a940">Nuxtでビルド時にAPIを静的化して、完全にサーバーへのリクエストをなくすト</a></li>\n</ul>\n\n<p>1つめの記事はFirebase向けのCMS Flamelinkの紹介のほか、JAMstackの説明なども丁寧に解説されています。素敵な記事ですね。その一環でJSONファイルへの保存も紹介しつつ、また、webworkerでキャッシュすることによって更にパフォーマンスを上げていることが紹介されています。先述したnuxt-payload-extractorはブラウザにキャッシュできませんでしたが、パフォーマンスを求めるならこちらを参考にしたほうが良さそうですね。</p>\n\n<p>2つめの記事は1つめの記事が参照されています。JSONへの保存・読み込み処理部分だけの記事なので参考にしやすいと思います。(なくすト.js<img alt=":thumbsup:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png" title=":thumbsup:" width="20" loading="lazy">)</p>\n\n<h2>\n<span id="3直接htmlから削除するブログ記事から" class="fragment"></span><a href="#3%E7%9B%B4%E6%8E%A5html%E3%81%8B%E3%82%89%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B%E3%83%96%E3%83%AD%E3%82%B0%E8%A8%98%E4%BA%8B%E3%81%8B%E3%82%89"><i class="fa fa-link"></i></a>3.直接htmlから削除する（ブログ記事から）</h2>\n\n<p>nuxt generateで生成されたhtmlには</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>＜script＞window.__NUXT__=\n</pre></div></div>\n\n<p>からはじまる箇所にJavaScriptの処理が記載されています。先述した、nuxt-payload-extractorはこの記載箇所からデータを取得しているので、そちらのソースも参照するとわかりやすいかもしれません。（そのほかの例はaxiosから直接データを取得しています）</p>\n\n<p>単純ですが、htmlからこの記載を削除してしまえば通信も発生しません。<br>\nサクッと導入するには以下の記事で紹介されているcheerioを利用した方法が手軽かと思います。</p>\n\n<p><a href="https://ondwn.com/blog-20190718/" rel="nofollow noopener" target="_blank">Nuxt.js Generate後の＜script＞window.__NUXT__=を消したい</a></p>\n\n<p>以下上記ブログ記事からの引用です。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>    <span class="kd">const</span> <span class="nx">cheerio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">cheerio</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n      <span class="c1">// 省略</span>\n      <span class="na">hooks</span><span class="p">:</span> <span class="p">{</span>\n        <span class="dl">\'</span><span class="s1">generate:page</span><span class="dl">\'</span><span class="p">:</span> <span class="nx">page</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">cheerio</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">html</span><span class="p">);</span>\n          <span class="nx">doc</span><span class="p">(</span><span class="s2">`body script`</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>\n          <span class="nx">page</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">html</span><span class="p">();</span>\n        <span class="p">},</span>\n      <span class="p">},</span>\n      <span class="c1">// 省略</span>\n    <span class="p">}</span>\n</pre></div>\n</div>\n\n<p>行っているのはnuxt.config.jsにcheerioで直接該当箇所を削除する処理を書くことだけです。アニメーションなどのために、クライアントサイドでJavaScriptを使う場合はscript全部ではなく、payload部分のみを削除すれば良さそうですね。（テストなどはしていません）</p>\n\n<h1>\n<span id="ケースごとのまとめ" class="fragment"></span><a href="#%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%94%E3%81%A8%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>ケースごとのまとめ</h1>\n\n<p>リンクも再掲します。</p>\n\n<h2>\n<span id="case1サクッと手軽になくしたい" class="fragment"></span><a href="#case1%E3%82%B5%E3%82%AF%E3%83%83%E3%81%A8%E6%89%8B%E8%BB%BD%E3%81%AB%E3%81%AA%E3%81%8F%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>case1　サクッと手軽になくしたい</h2>\n\n<p>htmlを軽くしたい。クライアントサイドのJavaScriptはいらない。既存のプロジェクトから不要なリクエストをとにかくサクッとなくしたい。セキュリティも気になる。<br>\n⇒D.直接htmlから削除する　が手軽です。<br>\n<a href="https://ondwn.com/blog-20190718/" rel="nofollow noopener" target="_blank">Nuxt.js Generate後の＜script＞window.__NUXT__=を消したい</a></p>\n\n<h2>\n<span id="case2webworkerやpwaは使わない" class="fragment"></span><a href="#case2webworker%E3%82%84pwa%E3%81%AF%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>case2　webworkerやPWAは使わない</h2>\n\n<p>サクッと手軽になくしたい。webworkerやPWAは使わない。一番多そうなケースです。<br>\n⇒A.nuxtServerInitで全データ取得＆JSONに保存。<br>\n⇒B.window.__NUXT__からJSONに保存。<br>\n⇒C.APIリクエスト時にJSONに保存。</p>\n\n<p>中でもB.<a href="https://github.com/DreaMinder/nuxt-payload-extractor" rel="nofollow noopener" target="_blank">nuxt-payload-extractor</a>か、C.「<a href="https://qiita.com/soichiro_nitta/items/7ca238d76072eba2ed97">Nuxtでビルド時にAPIを静的化して、完全にサーバーへのリクエストをなくすト</a>」が導入しやすそうだなと思います。</p>\n\n<h2>\n<span id="case3パフォーマンスを向上させたい" class="fragment"></span><a href="#case3%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%82%92%E5%90%91%E4%B8%8A%E3%81%95%E3%81%9B%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>case3　パフォーマンスを向上させたい</h2>\n\n<p>サイトのパフォーマンスを向上させたい。<br>\n⇒A.nuxtServerInitで全データ取得＆JSONに保存。<br>\n⇒C.APIリクエスト時にJSONに保存。</p>\n\n<p>加えてwebworkerでキャッシュ。更にhtmlから不要な処理は削除しても良いかもしれません。<br>\n<a href="https://qiita.com/miyaoka/items/9774f0250953da419a58#api%E3%82%92%E9%9D%99%E7%9A%84%E5%8C%96%E3%81%99%E3%82%8B">Firebase、Flamelink、Nuxt、Netlify、PWAを使ってJAMstackなブログを作る</a></p>\n\n<p>⇒更に更に、軽さを追求する場合は、AMPの導入を検討してみても良いかもしれません。<br>\nNuxtは公式でAMPのサンプルもあげられています。<a href="https://github.com/nuxt/nuxt.js/tree/dev/examples/with-amp" rel="nofollow noopener" target="_blank">nuxt.js/examples/with-amp/</a></p>\n\n<p>以上です。<br>\n至らない点あるかもしれません。不備などありましたら、ご指摘いただけるとありがたいです。</p>\n',body:"最近ContentfulとNetlify、Nuxt.jsを利用してブログを立ち上げました。\n\nヘッドレスCMSとNuxt generateで静的なサイトを！と思ったのですが、実際にはクライアントからのアクセスのたびにContentfulへの通信が発生していました。\n![Screenshot from.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89564/115eb022-29ed-d0ec-f192-3e619169d666.png)\n\n理由は明らかです。\nasyncDataでContentfulからのデータ取得処理を行っているからです。サーバー側だけでなく、クライアント側でも再度取得処理が実行されてしまっているのですね...。\n\nContentfulの記事更新時にNetlify上で generate⇒デプロイ まで自動で行うように設定しているので、記事は常に最新です。クライアントが新着問い合わせを行う必要はありません。「不要なアクセスがあるのは気持ち悪いな〜」と思って調べてみました。\n\n# この記事のまとめ\nはじめに結論をまとめておきます。\n## 通信を減らす・無くす手法は大きく4つに分けられます\n### A.nuxtServerInitで全データ取得＆JSONに保存。\n非常に直感的な手法です。完全に0にはできませんが、そこそこ減らせるはずです。個人ブログなどの場合はこれでも良いかもしれません。tagやキーワード検索などの機能が豊富なCMSも多いのですが、vueのfilterなどでリアルタイム検索すれば十分そうです。ただし、不要な通信は依然として残ります。\n\n### B.window.\\_\\_NUXT__からJSONに保存。\nnuxt generateで吐き出されたhtmlには window.\\_\\_NUXT__ からはじまる箇所にJavaScriptが記載されています。また、サーバーサイドで取得したデータも含まれています。そのデータをJSONにキャッシュして利用しようという考え方です。\nこちらのアプローチを取っているのは[nuxt-payload-extractor](https://github.com/DreaMinder/nuxt-payload-extractor)です。下記で軽く触れますが、詳しくは実装を参考ください。\n\nasyncDataで取得している場合はシンプルに導入できます。ただし、fetchやstore（ひとまとめにvuex）では不具合が起こる可能性があるとreadmeに記載されています。実は、full staticなgenerateはネイティブでの実装も検討されています。その1つの方策としても魅力的なようですが、課題もあるようです。\n\n### C.APIリクエスト時にJSONに保存。\nこちらも直感的ですね。個人でのアプローチ例も多い手法です。\n[nuxt-static](https://github.com/stursby/nuxt-static)ではプラグインとしてaxiosリクエスト時にキャッシュしています。\nまた、下記で触れますがQiitaでも2例紹介されています。\nトラブル時にも原因を突き止めやすそうで安心です:smiley:\n\n### D.htmlからJavaScriptを削除。\n正反対かつド直球なアプローチ。htmlからscriptを削除してしまいます。セキュリティの観点からがきっかけですが、以下のブログ記事でcheerioを使用した方法が紹介されています。\n[Nuxt.js Generate後の＜script＞window.\\_\\_NUXT__=を消したい](https://ondwn.com/blog-20190718/)\n\n\n## さらにパフォーマンスを求めるなら\n### JSONデータをキャッシュする場合(A,B,C)\n⇒下記Qiita記事で紹介されているように、webworkerでクライアント側にもキャッシュさせる。\n[Firebase、Flamelink、Nuxt、Netlify、PWAを使ってJAMstackなブログを作る](https://qiita.com/miyaoka/items/9774f0250953da419a58#api%E3%82%92%E9%9D%99%E7%9A%84%E5%8C%96%E3%81%99%E3%82%8B)\n\n### htmlからJavaScriptを削除する場合\n⇒AMPの導入。\n\n以降ではGithub Issue、Qiita、ブログ記事の3つのソースから上記の4つの方法をもう少し詳細に紹介します。\n\n# 目次\n\n- 1.Github Issueから(generate時にJSONに保存)\n- 2.Qiitaから(generate時にJSONに保存)\n- 3.ブログ記事から(htmlからJavaScriptを削除)\n\n## 1.JSONに保存（Github Issueから）\n[Full static generated mode #22](https://github.com/nuxt/rfcs/issues/22)で静的なgenerateについて議論されています。\n\n別の形で解決しましたが、以前にもnuxt generateには不要なJavaScriptがあるというIssueは上がっていました。現在は上記のIssueが中心のようです。（以前のIssue:[Lots of unnecessary JavaScript in generated Nuxt static build](https://github.com/nuxt/nuxt.js/issues/5260)）\n\nFull static generated mode #22では\n\n```\nnuxt generate --full-static\n```\nという新しいオプションも提案されています。\nただし、queryの処理など課題も多いようです。\n\n### Issueでは個人での対処例が2つ紹介されています。\n\n- [stursby/nuxt-static](https://github.com/stursby/nuxt-static/)\n- [nuxt-payload-extractor](https://github.com/DreaMinder/nuxt-payload-extractor)\n\nどちらもJSONファイルにデータを保存し、\n\n```\nif(process.static && process.client)\n```\nで条件分岐し、クライアントサイドでの通信であれば、JSONファイルからのフェッチに変更しています。\n\n仕組みは非常にシンプルなので、それぞれ簡単に紹介します。\n#### [stursby/nuxt-static](https://github.com/stursby/nuxt-static/)\naxiosでの通信時に条件分岐。JSONとして保存しておき、ベースURLを変更。\n[src/plugins/axios.js](https://github.com/stursby/nuxt-static/blob/master/src/plugins/axios.js)のファイルがメインの処理部分です。以下Githubからの引用にコメントを追記したものです。\n\n```javascript:src/plugins/axios.js\nimport axios from 'axios'\n\nlet baseURL = 'https://jsonplaceholder.typicode.com'\n\nif (process.browser && process.static) {\n  baseURL = '/data'  //クライアントサイドではaxiosのbaseurlを変更していますね！\n}\n\nconst api = axios.create({ baseURL })\n\n//クライアントでの実行時\nif (process.browser && process.static) {\n  //interceptorsでリクエスト前にリクエスト先のurlを書き換えています\n  api.interceptors.request.use(config => {\n    config.url = config.url + '.json'\n    return config\n  })\n}\n\n//サーバーサイドでの実行時\nif (process.server && process.static) {\n  const mkdirp = require('mkdirp-promise')\n  const { join, dirname } = require('path')\n  const { writeFileSync } = require('fs')\n\n  api.interceptors.response.use(\n    async function(response) {\n      // Do something with response data\n      //envファイルで予め格納先を指定しておいて、リクエストのパス名で取得データを保存\n      const path = join(process.env.dataDir, response.request.path + '.json')\n      console.log('Save', path)\n      await mkdirp(dirname(path))\n      writeFileSync(path, JSON.stringify(response.data))\n      return response\n    },\n    function(error) {\n      // Do something with response error\n      return Promise.reject(error)\n    }\n  )\n}\n\nexport { api }\n```\n\n\n#### [nuxt-payload-extractor](https://github.com/DreaMinder/nuxt-payload-extractor)\nこちらはgenerate時にデータをタイムスタンプ付きでJSONファイルに保存しています。\n以下moduleから抜粋\n\n```nuxt-payload-extractor/lib/module.js \n//略\n//生成されたhtmlから取得したデータが格納されている箇所を抜き出して保存\nlet extractPayload = function(html, route, base, timestamp){\n  let chunks = html.split('<script>window.__NUXT__=')\n  let pre = chunks[0]\n  let payload = chunks[1].split('<\/script>').shift()\n  let post = chunks[1].split('<\/script>').slice(1).join('<\/script>')\n  let path = route === '/' ? '' : route\n\n  return {\n    html: pre + '<script defer src=\"' + base + path + '/payload' + timestamp + '.js\"><\/script>' + post,\n    payload\n  }\n}\n//略\n//nuxt.hook\nthis.nuxt.hook('generate:page', async page => {\n    if(!this.nuxt.options.generate.subFolders) throw new Error('generate.subFolders should be true for nuxt-payload-extractor')\n    if(blacklist && blacklist.includes(page.route)) return page\n    //上記処理extractPayloadをgenerate時に呼び出しています\n    let { html, payload } = extractPayload(page.html, page.route, base, timestamp)\n    writePayload(payload, page.route, distDir, timestamp)\n\n    page.html = html\n\n    return page\n  })\n//略\n```\n\nその後、asyncData内で処理を分岐しています。(※$payloadURLはmodule読み込み時に指定するblacklistです)\n\n以下nuxt-payload-extractorの[サンプル](https://github.com/DreaMinder/nuxt-payload-extractor/blob/master/example/pages/extracted.vue)からです。\n\n```nuxt-payload-extractor/example/pages/extracted.vue\n//略\n<script>\nexport default {\n  async asyncData({ $axios, $payloadURL, route, error }){\n    try {\n      if(process.static && process.client && route.path !== '/'){\n        //route.path !== '/' - because this route is blacklisted for nuxt-payload-extractor\n        let {data} = await $axios.get($payloadURL(route))\n        return data\n      }\n      let post = await $axios.$get(`/post.json`)\n      return {\n        post\n      }\n      //Or alternative way\n      // let payload = {};\n      // if(process.static && process.client && route.path !== '/')\n      //   payload = await app.$axios.$get(document.location.origin + route.path + '/payload.json')\n      // else\n      //   payload.post = await app.$axios.$get(`/post.json`)\n      //\n      // return payload\n    } catch (e) {\n//略\n```\n\nどちらも導入も簡単ですが、nuxt-payload-extractorを利用される際はreadmeの以下の注意点もご確認ください。\n\n> Caveats\n> There may be issues with vuex data requests and nested routes. Keep in mind that payload.json has not hash in its name, so it shouldn't be cached in browser.\n\n翻訳\n> 注意事項\n> vuexデータリクエストとネストされたルートに問題がある可能性があります。 payload.jsonの名前にはハッシュがないため、ブラウザーにキャッシュしないでください。\n\nworkerでブラウザキャッシュしたい場合は次項のQiitaが参考になるかと思います。\n\n## 2.JSONに保存（Qiitaから）\n上記2つの例と同様、JSONファイルへの保存というアプローチを紹介しているQiita記事があります。\n\n- [Firebase、Flamelink、Nuxt、Netlify、PWAを使ってJAMstackなブログを作る](https://qiita.com/miyaoka/items/9774f0250953da419a58#api%E3%82%92%E9%9D%99%E7%9A%84%E5%8C%96%E3%81%99%E3%82%8B)\n- [Nuxtでビルド時にAPIを静的化して、完全にサーバーへのリクエストをなくすト](https://qiita.com/soichiro_nitta/items/7ca238d76072eba2ed97)\n\n1つめの記事はFirebase向けのCMS Flamelinkの紹介のほか、JAMstackの説明なども丁寧に解説されています。素敵な記事ですね。その一環でJSONファイルへの保存も紹介しつつ、また、webworkerでキャッシュすることによって更にパフォーマンスを上げていることが紹介されています。先述したnuxt-payload-extractorはブラウザにキャッシュできませんでしたが、パフォーマンスを求めるならこちらを参考にしたほうが良さそうですね。\n\n2つめの記事は1つめの記事が参照されています。JSONへの保存・読み込み処理部分だけの記事なので参考にしやすいと思います。(なくすト.js:thumbsup:)\n\n\n## 3.直接htmlから削除する（ブログ記事から）\nnuxt generateで生成されたhtmlには\n\n```\n＜script＞window.__NUXT__=\n```\nからはじまる箇所にJavaScriptの処理が記載されています。先述した、nuxt-payload-extractorはこの記載箇所からデータを取得しているので、そちらのソースも参照するとわかりやすいかもしれません。（そのほかの例はaxiosから直接データを取得しています）\n\n単純ですが、htmlからこの記載を削除してしまえば通信も発生しません。\nサクッと導入するには以下の記事で紹介されているcheerioを利用した方法が手軽かと思います。\n\n[Nuxt.js Generate後の＜script＞window.\\_\\_NUXT__=を消したい](https://ondwn.com/blog-20190718/)\n\n以下上記ブログ記事からの引用です。\n\n```nuxt.config.js\n    const cheerio = require('cheerio')\n    export default {\n      // 省略\n      hooks: {\n        'generate:page': page => {\n          const doc = cheerio.load(page.html);\n          doc(`body script`).remove();\n          page.html = doc.html();\n        },\n      },\n      // 省略\n    }\n```\n行っているのはnuxt.config.jsにcheerioで直接該当箇所を削除する処理を書くことだけです。アニメーションなどのために、クライアントサイドでJavaScriptを使う場合はscript全部ではなく、payload部分のみを削除すれば良さそうですね。（テストなどはしていません）\n\n# ケースごとのまとめ\nリンクも再掲します。\n\n## case1　サクッと手軽になくしたい\nhtmlを軽くしたい。クライアントサイドのJavaScriptはいらない。既存のプロジェクトから不要なリクエストをとにかくサクッとなくしたい。セキュリティも気になる。\n⇒D.直接htmlから削除する　が手軽です。\n[Nuxt.js Generate後の＜script＞window.\\_\\_NUXT__=を消したい](https://ondwn.com/blog-20190718/)\n\n## case2　webworkerやPWAは使わない\nサクッと手軽になくしたい。webworkerやPWAは使わない。一番多そうなケースです。\n⇒A.nuxtServerInitで全データ取得＆JSONに保存。\n⇒B.window.\\_\\_NUXT__からJSONに保存。\n⇒C.APIリクエスト時にJSONに保存。\n\n中でもB.[nuxt-payload-extractor](https://github.com/DreaMinder/nuxt-payload-extractor)か、C.「[Nuxtでビルド時にAPIを静的化して、完全にサーバーへのリクエストをなくすト](https://qiita.com/soichiro_nitta/items/7ca238d76072eba2ed97)」が導入しやすそうだなと思います。\n\n## case3　パフォーマンスを向上させたい\nサイトのパフォーマンスを向上させたい。\n⇒A.nuxtServerInitで全データ取得＆JSONに保存。\n⇒C.APIリクエスト時にJSONに保存。\n\n加えてwebworkerでキャッシュ。更にhtmlから不要な処理は削除しても良いかもしれません。\n[Firebase、Flamelink、Nuxt、Netlify、PWAを使ってJAMstackなブログを作る](https://qiita.com/miyaoka/items/9774f0250953da419a58#api%E3%82%92%E9%9D%99%E7%9A%84%E5%8C%96%E3%81%99%E3%82%8B)\n\n⇒更に更に、軽さを追求する場合は、AMPの導入を検討してみても良いかもしれません。\nNuxtは公式でAMPのサンプルもあげられています。[nuxt.js/examples/with-amp/](https://github.com/nuxt/nuxt.js/tree/dev/examples/with-amp)\n\n\n以上です。\n至らない点あるかもしれません。不備などありましたら、ご指摘いただけるとありがたいです。\n\n",coediting:a,comments_count:0,created_at:"2019-11-27T20:02:20+09:00",group:s,id:"ec6165b369c4b414c766",likes_count:0,private:a,reactions_count:0,tags:[{name:h,versions:[]},{name:"Netlify",versions:[]},{name:e,versions:[]},{name:"contentful",versions:[]}],title:"[FULL STATIC] Nuxt generate<4つのアプローチまとめ>",updated_at:"2019-11-27T20:07:57+09:00",url:"https://qiita.com/basho/items/ec6165b369c4b414c766",user:{description:I,facebook_id:n,followees_count:15,followers_count:3,github_login_name:$,id:L,items_count:14,linkedin_id:n,location:n,name:"kom",organization:n,permanent_id:89564,profile_image_url:B,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>以前、<a href="https://qiita.com/kira_puka/items/68732b402b2523f4ccd7" id="reference-b5c711e11dc9fd4a2415">FAQみたいなページをmarkdownで書けるようにしていた</a>けど、<br>\nランタイムでコンパイルするのはやっぱり重いなと思い、<br>\n軽量化の一環で前処理にしてみたときの備忘録。</p>\n\n<p>事前にPandocでVueのSFCを生成すればよかった(<em>´ω｀</em>)</p>\n\n<h3>\n<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h3>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>brew <span class="nb">install </span>pandoc\n</pre></div></div>\n\n<h3>\n<span id="テンプレートを用意する" class="fragment"></span><a href="#%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>テンプレートを用意する</h3>\n\n<p>こんな感じのファイルを用意する。<br>\n<code>$body$</code>にmarkdownで書いたHTMLが挿入される感じ</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="c">&lt;!-- ./vue-sfc.vue--&gt;</span>\n<span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div&gt;</span>$body$<span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n\n<span class="nt">&lt;script </span><span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">nuxt-property-decorator</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{}</span>\n<span class="nt">&lt;/script&gt;</span>\n</pre></div></div>\n\n<h3>\n<span id="pandocでvueを生成する" class="fragment"></span><a href="#pandoc%E3%81%A7vue%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Pandocで.vueを生成する</h3>\n\n<p>こんなMarkdownファイル(<code>faq.md</code>)を例に。</p>\n\n<div class="code-frame" data-lang="markdown"><div class="highlight"><pre><span class="gh"># よくある質問 / FAQ</span>\n\n<span class="gu">## 積読本しか登録してはいけないのですか？</span>\n</pre></div></div>\n\n<p>こんな感じで実行すると</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>pandoc <span class="nt">-f</span> markdown <span class="nt">-t</span> html <span class="nt">--template</span><span class="o">=</span>./vue-sfc.vue ./faq.md <span class="o">&gt;</span> ./FaqContent.vue\n<span class="c"># -f ... 入力ファイルのフォーマット</span>\n<span class="c"># -t ... 出力のフォーマット</span>\n<span class="c"># --template ... テンプレートファイル</span>\n</pre></div></div>\n\n<p>こんなファイルが生成されます。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="c">&lt;!-- FaqContent.vue --&gt;</span>\n<span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div&gt;&lt;h1&gt;</span>よくある質問 / FAQ<span class="nt">&lt;/h1&gt;</span>\n<span class="nt">&lt;h2&gt;</span>積読本しか登録してはいけないのですか？<span class="nt">&lt;/h2&gt;&lt;div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n\n<span class="nt">&lt;script </span><span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">nuxt-property-decorator</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{}</span>\n<span class="nt">&lt;/script&gt;</span>\n</pre></div></div>\n\n<p>あとは、このコンポーネント(<code>FaqContent.vue</code>)を表示するページにimportすればOK!</p>\n\n<p>ランタイムでコンパイルしなくても、前処理でいけた(<em>´ω｀</em>)</p>\n\n<h4>\n<span id="小ネタ" class="fragment"></span><a href="#%E5%B0%8F%E3%83%8D%E3%82%BF"><i class="fa fa-link"></i></a>小ネタ</h4>\n\n<h5>\n<span id="npm-run-build時に生成する" class="fragment"></span><a href="#npm-run-build%E6%99%82%E3%81%AB%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>npm run build</code>時に生成する</h5>\n\n<p>手動で実行するのはめんどうなので、<code>package.json</code>の<code>scripts</code>に追加した。</p>\n\n<div class="code-frame" data-lang="json"><div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"npm run build:md &amp;&amp; nuxt"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"npm run build:md &amp;&amp; nuxt generate"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"build:md"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pandoc -f markdown -t html --template=./vue-sfc.vue ./faq.md &gt; ./FaqContent.vue"</span><span class="p">,</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div></div>\n\n<h5>\n<span id="md内で別のコンポーネントを使う" class="fragment"></span><a href="#md%E5%86%85%E3%81%A7%E5%88%A5%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>.md内で別のコンポーネントを使う</h5>\n\n<p>別のコンポーネントを使いたいときは、テンプレートに追加しておく。<br>\n今回は、<a href="https://github.com/tonickkozlov/vue-tweet-embed#readme" rel="nofollow noopener" target="_blank">vue-tweet-embed</a>を使いたかったので追加。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div&gt;</span>$body$<span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n\n<span class="nt">&lt;script </span><span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">nuxt-property-decorator</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Tweet</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">vue-tweet-embed</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span> <span class="na">components</span><span class="p">:</span> <span class="p">{</span> <span class="nx">Tweet</span> <span class="p">}</span> <span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{}</span>\n<span class="nt">&lt;/script&gt;</span>\n</pre></div></div>\n\n<p>生のHTMLを表示したいときは、入力フォーマットに<code>+raw_html</code>をつけるらしい</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>pandoc <span class="nt">-f</span> markdown+raw_html <span class="nt">-t</span> html <span class="nt">--template</span><span class="o">=</span>./vue-sfc.vue ./faq.md <span class="o">&gt;</span> ./FaqContent.vue\n</pre></div></div>\n\n<p>ただ、ちゃんと変換されないことがあるので、<code>sed</code>で置換したりしてる...</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>pandoc <span class="nt">-f</span> markdown+raw_html <span class="nt">-t</span> html <span class="nt">--template</span><span class="o">=</span>./vue-sfc.vue ./faq.md | <span class="nb">sed</span> <span class="s1">\'s/&amp;lt;Tweet/&lt;Tweet/g\'</span> | <span class="nb">sed</span> <span class="s1">\'s:&amp;gt;&lt;/Tweet&gt;:&gt;&lt;/Tweet&gt;:g\'</span> <span class="o">&gt;</span> ./FaqContent.vue\n</pre></div></div>\n\n<p>Markdownの書き方などで回避できるかもしれないけど、暫定的にこの対応。。</p>\n\n<p>以上!!</p>\n\n<h2>\n<span id="こんなのつくってます" class="fragment"></span><a href="#%E3%81%93%E3%82%93%E3%81%AA%E3%81%AE%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%A6%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>こんなのつくってます!!</h2>\n\n<p>積読用の読書管理アプリ 『積読ハウマッチ』をリリースしました！<br>\n<a href="https://tsundoku.site" rel="nofollow noopener" target="_blank">積読ハウマッチ</a>は、Nuxt.js+Firebaseで開発してます!</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F478782%2F572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=b10c37fb591de27ad193d02a2a4cd916" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F478782%2F572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=b10c37fb591de27ad193d02a2a4cd916" width="200" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/478782/572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F478782%2F572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=45b94a2f1d7d67faacb0af5dd56a04c1 1x" loading="lazy"></a></p>\n\n<p>もしよかったら、遊んでみてくださいヽ(=´▽`=)ﾉ</p>\n\n<p>要望・感想・アドバイスなどあれば、<br>\n公式アカウント(<a href="https://twitter.com/MemoryLoverz" rel="nofollow noopener" target="_blank">@MemoryLoverz</a>)や開発者(<a href="https://twitter.com/kira_puka" rel="nofollow noopener" target="_blank">@kira_puka</a>)まで♪</p>\n\n<h1>\n<span id="参考にしたサイト様" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%A7%98"><i class="fa fa-link"></i></a>参考にしたサイト様</h1>\n\n<ul>\n<li><a href="https://qiita.com/sky_y/items/3c5c46ebd319490907e8#mac" id="reference-28ba56bc17616b3d0d39">Pandocの比較的簡単なインストール方法 - Qiita</a></li>\n<li><a href="https://qiita.com/cawpea/items/cea1243e106ababd15e7" id="reference-bd296c7f288f47daed9d">Pandocを使ってMarkdownを整形されたHTMLに変換する - Qiita</a></li>\n<li><a href="http://sky-y.github.io/site-pandoc-jp/users-guide/" rel="nofollow noopener" target="_blank">Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User\'s Association</a></li>\n<li><a href="https://qiita.com/tmsanrinsha/items/89df4500eb38a20e896e" id="reference-49d7c73f3b19c11eca7c">Pandocを使って、改行が必要な箇所にスペースを2ついれる - Qiita</a></li>\n</ul>\n',body:'以前、[FAQみたいなページをmarkdownで書けるようにしていた](https://qiita.com/kira_puka/items/68732b402b2523f4ccd7)けど、\nランタイムでコンパイルするのはやっぱり重いなと思い、\n軽量化の一環で前処理にしてみたときの備忘録。\n\n事前にPandocでVueのSFCを生成すればよかった(*´ω｀*)\n\n\n### インストール\n\n```shell\n$ brew install pandoc\n```\n\n### テンプレートを用意する\n\nこんな感じのファイルを用意する。\n`$body$`にmarkdownで書いたHTMLが挿入される感じ\n\n```html\n\x3c!-- ./vue-sfc.vue--\x3e\n<template>\n  <div>$body$</div>\n</template>\n\n<script lang="ts">\nimport { Component, Vue } from "nuxt-property-decorator";\n\n@Component\nexport default class extends Vue {}\n<\/script>\n```\n\n### Pandocで.vueを生成する\n\nこんなMarkdownファイル(`faq.md`)を例に。\n\n```markdown\n# よくある質問 / FAQ\n\n## 積読本しか登録してはいけないのですか？\n```\n\nこんな感じで実行すると\n\n```shell\n$ pandoc -f markdown -t html --template=./vue-sfc.vue ./faq.md > ./FaqContent.vue\n# -f ... 入力ファイルのフォーマット\n# -t ... 出力のフォーマット\n# --template ... テンプレートファイル\n```\n\nこんなファイルが生成されます。\n\n```html\n\x3c!-- FaqContent.vue --\x3e\n<template>\n  <div><h1>よくある質問 / FAQ</h1>\n<h2>積読本しか登録してはいけないのですか？</h2><div>\n</template>\n\n<script lang="ts">\nimport { Component, Vue } from "nuxt-property-decorator";\n\n@Component\nexport default class extends Vue {}\n<\/script>\n```\n\nあとは、このコンポーネント(`FaqContent.vue`)を表示するページにimportすればOK!\n\nランタイムでコンパイルしなくても、前処理でいけた(*´ω｀*)\n\n#### 小ネタ\n\n##### `npm run build`時に生成する\n\n手動で実行するのはめんどうなので、`package.json`の`scripts`に追加した。\n\n```json\n{\n  "scripts": {\n    "dev": "npm run build:md && nuxt",\n    "build": "npm run build:md && nuxt generate",\n    "build:md": "pandoc -f markdown -t html --template=./vue-sfc.vue ./faq.md > ./FaqContent.vue",\n  }\n}\n```\n\n##### .md内で別のコンポーネントを使う\n\n別のコンポーネントを使いたいときは、テンプレートに追加しておく。\n今回は、[vue-tweet-embed](https://github.com/tonickkozlov/vue-tweet-embed#readme)を使いたかったので追加。\n\n```html\n<template>\n  <div>$body$</div>\n</template>\n\n<script lang="ts">\nimport { Component, Vue } from "nuxt-property-decorator";\nimport { Tweet } from "vue-tweet-embed";\n\n@Component({ components: { Tweet } })\nexport default class extends Vue {}\n<\/script>\n```\n\n生のHTMLを表示したいときは、入力フォーマットに`+raw_html`をつけるらしい\n\n```shell\n$ pandoc -f markdown+raw_html -t html --template=./vue-sfc.vue ./faq.md > ./FaqContent.vue\n```\n\nただ、ちゃんと変換されないことがあるので、`sed`で置換したりしてる...\n\n```shell\n$ pandoc -f markdown+raw_html -t html --template=./vue-sfc.vue ./faq.md | sed \'s/&lt;Tweet/<Tweet/g\' | sed \'s:&gt;</Tweet>:></Tweet>:g\' > ./FaqContent.vue\n```\n\nMarkdownの書き方などで回避できるかもしれないけど、暫定的にこの対応。。\n\n以上!!\n\n## こんなのつくってます!!\n\n積読用の読書管理アプリ 『積読ハウマッチ』をリリースしました！\n[積読ハウマッチ](https://tsundoku.site)は、Nuxt.js+Firebaseで開発してます!\n\n<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/478782/572d4947-f40b-e4dc-1c9c-bc584cd2a66c.png" width="200"/>\n\nもしよかったら、遊んでみてくださいヽ(=´▽`=)ﾉ\n\n要望・感想・アドバイスなどあれば、\n公式アカウント([@MemoryLoverz](https://twitter.com/MemoryLoverz))や開発者([@kira_puka](https://twitter.com/kira_puka))まで♪\n\n\n# 参考にしたサイト様\n- [Pandocの比較的簡単なインストール方法 - Qiita](https://qiita.com/sky_y/items/3c5c46ebd319490907e8#mac)\n- [Pandocを使ってMarkdownを整形されたHTMLに変換する - Qiita](https://qiita.com/cawpea/items/cea1243e106ababd15e7)\n- [Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User\'s Association](http://sky-y.github.io/site-pandoc-jp/users-guide/)\n- [Pandocを使って、改行が必要な箇所にスペースを2ついれる - Qiita](https://qiita.com/tmsanrinsha/items/89df4500eb38a20e896e)\n',coediting:a,comments_count:0,created_at:D,group:s,id:"1e68c7838f123cd1255b",likes_count:1,private:a,reactions_count:0,tags:[{name:"Markdown",versions:[]},{name:"Pandoc",versions:[]},{name:c,versions:[]},{name:e,versions:[]}],title:"PandocでMarkdownからVueのSFCを生成してみた",updated_at:D,url:"https://qiita.com/kira_puka/items/1e68c7838f123cd1255b",user:{description:"フリーのエンジニア / 今はNuxt.jsが多め / いつかFlutterをやりたい\r\n受託開発をしながら、アプリ・Webサービス・ゲームを個人開発\r\n\r\nKotlin/Python/Swift/Unity/Java/Haskell/DDD",facebook_id:n,followees_count:98,followers_count:83,github_login_name:s,id:V,items_count:34,linkedin_id:n,location:n,name:"きらぷか",organization:"めもらば - Memory Lovers -",permanent_id:478782,profile_image_url:"https://pbs.twimg.com/profile_images/1096750155057909760/J1LKysPF_bigger.png",team_only:a,twitter_screen_name:V,website_url:"https://memory-lovers.com"},page_views_count:s},{rendered_body:'<p>新規でNuxt(Vue)のプロジェクトを立ち上げる機会があったので、初めてStorybookを導入してみました。<br>\n現在Storybookのバージョンは5.2.xですが、公式が推奨するストーリーの記述方式が<strong>Component Story Format (CSF)</strong>に変更されたようです。<br>\n(v5.1以前は<strong>StoriesOf API</strong>が一般的。v5.2でも問題なく使用できる)<br>\n<a href="https://storybook.js.org/docs/formats/component-story-format/" rel="nofollow noopener" target="_blank">Component Story Format (CSF)</a><br>\n<a href="https://storybook.js.org/docs/formats/storiesof-api/" rel="nofollow noopener" target="_blank">StoriesOf API</a><br>\n初導入にあたり参考情報を探していたのですが、公式ドキュメントもネットの情報も<strong>StoriesOf API</strong>での記載例が多かったので(当たり前ですが)、良い機会だと思い基本的な情報ですが<strong>CSF</strong>での記法でまとめでみました。</p>\n\n<h1>\n<span id="1インストールと基本設定" class="fragment"></span><a href="#1%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1.インストールと基本設定</h1>\n\n<p><a href="https://storybook.js.org/docs/guides/guide-vue/" rel="nofollow noopener" target="_blank">Storybook for Vue</a><br>\nCLIを使用して半自動でインストールする方法と、必要なモジュールを自分で追加していく方法がありますが、CLIでインストールする方がやはり楽です。</p>\n\n<h2>\n<span id="11-nuxtプロジェクトにstorybookをcliでインストール" class="fragment"></span><a href="#11-nuxt%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%ABstorybook%E3%82%92cli%E3%81%A7%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>1.1 NuxtプロジェクトにStorybookをCLIでインストール</h2>\n\n<p>CLIを使用すると雛形のStoryファイルが生成されるのでそれを見るだけでも基本的な使用方法はわかると思います。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>npx <span class="nt">-p</span> @storybook/cli sb init\n</pre></div></div>\n\n<p>上記の書き方で、プロジェクトが何のフレームワークで構成されているか自動で判定して必要なモジュール群をインストールしてくれます(心配な場合はオプションでフレームワーク名を追加してください。<code>--type vue</code>)<br>\n作ったばかりのNuxtプロジェクトですが、以下のモジュールが追加されました。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre>+ @babel/core@7.7.2\n+ babel-loader@8.0.6\n+ babel-preset-vue@2.0.2\n+ @storybook/addons@5.2.6\n+ @storybook/addon-actions@5.2.6\n+ @storybook/addon-links@5.2.6\n+ @storybook/vue@5.2.6\n</pre></div></div>\n\n<p>さらに、storybookの設定ファイルなどを格納する<code>.storybook</code>とストーリーファイルを格納する<code>stories</code>の2つのディレクトリも同時に生成されます。</p>\n\n<h2>\n<span id="12-packagejsonの設定" class="fragment"></span><a href="#12-packagejson%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1.2 package.jsonの設定</h2>\n\n<p>実行する際のコマンドを追加します。が、CLIでインストールするとこの記述も追加されていますので、特に編集はいりません。Dockerなどを使用している関係でポート番号を変更したいなどありましたら編集してください。</p>\n\n<div class="code-frame" data-lang="json"><div class="highlight"><pre><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="nl">"storybook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"start-storybook -p 6006"</span><span class="p">,</span><span class="w">\n  </span><span class="nl">"build-storybook"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build-storybook"</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div></div>\n\n<p>これで、下記コマンドによる実行ができるようになりました。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>npm run story\n</pre></div></div>\n\n<h2>\n<span id="13-storybook用webpackの設定" class="fragment"></span><a href="#13-storybook%E7%94%A8webpack%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1.3 Storybook用webpackの設定</h2>\n\n<p>StorybookはNuxtなどと実行環境が別(この言い方で良いのか..?)なので、専用にwebpackの設定も行う必要があります。以下のファイルを編集していきます。CLIによって自動生成されるはずですが、なかったら追加してください。<br>\n<code>.storybook/webpackconfig.js</code></p>\n\n<h3>\n<span id="131-nuxtプロジェクトで使用しているやなどのエイリアス設定" class="fragment"></span><a href="#131-nuxt%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%84%E3%81%AA%E3%81%A9%E3%81%AE%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1.3.1 Nuxtプロジェクトで使用している<code>@</code>や<code>~</code>などのエイリアス設定</h3>\n\n<p>これをしないとコンポーネントの読み込みなどでエイリアスを使用している場合にエラーになるので追記しましょう。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/webpackconfig.js</span></div>\n<div class="highlight"><pre><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">path</span><span class="dl">\'</span><span class="p">)</span>\n<span class="kd">const</span> <span class="nx">rootPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">../</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">config</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n\n  <span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span><span class="p">[</span><span class="dl">\'</span><span class="s1">~</span><span class="dl">\'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rootPath</span>\n  <span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span><span class="p">[</span><span class="dl">\'</span><span class="s1">@</span><span class="dl">\'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rootPath</span>\n\n  <span class="k">return</span> <span class="nx">config</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="132-typescriptの使用設定" class="fragment"></span><a href="#132-typescript%E3%81%AE%E4%BD%BF%E7%94%A8%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1.3.2 Typescriptの使用設定</h3>\n\n<p>Typescriptを使用する場合に。素のjsでプロジェクトを記述している場合は無視してください。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/webpackconfig.js</span></div>\n<div class="highlight"><pre><span class="nx">config</span><span class="p">.</span><span class="nx">module</span><span class="p">.</span><span class="nx">rules</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>\n  <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\\.</span><span class="sr">ts/</span><span class="p">,</span>\n  <span class="na">use</span><span class="p">:</span> <span class="p">[</span>\n    <span class="p">{</span>\n      <span class="na">loader</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">ts-loader</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">options</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">appendTsSuffixTo</span><span class="p">:</span> <span class="p">[</span><span class="sr">/</span><span class="se">\\.</span><span class="sr">vue$/</span><span class="p">],</span>\n        <span class="na">transpileOnly</span><span class="p">:</span> <span class="kc">true</span>\n      <span class="p">},</span>\n    <span class="p">}</span>\n  <span class="p">],</span>\n<span class="p">});</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="133-sassscssの使用設定かつグローバルなcss用変数やmixinを読み込む" class="fragment"></span><a href="#133-sassscss%E3%81%AE%E4%BD%BF%E7%94%A8%E8%A8%AD%E5%AE%9A%E3%81%8B%E3%81%A4%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E3%81%AAcss%E7%94%A8%E5%A4%89%E6%95%B0%E3%82%84mixin%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>1.3.3 sass(scss)の使用設定、かつグローバルなCSS用変数やmixinを読み込む</h3>\n\n<p>Storybookで表示するコンポーネント内で、scssの変数やmixinを使用している場合はここで指定します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/webpackconfig.js</span></div>\n<div class="highlight"><pre><span class="nx">config</span><span class="p">.</span><span class="nx">module</span><span class="p">.</span><span class="nx">rules</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>\n  <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\\.</span><span class="sr">scss$/</span><span class="p">,</span>\n    <span class="na">use</span><span class="p">:</span> <span class="p">[</span>\n      <span class="p">{</span>\n        <span class="na">loader</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">style-loader</span><span class="dl">\'</span>\n      <span class="p">},</span>\n      <span class="p">{</span>\n        <span class="na">loader</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">css-loader</span><span class="dl">\'</span>\n      <span class="p">},</span>\n      <span class="p">{</span>\n        <span class="na">loader</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">sass-loader</span><span class="dl">\'</span>\n      <span class="p">},</span>\n      <span class="p">{</span>\n        <span class="na">loader</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">sass-resources-loader</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">options</span><span class="p">:</span> <span class="p">{</span>\n          <span class="na">resources</span><span class="p">:</span> <span class="p">[</span> \n            <span class="dl">\'</span><span class="s1">./assets/scss/app.scss</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="p">],</span>\n          <span class="nx">rootPath</span>\n        <span class="p">}</span>\n      <span class="p">},</span>\n    <span class="p">],</span>\n<span class="p">});</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="134-css内からassets以下のファイルにアクセスできるように設定" class="fragment"></span><a href="#134-css%E5%86%85%E3%81%8B%E3%82%89assets%E4%BB%A5%E4%B8%8B%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>1.3.4 css内からassets以下のファイルにアクセスできるように設定</h3>\n\n<p><code>assets</code>ディレクトリ以下の画像やフォントにcssからアクセスできるように設定します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/webpackconfig.js</span></div>\n<div class="highlight"><pre><span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">modules</span> <span class="o">=</span> <span class="p">[</span>\n  <span class="p">...(</span><span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">modules</span> <span class="o">||</span> <span class="p">[]),</span>\n  <span class="nx">rootPath</span>\n<span class="p">];</span>\n</pre></div>\n</div>\n\n<p>基本的には、以上で設定は終わりです。</p>\n\n<h2>\n<span id="14-簡単なストーリーの記述" class="fragment"></span><a href="#14-%E7%B0%A1%E5%8D%98%E3%81%AA%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AA%E3%83%BC%E3%81%AE%E8%A8%98%E8%BF%B0"><i class="fa fa-link"></i></a>1.4 簡単なストーリーの記述</h2>\n\n<p><code>MyButton</code>コンポーネントを表示する、ごく基本的なストーリーの記述方を書きます。<br>\n<strong>Component Story Format (CSF)</strong>での書き方は、実際に記述してみれば結構簡単かと思います。<br>\nストーリーは<code>.storybook/config.js</code>の中にある以下の記述によって、<code>/stories</code>以下の<code>.stories.js</code>がついたファイルが自動で読み込まれます。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/config.js</span></div>\n<div class="highlight"><pre><span class="c1">// automatically import all files ending in *.stories.js</span>\n<span class="nx">configure</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="dl">\'</span><span class="s1">../stories/</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="sr">/</span><span class="se">\\.</span><span class="sr">stories</span><span class="se">\\.</span><span class="sr">js$/</span><span class="p">),</span> <span class="nx">module</span><span class="p">)</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">sample.stories.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">MyButton</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/MyButton</span><span class="dl">\'</span>\n\n<span class="c1">// コンポーネントのメタデータを記述</span>\n<span class="c1">// アドオンのでコレータやパラメータなどもここに書く</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="c1">// スラッシュで区切ると、Atoms&gt;Buttonと階層構造で表示できます</span>\n  <span class="c1">//　他にも記述方法はあるが割愛。公式ドキュメントを確認してください</span>\n  <span class="c1">// タイトルは一意であること</span>\n  <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Atoms/Button</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="na">decorators</span><span class="p">:</span> <span class="p">[</span> <span class="p">...</span> <span class="p">],</span>\n  <span class="na">parameters</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="c1">// Common Link Btnがストーリーの名前となります。</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">CommonLinkBtn</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="nx">MyButton</span><span class="p">,</span>\n  <span class="c1">// 適宜htmlなりを記述</span>\n  <span class="na">template</span><span class="p">:</span> <span class="s2">`\n  &lt;div id="storybook-container"&gt;\n    &lt;div class=\'component-wrapper\'&gt;\n      &lt;h5&gt;MyButton&lt;/h5&gt;\n      &lt;Button&gt;{{ label }}&lt;/ButtonLink&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  `</span>\n<span class="p">})</span>\n\n<span class="c1">// 下記のように名称を変更できます</span>\n<span class="c1">// CommonLinkBtn.story = { name: \'hoge\' }</span>\n\n</pre></div>\n</div>\n\n<hr>\n\n<h1>\n<span id="2-代表的なaddonの追加" class="fragment"></span><a href="#2-%E4%BB%A3%E8%A1%A8%E7%9A%84%E3%81%AAaddon%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>2. 代表的なaddonの追加</h1>\n\n<p>追加していくaddonは以下です。全てStorybookの<a href="https://github.com/storybookjs/storybook/blob/master/ADDONS_SUPPORT.md" rel="nofollow noopener" target="_blank">公式</a>です</p>\n\n<table>\n<thead>\n<tr>\n<th style="text-align: left">アドオン</th>\n<th style="text-align: left">機能</th>\n<th style="text-align: left">github</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style="text-align: left">addon-knobs</td>\n<td style="text-align: left">動的にpropsの値を変更して、コンポーネントの挙動を確認できる</td>\n<td style="text-align: left"><a href="https://github.com/storybookjs/storybook/tree/master/addons/knobs#with-vuejs" rel="nofollow noopener" target="_blank">@storybook/knobs</a></td>\n</tr>\n<tr>\n<td style="text-align: left">actions</td>\n<td style="text-align: left">onClickなどのUIアクションに対してのログを確認できる</td>\n<td style="text-align: left"><a href="https://github.com/storybookjs/storybook/tree/master/addons/actions" rel="nofollow noopener" target="_blank">@storybook/addon-actions</a></td>\n</tr>\n<tr>\n<td style="text-align: left">notes</td>\n<td style="text-align: left">text,html,マークダウンでコンポーネントの説明を追加できる</td>\n<td style="text-align: left"><a href="https://github.com/storybookjs/storybook/tree/master/addons/notes" rel="nofollow noopener" target="_blank">@storybook/notes</a></td>\n</tr>\n<tr>\n<td style="text-align: left">viewport</td>\n<td style="text-align: left">表示サイズの変更</td>\n<td style="text-align: left"><a href="https://github.com/storybookjs/storybook/tree/master/addons/viewport" rel="nofollow noopener" target="_blank">@storybook/viewport</a></td>\n</tr>\n<tr>\n<td style="text-align: left">a11y</td>\n<td style="text-align: left">コンポーネントのアクセシビリティチェック</td>\n<td style="text-align: left"><a href="https://github.com/storybookjs/storybook/tree/master/addons/a11y" rel="nofollow noopener" target="_blank">@storybook/addon-a11y</a></td>\n</tr>\n<tr>\n<td style="text-align: left">backgrounds</td>\n<td style="text-align: left">ストーリーの背景色変更</td>\n<td style="text-align: left"><a href="https://github.com/storybookjs/storybook/tree/master/addons/backgrounds" rel="nofollow noopener" target="_blank">@storybook/addon-backgrounds</a></td>\n</tr>\n</tbody>\n</table>\n\n<p>上記のアドオンをインストール&amp;Storyに追加</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>npm i <span class="nt">-D</span> @storybook/knobs @storybook/addon-actions @storybook/notes @storybook/viewport @storybook/addon-a11y @storybook/addon-backgrounds\n</pre></div></div>\n\n<p>インストールしたアドオンをimportします。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/config.js</span></div>\n<div class="highlight"><pre><span class="c1">// actionsとlinksはCLIによるインストール時に追加される。</span>\n<span class="c1">// linksについては省略</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-links/register</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-knobs/register</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-actions/register</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-notes/register</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-viewport/register</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-a11y/register</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">@storybook/addon-backgrounds/register</span><span class="dl">\'</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="21-knobs" class="fragment"></span><a href="#21-knobs"><i class="fa fa-link"></i></a>2.1 knobs</h2>\n\n<p>propsを設定したコンポーネントを用意します。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">MyButton.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;button</span> <span class="na">:disabled=</span><span class="s">"isDisabled"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;slot&gt;&lt;/slot&gt;</span>\n  <span class="nt">&lt;/button&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">isDisabled</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span>\n      <span class="na">default</span><span class="p">:</span> <span class="kc">false</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>ちなみにpropsだけでなく、slotの値の挿入などもOKです。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">MyButton.story.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">withKnobs</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">boolean</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@storybook/addon-knobs</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">MyButton</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/MyButton.vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Storybook Knobs</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="na">decorators</span><span class="p">:</span> <span class="p">[</span> <span class="nx">withKnobs</span> <span class="p">]</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">Button</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span> <span class="nx">MyButton</span> <span class="p">},</span>\n  <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">isDisabled</span><span class="p">:</span> <span class="p">{</span>\n      <span class="c1">// default: 与えるデータの型(\'ラベル\', 初期値)</span>\n      <span class="na">default</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Disabled</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>\n    <span class="p">},</span>\n    <span class="na">text</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">default</span><span class="p">:</span> <span class="nx">text</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Text</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">Hello Storybook</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">template</span><span class="p">:</span> <span class="s2">`&lt;MyButton :isDisabled="isDisabled"&gt;{{ text }}&lt;/MyButton&gt;`</span>\n<span class="p">})</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="22-actions" class="fragment"></span><a href="#22-actions"><i class="fa fa-link"></i></a>2.2 actions</h2>\n\n<p>下記のようなカスタムイベントを設定したコンポーネントを準備します。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">MyButton.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;button</span> <span class="err">@</span><span class="na">click=</span><span class="s">"sampleEvent"</span><span class="nt">&gt;</span>ボタン<span class="nt">&lt;/button&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">sampleEvent</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">clicked</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>上記を<code>actions</code>を使用して表示するストーリーは以下。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">MyButton.stories.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">action</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@storybook/addon-actions</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">MyButton</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/MyButton.vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Storybook Actions</span><span class="dl">\'</span><span class="p">,</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">PostBtn</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span> <span class="nx">Button</span> <span class="p">},</span>\n  <span class="c1">// カスタムイベントが発火すると、以下のactionが実行されます。</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">log</span><span class="p">:</span> <span class="nx">action</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Post!</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">},</span>\n  <span class="na">template</span><span class="p">:</span> <span class="s2">`&lt;ButtonPost @clicked="log" /&gt;`</span>\n<span class="p">})</span>\n</pre></div>\n</div>\n\n<p>actionが実行された様子<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F42337%2Fde90f6ff-2f89-a1ac-fe7e-c4a48c6bb834.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=8f5cc7178ad3b144b7d30c06c59fe64a" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F42337%2Fde90f6ff-2f89-a1ac-fe7e-c4a48c6bb834.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=8f5cc7178ad3b144b7d30c06c59fe64a" alt="スクリーンショット 2019-11-26 19.55.42.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/42337/de90f6ff-2f89-a1ac-fe7e-c4a48c6bb834.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F42337%2Fde90f6ff-2f89-a1ac-fe7e-c4a48c6bb834.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=d7ceb526e6971a8f15217dd28fdd83a5 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="23-notes" class="fragment"></span><a href="#23-notes"><i class="fa fa-link"></i></a>2.3 notes</h2>\n\n<p><code>parameters</code>にテキストなり、マークダウンファイルを指定すればOKです。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">sample.stories.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">markdownNotes</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./someMarkdownText.md</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Storybook Notes</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="c1">// テキストの場合</span>\n  <span class="na">parameters</span><span class="p">:</span> <span class="p">{</span> <span class="na">notes</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Some Notes</span><span class="dl">\'</span> <span class="p">},</span>\n  <span class="c1">// マークダウンファイルの場合</span>\n  <span class="na">parameters</span><span class="p">:</span> <span class="p">{</span> <span class="na">notes</span><span class="p">:</span> <span class="p">{</span> <span class="na">markdown</span><span class="p">:</span> <span class="nx">markdownNotes</span> <span class="p">}</span> <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="nx">__</span><span class="p">(</span><span class="err">省略</span><span class="p">)</span><span class="nx">__</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="24-viewport" class="fragment"></span><a href="#24-viewport"><i class="fa fa-link"></i></a>2.4 viewport</h2>\n\n<p>Storybook全体に適用する場合は、<code>.storybook/config.js</code>に設定を追記します。<br>\n公式ドキュメントの例に沿って、Kindle端末の画面サイズを追加します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/config.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">addParameters</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@storybook/vue</span><span class="dl">\'</span><span class="p">;</span>\n<span class="c1">// viewportが初期設定しているデバイスのパラメータリストを読み込む</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">INITIAL_VIEWPORTS</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@storybook/addon-viewport</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="c1">// Kindleのパラメータを設定</span>\n<span class="kd">const</span> <span class="nx">newViewports</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">kindleFire2</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Kindle Fire 2</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">styles</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">width</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">600px</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">height</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">963px</span><span class="dl">\'</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">kindleFireHD</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Kindle Fire HD</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">styles</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">width</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">533px</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">height</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">801px</span><span class="dl">\'</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="c1">// 初期パラメータと上記で設定したパラメータオブジェクトを追加</span>\n<span class="c1">// ...INITIAL_VIEWPORTS,を再度追加しているのは表示順を</span>\n<span class="c1">// INITIAL_VIEWPORTS &gt; newViewportsにするため</span>\n<span class="nx">addParameters</span><span class="p">({</span>\n  <span class="na">viewport</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">viewports</span><span class="p">:</span> <span class="p">{</span>\n      <span class="p">...</span><span class="nx">INITIAL_VIEWPORTS</span><span class="p">,</span>\n      <span class="p">...</span><span class="nx">newViewports</span><span class="p">,</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n\n<span class="c1">// 上記の設定はconfigure(require.context~より前に記載すること</span>\n<span class="nx">configure</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="dl">\'</span><span class="s1">../stories/</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="sr">/</span><span class="se">\\.</span><span class="sr">stories</span><span class="se">\\.</span><span class="sr">js$/</span><span class="p">),</span> <span class="nx">module</span><span class="p">)</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="25-a11y" class="fragment"></span><a href="#25-a11y"><i class="fa fa-link"></i></a>2.5 a11y</h2>\n\n<p>チェックしたいコンポーネントに読み込み、<code>decolators</code>に追加すればOK</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">sample.stories.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">withA11y</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@storybook/addon-a11y</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Sample</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="na">decorators</span><span class="p">:</span> <span class="p">[</span> <span class="nx">withA11y</span> <span class="p">]</span>\n<span class="p">}</span>\n\n<span class="nx">__</span><span class="p">(</span><span class="err">省略</span><span class="p">)</span><span class="nx">__</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="26-backgrounds" class="fragment"></span><a href="#26-backgrounds"><i class="fa fa-link"></i></a>2.6 backgrounds</h2>\n\n<p>全体に適用する場合は<code>config.js</code>に記述追加</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">　.storybook/config.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">addParameters</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@storybook/vue</span><span class="dl">\'</span>\n\n<span class="nx">addParameters</span><span class="p">({</span>\n  <span class="na">backgrounds</span><span class="p">:</span> <span class="p">[</span>\n    <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Sample BG 1</span><span class="dl">\'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#CCCCCC</span><span class="dl">\'</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>\n    <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Sample BG 2</span><span class="dl">\'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#000000</span><span class="dl">\'</span> <span class="p">},</span>\n  <span class="p">],</span>\n<span class="p">});</span>\n\n<span class="c1">// 上記の設定はconfigure(require.context~より前に記載すること</span>\n<span class="nx">configure</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="dl">\'</span><span class="s1">../stories/</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="sr">/</span><span class="se">\\.</span><span class="sr">stories</span><span class="se">\\.</span><span class="sr">js$/</span><span class="p">),</span> <span class="nx">module</span><span class="p">)</span>\n</pre></div>\n</div>\n\n<hr>\n\n<p>以上、私もまだ深いところまで触っていない&amp;導入したばかりで間違い等あるかもしれませんが、基本的なところは抑えられているかと思います<img alt=":pushpin:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f4cc.png" title=":pushpin:" width="20" loading="lazy"></p>\n',body:"新規でNuxt(Vue)のプロジェクトを立ち上げる機会があったので、初めてStorybookを導入してみました。\n現在Storybookのバージョンは5.2.xですが、公式が推奨するストーリーの記述方式が**Component Story Format (CSF)**に変更されたようです。\n(v5.1以前は**StoriesOf API**が一般的。v5.2でも問題なく使用できる)\n[Component Story Format (CSF)](https://storybook.js.org/docs/formats/component-story-format/)\n[StoriesOf API](https://storybook.js.org/docs/formats/storiesof-api/)\n初導入にあたり参考情報を探していたのですが、公式ドキュメントもネットの情報も**StoriesOf API**での記載例が多かったので(当たり前ですが)、良い機会だと思い基本的な情報ですが**CSF**での記法でまとめでみました。\n\n# 1.インストールと基本設定\n[Storybook for Vue](https://storybook.js.org/docs/guides/guide-vue/)\nCLIを使用して半自動でインストールする方法と、必要なモジュールを自分で追加していく方法がありますが、CLIでインストールする方がやはり楽です。\n\n## 1.1 NuxtプロジェクトにStorybookをCLIでインストール\n\nCLIを使用すると雛形のStoryファイルが生成されるのでそれを見るだけでも基本的な使用方法はわかると思います。\n\n```shell\n$ npx -p @storybook/cli sb init\n```\n上記の書き方で、プロジェクトが何のフレームワークで構成されているか自動で判定して必要なモジュール群をインストールしてくれます(心配な場合はオプションでフレームワーク名を追加してください。`--type vue`)\n作ったばかりのNuxtプロジェクトですが、以下のモジュールが追加されました。\n\n```shell\n+ @babel/core@7.7.2\n+ babel-loader@8.0.6\n+ babel-preset-vue@2.0.2\n+ @storybook/addons@5.2.6\n+ @storybook/addon-actions@5.2.6\n+ @storybook/addon-links@5.2.6\n+ @storybook/vue@5.2.6\n```\nさらに、storybookの設定ファイルなどを格納する`.storybook`とストーリーファイルを格納する`stories`の2つのディレクトリも同時に生成されます。\n\n## 1.2 package.jsonの設定\n実行する際のコマンドを追加します。が、CLIでインストールするとこの記述も追加されていますので、特に編集はいりません。Dockerなどを使用している関係でポート番号を変更したいなどありましたら編集してください。\n\n```json\n\"scripts\": {\n  \"storybook\": \"start-storybook -p 6006\",\n  \"build-storybook\": \"build-storybook\"\n}\n```\nこれで、下記コマンドによる実行ができるようになりました。\n\n```shell\n$ npm run story\n```\n\n## 1.3 Storybook用webpackの設定\nStorybookはNuxtなどと実行環境が別(この言い方で良いのか..?)なので、専用にwebpackの設定も行う必要があります。以下のファイルを編集していきます。CLIによって自動生成されるはずですが、なかったら追加してください。\n`.storybook/webpackconfig.js`\n\n### 1.3.1 Nuxtプロジェクトで使用している`@`や`~`などのエイリアス設定\nこれをしないとコンポーネントの読み込みなどでエイリアスを使用している場合にエラーになるので追記しましょう。\n\n```　.storybook/webpackconfig.js\nconst path = require('path')\nconst rootPath = path.resolve(__dirname, '../')\n\nmodule.exports = ({ config }) => {\n\n  config.resolve.alias['~'] = rootPath\n  config.resolve.alias['@'] = rootPath\n  \n  return config\n}\n```\n\n### 1.3.2 Typescriptの使用設定\nTypescriptを使用する場合に。素のjsでプロジェクトを記述している場合は無視してください。\n\n```　.storybook/webpackconfig.js\nconfig.module.rules.push({\n  test: /\\.ts/,\n  use: [\n    {\n      loader: 'ts-loader',\n      options: {\n        appendTsSuffixTo: [/\\.vue$/],\n        transpileOnly: true\n      },\n    }\n  ],\n});\n```\n\n### 1.3.3 sass(scss)の使用設定、かつグローバルなCSS用変数やmixinを読み込む\nStorybookで表示するコンポーネント内で、scssの変数やmixinを使用している場合はここで指定します。\n\n```　.storybook/webpackconfig.js\nconfig.module.rules.push({\n  test: /\\.scss$/,\n    use: [\n      {\n        loader: 'style-loader'\n      },\n      {\n        loader: 'css-loader'\n      },\n      {\n        loader: 'sass-loader'\n      },\n      {\n        loader: 'sass-resources-loader',\n        options: {\n          resources: [ \n            './assets/scss/app.scss',\n          ],\n          rootPath\n        }\n      },\n    ],\n});\n```\n\n### 1.3.4 css内からassets以下のファイルにアクセスできるように設定\n`assets`ディレクトリ以下の画像やフォントにcssからアクセスできるように設定します。\n\n```　.storybook/webpackconfig.js\nconfig.resolve.modules = [\n  ...(config.resolve.modules || []),\n  rootPath\n];\n```\n\n基本的には、以上で設定は終わりです。\n\n## 1.4 簡単なストーリーの記述\n\n`MyButton`コンポーネントを表示する、ごく基本的なストーリーの記述方を書きます。\n**Component Story Format (CSF)**での書き方は、実際に記述してみれば結構簡単かと思います。\nストーリーは`.storybook/config.js`の中にある以下の記述によって、`/stories`以下の`.stories.js`がついたファイルが自動で読み込まれます。\n\n```　.storybook/config.js\n// automatically import all files ending in *.stories.js\nconfigure(require.context('../stories/', true, /\\.stories\\.js$/), module)\n```\n\n\n```sample.stories.js\nimport MyButton from '@/components/MyButton'\n\n// コンポーネントのメタデータを記述\n// アドオンのでコレータやパラメータなどもここに書く\nexport default {\n  // スラッシュで区切ると、Atoms>Buttonと階層構造で表示できます\n  //　他にも記述方法はあるが割愛。公式ドキュメントを確認してください\n  // タイトルは一意であること\n  title: 'Atoms/Button',\n  decorators: [ ... ],\n  parameters: { ... }\n}\n\n// Common Link Btnがストーリーの名前となります。\nexport const CommonLinkBtn = () => ({\n  components: MyButton,\n  // 適宜htmlなりを記述\n  template: `\n  <div id=\"storybook-container\">\n    <div class='component-wrapper'>\n      <h5>MyButton</h5>\n      <Button>{{ label }}</ButtonLink>\n    </div>\n  </div>\n  `\n})\n\n// 下記のように名称を変更できます\n// CommonLinkBtn.story = { name: 'hoge' }\n\n```\n\n---\n\n# 2. 代表的なaddonの追加\n\n追加していくaddonは以下です。全てStorybookの[公式](https://github.com/storybookjs/storybook/blob/master/ADDONS_SUPPORT.md)です\n\n|アドオン|機能|github|\n|:--|:--|:--|\n|addon-knobs|動的にpropsの値を変更して、コンポーネントの挙動を確認できる|[@storybook/knobs](https://github.com/storybookjs/storybook/tree/master/addons/knobs#with-vuejs)|\n|actions|onClickなどのUIアクションに対してのログを確認できる|[@storybook/addon-actions](https://github.com/storybookjs/storybook/tree/master/addons/actions)|\n|notes|text,html,マークダウンでコンポーネントの説明を追加できる|[@storybook/notes](https://github.com/storybookjs/storybook/tree/master/addons/notes)|\n|viewport|表示サイズの変更|[@storybook/viewport](https://github.com/storybookjs/storybook/tree/master/addons/viewport)|\n|a11y|コンポーネントのアクセシビリティチェック|[@storybook/addon-a11y](https://github.com/storybookjs/storybook/tree/master/addons/a11y)|\n|backgrounds|ストーリーの背景色変更|[@storybook/addon-backgrounds](https://github.com/storybookjs/storybook/tree/master/addons/backgrounds)|\n\n上記のアドオンをインストール&Storyに追加\n\n```shell\n$ npm i -D @storybook/knobs @storybook/addon-actions @storybook/notes @storybook/viewport @storybook/addon-a11y @storybook/addon-backgrounds\n```\n\nインストールしたアドオンをimportします。\n\n```　.storybook/config.js\n// actionsとlinksはCLIによるインストール時に追加される。\n// linksについては省略\nimport '@storybook/addon-links/register'\nimport '@storybook/addon-knobs/register'\nimport '@storybook/addon-actions/register'\nimport '@storybook/addon-notes/register'\nimport '@storybook/addon-viewport/register'\nimport '@storybook/addon-a11y/register'\nimport '@storybook/addon-backgrounds/register'\n```\n\n## 2.1 knobs\n\npropsを設定したコンポーネントを用意します。\n\n```MyButton.vue\n<template>\n  <button :disabled=\"isDisabled\">\n    <slot></slot>\n  </button>\n</template>\n \n<script>\nexport default {\n  props: {\n    isDisabled: {\n      type: Boolean,\n      default: false\n    }\n  }\n}\n<\/script>\n```\n\nちなみにpropsだけでなく、slotの値の挿入などもOKです。\n\n```MyButton.story.js\nimport { withKnobs, text, boolean } from '@storybook/addon-knobs';\nimport MyButton from '@/components/MyButton.vue';\n \nexport default {\n  title: 'Storybook Knobs',\n  decorators: [ withKnobs ]\n}\n\nexport const Button = () => ({\n  components: { MyButton },\n  props: {\n    isDisabled: {\n      // default: 与えるデータの型('ラベル', 初期値)\n      default: boolean('Disabled', false)\n    },\n    text: {\n      default: text('Text', 'Hello Storybook')\n    }\n  },\n  template: `<MyButton :isDisabled=\"isDisabled\">{{ text }}</MyButton>`\n})\n```\n\n## 2.2 actions\n\n下記のようなカスタムイベントを設定したコンポーネントを準備します。\n\n```MyButton.vue\n<template>\n  <button @click=\"sampleEvent\">ボタン</button>\n</template>\n\n<script>\nexport default {\n  methods: {\n    sampleEvent (e) {\n      this.$emit('clicked', e)\n    }\n  }\n}\n<\/script>\n```\n\n上記を`actions`を使用して表示するストーリーは以下。\n\n```MyButton.stories.js\nimport { action } from '@storybook/addon-actions'\nimport MyButton from '@/components/MyButton.vue';\n\nexport default {\n  title: 'Storybook Actions',\n}\n\nexport const PostBtn = () => ({\n  components: { Button },\n  // カスタムイベントが発火すると、以下のactionが実行されます。\n  methods: {\n    log: action('Post!')\n  },\n  template: `<ButtonPost @clicked=\"log\" />`\n})\n```\nactionが実行された様子\n![スクリーンショット 2019-11-26 19.55.42.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/42337/de90f6ff-2f89-a1ac-fe7e-c4a48c6bb834.png)\n\n\n## 2.3 notes\n\n`parameters`にテキストなり、マークダウンファイルを指定すればOKです。\n\n```sample.stories.js\nimport markdownNotes from './someMarkdownText.md';\n\nexport default {\n  title: 'Storybook Notes',\n  // テキストの場合\n  parameters: { notes: 'Some Notes' },\n  // マークダウンファイルの場合\n  parameters: { notes: { markdown: markdownNotes } }\n}\n\n__(省略)__\n```\n\n## 2.4 viewport\nStorybook全体に適用する場合は、`.storybook/config.js`に設定を追記します。\n公式ドキュメントの例に沿って、Kindle端末の画面サイズを追加します。\n\n```　.storybook/config.js\nimport { addParameters } from '@storybook/vue';\n// viewportが初期設定しているデバイスのパラメータリストを読み込む\nimport { INITIAL_VIEWPORTS } from '@storybook/addon-viewport';\n\n// Kindleのパラメータを設定\nconst newViewports = {\n  kindleFire2: {\n    name: 'Kindle Fire 2',\n    styles: {\n      width: '600px',\n      height: '963px'\n    }\n  },\n  kindleFireHD: {\n    name: 'Kindle Fire HD',\n    styles: {\n      width: '533px',\n      height: '801px'\n    }\n  }\n}\n\n// 初期パラメータと上記で設定したパラメータオブジェクトを追加\n// ...INITIAL_VIEWPORTS,を再度追加しているのは表示順を\n// INITIAL_VIEWPORTS > newViewportsにするため\naddParameters({\n  viewport: {\n    viewports: {\n      ...INITIAL_VIEWPORTS,\n      ...newViewports,\n    }\n  }\n})\n\n// 上記の設定はconfigure(require.context~より前に記載すること\nconfigure(require.context('../stories/', true, /\\.stories\\.js$/), module)\n```\n\n## 2.5 a11y\nチェックしたいコンポーネントに読み込み、`decolators`に追加すればOK\n\n```sample.stories.js\nimport { withA11y } from '@storybook/addon-a11y'\n\nexport default {\n  title: 'Sample',\n  decorators: [ withA11y ]\n}\n\n__(省略)__\n```\n\n## 2.6 backgrounds\n\n全体に適用する場合は`config.js`に記述追加\n\n```　.storybook/config.js\nimport { addParameters } from '@storybook/vue'\n\naddParameters({\n  backgrounds: [\n    { name: 'Sample BG 1', value: '#CCCCCC', default: true },\n    { name: 'Sample BG 2', value: '#000000' },\n  ],\n});\n\n// 上記の設定はconfigure(require.context~より前に記載すること\nconfigure(require.context('../stories/', true, /\\.stories\\.js$/), module)\n```\n\n---\n\n以上、私もまだ深いところまで触っていない&導入したばかりで間違い等あるかもしれませんが、基本的なところは抑えられているかと思います:pushpin:\n",coediting:a,comments_count:0,created_at:"2019-11-26T22:34:40+09:00",group:s,id:"887d9dc40facaa43eed7",likes_count:2,private:a,reactions_count:0,tags:[{name:c,versions:[]},{name:e,versions:[]},{name:"storybook",versions:[]}],title:"【Nuxt.js / Storybook】インストールとaddonの導入まで(StoriesOf APIではなく最新ver推奨のCSF記法で)",updated_at:"2019-11-26T23:04:56+09:00",url:"https://qiita.com/kamicop/items/887d9dc40facaa43eed7",user:{description:s,facebook_id:s,followees_count:5,followers_count:2,github_login_name:s,id:"kamicop",items_count:2,linkedin_id:s,location:s,name:n,organization:s,permanent_id:42337,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/42337/profile-images/1555933247",team_only:a,twitter_screen_name:s,website_url:s},page_views_count:s},{rendered_body:'<p>この記事では<code>"&lt;template&gt;&lt;MyComponent /&gt;&lt;/template&gt;"</code>のような文字列データを、Vueコンポーネントを正しく解釈した上で画面上に描画してSSRすることを目指します。</p>\n\n<p>これを実現したい主要なモチベーションとしては、ブログ投稿を管理するシステムを構築するシーン等を想定してもらうとわかりやすいかもしれません。「 <strong>ブログの投稿をVueの文法で書きたい</strong> 」かつ「 <strong>投稿は検索エンジンにインデックスされてほしい</strong> 」ようなケースをこの記事では想定しています。</p>\n\n<h2>\n<span id="html文字列をvueのテンプレートとして描画する" class="fragment"></span><a href="#html%E6%96%87%E5%AD%97%E5%88%97%E3%82%92vue%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%A8%E3%81%97%E3%81%A6%E6%8F%8F%E7%94%BB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>HTML文字列をVueのテンプレートとして描画する</h2>\n\n<p>HTMLを記述した文字列オブジェクトをそのまま描画するだけであれば<code>v-html</code>で実現することができます。しかし、ここではHTML文字列中に<code>&lt;MyComponent&gt;</code>が含まれていることが問題です。これをそのままDOMに挿入しても、当然ブラウザが正しく解釈することはできません。</p>\n\n<p>ここでは、以下のような単純なブログページを作るものとします。  </p>\n\n<div class="code-frame" data-lang="html">\n<div class="code-lang"><span class="bold">pages/blog/index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;header&gt;&lt;/header&gt;</span>\n  <span class="nt">&lt;main&gt;</span>\n    <span class="c">&lt;!-- \n    ここに\n    "&lt;article&gt;\n      &lt;MyComponent /&gt;\n    &lt;/article&gt;"\n    みたいな文字列を挟んで、正しくレンダリングしてほしい\n    --&gt;</span>\n  <span class="nt">&lt;/main&gt;</span>\n  <span class="nt">&lt;footer&gt;&lt;/footer&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n</pre></div>\n</div>\n\n<p>この問題に関しては自前で<code>render</code>をゴリゴリ書いてもよいですが、<code>v-runtime-template</code>というライブラリが広く使われているので、これを用いることで解決できます。</p>\n\n<ul>\n<li><a href="https://github.com/alexjoverm/v-runtime-template" rel="nofollow noopener" target="_blank">v-runtime-template</a></li>\n</ul>\n\n<p>(導入方法等の詳細はREADMEに記載があるので省略します)</p>\n\n<p><code>v-runtime-template</code>を用いて文字列からコンポーネントを描画する例は以下の通りです。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/blog/index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;header&gt;&lt;/header&gt;</span>\n  <span class="nt">&lt;main&gt;</span>\n    <span class="nt">&lt;v-runtime-template</span> <span class="na">:template=</span><span class="s">"template"</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;/main&gt;</span>\n  <span class="nt">&lt;footer&gt;&lt;/footer&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">VRuntimeTemplate</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">v-runtime-template</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">MyComponent</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/components/MyComponent.vue</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">VRuntimeTemplate</span><span class="p">,</span>\n    <span class="nx">MyComponent</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">template</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">&lt;article&gt;&lt;MyComponent /&gt;&lt;/article&gt;</span><span class="dl">\'</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>これで(一番単純な例ですが)文字列をVueのテンプレートとして解釈して正しく描画することができました。<br>\nここでは<code>template</code>へ値を直接代入していますが、実際には<code>asyncData</code>や<code>fetch</code>内でサーバー応答をバインドすることによって問題なくSSRできます。問題になるのは子コンポーネントである<code>MyComponent</code>の描画にサーバー上の情報などコンポーネントの外の情報を使う必要がある場合で、これを正しくSSRするにはもう少し考慮が必要になります。</p>\n\n<h2>\n<span id="v-runtime-templateで解決されるhtmlをssrする" class="fragment"></span><a href="#v-runtime-template%E3%81%A7%E8%A7%A3%E6%B1%BA%E3%81%95%E3%82%8C%E3%82%8Bhtml%E3%82%92ssr%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>v-runtime-templateで解決されるHTMLをSSRする</h2>\n\n<p>以下のように<code>MyComponent</code>が内部でサーバー呼び出しを行うようなケースではSSRされません。(Nuxtを使うプロジェクトではあまりこういう設計にならない気もしますが)</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">components/MyComponent.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="si">{{</span> <span class="nx">content</span> <span class="si">}}</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">MyComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">content</span> <span class="o">=</span> <span class="dl">\'\'</span>\n\n  <span class="k">async</span> <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/from/server</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>createdフックが動作するのはクライアントサイドですのでこの方針ではSSRは動作しません。サーバー側で処理が行われる(ページコンポーネントの)<code>asyncData</code>や<code>fetch</code>の中で値を設定する必要があります。</p>\n\n<h3>\n<span id="方針1-propsで渡す" class="fragment"></span><a href="#%E6%96%B9%E9%87%9D1-props%E3%81%A7%E6%B8%A1%E3%81%99"><i class="fa fa-link"></i></a>方針1: propsで渡す</h3>\n\n<p>ページコンポーネントの<code>asyncData</code>で取得した値を子コンポーネントのpropsに渡せばSSRが動作します。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">components/MyComponent.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">MyComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">()</span>\n  <span class="nx">content</span> <span class="o">=</span> <span class="dl">\'\'</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/blog/index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">VRuntimeTemplate</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">v-runtime-template</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">MyComponent</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/components/MyComponent.vue</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">VRuntimeTemplate</span><span class="p">,</span>\n    <span class="nx">MyComponent</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// templateの文字列の中にバインドを書く</span>\n    <span class="nx">template</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">&lt;article&gt;&lt;MyComponent :content="content" /&gt;&lt;/article&gt;</span><span class="dl">\'</span>\n    <span class="nx">content</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/from/server</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">template</span><span class="p">,</span>\n      <span class="nx">content</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>ただし、これではコンポーネントの引数体系に合わせてテンプレートの内容を書き換える必要があるため、テンプレートのメンテナンス性が高くありません。<br>\nまた、1階層の子コンポーネントであればこの程度ですが、ネストしたコンポーネントを考えるとpropsのバケツリレーが大変なことになりそうです。</p>\n\n<h3>\n<span id="方針2-ストアで渡す" class="fragment"></span><a href="#%E6%96%B9%E9%87%9D2-%E3%82%B9%E3%83%88%E3%82%A2%E3%81%A7%E6%B8%A1%E3%81%99"><i class="fa fa-link"></i></a>方針2: ストアで渡す</h3>\n\n<p>Vuexを使用可能な環境であればこの方針が一番管理しやすいと思います。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">components/MyComponent.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">MyComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">content</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/blog/index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">axios</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">VRuntimeTemplate</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">v-runtime-template</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">MyComponent</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/components/MyComponent.vue</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">VRuntimeTemplate</span><span class="p">,</span>\n    <span class="nx">MyComponent</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// ストアを使えばpropsをバインドする必要がない</span>\n    <span class="nx">template</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">&lt;article&gt;&lt;MyComponent /&gt;&lt;/article&gt;</span><span class="dl">\'</span>\n    <span class="nx">content</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/from/server</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">template</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>以上のようにしてHTMLのテンプレート文字列をVueのコンポーネントとして描画し、SSRを行う事ができました。</p>\n',body:"この記事では`\"<template><MyComponent /></template>\"`のような文字列データを、Vueコンポーネントを正しく解釈した上で画面上に描画してSSRすることを目指します。\n\nこれを実現したい主要なモチベーションとしては、ブログ投稿を管理するシステムを構築するシーン等を想定してもらうとわかりやすいかもしれません。「 **ブログの投稿をVueの文法で書きたい** 」かつ「 **投稿は検索エンジンにインデックスされてほしい** 」ようなケースをこの記事では想定しています。\n\n## HTML文字列をVueのテンプレートとして描画する\n\nHTMLを記述した文字列オブジェクトをそのまま描画するだけであれば`v-html`で実現することができます。しかし、ここではHTML文字列中に`<MyComponent>`が含まれていることが問題です。これをそのままDOMに挿入しても、当然ブラウザが正しく解釈することはできません。\n\nここでは、以下のような単純なブログページを作るものとします。  \n\n```html:pages/blog/index.vue\n<template>\n  <header></header>\n  <main>\n    \x3c!-- \n    ここに\n    \"<article>\n      <MyComponent />\n    </article>\"\n    みたいな文字列を挟んで、正しくレンダリングしてほしい\n    --\x3e\n  </main>\n  <footer></footer>\n</template>\n```\n\nこの問題に関しては自前で`render`をゴリゴリ書いてもよいですが、`v-runtime-template`というライブラリが広く使われているので、これを用いることで解決できます。\n\n- [v-runtime-template](https://github.com/alexjoverm/v-runtime-template)\n\n(導入方法等の詳細はREADMEに記載があるので省略します)\n\n`v-runtime-template`を用いて文字列からコンポーネントを描画する例は以下の通りです。\n\n```vue:pages/blog/index.vue\n<template>\n  <header></header>\n  <main>\n    <v-runtime-template :template=\"template\" />\n  </main>\n  <footer></footer>\n</template>\n\n<script lang=\"ts\">\nimport { Vue, Component } from 'nuxt-property-decorator'\nimport VRuntimeTemplate from 'v-runtime-template'\nimport MyComponent from '~/components/MyComponent.vue'\n\n@Component({\n  components: {\n    VRuntimeTemplate,\n    MyComponent\n  }\n})\nexport default class extends Vue {\n  template = '<article><MyComponent /></article>'\n}\n<\/script>\n```\n\nこれで(一番単純な例ですが)文字列をVueのテンプレートとして解釈して正しく描画することができました。\nここでは`template`へ値を直接代入していますが、実際には`asyncData`や`fetch`内でサーバー応答をバインドすることによって問題なくSSRできます。問題になるのは子コンポーネントである`MyComponent`の描画にサーバー上の情報などコンポーネントの外の情報を使う必要がある場合で、これを正しくSSRするにはもう少し考慮が必要になります。\n\n## v-runtime-templateで解決されるHTMLをSSRする\n\n以下のように`MyComponent`が内部でサーバー呼び出しを行うようなケースではSSRされません。(Nuxtを使うプロジェクトではあまりこういう設計にならない気もしますが)\n\n```vue:components/MyComponent.vue\n<template>\n  <div>\n    {{ content }}\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport axios from 'axios'\nimport { Vue, Component } from 'nuxt-property-decorator'\n\n@Component({})\nexport default class MyComponent extends Vue {\n  content = ''\n\n  async created() {\n    this.content = await axios.get('/from/server')\n  }\n}\n<\/script>\n```\n\ncreatedフックが動作するのはクライアントサイドですのでこの方針ではSSRは動作しません。サーバー側で処理が行われる(ページコンポーネントの)`asyncData`や`fetch`の中で値を設定する必要があります。\n\n### 方針1: propsで渡す\n\nページコンポーネントの`asyncData`で取得した値を子コンポーネントのpropsに渡せばSSRが動作します。\n\n```vue:components/MyComponent.vue\n<script lang=\"ts\">\nimport { Vue, Component, Prop } from 'nuxt-property-decorator'\n\n@Component({})\nexport default class MyComponent extends Vue {\n  @Prop()\n  content = ''\n}\n<\/script>\n```\n\n```vue:pages/blog/index.vue\n<script lang=\"ts\">\nimport axios from 'axios'\nimport { Vue, Component } from 'nuxt-property-decorator'\nimport VRuntimeTemplate from 'v-runtime-template'\nimport MyComponent from '~/components/MyComponent.vue'\n\n@Component({\n  components: {\n    VRuntimeTemplate,\n    MyComponent\n  }\n})\nexport default class extends Vue {\n  async asyncData() {\n    // templateの文字列の中にバインドを書く\n    template = '<article><MyComponent :content=\"content\" /></article>'\n    content = await axios.get('/from/server')\n    return {\n      template,\n      content\n    }\n  }\n}\n<\/script>\n```\n\nただし、これではコンポーネントの引数体系に合わせてテンプレートの内容を書き換える必要があるため、テンプレートのメンテナンス性が高くありません。\nまた、1階層の子コンポーネントであればこの程度ですが、ネストしたコンポーネントを考えるとpropsのバケツリレーが大変なことになりそうです。\n\n### 方針\b2: ストアで渡す\n\nVuexを使用可能な環境であればこの方針が一番管理しやすいと思います。\n\n```vue:components/MyComponent.vue\n<script lang=\"ts\">\nimport { Vue, Component } from 'nuxt-property-decorator'\n\n@Component({})\nexport default class MyComponent extends Vue {\n  content = this.$store.getters.content\n}\n<\/script>\n```\n\n```vue:pages/blog/index.vue\n<script lang=\"ts\">\nimport axios from 'axios'\nimport { Vue, Component } from 'nuxt-property-decorator'\nimport VRuntimeTemplate from 'v-runtime-template'\nimport MyComponent from '~/components/MyComponent.vue'\n\n@Component({\n  components: {\n    VRuntimeTemplate,\n    MyComponent\n  }\n})\nexport default class extends Vue {\n  async asyncData() {\n    // ストアを使えばpropsをバインドする必要がない\n    template = '<article><MyComponent /></article>'\n    content = await axios.get('/from/server')\n    this.$store.commit('content', content)\n    return {\n      template\n    }\n  }\n}\n<\/script>\n```\n\n以上のようにしてHTMLのテンプレート文字列をVueのコンポーネントとして描画し、SSRを行う事ができました。\n",coediting:a,comments_count:0,created_at:"2019-11-26T20:13:39+09:00",group:s,id:"32ea0ac5f88f158d3e4d",likes_count:1,private:a,reactions_count:0,tags:[{name:c,versions:[]},{name:"ssr",versions:[]},{name:e,versions:[]}],title:"Nuxt.jsで文字列からコンポーネントを描画してSSRする",updated_at:"2019-11-27T21:21:38+09:00",url:"https://qiita.com/d6ms/items/32ea0ac5f88f158d3e4d",user:{description:s,facebook_id:s,followees_count:0,followers_count:0,github_login_name:s,id:"d6ms",items_count:1,linkedin_id:s,location:s,name:n,organization:s,permanent_id:250481,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/250481/profile-images/1523771517",team_only:a,twitter_screen_name:s,website_url:s},page_views_count:s},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>この記事は、Nuxt.jsを使ってEtherumのブロックチェーン上で動くアプリを開発しようという人向けにはじめの一歩として書きました。EthereumはReactを使って実装する情報は多く存在するのですが、VueやNuxtでの情報はそれほど多くありません。最近使われることの多くなってきたNuxtでEthereumのアプリ開発を行いたいという人の助けになれば幸いです。</p>\n\n<h1>\n<span id="前提条件" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>前提条件</h1>\n\n<p>この記事では、説明の簡略化のために、以下の条件を満たしている環境を前提にしています。</p>\n\n<ul>\n<li>node 10以上がインストールされている(今回は10.16.3を使用)</li>\n<li>yarnがインストールされている</li>\n<li>GethやGanacheなどを使用し、ローカルでブロックチェーンが動いている状態\n\n<ul>\n<li>Geth : <a href="https://github.com/ethereum/go-ethereum/wiki/geth" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ethereum/go-ethereum/wiki/geth</a>\n</li>\n<li>Ganache : <a href="https://www.trufflesuite.com/ganache" class="autolink" rel="nofollow noopener" target="_blank">https://www.trufflesuite.com/ganache</a>\n</li>\n</ul>\n</li>\n</ul>\n\n<h1>\n<span id="nuxtのプロジェクトを作成する" class="fragment"></span><a href="#nuxt%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Nuxtのプロジェクトを作成する</h1>\n\n<p>まずは、nuxtのプロジェクトを作りましょう。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>yarn create nuxt-app nuxt-web3\n</pre></div></div>\n\n<p>プロジェクトの初期設定が始まりますが、今回は、細かい設定は全部[enter]連打で初期値で設定しても大丈夫です。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn create nuxt-app nuxt-web3\nyarn create v1.19.2\n[1/4] 🔍  Resolving packages...\n[2/4] 🚚  Fetching packages...\n[3/4] 🔗  Linking dependencies...\n[4/4] 🔨  Building fresh packages...\nsuccess Installed "create-nuxt-app@2.11.1" with binaries:\n      - create-nuxt-app\n\ncreate-nuxt-app v2.11.1\n✨  Generating Nuxt.js project in nuxt-web3\n? Project name nuxt-web3\n? Project description My best Nuxt.js project\n? Author name Aram Mine\n? Choose the package manager Yarn\n? Choose UI framework None\n? Choose custom server framework None (Recommended)\n? Choose Nuxt.js modules (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)\n? Choose linting tools (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)\n? Choose test framework None\n? Choose rendering mode Universal (SSR)\n? Choose development tools (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)\n\n🎉  Successfully created project nuxt-web3\n\n  To get started:\n\n    cd nuxt-web3\n    yarn dev\n\n  To build &amp; start for production:\n\n    cd nuxt-web3\n    yarn build\n    yarn start\n\n✨  Done in 173.50s.\n</pre></div></div>\n\n<p>出来上がったらすぐに動作確認してみましょう</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cd nuxt-web3\n$ yarn dev\n</pre></div></div>\n\n<p>localhost:3000にブラウザでアクセスして、nuxtの初期画面が表示される確認しましょう。</p>\n\n<h1>\n<span id="npmモジュールの追加" class="fragment"></span><a href="#npm%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>npmモジュールの追加</h1>\n\n<p>Ethereumのアプリを動かすのに必要なweb3.jsをpackge.jsonに追加します。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn add web3.js\n</pre></div></div>\n\n<h1>\n<span id="ブロックチェーンと接続する" class="fragment"></span><a href="#%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3%E3%81%A8%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ブロックチェーンと接続する</h1>\n\n<p>準備はここまでで、ここから本番のnuxtアプリをブロックチェーンにつないでいく行程に入ります。まずはweb3.jsを使って、ブロックチェーンと接続します。このとき、あらゆるページからブロックチェーンにアクセスすることが想定されるので、pluginとして登録し、appにインスタンスを追加する形式でつなぎ込んでいきます。</p>\n\n<h2>\n<span id="pluginを作る" class="fragment"></span><a href="#plugin%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>pluginを作る</h2>\n\n<p>まずは、ブロックチェーンと接続するpluginを作ります。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">~/plugins/web3.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">Web3</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">web3</span><span class="dl">"</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">inject</span><span class="p">)</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">httpEndpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://127.0.0.1:7545</span><span class="dl">"</span> <span class="c1">//ここを変えればいろんなチェーンに繋げられます</span>\n    <span class="kd">const</span> <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">(</span><span class="k">new</span> <span class="nx">Web3</span><span class="p">.</span><span class="nx">providers</span><span class="p">.</span><span class="nx">HttpProvider</span><span class="p">(</span><span class="nx">httpEndpoint</span><span class="p">))</span>\n\n    <span class="nx">inject</span><span class="p">(</span><span class="dl">\'</span><span class="s1">web3</span><span class="dl">\'</span><span class="p">,</span><span class="nx">web3</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>httpEndpoint に接続するブロックチェーンの情報を設定しているので、ここを書き換えればいろいろなチェーンにつなぐことができます。また、開発環境と本番環境で分けたいなどは、環境変数を使って出し分けると使いやすくなります。</p>\n\n<p>また、MetaMaskを使った実装をした経験がある人からすると、見慣れた実装と違い、さっぱりした印象に見えるかもしれません。これは接続するチェーンの指定をコード側で行っているからです。MetaMaskを使う場合は、MetaMaskが接続するチェーンを設定する機能を持ち、その接続設定を引き継いで動作させるために複雑な書き方になっています。もちろん、MetaMaskを使った接続方法をそのまま流用しても動きますのでご安心ください。</p>\n\n<h2>\n<span id="pluginをすべてのページで読み込まれるようにする" class="fragment"></span><a href="#plugin%E3%82%92%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%A7%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>pluginをすべてのページで読み込まれるようにする</h2>\n\n<p>次に、このpluginがすべてのページで自動的に読み込まれるように、nuxt.config.jsに設定を追加します。pluginsの設定に、1行追加して、さきほどのpluginが読み込まれるようにしましょう。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="p">...</span>\n<span class="nx">plugins</span><span class="p">:</span> <span class="p">[</span>\n    <span class="p">{</span> <span class="na">src</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">~/plugins/web3.js</span><span class="dl">\'</span> <span class="p">}</span> <span class="c1">//この行を追加してください。</span>\n  <span class="p">],</span>\n<span class="p">...</span>\n</pre></div>\n</div>\n\n<p>たったこの2つを設定するだけで、ブロックチェーンとの接続はできます。</p>\n\n<h1>\n<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h1>\n\n<p>実は、ここまでの実装だけでは動作確認をすることはできません。ブロックチェーンが止まっていたり、そのURLにブロックチェーンがなくても、エラーとならずに問題なく動作してしまいます。その理由は実際にブロックチェーン上の情報を取得するまで、ブロックチェーンと通信することがないためです。そこで、実際にブロックチェーンと通信を発生させるために、ブロックチェーン上の情報を見に行くコードを入れて動作確認してみましょう。</p>\n\n<p>ここでは単純に接続できていることの動作確認するだけなので、console.logでの簡易的な確認という形でお茶を濁しますが、今回の実装であればこれで十分だと思います。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">pages/index.vue</span></div>\n<div class="highlight"><pre><span class="p">...</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">Logo</span>\n  <span class="p">},</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">Current Block Number</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getBlockNumber</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="p">...</span>\n</pre></div>\n</div>\n\n<p>eth.getBlockNumber()はその時点のBlockHeight すなわち承認済みの最新のブロックの番号を返してくれるメソッドです。よってこの番号を取得するために実際にブロックチェーンへのアクセスが発生するため、ブロックチェーンと正しく接続されていないと、エラーが発生します。</p>\n\n<p>では、実際に動かしてみましょう。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>yarn dev\n</pre></div></div>\n\n<p>ブラウザのデバッグツールで、console.logを見てみましょう。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>Current Block Number\n516\n</pre></div></div>\n\n<p>などと表示されていればOKです。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>POST http://127.0.0.1:7545/ net::ERR_CONNECTION_REFUSED\nUncaught (in promise) Error: Invalid JSON RPC response: ""\n    at Object.InvalidResponse (errors.js?5f2e:42)\n    at XMLHttpRequest.request.onreadystatechange (index.js?8148:98)\n</pre></div></div>\n\n<p>などと表示された場合は、ブロックチェーンとうまく接続できていません。ブロックチェーンが止まっているかもしれないですし、またはアクセス周りの設定でlocalhost:3000からの参照を禁止しているかもしれません。チェーン側の設定を見直してみると良いでしょう。</p>\n\n<h1>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>\n\n<p>NuxtでEthereum、web3を使ったアプリケーション開発は比較的容易に始められます。Nuxtを使って、ブロックチェーンを活用したアプリを開発してみようと思う方が少しでも増えてくれれば幸いです。</p>\n\n<p>ソースコード：<a href="https://github.com/gaiax/nuxt-web3" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/gaiax/nuxt-web3</a></p>\n',body:'# はじめに\nこの記事は、Nuxt.jsを使ってEtherumのブロックチェーン上で動くアプリを開発しようという人向けにはじめの一歩として書きました。EthereumはReactを使って実装する情報は多く存在するのですが、VueやNuxtでの情報はそれほど多くありません。最近使われることの多くなってきたNuxtでEthereumのアプリ開発を行いたいという人の助けになれば幸いです。\n\n# 前提条件\nこの記事では、説明の簡略化のために、以下の条件を満たしている環境を前提にしています。\n\n- node 10以上がインストールされている(今回は10.16.3を使用)\n- yarnがインストールされている\n- GethやGanacheなどを使用し、ローカルでブロックチェーンが動いている状態\n  - Geth : https://github.com/ethereum/go-ethereum/wiki/geth\n  - Ganache : https://www.trufflesuite.com/ganache\n   \n# Nuxtのプロジェクトを作成する\n\nまずは、nuxtのプロジェクトを作りましょう。\n\n```shell\n$ yarn create nuxt-app nuxt-web3\n```\n\nプロジェクトの初期設定が始まりますが、今回は、細かい設定は全部[enter]連打で初期値で設定しても大丈夫です。\n\n```\n$ yarn create nuxt-app nuxt-web3\nyarn create v1.19.2\n[1/4] 🔍  Resolving packages...\n[2/4] 🚚  Fetching packages...\n[3/4] 🔗  Linking dependencies...\n[4/4] 🔨  Building fresh packages...\nsuccess Installed "create-nuxt-app@2.11.1" with binaries:\n      - create-nuxt-app\n\ncreate-nuxt-app v2.11.1\n✨  Generating Nuxt.js project in nuxt-web3\n? Project name nuxt-web3\n? Project description My best Nuxt.js project\n? Author name Aram Mine\n? Choose the package manager Yarn\n? Choose UI framework None\n? Choose custom server framework None (Recommended)\n? Choose Nuxt.js modules (Press <space> to select, <a> to toggle all, <i> to invert selection)\n? Choose linting tools (Press <space> to select, <a> to toggle all, <i> to invert selection)\n? Choose test framework None\n? Choose rendering mode Universal (SSR)\n? Choose development tools (Press <space> to select, <a> to toggle all, <i> to invert selection)\n\n🎉  Successfully created project nuxt-web3\n\n  To get started:\n\n\tcd nuxt-web3\n\tyarn dev\n\n  To build & start for production:\n\n\tcd nuxt-web3\n\tyarn build\n\tyarn start\n\n✨  Done in 173.50s.\n```\n出来上がったらすぐに動作確認してみましょう\n\n```\n$ cd nuxt-web3\n$ yarn dev\n```\n\nlocalhost:3000にブラウザでアクセスして、nuxtの初期画面が表示される確認しましょう。\n\n# npmモジュールの追加\n\nEthereumのアプリを動かすのに必要なweb3.jsをpackge.jsonに追加します。\n\n```\n$ yarn add web3.js\n```\n\n# ブロックチェーンと接続する\n\n準備はここまでで、ここから本番のnuxtアプリをブロックチェーンにつないでいく行程に入ります。まずはweb3.jsを使って、ブロックチェーンと接続します。このとき、あらゆるページからブロックチェーンにアクセスすることが想定されるので、pluginとして登録し、appにインスタンスを追加する形式でつなぎ込んでいきます。\n\n## pluginを作る\n\nまずは、ブロックチェーンと接続するpluginを作ります。\n\n```javascript:~/plugins/web3.js\nimport Web3 from "web3"\n\nexport default async function(context, inject) {\n    const httpEndpoint = "http://127.0.0.1:7545" //ここを変えればいろんなチェーンに繋げられます\n    const web3 = new Web3(new Web3.providers.HttpProvider(httpEndpoint))\n\n    inject(\'web3\',web3)\n}\n```\n\nhttpEndpoint に接続するブロックチェーンの情報を設定しているので、ここを書き換えればいろいろなチェーンにつなぐことができます。また、開発環境と本番環境で分けたいなどは、環境変数を使って出し分けると使いやすくなります。\n\nまた、MetaMaskを使った実装をした経験がある人からすると、見慣れた実装と違い、さっぱりした印象に見えるかもしれません。これは接続するチェーンの指定をコード側で行っているからです。MetaMaskを使う場合は、MetaMaskが接続するチェーンを設定する機能を持ち、その接続設定を引き継いで動作させるために複雑な書き方になっています。もちろん、MetaMaskを使った接続方法をそのまま流用しても動きますのでご安心ください。\n\n## pluginをすべてのページで読み込まれるようにする\n\n次に、このpluginがすべてのページで自動的に読み込まれるように、nuxt.config.jsに設定を追加します。pluginsの設定に、1行追加して、さきほどのpluginが読み込まれるようにしましょう。\n\n```javascript:nuxt.config.js\n...\nplugins: [\n    { src: \'~/plugins/web3.js\' } //この行を追加してください。\n  ],\n...\n```\n\nたったこの2つを設定するだけで、ブロックチェーンとの接続はできます。\n\n# 動作確認\n\n実は、ここまでの実装だけでは動作確認をすることはできません。ブロックチェーンが止まっていたり、そのURLにブロックチェーンがなくても、エラーとならずに問題なく動作してしまいます。その理由は実際にブロックチェーン上の情報を取得するまで、ブロックチェーンと通信することがないためです。そこで、実際にブロックチェーンと通信を発生させるために、ブロックチェーン上の情報を見に行くコードを入れて動作確認してみましょう。\n\nここでは単純に接続できていることの動作確認するだけなので、console.logでの簡易的な確認という形でお茶を濁しますが、今回の実装であればこれで十分だと思います。\n\n```javascript:pages/index.vue\n...\nexport default {\n  components: {\n    Logo\n  },\n  mounted() {\n    console.log(\'Current Block Number\')\n    this.$web3.eth.getBlockNumber().then(console.log)\n  }\n}\n...\n```\n\neth.getBlockNumber()はその時点のBlockHeight すなわち承認済みの最新のブロックの番号を返してくれるメソッドです。よってこの番号を取得するために実際にブロックチェーンへのアクセスが発生するため、ブロックチェーンと正しく接続されていないと、エラーが発生します。\n\nでは、実際に動かしてみましょう。\n\n```shell\n$ yarn dev\n```\n\nブラウザのデバッグツールで、console.logを見てみましょう。\n\n```\nCurrent Block Number\n516\n```\n\nなどと表示されていればOKです。\n\n```\nPOST http://127.0.0.1:7545/ net::ERR_CONNECTION_REFUSED\nUncaught (in promise) Error: Invalid JSON RPC response: ""\n    at Object.InvalidResponse (errors.js?5f2e:42)\n    at XMLHttpRequest.request.onreadystatechange (index.js?8148:98)\n```\n\nなどと表示された場合は、ブロックチェーンとうまく接続できていません。ブロックチェーンが止まっているかもしれないですし、またはアクセス周りの設定でlocalhost:3000からの参照を禁止しているかもしれません。チェーン側の設定を見直してみると良いでしょう。\n\n# まとめ\n\nNuxtでEthereum、web3を使ったアプリケーション開発は比較的容易に始められます。Nuxtを使って、ブロックチェーンを活用したアプリを開発してみようと思う方が少しでも増えてくれれば幸いです。\n\nソースコード：https://github.com/gaiax/nuxt-web3\n\n\n\n\n\n\n\n\n',coediting:a,comments_count:0,created_at:z,group:s,id:"93e35a27e6fb51a2f269",likes_count:3,private:a,reactions_count:0,tags:[{name:"Blockchain",versions:[]},{name:"Ethereum",versions:[]},{name:"ブロックチェーン",versions:[]},{name:"web3.js",versions:[]},{name:e,versions:[]}],title:"Nuxt.jsでEthereumアプリ開発 - pluginでチェーンと接続する",updated_at:z,url:"https://qiita.com/aramsan/items/93e35a27e6fb51a2f269",user:{description:s,facebook_id:s,followees_count:8,followers_count:o,github_login_name:s,id:J,items_count:6,linkedin_id:s,location:s,name:n,organization:s,permanent_id:28426,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/28426/profile-images/1473685193",team_only:a,twitter_screen_name:J,website_url:s},page_views_count:s},{rendered_body:'<p>heroku で環境変数がうまく通らなかったことがあったので自分用にメモ。</p>\n\n<h2>\n<span id="1-nuxtconfigに正しく-env-が設定されていますか" class="fragment"></span><a href="#1-nuxtconfig%E3%81%AB%E6%AD%A3%E3%81%97%E3%81%8F-env-%E3%81%8C%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>1. nuxt.configに正しく env が設定されていますか？</h2>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>  <span class="nx">env</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">API_KEY</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_KEY</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="nx">AUTH_DOMAIN</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">AUTH_DOMAIN</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="nx">DATABASE_URL</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_URL</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="nx">PROJECT_ID</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PROJECT_ID</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="nx">STORAGE_BUCKET</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">STORAGE_BUCKET</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="nx">MESSAGING_SENDER_ID</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MESSAGING_SENDER_ID</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="nx">APP_ID</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">APP_ID</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n  <span class="p">},</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="2-herokuに正しく環境変数が設定されていますか" class="fragment"></span><a href="#2-heroku%E3%81%AB%E6%AD%A3%E3%81%97%E3%81%8F%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%8C%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>2. herokuに正しく環境変数が設定されていますか？</h2>\n\n<p><a href="https://dashboard.heroku.com/apps/%7Bapp-name%7D/settings" class="autolink" rel="nofollow noopener" target="_blank">https://dashboard.heroku.com/apps/{app-name}/settings</a> で確認できます。<br>\nFirebaseの場合、valueは<code>\'abc\'</code>だと通らないかもです。<br>\n<code>abc</code>と言う書き方になっているかチェックしましょう。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F107167%2F2c0cb480-274d-0c11-655a-7096b8da3586.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=b23edb5024263e54bac93b5499b1ce51" target="_blank" rel="nofollow noopener"><img width="1118" alt="スクリーンショット 2019-11-26 12.57.15.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F107167%2F2c0cb480-274d-0c11-655a-7096b8da3586.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=b23edb5024263e54bac93b5499b1ce51" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/107167/2c0cb480-274d-0c11-655a-7096b8da3586.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F107167%2F2c0cb480-274d-0c11-655a-7096b8da3586.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=1de45ce9690a4b9e137c02c46d985838 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="3-herokuの環境変数を設定した後コンパイルし直しましたか" class="fragment"></span><a href="#3-heroku%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F%E5%BE%8C%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%97%E7%9B%B4%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F%E3%81%8B"><i class="fa fa-link"></i></a>3. herokuの環境変数を設定した後、コンパイルし直しましたか？</h2>\n\n<p>webpackなどを使っている場合、herokuで環境変数をセットした後、 <strong>コンパイルし直す</strong>必要があります。再起動ではダメみたいです。<br>\nプッシュせずにコンパイルする方法は<a href="https://stackoverflow.com/questions/9713183/recompile-heroku-slug-without-push-or-config-change" rel="nofollow noopener" target="_blank">いくつかある</a>ようですが一番簡単なのは空のコミットを作ってプッシュしちゃうのが良いでしょう。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>git commit --allow-empty -m "empty commit"\ngit push heroku master\n</pre></div></div>\n\n<hr>\n\n<p>もし何か間違いあれば教えてください。</p>\n',body:"heroku で環境変数がうまく通らなかったことがあったので自分用にメモ。\n##1. nuxt.configに正しく env が設定されていますか？\n\n```nuxt.config.js\n  env: {\n    API_KEY: process.env.API_KEY || '',\n    AUTH_DOMAIN: process.env.AUTH_DOMAIN || '',\n    DATABASE_URL: process.env.DATABASE_URL || '',\n    PROJECT_ID: process.env.PROJECT_ID || '',\n    STORAGE_BUCKET: process.env.STORAGE_BUCKET || '',\n    MESSAGING_SENDER_ID: process.env.MESSAGING_SENDER_ID || '',\n    APP_ID: process.env.APP_ID || '',\n  },\n```\n\n##2. herokuに正しく環境変数が設定されていますか？\nhttps://dashboard.heroku.com/apps/{app-name}/settings で確認できます。\nFirebaseの場合、valueは`'abc'`だと通らないかもです。\n`abc`と言う書き方になっているかチェックしましょう。\n\n<img width=\"1118\" alt=\"スクリーンショット 2019-11-26 12.57.15.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/107167/2c0cb480-274d-0c11-655a-7096b8da3586.png\">\n\n##3. herokuの環境変数を設定した後、コンパイルし直しましたか？\nwebpackなどを使っている場合、herokuで環境変数をセットした後、 **コンパイルし直す**必要があります。再起動ではダメみたいです。\nプッシュせずにコンパイルする方法は[いくつかある](https://stackoverflow.com/questions/9713183/recompile-heroku-slug-without-push-or-config-change)ようですが一番簡単なのは空のコミットを作ってプッシュしちゃうのが良いでしょう。\n\n```\ngit commit --allow-empty -m \"empty commit\"\ngit push heroku master\n```\n\n---\nもし何か間違いあれば教えてください。\n",coediting:a,comments_count:0,created_at:_,group:s,id:"6b48d95d7eb81f52909a",likes_count:1,private:a,reactions_count:0,tags:[{name:"Heroku",versions:[]},{name:u,versions:[]},{name:"環境変数",versions:[]},{name:".env",versions:[]},{name:e,versions:[]}],title:"Nuxt.js + Heroku で環境変数が通らない時の確認事項",updated_at:_,url:"https://qiita.com/lord_sasapple/items/6b48d95d7eb81f52909a",user:{description:"あっぷるささきです。\r\nエンジニアやったり学生やったりディベートやったりライターやったり放浪したりしてます。\r\n最近は自分でネットラジオのサービスを開発しています。",facebook_id:"lord.sasapple",followees_count:3,followers_count:2,github_login_name:"Steve-Sasaki",id:F,items_count:1,linkedin_id:n,location:n,name:"Masato SASAKI",organization:n,permanent_id:107167,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/107167/profile-images/1536615694",team_only:a,twitter_screen_name:F,website_url:"https://scrapbox.io/sasa-pedia/"},page_views_count:s},{rendered_body:'<p>iPadでspaで簡単なサイトを作って「ホームに画面に追加」をして疑似アプリケーション化して使っていたのですが、いつのまにか遷移すると「上部にバー」が出るようになってしまいました。「完了」を押すとバー自体は消えるのですが、せっかくの専用端末化が台無しです。ということで調査しました。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14768%2Fab66cd69-6d0f-38ff-b459-abcf6e41f299.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=31872d54c216c8253cdf2b4bdd845cd3" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14768%2Fab66cd69-6d0f-38ff-b459-abcf6e41f299.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=31872d54c216c8253cdf2b4bdd845cd3" alt="IMG_0002.jpg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/14768/ab66cd69-6d0f-38ff-b459-abcf6e41f299.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F14768%2Fab66cd69-6d0f-38ff-b459-abcf6e41f299.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=05c6283db296ccdfae2ee6b46485cf2b 1x" loading="lazy"></a><br>\n※縮めています＆ダークモードなので灰色。</p>\n\n<h1>\n<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h1>\n\n<ul>\n<li>iPadOS 13.1.3</li>\n</ul>\n\n<p>たぶん、どこかのバージョンで治る気がしますが...。</p>\n\n<h1>\n<span id="方法" class="fragment"></span><a href="#%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>方法</h1>\n\n<p>結論から書くとmanifestファイルを追加します。</p>\n\n<div class="code-frame" data-lang="html">\n<div class="code-lang"><span class="bold">index.html</span></div>\n<div class="highlight"><pre><span class="c">&lt;!-- タイトルバーを消す設定 --&gt;</span>\n<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"apple-mobile-web-app-capable"</span> <span class="na">content=</span><span class="s">"yes"</span><span class="nt">&gt;</span>\n<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"apple-mobile-web-app-status-bar-style"</span> <span class="na">content=</span><span class="s">"black"</span><span class="nt">&gt;</span>\n\n<span class="c">&lt;!-- 追加 --&gt;</span>\n<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"manifest"</span> <span class="na">href=</span><span class="s">"manifest.json"</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">manifest.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">  \n  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"サンプルアプリ"</span><span class="p">,</span><span class="w">  \n  </span><span class="nl">"short_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"サンプル"</span><span class="p">,</span><span class="w">  \n  </span><span class="nl">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"standalone"</span><span class="p">,</span><span class="w">  \n  </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">  \n  </span><span class="nl">"start_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="w">  \n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<h2>\n<span id="nuxtの場合" class="fragment"></span><a href="#nuxt%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>nuxtの場合</h2>\n\n<ul>\n<li>manifest.jsonをstaticに入れます</li>\n<li>nuxt.config.jsに以下を追加します。</li>\n</ul>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>  <span class="nx">head</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span>\n    <span class="nx">meta</span><span class="p">:</span> <span class="p">[</span>\n      <span class="p">...</span>\n      <span class="p">{</span> <span class="nl">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">apple-mobile-web-app-capable</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">content</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">yes</span><span class="dl">\'</span> <span class="p">},</span>  \n      <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">apple-mobile-web-app-status-bar-style</span><span class="dl">\'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">black-translucent</span><span class="dl">\'</span> <span class="p">}</span>\n      <span class="p">...</span>\n    <span class="p">]</span>\n    <span class="p">...</span>\n    <span class="nx">link</span><span class="p">:</span> <span class="p">[</span>\n      <span class="p">{</span> <span class="na">rel</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">manifest</span><span class="dl">\'</span><span class="p">,</span> <span class="na">href</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/manifest.json</span><span class="dl">\'</span><span class="p">},</span>\n    <span class="p">]</span>\n  <span class="p">}</span>\n  <span class="p">...</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="メモ" class="fragment"></span><a href="#%E3%83%A1%E3%83%A2"><i class="fa fa-link"></i></a>メモ</h1>\n\n<p>前はmanifest無くてもできていたと思うのですが...。ハマったのでメモしておきます。</p>\n',body:'iPadでspaで簡単なサイトを作って「ホームに画面に追加」をして疑似アプリケーション化して使っていたのですが、いつのまにか遷移すると「上部にバー」が出るようになってしまいました。「完了」を押すとバー自体は消えるのですが、せっかくの専用端末化が台無しです。ということで調査しました。\n\n![IMG_0002.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/14768/ab66cd69-6d0f-38ff-b459-abcf6e41f299.jpeg)\n※縮めています＆ダークモードなので灰色。\n\n\n# 環境\n- iPadOS 13.1.3\n\nたぶん、どこかのバージョンで治る気がしますが...。\n\n# 方法\n\n結論から書くとmanifestファイルを追加します。\n\n```index.html\n\x3c!-- タイトルバーを消す設定 --\x3e\n<meta name="apple-mobile-web-app-capable" content="yes">\n<meta name="apple-mobile-web-app-status-bar-style" content="black">\n\n\x3c!-- 追加 --\x3e\n<link rel="manifest" href="manifest.json">\n```\n\n```manifest.json\n{  \n  "name": "サンプルアプリ",  \n  "short_name": "サンプル",  \n  "display": "standalone",  \n  "scope": "/",  \n  "start_url": "/"  \n}\n```\n\n## nuxtの場合\n\n- manifest.jsonをstaticに入れます\n- nuxt.config.jsに以下を追加します。\n\n```nuxt.config.js\n  head: {\n    ...\n    meta: [\n      ...\n      { name: \'apple-mobile-web-app-capable\', content: \'yes\' },  \n      { name: \'apple-mobile-web-app-status-bar-style\', content: \'black-translucent\' }\n      ...\n    ]\n    ...\n    link: [\n      { rel: \'manifest\', href: \'/manifest.json\'},\n    ]\n  }\n  ...\n```\n\n# メモ\n\n前はmanifest無くてもできていたと思うのですが...。ハマったのでメモしておきます。\n\n\n\n\n\n\n\n\n',coediting:a,comments_count:0,created_at:"2019-11-26T11:24:00+09:00",group:s,id:"f20ce01d6aa9b1751b91",likes_count:2,private:a,reactions_count:0,tags:[{name:"iOS",versions:[]},{name:e,versions:[]},{name:"iPadOS",versions:[]}],title:"ホーム画面に追加したspaサイトで遷移すると上部にバーが出るのを消す",updated_at:"2019-11-26T13:07:04+09:00",url:"https://qiita.com/bellx2/items/f20ce01d6aa9b1751b91",user:{description:"ソフトウェアで世の中をハッピーにしたい何でもやる系エンジニアです。",facebook_id:n,followees_count:5,followers_count:27,github_login_name:k,id:k,items_count:79,linkedin_id:n,location:"Tokyo, Japan",name:"Ryu Tanabe",organization:n,permanent_id:14768,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/14768/profile-images/1501652482",team_only:a,twitter_screen_name:k,website_url:"http://bellx2.hateblo.jp/"},page_views_count:s},{rendered_body:'\n<h2>\n<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>\n\n<p>Nuxt.jsは今最も<strong>イケてるゥ!最高にCoooooool</strong>なWEB開発フレームワークです。巷でNuxt.jsについての記事も増えていますね。<br>\nしかし、ネット上のNuxt.jsの記事では、Nuxt.jsを始める上で前提となる前提知識の存在が省略されているように思います。Nuxt.jsはVue.jsの発展形(=Nuxt.jsを触る人はVue.jsの経験があるという前提）なので当然と言えば当然なのですが。</p>\n\n<p>本記事では、<strong>これからWEB開発者を目指す人</strong>を対象に、<br>\n<strong>・Nuxt.jsを習得するには何が必要か？</strong> <br>\n<strong>・そのための勉強方法</strong> <br>\nを紹介します。</p>\n\n<h2>\n<span id="自己紹介" class="fragment"></span><a href="#%E8%87%AA%E5%B7%B1%E7%B4%B9%E4%BB%8B"><i class="fa fa-link"></i></a>自己紹介</h2>\n\n<p>Nuxt.jsとFirebaseを用いたWEBアプリ開発を担当することになりました。<br>\nPythonはある程度触ってきたものの（機械学習やスクレイピング等）、WEB開発は全くの未経験。Progateや入門書を触って、簡単なWEBサイトを公開した経験がある程度でした。</p>\n\n<h2>\n<span id="失敗談とりあえずnuxtアプリを作ってみたけど" class="fragment"></span><a href="#%E5%A4%B1%E6%95%97%E8%AB%87%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9Anuxt%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%81%91%E3%81%A9"><i class="fa fa-link"></i></a>失敗談「とりあえずNuxtアプリを作ってみたけど・・・・・・・?」</h2>\n\n<p>さて、Nuxt.jsは<a href="https://ja.nuxtjs.org/" rel="nofollow noopener" target="_blank">公式ドキュメント</a>の内容が充実しており、"分かりやすい"です。<br>\nしかも驚くべきことに日本語に翻訳されています。</p>\n\n<p>例えば、npxさえ事前にインストールされていれば下記の簡単なコマンドで簡単にプロジェクト(※)を始めることができます。<br>\n(※厳密には違うのですが、初心者の方は「プロジェクトを作る=アプリを作る」と読みかえてください)<br>\n<a href="https://ja.nuxtjs.org/guide/installation" rel="nofollow noopener" target="_blank">Nuxt.js - ユニバーサル Vue.js アプリケーション/インストール</a></p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>\n//任意のディレクトリで下記を実行すると、&lt;project-name&gt;という名前のプロジェクトが作成されます\n$ npx create-nuxt-app &lt;project-name&gt;\n\n//サーバーを立ち上げます。http://localhost:3000で確認できます\n$ npm run dev\n</pre></div></div>\n\n<p>また、Nuxt.jsとFirebaseを組み合わせることも簡単です。<br>\n私は下記記事を参考にユーザー認証を実装しました。<br>\n<a href="https://qiita.com/redshoga/items/da5c0e247e0df314a257#%E6%A6%82%E8%A6%81" id="reference-24cee34089309f6ebba0">『FirebaseとNuxt.jsを使ってユーザ認証関係を簡単に作ってみる+1ヶ月前の自分に教えたいリンク集</a><br>\nあとはTwitterでログインできる簡単なチャットなんかも作りましたね。</p>\n\n<p>ここまでで、カタチがあり動くものを何となく作れました。</p>\n\n<p>しかし、<strong>WEBエンジニアとして自分が殆ど成長していないことに気付きます。</strong>なぜなら、Nuxt.jsの中身を理解できているわけではないから。<strong>「このままだとググってコピペすることしかできないし、永遠にWEBエンジニアとして自立できない」</strong>と危機感を募らせました。</p>\n\n<h2>\n<span id="nuxtjsに飛びつく前にまず基本をちゃんと押さえよう" class="fragment"></span><a href="#nuxtjs%E3%81%AB%E9%A3%9B%E3%81%B3%E3%81%A4%E3%81%8F%E5%89%8D%E3%81%AB%E3%81%BE%E3%81%9A%E5%9F%BA%E6%9C%AC%E3%82%92%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E6%8A%BC%E3%81%95%E3%81%88%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>Nuxt.jsに飛びつく前にまず基本をちゃんと押さえよう</h2>\n\n<p><strong>「Nuxt.jsは公式ドキュメントが充実していて分かりやすい」とよく言われていますが、正直当初はさっぱり分かりませんでした。</strong><br>\nええ、Nuxt.jsのドキュメントはとても優良なドキュメントです。<br>\nしかし但書をつけると、「<strong>(Vue.jsの経験がある人には）</strong>Nuxt.jsは公式ドキュメントが充実していて分かりやすい」んですね。<strong>なぜなら、Nuxt.jsはVue.jsを発展させて、その弱点を補ったものだからです。</strong></p>\n\n<p>なので、<strong>Nuxt.jsに飛びつく前にまず基本をきちんと押さえましょう。</strong>（自戒を込めて）</p>\n\n<h2>\n<span id="nuxtjsを習得するために必要な技術" class="fragment"></span><a href="#nuxtjs%E3%82%92%E7%BF%92%E5%BE%97%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E6%8A%80%E8%A1%93"><i class="fa fa-link"></i></a>Nuxt.jsを習得するために必要な技術</h2>\n\n<p>さて、いよいよ本題です。WEB開発未経験者がNuxt.jsを習得するために必要な要素を列挙します。</p>\n\n<p><strong>Vue.js</strong><br>\n「コンポーネントとは？」「テンプレートとは？」等、基本を抑えていますか？ ごく簡単なもので良いので、フルスクラッチ※（後述）で一つ一つのファイルやコードの意味をきちんと理解しながらアプリを作ってみると良いです。<br>\n<strong>JavaScript ES6</strong><br>\nProgateレベルだと少し物足りないです。特にアロー関数は頻繁に使いますね。<strong>おすすめは「MDN web docs」を読むことです。</strong><br>\n<strong>JSON</strong><br>\n超大事です!エンジニアにとって当たり前の知識ですが、何となくで済ませてきた人も多いのではないでしょうか。この機会にしっかりと理解しましょう。<strong>おすすめは「MDN web docs」を読むことです。</strong><br>\n<strong>HTML</strong><br>\nやはりProgateレベルだと少し物足りないです。<strong>おすすめは「MDN web docs」を読むことです。</strong><br>\n<strong>CSS</strong><br>\nCSSはProgateで十分ですね。<br>\n<strong>WEB開発の基本知識</strong><br>\nコードを書くのと直接は関係ないですが、きちんと理解しておくと学習が捗ります。<strong>おすすめは「MDN web docs」を(略）</strong></p>\n\n<p>「こんなにやってられないよ」と思う方。安心してください！<br>\nそれぞれのおすすめの教材もきちんとご紹介します。<br>\n目標(=Nuxt.jsを扱えるようになる）と目標に向けて自分に必要なカリキュラムが明確に分かっていれば、短期間で効率的に学習することができます。具体的には合わせて2週間程度で、無理なくNuxt.jsを習得するための準備学習を完了できます。</p>\n\n<h2>\n<span id="おすすめの学習教材方法" class="fragment"></span><a href="#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%AE%E5%AD%A6%E7%BF%92%E6%95%99%E6%9D%90%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>おすすめの学習教材・方法</h2>\n\n<p>「Vue.jsは未経験だがES6は分かる」「正直HTMLも怪しい・・・」とレベル感に差があると思うので、三つのペルソナに分けました。ご自身のレベルに応じて参考になさってください。</p>\n\n<h4>\n<span id="vuejsの経験がある基本がわかる人向け" class="fragment"></span><a href="#vuejs%E3%81%AE%E7%B5%8C%E9%A8%93%E3%81%8C%E3%81%82%E3%82%8B%E5%9F%BA%E6%9C%AC%E3%81%8C%E3%82%8F%E3%81%8B%E3%82%8B%E4%BA%BA%E5%90%91%E3%81%91"><i class="fa fa-link"></i></a>「Vue.jsの経験がある、基本がわかる」人向け</h4>\n\n<p>公式ドキュメントや<a href="//af.moshimo.com/af/c/click?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637&amp;url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15653299%2F%3Fl-id%3Dsearch-c-item-text-02" rel="nofollow noopener" target="_blank">『Nuxt.jsビギナーズガイド Vue.jsベースのフレームワークによるシングルページアプリケーション』</a><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" width="1" height="1" data-canonical-src="//i.moshimo.com/af/i/impression?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=21ee3e82b5df1dffb931d33d9f9e200e 1x" loading="lazy"></a>がおすすめです。</p>\n\n<h4>\n<span id="vuejs未経験vueだけ分からない人向け" class="fragment"></span><a href="#vuejs%E6%9C%AA%E7%B5%8C%E9%A8%93vue%E3%81%A0%E3%81%91%E5%88%86%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E4%BA%BA%E5%90%91%E3%81%91"><i class="fa fa-link"></i></a>「Vue.js未経験、Vueだけ分からない」人向け</h4>\n\n<p><a href="//af.moshimo.com/af/c/click?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637&amp;url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15780752%2F%3Fl-id%3Dsearch-c-item-text-04" rel="nofollow noopener" target="_blank">『Vue.js&amp;Nuxt.js超入門』</a><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" width="1" height="1" data-canonical-src="//i.moshimo.com/af/i/impression?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=21ee3e82b5df1dffb931d33d9f9e200e 1x" loading="lazy"></a><br>\n正直、時間がない方は<strong>これ一冊でも良い</strong>かもしれません。<br>\nNuxt.jsを習得するためのVue.jsやJavaScriptを網羅しています。<br>\n特に素晴らしいのですが、<strong>フルスクラッチで（=一枚のHTMLファイルから手作業で）Vue.jsのアプリを作っていくので、Vue.jsの構造やファイルの中身を一つ一つきちんと理解できます。</strong><br>\n僕は本書がきっかけで急に理解が深まりました（掌田さんの本は片っ端から揃えようと思います）。</p>\n\n<h4>\n<span id="progateは終わったけど正直web開発の基本も自信ないjsonって何人向け" class="fragment"></span><a href="#progate%E3%81%AF%E7%B5%82%E3%82%8F%E3%81%A3%E3%81%9F%E3%81%91%E3%81%A9%E6%AD%A3%E7%9B%B4web%E9%96%8B%E7%99%BA%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%82%82%E8%87%AA%E4%BF%A1%E3%81%AA%E3%81%84json%E3%81%A3%E3%81%A6%E4%BD%95%E4%BA%BA%E5%90%91%E3%81%91"><i class="fa fa-link"></i></a>「Progateは終わったけど・・・」「正直WEB開発の基本も自信ない」「JSONって何？」人向け</h4>\n\n<p><strong>「MDN web docs」を読みましょう！</strong><br>\n「MDN web docs」はGoogleやMicroSoft等、世界のトップレベルの人たちが中心に作成しているサイトです。<strong>つまり情報の信頼性がこの上なく高いので、正確で丁寧な理解ができます。</strong>「でも難しいんでしょ？」と思われた方、そんなことはありません。むしろ、<strong>文章量が紙幅に制限されないので懇切丁寧に解説が記述されており、とても分かりやすいです。しかも完全無料。（ほぼ）日本語対応。</strong>あらゆる点で書籍や大学の情報系の講義より遥かに優れた教材です。<br>\n何と<a href="https://developer.mozilla.org/ja/docs/Learn/Getting_started_with_the_web" rel="nofollow noopener" target="_blank">WEB入門</a>や<a href="https://developer.mozilla.org/ja/docs/Learn/JavaScript/First_steps" rel="nofollow noopener" target="_blank">JavaScriptの第一歩</a>などの体系的なカリキュラムまで備えています。</p>\n\n<p>ただ、プログラミングの知識が全くのゼロの状態で読むと少し辛いと思うので、プログラミング初心者の方はまず<a href="https://prog-8.com/" rel="nofollow noopener" target="_blank">Progate</a>から始めるのが良いでしょう。</p>\n\n<h2>\n<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>\n\n<p>さあ、これで貴方もNuxt.js公式ドキュメントが「分かりやすい」と感じられるようになります。<br>\n自分のレベルに合わせて、無理なく学習を進めてください。<br>\n良いエンジニアライフを〜</p>\n\n<h2>\n<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h2>\n\n<p><a href="https://ja.nuxtjs.org/" rel="nofollow noopener" target="_blank">Nuxt.js 公式ドキュメント</a><br>\n<a href="https://developer.mozilla.org/ja/" rel="nofollow noopener" target="_blank">MDN web docs</a><br>\n<a href="//af.moshimo.com/af/c/click?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637&amp;url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15653299%2F%3Fl-id%3Dsearch-c-item-text-02" rel="nofollow noopener" target="_blank">『Nuxt.jsビギナーズガイド Vue.jsベースのフレームワークによるシングルページアプリケーション』</a><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" width="1" height="1" data-canonical-src="//i.moshimo.com/af/i/impression?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=21ee3e82b5df1dffb931d33d9f9e200e 1x" loading="lazy"></a><br>\n<a href="//af.moshimo.com/af/c/click?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637&amp;url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15780752%2F%3Fl-id%3Dsearch-c-item-text-04" rel="nofollow noopener" target="_blank">『Vue.js&amp;Nuxt.js超入門』</a><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f783a516366bc32016929332fdedd15b" width="1" height="1" data-canonical-src="//i.moshimo.com/af/i/impression?a_id=1675596&amp;p_id=56&amp;pc_id=56&amp;pl_id=637" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fi.moshimo.com%2Faf%2Fi%2Fimpression%3Fa_id%3D1675596%26p_id%3D56%26pc_id%3D56%26pl_id%3D637?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=21ee3e82b5df1dffb931d33d9f9e200e 1x" loading="lazy"></a></p>\n',body:'##概要\nNuxt.jsは今最も**イケてるゥ!最高にCoooooool**なWEB開発フレームワークです。巷でNuxt.jsについての記事も増えていますね。\nしかし、ネット上のNuxt.jsの記事では、Nuxt.jsを始める上で前提となる前提知識の存在が省略されているように思います。Nuxt.jsはVue.jsの発展形(=Nuxt.jsを触る人はVue.jsの経験があるという前提）なので当然と言えば当然なのですが。\n\n本記事では、**これからWEB開発者を目指す人**を対象に、\n**・Nuxt.jsを習得するには何が必要か？** \n**・そのための勉強方法** \nを紹介します。\n\n##自己紹介\nNuxt.jsとFirebaseを用いたWEBアプリ開発を担当することになりました。\nPythonはある程度触ってきたものの（機械学習やスクレイピング等）、WEB開発は全くの未経験。Progateや入門書を触って、簡単なWEBサイトを公開した経験がある程度でした。\n\n##失敗談「とりあえずNuxtアプリを作ってみたけど・・・・・・・?」\nさて、Nuxt.jsは[公式ドキュメント](https://ja.nuxtjs.org/)の内容が充実しており、"分かりやすい"です。\nしかも驚くべきことに日本語に翻訳されています。\n\n例えば、npxさえ事前にインストールされていれば下記の簡単なコマンドで簡単にプロジェクト(※)を始めることができます。\n(※厳密には違うのですが、初心者の方は「プロジェクトを作る=アプリを作る」と読みかえてください)\n[Nuxt.js - ユニバーサル Vue.js アプリケーション/インストール](https://ja.nuxtjs.org/guide/installation)\n\n\n\n\n```\n\n//任意のディレクトリで下記を実行すると、<project-name>という名前のプロジェクトが作成されます\n$ npx create-nuxt-app <project-name>\n\n//サーバーを立ち上げます。http://localhost:3000で確認できます\n$ npm run dev\n```\n\nまた、Nuxt.jsとFirebaseを組み合わせることも簡単です。\n私は下記記事を参考にユーザー認証を実装しました。\n[『FirebaseとNuxt.jsを使ってユーザ認証関係を簡単に作ってみる+1ヶ月前の自分に教えたいリンク集](https://qiita.com/redshoga/items/da5c0e247e0df314a257#%E6%A6%82%E8%A6%81)\nあとはTwitterでログインできる簡単なチャットなんかも作りましたね。\n\nここまでで、カタチがあり動くものを何となく作れました。\n\nしかし、**WEBエンジニアとして自分が殆ど成長していないことに気付きます。**なぜなら、Nuxt.jsの中身を理解できているわけではないから。**「このままだとググってコピペすることしかできないし、永遠にWEBエンジニアとして自立できない」**と危機感を募らせました。\n\n##Nuxt.jsに飛びつく前にまず基本をちゃんと押さえよう\n**「Nuxt.jsは公式ドキュメントが充実していて分かりやすい」とよく言われていますが、正直当初はさっぱり分かりませんでした。**\nええ、Nuxt.jsのドキュメントはとても優良なドキュメントです。\nしかし但書をつけると、「**(Vue.jsの経験がある人には）**Nuxt.jsは公式ドキュメントが充実していて分かりやすい」んですね。**なぜなら、Nuxt.jsはVue.jsを発展させて、その弱点を補ったものだからです。**\n\nなので、**Nuxt.jsに飛びつく前にまず基本をきちんと押さえましょう。**（自戒を込めて）\n\n##Nuxt.jsを習得するために必要な技術\nさて、いよいよ本題です。WEB開発未経験者がNuxt.jsを習得するために必要な要素を列挙します。\n\n**Vue.js**\n「コンポーネントとは？」「テンプレートとは？」等、基本を抑えていますか？ ごく簡単なもので良いので、フルスクラッチ※（後述）で一つ一つのファイルやコードの意味をきちんと理解しながらアプリを作ってみると良いです。\n**JavaScript ES6**\nProgateレベルだと少し物足りないです。特にアロー関数は頻繁に使いますね。**おすすめは「MDN web docs」を読むことです。**\n**JSON**\n超大事です!エンジニアにとって当たり前の知識ですが、何となくで済ませてきた人も多いのではないでしょうか。この機会にしっかりと理解しましょう。**おすすめは「MDN web docs」を読むことです。**\n**HTML**\nやはりProgateレベルだと少し物足りないです。**おすすめは「MDN web docs」を読むことです。**\n**CSS**\nCSSはProgateで十分ですね。\n**WEB開発の基本知識**\nコードを書くのと直接は関係ないですが、きちんと理解しておくと学習が捗ります。**おすすめは「MDN web docs」を(略）**\n\n「こんなにやってられないよ」と思う方。安心してください！\nそれぞれのおすすめの教材もきちんとご紹介します。\n目標(=Nuxt.jsを扱えるようになる）と目標に向けて自分に必要なカリキュラムが明確に分かっていれば、短期間で効率的に学習することができます。具体的には合わせて2週間程度で、無理なくNuxt.jsを習得するための準備学習を完了できます。\n\n##おすすめの学習教材・方法\n「Vue.jsは未経験だがES6は分かる」「正直HTMLも怪しい・・・」とレベル感に差があると思うので、三つのペルソナに分けました。ご自身のレベルに応じて参考になさってください。\n\n\n####「Vue.jsの経験がある、基本がわかる」人向け\n公式ドキュメントや<a href="//af.moshimo.com/af/c/click?a_id=1675596&p_id=56&pc_id=56&pl_id=637&url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15653299%2F%3Fl-id%3Dsearch-c-item-text-02" rel="nofollow">『Nuxt.jsビギナーズガイド Vue.jsベースのフレームワークによるシングルページアプリケーション』</a><img src="//i.moshimo.com/af/i/impression?a_id=1675596&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;">がおすすめです。\n\n####「Vue.js未経験、Vueだけ分からない」人向け\n<a href="//af.moshimo.com/af/c/click?a_id=1675596&p_id=56&pc_id=56&pl_id=637&url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15780752%2F%3Fl-id%3Dsearch-c-item-text-04" rel="nofollow">『Vue.js&Nuxt.js超入門』</a><img src="//i.moshimo.com/af/i/impression?a_id=1675596&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;">\n正直、時間がない方は**これ一冊でも良い**かもしれません。\nNuxt.jsを習得するためのVue.jsやJavaScriptを網羅しています。\n特に素晴らしいのですが、**フルスクラッチで（=一枚のHTMLファイルから手作業で）Vue.jsのアプリを作っていくので、Vue.jsの構造やファイルの中身を一つ一つきちんと理解できます。**\n僕は本書がきっかけで急に理解が深まりました（掌田さんの本は片っ端から揃えようと思います）。\n\n####「Progateは終わったけど・・・」「正直WEB開発の基本も自信ない」「JSONって何？」人向け\n**「MDN web docs」を読みましょう！**\n「MDN web docs」はGoogleやMicroSoft等、世界のトップレベルの人たちが中心に作成しているサイトです。**つまり情報の信頼性がこの上なく高いので、正確で丁寧な理解ができます。**「でも難しいんでしょ？」と思われた方、そんなことはありません。むしろ、**文章量が紙幅に制限されないので懇切丁寧に解説が記述されており、とても分かりやすいです。しかも完全無料。（ほぼ）日本語対応。**あらゆる点で書籍や大学の情報系の講義より遥かに優れた教材です。\n何と[WEB入門](https://developer.mozilla.org/ja/docs/Learn/Getting_started_with_the_web)や[JavaScriptの第一歩](https://developer.mozilla.org/ja/docs/Learn/JavaScript/First_steps)などの体系的なカリキュラムまで備えています。\n\nただ、プログラミングの知識が全くのゼロの状態で読むと少し辛いと思うので、プログラミング初心者の方はまず[Progate](https://prog-8.com/)から始めるのが良いでしょう。\n\n##終わりに\nさあ、これで貴方もNuxt.js公式ドキュメントが「分かりやすい」と感じられるようになります。\n自分のレベルに合わせて、無理なく学習を進めてください。\n良いエンジニアライフを〜\n\n##参考文献\n[Nuxt.js 公式ドキュメント](https://ja.nuxtjs.org/)\n[MDN web docs](https://developer.mozilla.org/ja/)\n<a href="//af.moshimo.com/af/c/click?a_id=1675596&p_id=56&pc_id=56&pl_id=637&url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15653299%2F%3Fl-id%3Dsearch-c-item-text-02" rel="nofollow">『Nuxt.jsビギナーズガイド Vue.jsベースのフレームワークによるシングルページアプリケーション』</a><img src="//i.moshimo.com/af/i/impression?a_id=1675596&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;">\n<a href="//af.moshimo.com/af/c/click?a_id=1675596&p_id=56&pc_id=56&pl_id=637&url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15780752%2F%3Fl-id%3Dsearch-c-item-text-04" rel="nofollow">『Vue.js&Nuxt.js超入門』</a><img src="//i.moshimo.com/af/i/impression?a_id=1675596&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;">\n\n\n\n\n\n',coediting:a,comments_count:0,created_at:"2019-11-26T01:23:49+09:00",group:s,id:"763b0c228a8451c68865",likes_count:113,private:a,reactions_count:0,tags:[{name:"HTML",versions:[]},{name:h,versions:[]},{name:"es6",versions:[]},{name:c,versions:[]},{name:e,versions:[]}],title:"Nuxt.jsに飛びつく前に~Nuxt.jsを習得するための前提技術と、その勉強方法の紹介~",updated_at:"2019-11-26T19:31:17+09:00",url:"https://qiita.com/newt0/items/763b0c228a8451c68865",user:{description:"Nuxt.jsでWEB開発、Pythonで機械学習をしています。\r\nお仕事ください",facebook_id:n,followees_count:8,followers_count:1,github_login_name:s,id:C,items_count:5,linkedin_id:n,location:S,name:C,organization:"早稲田大学",permanent_id:438597,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/438597/a267d0fce2c6eeed3850277df5d103658f089ae3/x_large.png?1574760706",team_only:a,twitter_screen_name:"kyohei_ai",website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="背景" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF"><i class="fa fa-link"></i></a>背景</h1>\n\n<p>機能の内容は言えませんが、外部ＡＰＩを利用した既存の機能の簡易版のツールを作りたい。そういった依頼が舞い込んできました。<br>\nすでにその機能は提供されていますが、画面仕様のもと多くの項目の入力が必要で、客先でさくっと処理させるには不向きでした。<br>\nそのため、既存機能の登録機能のみを切り出してほしいとのことでした。<br>\n二つ返事で了承。<br>\n今後のことを考えフロントエンドは別プロジェクトにし、ＡＰＩは既存のものを利用。<br>\n外部のＡＰＩはフロントエンドでのスクリプト読み込み後のAjax送信とサーバーサイドでのポストの処理があり、特定のホスト名と特定のＩＰにしか対応してませんでした。<br>\nそれは困った。<br>\nということで、nuxtで静的サイトとしてgenerateしたものを既存のプロジェクトでホスティングさせてしまえば、ホスト名とＩＰの課題は解決するということでやり方を書いておきます。</p>\n\n<p>※ソースは抜粋しか載せられないのでその点はご理解ください。</p>\n\n<h1>\n<span id="流れ" class="fragment"></span><a href="#%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>流れ</h1>\n\n<ol>\n<li>nuxtでプロジェクトを作成しgenerateすることで静的サイトへ</li>\n<li>golangとechoでできた既存システムでgenerateした静的サイトをホスティング</li>\n<li>リリース方法を検討していい感じにリリースできるようにする。</li>\n</ol>\n\n<h1>\n<span id="nuxtでプロジェクトを作成しgenerateすることで静的サイトへ" class="fragment"></span><a href="#nuxt%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97generate%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%A7%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%81%B8"><i class="fa fa-link"></i></a>nuxtでプロジェクトを作成しgenerateすることで静的サイトへ</h1>\n\n<ul>\n<li>ソースを載せられないのでいい感じにご自身で実装してください。</li>\n</ul>\n\n<h2>\n<span id="静的サイトへgenerate" class="fragment"></span><a href="#%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%81%B8generate"><i class="fa fa-link"></i></a>静的サイトへgenerate</h2>\n\n<ul>\n<li>なんのこっちゃない。あまりやったことないがとりあえずlocalで</li>\n</ul>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>yarn generate\n</pre></div></div>\n\n<ul>\n<li>generate?めんどくさいのでpackage.jsonをいじって</li>\n</ul>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="nl">"gen"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt generate"</span><span class="err">,</span><span class="w">\n</span></pre></div>\n</div>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>yarn gen\n</pre></div></div>\n\n<ul>\n<li>distに静的なファイルが出力されました。\n静的なファイルっていうくらいなので、要はＨＴＭＬを生で書いたのと同じ状態ですよね？ということで、ブラウザでこのファイルを開く</li>\n<li>おや？スクリプト（画面のイベント）が発火してない？そんなことある？\nどうやらnuxt generateしても、ルート情報が正しくないと、生成されたスクリプトを読み込めないらしい。\nこの場合だと当然、/hoge/hoge/index.htmlでアクセスしてる。少し調べるとわかりますが、どうやらgithubpageやnetlifyやS3でホスティングしないと正常に動かないらしい。\nなるほど。</li>\n</ul>\n\n<p>じゃあ、当社で使っているbacklogで「ブラウザで直接開く」なるものがあるので、まずはそいつでホスティングさせてみましょう。</p>\n\n<ul>\n<li><p>backlog「ブラウザで直接開く」で開いても正しく動かない。<br>\nなるほど。ＵＲＬ見ればわかるが、これはＨＴＭＬをただブラウザで開いてるだけか。。。ホスティングサービスとは別物。。。<br>\ngitと名乗る以上極力githubに寄せてほしいところだが、できないものはできないのでどうしようもない。</p></li>\n<li><p>じゃあ、githubでpage作るか。<br>\nはい、そうです。金払わんとできない。金はない。やめる。</p></li>\n<li><p>じゃあ、いったんnetlifyで。<br>\nいける！どうやらホスティングさせてあげれば正しく動くみたい。ということが分かったので、nuxtはこんなところにしておく。</p></li>\n<li><p>ホスティングする際のエントリーポイントをルートに追加<br>\n<a href="http://hostname/nuxtproject%E3%81%A7%E5%8F%97%E3%81%91%E3%82%8B%E4%BA%88%E5%AE%9A%E3%81%AA%E3%81%AE%E3%81%A7%E3%80%81nuxt.config.js%E3%81%AB%E4%BB%A5%E4%B8%8B%E3%82%92%E8%BF%BD%E5%8A%A0" class="autolink" rel="nofollow noopener" target="_blank">http://hostname/nuxtprojectで受ける予定なので、nuxt.config.jsに以下を追加</a></p></li>\n</ul>\n\n<div class="code-frame" data-lang="js"><div class="highlight"><pre>  <span class="nx">router</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">base</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/nuxtproject</span><span class="dl">\'</span> \n  <span class="p">}</span>\n</pre></div></div>\n\n<h1>\n<span id="golangとechoでできた既存システムでgenerateした静的サイトをホスティング" class="fragment"></span><a href="#golang%E3%81%A8echo%E3%81%A7%E3%81%A7%E3%81%8D%E3%81%9F%E6%97%A2%E5%AD%98%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%A7generate%E3%81%97%E3%81%9F%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>golangとechoでできた既存システムでgenerateした静的サイトをホスティング</h1>\n\n<ul>\n<li>まずはgitから落としてプロジェクトへぶっこむ</li>\n</ul>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span class="nb">cd </span>echoproject\ngit clone &lt;nuxtprojectURL&gt;\n</pre></div></div>\n\n<p>echoのプロジェクト直下にぶっこむ。<br>\ndepやglideで入れたかったのですが、なかなかてこずってできなかったので、直接ぶっこむ。</p>\n\n<ul>\n<li>次にgenerateする</li>\n</ul>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span class="nb">cd </span>nuxtproject\nyarn gen\n</pre></div></div>\n\n<p>後で、distもリポジトリにぶっこむつくりにしますが、いったんはこんな感じでOK.</p>\n\n<ul>\n<li>ホスティングする</li>\n</ul>\n\n<p>非常に簡単。やっぱりFWって素晴らしい。</p>\n\n<div class="code-frame" data-lang="go"><div class="highlight"><pre><span class="n">e</span><span class="o">.</span><span class="n">Static</span><span class="p">(</span><span class="s">"/nuxtproject"</span><span class="p">,</span> <span class="s">"nuxtproject/dist"</span><span class="p">)</span>\n</pre></div></div>\n\n<ul>\n<li><a href="http://hostname/nuxtproject%E3%81%B8%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%81%8C%E6%9D%A5%E3%81%9F%E3%82%89nuxtproject%E7%9B%B4%E4%B8%8B%E3%81%AEdist%E3%81%AEindex.html%E3%82%92%E8%BF%94%E3%81%99%E3%81%A3%E3%81%A6%E3%81%84%E3%81%86%E6%84%8F%E5%91%B3%E3%80%82" class="autolink" rel="nofollow noopener" target="_blank">http://hostname/nuxtprojectへリクエストが来たらnuxtproject直下のdistのindex.htmlを返すっていう意味。</a></li>\n</ul>\n\n<p>これだけでOK。</p>\n\n<ul>\n<li>nuxtprojectを編集した際は毎回cloneしてgenerateする必要があるよ。</li>\n</ul>\n\n<h1>\n<span id="こっからいろいろ考える" class="fragment"></span><a href="#%E3%81%93%E3%81%A3%E3%81%8B%E3%82%89%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E8%80%83%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>こっからいろいろ考える。</h1>\n\n<ul>\n<li>パッケージ化しようとしたけど、うまくできなかったので、以下の流れで本番のモジュールに組み込む</li>\n</ul>\n\n<ol>\n<li>distをリポジトリ保存する。</li>\n<li>echoprojectのデプロイ時にcloneする。</li>\n<li>環境により変更すべき値を考慮する。</li>\n</ol>\n\n<h2>\n<span id="distをリポジトリ保存する" class="fragment"></span><a href="#dist%E3%82%92%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>distをリポジトリ保存する。</h2>\n\n<ul>\n<li><p>.gitignoreでdistを外し、yarn generateした後にpushする。<br>\nさすがに毎回手でやるのはだるい。本当ならビルド環境用意してそいつにやらせてあげればいいのだけれども、サーバー用意するのがめんどいうえ、金がない。<br>\nなのでローカルで必ずやるようにする。</p></li>\n<li><p>どうやらgitの機能にHookがあるらしい。<br>\nコミット前、プッシュ前様々なタイミングでフックができるらしいが、今回はコミットする前を選択。<br>\n.git/hooks/pre-commitにコマンド書いとけばいいらしい。</p></li>\n</ul>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="c">#!/bin/sh</span>\nyarn\nyarn gen\ngit add <span class="nb">.</span>\n\n<span class="nb">exit </span>0\n</pre></div></div>\n\n<ul>\n<li>インストールして静的なファイルを生成、できたファイルを管理対象にして終わり。pushは自分でやる\nこれで常にdistが最新される。</li>\n</ul>\n\n<h2>\n<span id="echoprojectのデプロイ時にcloneする" class="fragment"></span><a href="#echoproject%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E6%99%82%E3%81%ABclone%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>echoprojectのデプロイ時にcloneする。</h2>\n\n<p>本来ならここでビルドすればよいのだが、dokerのイメージにnuxtとnodeとnpmとyarnを入れるのは避けたかったので、クローンするだけ。その際今回のnuxtprojectはパブリックなリポジトリではないので、いじいじする。<br>\ngitはnetrcの認証情報をもとにリポジトリからとってくることができるらしい。じゃあ簡単だ。<br>\nechoprojectにechoproject_nutrcをまずは作ります。</p>\n\n<div class="code-frame" data-lang="echoproject_nutrc"><div class="highlight"><pre># 自分の情報を設定してね。\nmachine &lt;git_host&gt;\nlogin &lt;git_user_id&gt;\npassword &lt;git_user_pwd&gt;\n\n</pre></div></div>\n\n<p>これをdockerfileで ~/.netrcにしてやればOK</p>\n\n<div class="code-frame" data-lang="docker"><div class="highlight"><pre><span class="k">RUN </span><span class="nb">cp </span>echoproject_nutrc ~/.netrc\n</pre></div></div>\n\n<h1>\n<span id="環境により変更すべき値を考慮する" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E3%81%AB%E3%82%88%E3%82%8A%E5%A4%89%E6%9B%B4%E3%81%99%E3%81%B9%E3%81%8D%E5%80%A4%E3%82%92%E8%80%83%E6%85%AE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>環境により変更すべき値を考慮する。</h1>\n\n<p>当然開発環境と本番環境は分かれてまっせということ。<br>\nechoprojectではENVという環境変数で振り分けてますが、nuxtはどうしましょう。<br>\nよし、どちらもgenerateしてホスティングするdistの名称を変えればOKじゃね？ということでそのようにします。</p>\n\n<ol>\n<li><p>nuxt.config-dev.jsを作る</p></li>\n<li><p>nuxt.config-dev.jsでgenerateの際の出力フォルダを指定</p></li>\n</ol>\n\n<div class="code-frame" data-lang="js"><div class="highlight"><pre>  <span class="nx">generate</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">subFolders</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n    <span class="nx">dir</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">./dist_dev</span><span class="dl">\'</span>\n  <span class="p">},</span>\n</pre></div></div>\n\n<ol>\n<li>package.jsonに下記を追加</li>\n<li><div class="code-frame" data-lang="js"><div class="highlight"><pre><span class="dl">"</span><span class="s2">gen-dev</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">nuxt generate --config-file nuxt.config-dev.js</span><span class="dl">"</span><span class="p">,</span>\n</pre></div></div></li>\n<li><p>.git/hooks/pre-commitにyarn gen-devを追加</p></li>\n</ol>\n\n<p>これでdistとdist_devができるので後はechoprojectでdistをホスティングするのかdist_devをホスティングするの指定してあげればOK。</p>\n\n<p>非常にむりやりではありますが、今回はこのようにしましたとさ。</p>\n',body:'\n# 背景\n機能の内容は言えませんが、外部ＡＰＩを利用した既存の機能の簡易版のツールを作りたい。そういった依頼が舞い込んできました。\nすでにその機能は提供されていますが、画面仕様のもと多くの項目の入力が必要で、客先でさくっと処理させるには不向きでした。\nそのため、既存機能の登録機能のみを切り出してほしいとのことでした。\n二つ返事で了承。\n今後のことを考えフロントエンドは別プロジェクトにし、ＡＰＩは既存のものを利用。\n外部のＡＰＩはフロントエンドでのスクリプト読み込み後のAjax送信とサーバーサイドでのポストの処理があり、特定のホスト名と特定のＩＰにしか対応してませんでした。\nそれは困った。\nということで、nuxtで静的サイトとしてgenerateしたものを既存のプロジェクトでホスティングさせてしまえば、ホスト名とＩＰの課題は解決するということでやり方を書いておきます。\n\n※ソースは抜粋しか載せられないのでその点はご理解ください。\n\n# 流れ\n1. nuxtでプロジェクトを作成しgenerateすることで静的サイトへ\n2. golangとechoでできた既存システムでgenerateした静的サイトをホスティング\n3. リリース方法を検討していい感じにリリースできるようにする。\n\n\n# nuxtでプロジェクトを作成しgenerateすることで静的サイトへ\n- ソースを載せられないのでいい感じにご自身で実装してください。\n\n## 静的サイトへgenerate\n- なんのこっちゃない。あまりやったことないがとりあえずlocalで\n\n```\nyarn generate\n```\n\n- generate?めんどくさいのでpackage.jsonをいじって\n\n```package.json\n"gen": "nuxt generate",\n```\n\n```\nyarn gen\n```\n\n- distに静的なファイルが出力されました。\n静的なファイルっていうくらいなので、要はＨＴＭＬを生で書いたのと同じ状態ですよね？ということで、ブラウザでこのファイルを開く\n- おや？スクリプト（画面のイベント）が発火してない？そんなことある？\nどうやらnuxt generateしても、ルート情報が正しくないと、生成されたスクリプトを読み込めないらしい。\nこの場合だと当然、/hoge/hoge/index.htmlでアクセスしてる。少し調べるとわかりますが、どうやらgithubpageやnetlifyやS3でホスティングしないと正常に動かないらしい。\nなるほど。\n\nじゃあ、当社で使っているbacklogで「ブラウザで直接開く」なるものがあるので、まずはそいつでホスティングさせてみましょう。\n\n- backlog「ブラウザで直接開く」で開いても正しく動かない。\nなるほど。ＵＲＬ見ればわかるが、これはＨＴＭＬをただブラウザで開いてるだけか。。。ホスティングサービスとは別物。。。\ngitと名乗る以上極力githubに寄せてほしいところだが、できないものはできないのでどうしようもない。\n\n- じゃあ、githubでpage作るか。\nはい、そうです。金払わんとできない。金はない。やめる。\n\n- じゃあ、いったんnetlifyで。\nいける！どうやらホスティングさせてあげれば正しく動くみたい。ということが分かったので、nuxtはこんなところにしておく。\n\n\n- ホスティングする際のエントリーポイントをルートに追加\nhttp://hostname/nuxtprojectで受ける予定なので、nuxt.config.jsに以下を追加\n\n```js\n  router: {\n    base: \'/nuxtproject\' \n  }\n```\n\n\n# golangとechoでできた既存システムでgenerateした静的サイトをホスティング\n\n- まずはgitから落としてプロジェクトへぶっこむ\n\n```sh\ncd echoproject\ngit clone <nuxtprojectURL>\n```\nechoのプロジェクト直下にぶっこむ。\ndepやglideで入れたかったのですが、なかなかてこずってできなかったので、直接ぶっこむ。\n\n- 次にgenerateする\n\n```sh\ncd nuxtproject\nyarn gen\n```\n後で、distもリポジトリにぶっこむつくりにしますが、いったんはこんな感じでOK.\n\n\n- ホスティングする\n\n非常に簡単。やっぱりFWって素晴らしい。\n\n```go\ne.Static("/nuxtproject", "nuxtproject/dist")\n```\n- http://hostname/nuxtprojectへリクエストが来たらnuxtproject直下のdistのindex.htmlを返すっていう意味。\n\nこれだけでOK。\n\n- nuxtprojectを編集した際は毎回cloneしてgenerateする必要があるよ。\n\n\n\n# こっからいろいろ考える。\n- パッケージ化しようとしたけど、うまくできなかったので、以下の流れで本番のモジュールに組み込む\n\n1. distをリポジトリ保存する。\n2. echoprojectのデプロイ時にcloneする。\n3. 環境により変更すべき値を考慮する。\n\n## distをリポジトリ保存する。\n- .gitignoreでdistを外し、yarn generateした後にpushする。\nさすがに毎回手でやるのはだるい。本当ならビルド環境用意してそいつにやらせてあげればいいのだけれども、サーバー用意するのがめんどいうえ、金がない。\nなのでローカルで必ずやるようにする。\n\n- どうやらgitの機能にHookがあるらしい。\nコミット前、プッシュ前様々なタイミングでフックができるらしいが、今回はコミットする前を選択。\n.git/hooks/pre-commitにコマンド書いとけばいいらしい。\n\n```shell\n#!/bin/sh\nyarn\nyarn gen\ngit add .\n\nexit 0\n```\n\n- インストールして静的なファイルを生成、できたファイルを管理対象にして終わり。pushは自分でやる\nこれで常にdistが最新される。\n\n\n## echoprojectのデプロイ時にcloneする。\n本来ならここでビルドすればよいのだが、dokerのイメージにnuxtとnodeとnpmとyarnを入れるのは避けたかったので、クローンするだけ。その際今回のnuxtprojectはパブリックなリポジトリではないので、いじいじする。\ngitはnetrcの認証情報をもとにリポジトリからとってくることができるらしい。じゃあ簡単だ。\nechoprojectにechoproject_nutrcをまずは作ります。\n\n```echoproject_nutrc\n# 自分の情報を設定してね。\nmachine <git_host>\nlogin <git_user_id>\npassword <git_user_pwd>\n\n```\n\nこれをdockerfileで ~/.netrcにしてやればOK\n\n```docker\nRUN cp echoproject_nutrc ~/.netrc\n```\n\n\n# 環境により変更すべき値を考慮する。\n当然開発環境と本番環境は分かれてまっせということ。\nechoprojectではENVという環境変数で振り分けてますが、nuxtはどうしましょう。\nよし、どちらもgenerateしてホスティングするdistの名称を変えればOKじゃね？ということでそのようにします。\n\n1. nuxt.config-dev.jsを作る\n\n2. nuxt.config-dev.jsでgenerateの際の出力フォルダを指定\n\n```js\n  generate: {\n    subFolders: false,\n    dir: \'./dist_dev\'\n  },\n```\n\n3. package.jsonに下記を追加\n4. \n```js\n"gen-dev":"nuxt generate --config-file nuxt.config-dev.js",\n```\n\n4. .git/hooks/pre-commitにyarn gen-devを追加\n\nこれでdistとdist_devができるので後はechoprojectでdistをホスティングするのかdist_devをホスティングするの指定してあげればOK。\n\n\n\n非常にむりやりではありますが、今回はこのようにしましたとさ。\n',coediting:a,comments_count:0,created_at:"2019-11-25T17:26:39+09:00",group:s,id:"45c84f2529f721824df1",likes_count:1,private:a,reactions_count:0,tags:[{name:"Go",versions:[]},{name:m,versions:[]},{name:"echo",versions:[]},{name:e,versions:[]}],title:"nuxtで作った静的ファイルをgolangのechoでホスティングする。",updated_at:"2019-11-26T14:23:12+09:00",url:"https://qiita.com/sugimotosyo/items/45c84f2529f721824df1",user:{description:n,facebook_id:n,followees_count:96,followers_count:17,github_login_name:s,id:N,items_count:o,linkedin_id:n,location:"東京",name:"杉本 翔平",organization:"株式会社エンジョイ",permanent_id:308228,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/308228/profile-images/1565139059",team_only:a,twitter_screen_name:N,website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="やる事" class="fragment"></span><a href="#%E3%82%84%E3%82%8B%E4%BA%8B"><i class="fa fa-link"></i></a>やる事</h1>\n\n<p>「画像を投稿して、投稿した画像にコメントを付けたい」<br>\n「コメントページは別ページ」<br>\n「別ページの背景を投稿画像にしたい。」<br>\nできるだけ頭を使わずにVue.js/Nuxt.jsでやっていきましょう。</p>\n\n<h1>\n<span id="方法" class="fragment"></span><a href="#%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>方法</h1>\n\n<h2>\n<span id="ページ内の要素をdivで包む" class="fragment"></span><a href="#%E3%83%9A%E3%83%BC%E3%82%B8%E5%86%85%E3%81%AE%E8%A6%81%E7%B4%A0%E3%82%92div%E3%81%A7%E5%8C%85%E3%82%80"><i class="fa fa-link"></i></a>ページ内の要素をdivで包む</h2>\n\n<div class="code-frame" data-lang="HTML"><div class="highlight"><pre>\n<span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="c">&lt;!-- ここに中身。カニ味噌とか --&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n</pre></div></div>\n\n<h2>\n<span id="div要素のスタイルをバインド" class="fragment"></span><a href="#div%E8%A6%81%E7%B4%A0%E3%81%AE%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%92%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>div要素のスタイルをバインド</h2>\n\n<p>バインド自体はsrcなどの属性に対して行うのとまったく同じ。</p>\n\n<div class="code-frame" data-lang="HTML"><div class="highlight"><pre>\n<span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div</span> <span class="na">v-bind:style=</span><span class="s">"pageStyle"</span><span class="nt">&gt;</span>\n    <span class="c">&lt;!-- ここに中身。ウニとか --&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n</pre></div></div>\n\n<h2>\n<span id="スクリプトで背景要素を設定する" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%83%8C%E6%99%AF%E8%A6%81%E7%B4%A0%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>スクリプトで背景要素を設定する。</h2>\n\n<p>連想配列にスタイルを書いていく。CSSのプロパティは通常<strong>ケバブケース</strong>だが、ここでは<strong>キャメルケース</strong>で書くこと。<br>\nあと"url(\'ebikaniuni\')"の中にURLを入れる部分に注意。落ち着いて書きましょう。<br>\nちなみにTemplate部に直で書いてもOKだったりする。とても読みにくくなるけど...。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre>\n<span class="nt">&lt;script&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">pageStyle</span><span class="p">:</span> <span class="p">{</span>\n        <span class="c1">// 背景変更用スタイル</span>\n        <span class="na">backgroundImage</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="c1">// 背景読み込み前なので空白</span>\n        <span class="na">backgroundRepeat</span><span class="p">:</span> <span class="dl">"</span><span class="s2">no-repeat</span><span class="dl">"</span><span class="p">,</span>\n        <span class="na">backgroundAttachment</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fixed</span><span class="dl">"</span><span class="p">,</span>\n        <span class="na">backgroundPosition</span><span class="p">:</span> <span class="dl">"</span><span class="s2">center center</span><span class="dl">"</span><span class="p">,</span>\n      <span class="p">}</span>\n    <span class="p">};</span>\n<span class="err">　</span><span class="p">},</span>\n  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">pageStyle</span><span class="p">.</span><span class="nx">backgroundImage</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">url(\'</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">gazouNoUrl</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">\')</span><span class="dl">"</span><span class="p">;</span> \n    <span class="c1">// クォートをいい感じにエスケープする必要がある点に注意。</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n\n<span class="nt">&lt;/script&gt;</span>\n</pre></div></div>\n\n<p>もっといい方法があったら教えてクレメンス</p>\n\n<h1>\n<span id="参考資料" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>参考資料</h1>\n\n<p><a href="https://noumenon-th.net/programming/2019/05/21/v-bind/" rel="nofollow noopener" target="_blank">思考の葉:v-bindでstyle、classの属性値を変える[Vue.js]</a></p>\n',body:'#やる事\n「画像を投稿して、投稿した画像にコメントを付けたい」\n「コメントページは別ページ」\n「別ページの背景を投稿画像にしたい。」\nできるだけ頭を使わずにVue.js/Nuxt.jsでやっていきましょう。\n\n#方法\n##ページ内の要素をdivで包む\n\n```HTML\n\n<template>\n  <div>\n    \x3c!-- ここに中身。カニ味噌とか --\x3e\n  </div>\n</template>\n```\n\n##div要素のスタイルをバインド\nバインド自体はsrcなどの属性に対して行うのとまったく同じ。\n\n```HTML\n\n<template>\n  <div v-bind:style="pageStyle">\n    \x3c!-- ここに中身。ウニとか --\x3e\n  </div>\n</template>\n```\n\n##スクリプトで背景要素を設定する。\n連想配列にスタイルを書いていく。CSSのプロパティは通常**ケバブケース**だが、ここでは**キャメルケース**で書くこと。\nあと"url(\'ebikaniuni\')"の中にURLを入れる部分に注意。落ち着いて書きましょう。\nちなみにTemplate部に直で書いてもOKだったりする。とても読みにくくなるけど...。\n\n```html\n\n<script>\nexport default {\n  data() {\n    return {\n      pageStyle: {\n        // 背景変更用スタイル\n        backgroundImage: "", // 背景読み込み前なので空白\n        backgroundRepeat: "no-repeat",\n        backgroundAttachment: "fixed",\n        backgroundPosition: "center center",\n      }\n    };\n　},\n  created() {\n    this.pageStyle.backgroundImage = "url(\'" + gazouNoUrl + "\')"; \n    // クォートをいい感じにエスケープする必要がある点に注意。\n  },\n}\n\n<\/script>\n```\n\nもっといい方法があったら教えてクレメンス\n\n#参考資料\n\n[思考の葉:v-bindでstyle、classの属性値を変える[Vue.js]](https://noumenon-th.net/programming/2019/05/21/v-bind/)\n\n',coediting:a,comments_count:1,created_at:"2019-11-25T13:28:27+09:00",group:s,id:"4343479479bef7b02719",likes_count:4,private:a,reactions_count:0,tags:[{name:"CSS",versions:[]},{name:h,versions:[]},{name:c,versions:[]},{name:u,versions:[]},{name:e,versions:[]}],title:"Vueで背景をページ毎に動的に変えたい",updated_at:"2019-11-26T22:07:08+09:00",url:"https://qiita.com/ddg171/items/4343479479bef7b02719",user:{description:"Python3おいしい",facebook_id:n,followees_count:10,followers_count:2,github_login_name:T,id:T,items_count:7,linkedin_id:n,location:"Hiroshima",name:n,organization:n,permanent_id:425022,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/425022/profile-images/1558918214",team_only:a,twitter_screen_name:s,website_url:"https://poriporigrass.blogspot.com/"},page_views_count:s},{rendered_body:'\n<h1>\n<span id="composition-apiはthisを潰す" class="fragment"></span><a href="#composition-api%E3%81%AFthis%E3%82%92%E6%BD%B0%E3%81%99"><i class="fa fa-link"></i></a>Composition APIはthisを潰す</h1>\n\n<ol>\n<li>dayjsインストール</li>\n<li>pluginsにdayjsを追加</li>\n<li>TypeScript用の設定</li>\n<li>使い方</li>\n</ol>\n\n<h2>\n<span id="dayjsインストール" class="fragment"></span><a href="#dayjs%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>dayjsインストール</h2>\n\n<p><code>$ yarn add dayjs</code></p>\n\n<h2>\n<span id="pluginsにdayjsを追加" class="fragment"></span><a href="#plugins%E3%81%ABdayjs%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>pluginsにdayjsを追加</h2>\n\n<p>理由は後述しますが,plugins/dayjs/dayjs.jsとしています。<br>\n一個専用のディレクトリを切ります。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">plugins/dayjs/dayjs.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">dayjs</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">dayjs</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="dl">\'</span><span class="s1">dayjs/locale/ja</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">relativeTime</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">dayjs/plugin/relativeTime</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">LocalizedFormat</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">dayjs/plugin/localizedFormat</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">weekday</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">dayjs/plugin/weekday</span><span class="dl">\'</span>\n\n<span class="nx">dayjs</span><span class="p">.</span><span class="nx">locale</span><span class="p">(</span><span class="dl">\'</span><span class="s1">ja</span><span class="dl">\'</span><span class="p">)</span>\n<span class="nx">dayjs</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">weekday</span><span class="p">)</span>\n<span class="nx">dayjs</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">relativeTime</span><span class="p">)</span>\n<span class="nx">dayjs</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">LocalizedFormat</span><span class="p">)</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$dayjs</span> <span class="o">=</span> <span class="nx">dayjs</span>\n\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.cofig.js</span></div>\n<div class="highlight"><pre><span class="nx">plugins</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">@/plugins/dayjs/dayjs</span><span class="dl">\'</span><span class="p">]</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="typescript用の設定追加" class="fragment"></span><a href="#typescript%E7%94%A8%E3%81%AE%E8%A8%AD%E5%AE%9A%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>TypeScript用の設定追加</h2>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">@/plugins/dayjs/dayjs.d.ts</span></div>\n<div class="highlight"><pre><span class="c1">// 1. Make sure to import \'vue\' before declaring augmented types</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n\n<span class="k">import</span> <span class="nx">dayjs</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">dayjs</span><span class="dl">\'</span>\n\n<span class="c1">// 2. Specify a file with the types you want to augment</span>\n<span class="c1">//    Vue has the constructor type in types/vue.d.ts</span>\n<span class="nx">declare</span> <span class="nx">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="c1">// 3. Declare augmentation for Vue</span>\n  <span class="kr">interface</span> <span class="nx">Vue</span> <span class="p">{</span>\n    <span class="nx">$dayjs</span><span class="p">(</span><span class="nx">date</span><span class="p">?:</span> <span class="nx">dayjs</span><span class="p">.</span><span class="nx">ConfigType</span><span class="p">,</span> <span class="nx">option</span><span class="p">?:</span> <span class="nx">dayjs</span><span class="p">.</span><span class="nx">OptionType</span><span class="p">,</span> <span class="nx">locale</span><span class="p">?:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">dayjs</span><span class="p">.</span><span class="nx">Dayjs</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nx">declare</span> <span class="nx">module</span> <span class="dl">\'</span><span class="s1">dayjs</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">Dayjs</span> <span class="p">{</span>\n    <span class="nx">weekday</span><span class="p">():</span> <span class="nx">number</span>\n\n    <span class="nx">weekday</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">number</span><span class="p">):</span> <span class="nx">Dayjs</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">tsconfig.json</span></div>\n<div class="highlight"><pre><span class="w">  </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n    </span><span class="s2">"plugins/dayjs/dayjs.d.ts"</span><span class="w">\n  </span><span class="p">]</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>この型定義ファイルを書くときに,@/dayjs.d.tsって感じで置くと,pluginのdayjsをうまく読み込んでくれなかった。plugins下だと読み込んでくれるので,型定義ファイルとpluginファイルを機能ごとにひとまとめにする構成にした。</p>\n\n<h2>\n<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">component.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">createComponent</span><span class="p">,</span> <span class="nx">reactive</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@vue/composition-api</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">createComponent</span><span class="p">({</span>\n  <span class="nx">setup</span> <span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="p">{},</span> <span class="p">{</span> <span class="na">root</span><span class="p">:</span> <span class="p">{</span> <span class="nx">$dayjs</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">reactive</span><span class="p">({</span>\n      <span class="na">now</span><span class="p">:</span> <span class="nx">$dayjs</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">\'</span><span class="s1">MM月DD日 (ddd)</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">})</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">state</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>下記でもいけますが,上記だと省略できていい感じです。</p>\n\n<div class="code-frame" data-lang="typescript"><div class="highlight"><pre><span class="nx">setup</span> <span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="p">{},</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">reactive</span><span class="p">({</span>\n      <span class="na">now</span><span class="p">:</span> <span class="nx">context</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">$dayjs</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">\'</span><span class="s1">MM月DD日 (ddd)</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">})</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">state</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n</pre></div></div>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<p><a href="https://techblog.roxx.co.jp/entry/2019/03/20/143750" rel="nofollow noopener" target="_blank">僕はとりあえず dayjs !</a><br>\n<a href="https://youtu.be/C1BripDJktc" rel="nofollow noopener" target="_blank"><br>\nSETUP VUEX IN VUE.JS 3 COMPOSITION API WITH EXAMPLE</a><br>\n<a href="https://github.com/iamkun/dayjs/issues/611" rel="nofollow noopener" target="_blank">Some documentation/guidance to Typescript and using dayjs as a Vue.js plugin #611<br>\n</a></p>\n',body:"# Composition APIはthisを潰す\n\n1. dayjsインストール\n2. pluginsにdayjsを追加\n2. TypeScript用の設定\n3. 使い方\n\n## dayjsインストール\n\n```$ yarn add dayjs```\n\n## pluginsにdayjsを追加\n\n理由は後述しますが,plugins/dayjs/dayjs.jsとしています。\n一個専用のディレクトリを切ります。\n\n```plugins/dayjs/dayjs.js\nimport Vue from 'vue'\nimport dayjs from 'dayjs'\nimport 'dayjs/locale/ja'\n\nimport relativeTime from 'dayjs/plugin/relativeTime'\nimport LocalizedFormat from 'dayjs/plugin/localizedFormat'\nimport weekday from 'dayjs/plugin/weekday'\n\ndayjs.locale('ja')\ndayjs.extend(weekday)\ndayjs.extend(relativeTime)\ndayjs.extend(LocalizedFormat)\nVue.prototype.$dayjs = dayjs\n\n```\n\n```nuxt.cofig.js\nplugins: ['@/plugins/dayjs/dayjs']\n```\n## TypeScript用の設定追加\n```@/plugins/dayjs/dayjs.d.ts\n// 1. Make sure to import 'vue' before declaring augmented types\nimport Vue from 'vue'\n\nimport dayjs from 'dayjs'\n\n// 2. Specify a file with the types you want to augment\n//    Vue has the constructor type in types/vue.d.ts\ndeclare module 'vue/types/vue' {\n  // 3. Declare augmentation for Vue\n  interface Vue {\n    $dayjs(date?: dayjs.ConfigType, option?: dayjs.OptionType, locale?: string): dayjs.Dayjs;\n  }\n}\ndeclare module 'dayjs' {\n  interface Dayjs {\n    weekday(): number\n\n    weekday(value: number): Dayjs\n  }\n}\n```\n\n```tsconfig.json\n  \"files\": [\n    \"plugins/dayjs/dayjs.d.ts\"\n  ]\n```\n\nこの型定義ファイルを書くときに,@/dayjs.d.tsって感じで置くと,pluginのdayjsをうまく読み込んでくれなかった。plugins下だと読み込んでくれるので,型定義ファイルとpluginファイルを機能ごとにひとまとめにする構成にした。\n\n## 使い方\n\n```component.vue\n<script lang=\"ts\">\nimport { createComponent, reactive } from '@vue/composition-api'\n\nexport default createComponent({\n  setup (props: {}, { root: { $dayjs } }) {\n    const state = reactive({\n      now: $dayjs().format('MM月DD日 (ddd)')\n    })\n    return {\n      state\n    }\n  }\n})\n<\/script>\n```\n\n下記でもいけますが,上記だと省略できていい感じです。\n\n```typescript\nsetup (props: {}, context) {\n    const state = reactive({\n      now: context.root.$dayjs().format('MM月DD日 (ddd)')\n    })\n    return {\n      state\n    }\n  }\n```\n\n# 参考\n\n[僕はとりあえず dayjs !](https://techblog.roxx.co.jp/entry/2019/03/20/143750)\n[\nSETUP VUEX IN VUE.JS 3 COMPOSITION API WITH EXAMPLE](https://youtu.be/C1BripDJktc)\n[Some documentation/guidance to Typescript and using dayjs as a Vue.js plugin #611\n](https://github.com/iamkun/dayjs/issues/611)\n",coediting:a,comments_count:0,created_at:"2019-11-24T23:35:03+09:00",group:s,id:"6d3ffa67c625b76d9f24",likes_count:1,private:a,reactions_count:0,tags:[{name:q,versions:[]},{name:c,versions:[]},{name:e,versions:[]}],title:"NuxtのCompositionAPIでdayjsをぶっこむ",updated_at:"2019-11-25T09:53:18+09:00",url:"https://qiita.com/flowphantom/items/6d3ffa67c625b76d9f24",user:{description:s,facebook_id:s,followees_count:5,followers_count:7,github_login_name:s,id:O,items_count:o,linkedin_id:s,location:s,name:n,organization:s,permanent_id:35159,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/35159/profile-images/1560465407",team_only:a,twitter_screen_name:O,website_url:s},page_views_count:s},{rendered_body:'<p>davidroyerさんの<a href="https://github.com/davidroyer/nuxt-ssr-firebase-auth.v2" rel="nofollow noopener" target="_blank">nuxt-ssr-firebase-auth.v2</a>というリポジトリをベースに解説していきます。</p>\n\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>この記事では</p>\n\n<p>section1.未認証ユーザーをはじく実装<br>\nsection2.新規登録(Email)の実装<br>\nsection3.新規登録(Googleアカウント)の実装<br>\nsection4.nuxtServerInitによる自動認証</p>\n\n<p>の順でソースを読んで行きます。</p>\n\n<h2>\n<span id="認証方式" class="fragment"></span><a href="#%E8%AA%8D%E8%A8%BC%E6%96%B9%E5%BC%8F"><i class="fa fa-link"></i></a>認証方式</h2>\n\n<p>認証の実装はGoogleアカウントorEmailの2種類。<br>\nFirebase認証のソリューションは2つありますが、今回利用するのはFirebase SDK Authenticationです。後で詳しく触れます。<br>\n大まかな流れは、<br>\nクライアントのEmail・パスワードからJWTを取得 ⇒ storeとcookieに保存 ⇒ 認証です。sessionは利用しません。</p>\n\n<p>認証におけるJWT(Json Web Token)の利用について下記がわかりやすいと思います。「JWT」と「cookieのsessionによる認証」の2つを比較した記事ですが、JWTをlocalStrageやcookieに保存する点での注意事項も記載されています。<br>\n<a href="https://qiita.com/doyaaaaaken/items/02357c2ebca994160804" id="reference-0d7eff63542de54d1b13">JWT・Cookieそれぞれの認証方式のメリデメ比較</a></p>\n\n<p>簡単に説明すると、JSON Web Tokenとは、ユーザー識別用のIDと有効期限が含まれた改ざん検証が可能なデータです。「ログイン済みです」という証をクライアント側が保持しているんですね。見た目はドット区切りで　{base64エンコードしたuserデータ}.{base64エンコードした有効期限}.{署名}　というフォーマットです。別のユーザーになりすまそうとして改ざんしたり、有効期限を改ざんしても署名による検証でひっかかります。</p>\n\n<h2>\n<span id="ディレクトリ構造" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E9%80%A0"><i class="fa fa-link"></i></a>ディレクトリ構造</h2>\n\n<p>この記事の説明に関連するディレクトリの構造は下記です。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>  ├firebase/\n  |  └app.js\n  ├helpers/\n  |  └index.js\n  ├layouts/\n  |  ├default.vue\n  |  └protected.vue\n  ├middleware/\n  |  ├authenticated.js\n  |  ├check-auth.js\n  |  └handle-login-route.js\n  ├page/\n  |  ├index.vue  //topページ\n  |  ├auth/\n  |  |  ├signin.vue\n  |  |  └signup.vue\n  |  └protected/\n  |     └index.vue //認証済みのユーザーのみ閲覧可能。\n  └store\n     ├modules/\n     |  └user.js\n     └index.js\n</pre></div></div>\n\n<h1>\n<span id="リーディング" class="fragment"></span><a href="#%E3%83%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>リーディング</h1>\n\n<p>まずは認証されていないユーザーがどのようにはじかれているのかを確認するところからはじめます！</p>\n\n<h2>\n<span id="section1未認証ユーザーをはじく" class="fragment"></span><a href="#section1%E6%9C%AA%E8%AA%8D%E8%A8%BC%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%92%E3%81%AF%E3%81%98%E3%81%8F"><i class="fa fa-link"></i></a>section1.未認証ユーザーをはじく</h2>\n\n<p>未認証のユーザーをはじく機能はlayoutsとmiddleware、そしてstoreが担っています。</p>\n\n<p>page -- &gt; layouts --&gt; middleware -- &gt;storeの順でソースを見てみましょう。</p>\n\n<h3>\n<span id="pageprotectedindexvue" class="fragment"></span><a href="#pageprotectedindexvue"><i class="fa fa-link"></i></a>page/protected/index.vue</h3>\n\n<ul>\n<li>page/index.vueは認証不要なトップページ</li>\n<li>page/protected/index.vueは認証済みユーザーのみアクセスできるページです。</li>\n</ul>\n\n<p>今回の実装の場合、「認証不要なページ」と「認証済みユーザーのみアクセスできるページ」の違いはlayoutにprotectedを指定しているか否かだけです。<br>\n新たにページを作る際も、これを指定するだけで未認証ユーザーをはじくことができます。</p>\n\n<p>pageにおける実装のコードもたったの1行。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">page/protected/index.vue</span></div>\n<div class="highlight"><pre><span class="c1">//...略</span>\n<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n  <span class="k">import</span> <span class="p">{</span> <span class="nx">mapGetters</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuex</span><span class="dl">\'</span>\n  <span class="k">import</span> <span class="nx">firebaseApp</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/firebase/app.js</span><span class="dl">\'</span>\n\n  <span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n    <span class="na">layout</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">protected</span><span class="dl">\'</span><span class="p">,</span> <span class="c1">//ここでlayoutを指定しています。</span>\n    <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n<span class="c1">//...略</span>\n</pre></div>\n</div>\n\n<p>では次にこのlayoutでは何を行っているのかを見てみます。</p>\n\n<h3>\n<span id="layoutsは以下の2つ" class="fragment"></span><a href="#layouts%E3%81%AF%E4%BB%A5%E4%B8%8B%E3%81%AE2%E3%81%A4"><i class="fa fa-link"></i></a>layoutsは以下の2つ</h3>\n\n<p>リポジトリを見るとlayoutsは2つのみです。それぞれの役割は下記。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>--|layouts/\n----|default.vue   //誰でも見れるページ用\n----|protected.vue //認証済みユーザーのみのページ用\n</pre></div></div>\n\n<p>もちろん、default.vueでは特別な処理は行いません。肝心なのはprotected.vueの方です。コードは以下。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">layouts/protected.vue</span></div>\n<div class="highlight"><pre>\n<span class="c1">//...略</span>\n<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n  <span class="k">import</span> <span class="p">{</span> <span class="nx">mapActions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuex</span><span class="dl">\'</span>\n\n  <span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n    <span class="na">middleware</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">authenticated</span><span class="dl">\'</span><span class="p">,</span> <span class="c1">//ここでmiddlewareを指定しています。</span>\n    <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n<span class="c1">//...略</span>\n</pre></div>\n</div>\n\n<p>Nuxt.jsにおけるmiddlewareの適用方法をここで改めて整理しておきます。全部で3つあります。</p>\n\n<ol>\n<li>nuxt.config.jsで指定</li>\n<li>layoutでミドルウェアを指定 --&gt; pageでlayoutを読み込む</li>\n<li>各ページでミドルウェアを指定。</li>\n</ol>\n\n<p>今回はlayoutで指定する2番ですね。<br>\nmiddlewareはページがレンダリングされる前に実行されます。</p>\n\n<p>今回の実装では、レンダリング前に「認証済みか否かをチェックして未認証の場合はリダイレクトする」ことで未認証ユーザーを弾いていることがわかります。ではmiddlewareのコードを見てみましょう。</p>\n\n<h3>\n<span id="middlewareのソース" class="fragment"></span><a href="#middleware%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>middlewareのソース</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>--|middleware/\n----|authenticated.js //上記で呼び出されていたmiddleware\n----|check-auth.js\n----|handle-login-route.js \n</pre></div></div>\n\n<p>それぞれの役割は以下です。</p>\n\n<table>\n<thead>\n<tr>\n<th>名前</th>\n<th>役割</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>authenticated.js</td>\n<td>認証済みかチェック。未認証ならsign inページへリダイレクト。未認証ユーザーがprotectedページへ遷移しようとしたときに実行されます。</td>\n</tr>\n<tr>\n<td>check-auth.js</td>\n<td>ご自由に使えます。中身はstore/index.jsと似ています。</td>\n</tr>\n<tr>\n<td>handle-login-route.js</td>\n<td>認証済みかチェック。認証済みならprotectedへリダイレクト。認証済みユーザーがログインページへ遷移しようとしたときに実行されます。</td>\n</tr>\n</tbody>\n</table>\n\n<p>layouts/protected.vueで呼び出されていたauthenticated.jsのコードは次のようになっています。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">authenticated.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="p">({</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">redirect</span> <span class="p">})</span> <span class="p">{</span>\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="dl">\'</span><span class="s1">modules/user/isAuthenticated</span><span class="dl">\'</span><span class="p">])</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/auth/signin</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>gettersでstoreからisAuthenticatedを取得していますね。<br>\nこのisAuthenticatedで認証済/未認証チェックを行い、falseの場合はsigninページへリダイレクトしています。</p>\n\n<p>ちなみに、Nuxt.js公式のmiddlewareの解説もほとんど同じコードです。公式の場合はpageに直接middlewareを指定している例ですね。<a href="https://ja.nuxtjs.org/api/pages-middleware/" rel="nofollow noopener" target="_blank">API: middleware プロパティ 公式</a></p>\n\n<h3>\n<span id="最後にstoreです" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%ABstore%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>最後にstoreです</h3>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>--|store/\n----|index.js\n----|modules/\n------|user.js  //上記で呼び出していたstore\n</pre></div></div>\n\n<p>それぞれの役割は下記</p>\n\n<table>\n<thead>\n<tr>\n<th>名前</th>\n<th>役割</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.js</td>\n<td>nuxtServerInitでcookieをチェック。認証データがあれば自動ログインさせます。</td>\n</tr>\n<tr>\n<td>user.js</td>\n<td>userデータを保持。login/logout/cookieへのデータ登録を行います。認証済みかチェックするためには、userデータが存在するかどうかをチェックします。</td>\n</tr>\n</tbody>\n</table>\n\n<p>user.jsのソースを見てみます。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">store/modules/user.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">firebaseApp</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/firebase/app</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Cookies</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">js-cookie</span><span class="dl">\'</span>\n<span class="c1">// state</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">uid</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>  <span class="c1">//userのID</span>\n  <span class="na">user</span><span class="p">:</span> <span class="kc">null</span>  <span class="c1">//userのデータ</span>\n<span class="p">})</span>\n\n\n<span class="c1">// getters</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">getters</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">uid</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">&amp;&amp;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">)</span> <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span>\n    <span class="k">else</span> <span class="k">return</span> <span class="kc">null</span>\n  <span class="p">},</span>\n  <span class="nx">user</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span>\n  <span class="p">},</span>\n\n  <span class="c1">//上記middlewareで呼び出されていた認証チェック</span>\n  <span class="nx">isAuthenticated</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="o">!!</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">&amp;&amp;</span> <span class="o">!!</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>\n<span class="c1">//略</span>\n</pre></div>\n</div>\n\n<p>isAuthenticatedではuserのidが存在するかをチェックしていることがわかりますね。省略しましたが、先述の通りuser.jsはlogin/logoutの機能も担っています。新規登録の実装を見ながらlogin/logoutの機能にも触れていきます。</p>\n\n<h2>\n<span id="section2新規登録emailの実装" class="fragment"></span><a href="#section2%E6%96%B0%E8%A6%8F%E7%99%BB%E9%8C%B2email%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>section2.新規登録(Email)の実装</h2>\n\n<p>このセクションではfirebaseAppの機能も参照しながら、新規登録の実装を読んでいきます。</p>\n\n<h3>\n<span id="前提の確認" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>前提の確認</h3>\n\n<ol>\n<li>上記の認証の流れから、新規登録時にはuser.jsのstate.userにデータを格納しているのだろうというのはわかっています。</li>\n<li>新規登録はGoogleアカウントとEmailの2つが利用できます。</li>\n</ol>\n\n<p>改めてpagesの構造です。役割も追記しました。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>--|page/\n----|index.vue  //topページ\n----|auth/\n------|signin.vue //次のsectionで扱う。Googleアカウントによる新規登録を担う。\n------|signup.vue //このsectionで扱う。Emailによる新規登録を担う。\n----|protected/\n------|index.vue //前section1。認証済みのユーザーのみ閲覧可能。\n</pre></div></div>\n\n<p>GoogleアカウントとEmailでそれぞれ新規登録のpageが異なりますね。<br>\nでは、まずはEmailの方から見ていきましょう。</p>\n\n<h3>\n<span id="その前に認証ソリューションもおさらい" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E5%89%8D%E3%81%AB%E8%AA%8D%E8%A8%BC%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%82%E3%81%8A%E3%81%95%E3%82%89%E3%81%84"><i class="fa fa-link"></i></a>その前に認証ソリューションもおさらい</h3>\n\n<p>ソースを見る前に改めてfirebaseの認証ソリューションをおさらいしておきます。<br>\n大きく2つの方法があります。</p>\n\n<table>\n<thead>\n<tr>\n<th>名前</th>\n<th>解説</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>FirebaseUI Auth</td>\n<td>FirebaseUI に備わっているドロップイン認証ソリューションは、メールアドレスとパスワード、電話番号を使用したり、Google ログインや Facebook ログインなどの一般的なフェデレーション ID プロバイダを使用したりしてユーザーをログインさせるための UI フローを処理します。</td>\n</tr>\n<tr>\n<td>Firebase SDK Authentication</td>\n<td>1つまたは複数のログイン方法を手動でアプリに統合することができる。メールアドレスとパスワードを使用した認証、Google、Facebook、Twitter、GitHub アカウントを使用した認証、電話番号認証、匿名認証など。</td>\n</tr>\n</tbody>\n</table>\n\n<p><a href="https://firebase.google.com/docs/auth?hl=ja" rel="nofollow noopener" target="_blank">Firebase Authentication 公式</a>より一部引用。<br>\nGoogle推奨のソリューションはFirebaseUI Authですが、今回扱っているのはFirebase SDK Authenticationです。</p>\n\n<p>公式のJavaScriptによる認証の解説ページは<a href="https://firebase.google.com/docs/auth/web/password-auth?hl=ja" rel="nofollow noopener" target="_blank">こちら</a>。</p>\n\n<h3>\n<span id="signupvueemail登録" class="fragment"></span><a href="#signupvueemail%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>signup.vue（Email登録）</h3>\n\n<p>さっそくコードを見ていきます。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/auth/signup.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;div&gt;</span>\n      <span class="c">&lt;!-- ログインページへのリンク --&gt;</span>\n      <span class="nt">&lt;nuxt-link</span> <span class="na">to=</span><span class="s">"/auth/signin"</span><span class="nt">&gt;</span>Already a user? Sign-in<span class="nt">&lt;/nuxt-link&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;div&gt;</span>\n      <span class="c">&lt;!-- サインアップ --&gt;</span>\n      <span class="nt">&lt;form</span> <span class="err">@</span><span class="na">submit.prevent=</span><span class="s">"signUp"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"usernameTxt"</span><span class="nt">&gt;</span>Username:<span class="nt">&lt;/label&gt;</span>\n        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"usernameTxt"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">v-model=</span><span class="s">"email"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"passwordTxt"</span><span class="nt">&gt;</span>Password:<span class="nt">&lt;/label&gt;</span>\n        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"passwordTxt"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">v-model=</span><span class="s">"password"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Sign Up<span class="nt">&lt;/button&gt;</span>\n      <span class="nt">&lt;/form&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/section&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">mapActions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuex</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">firebaseApp</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/firebase/app</span><span class="dl">\'</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">email</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n      <span class="na">password</span><span class="p">:</span> <span class="dl">\'\'</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">mapActions</span><span class="p">(</span><span class="dl">\'</span><span class="s1">modules/user</span><span class="dl">\'</span><span class="p">,</span> <span class="p">[</span> <span class="dl">\'</span><span class="s1">login</span><span class="dl">\'</span> <span class="p">]),</span>\n    <span class="k">async</span> <span class="nx">signUp</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="k">try</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">firebaseUser</span> <span class="o">=</span> <span class="k">await</span><span class="err">　</span> <span class="nx">firebaseApp</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">createUserWithEmailAndPassword</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="c1">//①</span>\n\n        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">writeUserData</span><span class="p">(</span><span class="nx">firebaseUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">,</span> <span class="nx">firebaseUser</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span> <span class="c1">//この1行は一旦無視</span>\n        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">firebaseUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">)</span> <span class="c1">//②</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/protected</span><span class="dl">\'</span><span class="p">)</span> <span class="c1">//③</span>\n      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>\n        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>\n      <span class="p">}</span>\n    <span class="p">},</span>\n    <span class="nx">writeUserData</span> <span class="p">(</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="nx">firebaseApp</span><span class="p">.</span><span class="nx">database</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="dl">\'</span><span class="s1">users/</span><span class="dl">\'</span> <span class="o">+</span> <span class="nx">userId</span><span class="p">).</span><span class="kd">set</span><span class="p">({</span>\n        <span class="na">email</span><span class="p">:</span> <span class="nx">email</span>\n      <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">style</span> <span class="na">scoped</span><span class="nt">&gt;</span>\n<span class="o">//</span><span class="err">略</span>\n</pre></div>\n</div>\n\n<p>上記コメントの①②③の順で見ていきます。<br>\n大まかに、以下の流れです。</p>\n\n<ul>\n<li>①でfirebaseの認証</li>\n<li>②でstoreへの登録、cookieへの登録</li>\n<li>③でリダイレクト</li>\n</ul>\n\n<h4>\n<span id="createuserwithemailandpassword" class="fragment"></span><a href="#createuserwithemailandpassword"><i class="fa fa-link"></i></a>①createUserWithEmailAndPassword</h4>\n\n<p>Emailとパスワードから新規アカウントを作成するには、<br>\ncreateUserWithEmailAndPasswordを利用します。<br>\n<a href="https://firebase.google.com/docs/reference/js/firebase.auth.Auth.html?hl=ja#createuserwithemailandpassword" rel="nofollow noopener" target="_blank">公式のAPIリファレンスページはこちら。</a></p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>createUserWithEmailAndPassword(email: string, password: string): Promise&lt;UserCredential&gt;\n</pre></div></div>\n\n<p>2つのstring（emailとpassword）を受けて、Promiseを返します。<br>\nまた、新しいアカウントが作成されると、そのユーザーは自動的にログインされた状態になります。<br>\nUser情報はUserCredentialから参照することができます。フェデレーション ID プロバイダ(Googleアカウント・Facebookアカウントなど）での認証時にはproviderIDなどの情報も参照できるようです。</p>\n\n<h4>\n<span id="storeへの登録cookieへの登録" class="fragment"></span><a href="#store%E3%81%B8%E3%81%AE%E7%99%BB%E9%8C%B2cookie%E3%81%B8%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>②storeへの登録、cookieへの登録</h4>\n\n<p>①で「新しいアカウントが作成されると、そのユーザーは自動的にログインされた状態になります。」と述べましたが、storeやcookieにログイン情報を登録しておかないとNuxt.jsは認証ユーザーか未認証ユーザーかの判別がつきません。</p>\n\n<p>②ではその処理を行っています。<br>\n①で取得したデータ（firebaseUser）をstoreに登録するために呼び出しているthis.login(firebaseUser.uid)。<br>\nstore/modules/user.jsでそのソースを見てみましょう。以下のコメント「ログイン処理」の部分です。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">store/modules/user.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">firebaseApp</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/firebase/app</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Cookies</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">js-cookie</span><span class="dl">\'</span>\n<span class="c1">//略</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="c1">//ログイン処理</span>\n  <span class="k">async</span> <span class="nx">login</span><span class="p">({</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">state</span><span class="p">},</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">[STORE ACTIONS] - login</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">firebaseApp</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">currentUser</span><span class="p">.</span><span class="nx">getIdToken</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="c1">//②-1</span>\n    <span class="kd">const</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">name</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span>\n      <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>\n      <span class="na">avatar</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">photoURL</span><span class="p">,</span>\n      <span class="na">uid</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">uid</span>\n    <span class="p">}</span>\n    <span class="nx">Cookies</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">\'</span><span class="s1">access_token</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span>  <span class="c1">//②-2</span>\n    <span class="k">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setUSER</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">userInfo</span><span class="p">)</span> <span class="c1">//②-3</span>\n    <span class="k">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">saveUID</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">userInfo</span><span class="p">.</span><span class="nx">uid</span><span class="p">)</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">[STORE ACTIONS] - in login, response:</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span>\n\n  <span class="p">},</span>\n  <span class="c1">//ログアウト処理</span>\n  <span class="k">async</span> <span class="nx">logout</span><span class="p">({</span><span class="nx">commit</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">})</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">\'</span><span class="s1">[STORE ACTIONS] - logout</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="k">await</span> <span class="nx">firebaseApp</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">signOut</span><span class="p">()</span>\n\n    <span class="nx">Cookies</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">\'</span><span class="s1">access_token</span><span class="dl">\'</span><span class="p">);</span>\n    <span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setUSER</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>\n    <span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">saveUID</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>\n  <span class="p">},</span>\n<span class="c1">//略</span>\n</pre></div>\n</div>\n\n<h5>\n<span id="-1-currentusergetidtokentrue" class="fragment"></span><a href="#-1-currentusergetidtokentrue"><i class="fa fa-link"></i></a>②-1 currentUser.getIdToken(true)</h5>\n\n<p>ログインしているユーザーは、firebaseApp.auth().currentUserで取得できます。<br>\n②では、更にgetIdTokenメソッドを呼び出してJWT(JSON Web Token)を取得しています。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>getIdToken(forceRefresh?: boolean): Promise&lt;string&gt;\n</pre></div></div>\n\n<p><a href="https://firebase.google.com/docs/reference/js/firebase.User.html?hl=ja#getidtoken" rel="nofollow noopener" target="_blank">公式レファレンス User getIdToken</a></p>\n\n<h5>\n<span id="-2-cookiesset" class="fragment"></span><a href="#-2-cookiesset"><i class="fa fa-link"></i></a>②-2 Cookies.set</h5>\n\n<p>取得したJWTをcookieにセット。</p>\n\n<h5>\n<span id="-3-dispatchsetuser-userinfo" class="fragment"></span><a href="#-3-dispatchsetuser-userinfo"><i class="fa fa-link"></i></a>②-3 dispatch(\'setUSER\', userInfo)</h5>\n\n<p>userデータをstoreに保存。<br>\nログアウト処理を見ると、ログアウト時にcookieとstoreからuserデータを削除しているのも確認できますね。</p>\n\n<h5>\n<span id="でリダイレクト" class="fragment"></span><a href="#%E3%81%A7%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a>③でリダイレクト</h5>\n\n<p>リダイレクト時にはstoreにuserデータが保存されているので、section1で見たmiddlewareも素通りできます。<br>\nちなみに無視した1行はデータベースへのユーザー情報の登録です。このリポジトリはログインしたユーザーがデータベースのユーザー情報を閲覧できるようなデモになっています。今回は扱わないのでpages/protected/index.vueを参照ください。</p>\n\n<h2>\n<span id="section3新規登録googleアカウントの実装" class="fragment"></span><a href="#section3%E6%96%B0%E8%A6%8F%E7%99%BB%E9%8C%B2google%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>section3.新規登録(Googleアカウント)の実装</h2>\n\n<p>Googleアカウントによる認証もほとんど同じです。</p>\n\n<h3>\n<span id="pagesauthsigninvuegoogleアカウントによる新規登録" class="fragment"></span><a href="#pagesauthsigninvuegoogle%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E6%96%B0%E8%A6%8F%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>pages/auth/signin.vue(Googleアカウントによる新規登録)</h3>\n\n<p>既存ユーザーのログイン処理のコードが目立ちますが、fbGoogleLoginの処理を見ていきます。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/auth/signin.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;div&gt;</span>\n      <span class="nt">&lt;nuxt-link</span> <span class="na">to=</span><span class="s">"/auth/signup"</span><span class="nt">&gt;</span>Not a user? Sign-up<span class="nt">&lt;/nuxt-link&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;div&gt;</span>\n      <span class="nt">&lt;form</span> <span class="err">@</span><span class="na">submit.prevent=</span><span class="s">"submit"</span><span class="nt">&gt;</span>//このformは既存ユーザーのログイン処理用\n        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"usernameTxt"</span><span class="nt">&gt;</span>Username:<span class="nt">&lt;/label&gt;</span>\n        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"usernameTxt"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">v-model=</span><span class="s">"email"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"passwordTxt"</span><span class="nt">&gt;</span>Password:<span class="nt">&lt;/label&gt;</span>\n        <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"passwordTxt"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">v-model=</span><span class="s">"password"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Sign In<span class="nt">&lt;/button&gt;</span>\n      <span class="nt">&lt;/form&gt;</span>\n      //以下を見ていきます。\n      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"button"</span> <span class="err">@</span><span class="na">click.prevent=</span><span class="s">"fbGoogleLogin"</span><span class="nt">&gt;</span>Google Login<span class="nt">&lt;/button&gt;</span>\n      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"button"</span> <span class="err">@</span><span class="na">click.prevent=</span><span class="s">"fbGoogleLogout"</span><span class="nt">&gt;</span>Google Logout<span class="nt">&lt;/button&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/section&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">mapActions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">vuex</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">firebaseApp</span><span class="p">,</span> <span class="p">{</span> <span class="nx">googleProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">~/firebase/app</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">email</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>\n      <span class="na">password</span><span class="p">:</span> <span class="dl">""</span>\n    <span class="p">};</span>\n  <span class="p">},</span>\n  <span class="c1">//section1で触れたようにログイン済みのユーザーはこのページにアクセスできません。middlewareでリダイレクトされます。</span>\n  <span class="na">middleware</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">handle-login-route</span><span class="dl">"</span><span class="p">],</span> \n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">mapActions</span><span class="p">(</span><span class="dl">"</span><span class="s2">modules/user</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">login</span><span class="dl">"</span><span class="p">]),</span>\n    <span class="c1">//既存ユーザーのlogin処理</span>\n    <span class="nx">submit</span><span class="p">()</span> <span class="p">{</span> \n      <span class="nx">firebaseApp</span>\n        <span class="p">.</span><span class="nx">auth</span><span class="p">()</span>\n        <span class="p">.</span><span class="nx">signInWithEmailAndPassword</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">firebaseUser</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">firebaseUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">);</span>\n        <span class="p">})</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">/protected</span><span class="dl">"</span><span class="p">);</span>\n        <span class="p">})</span>\n        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>\n        <span class="p">});</span>\n    <span class="p">},</span>\n    <span class="c1">//Googleアカウントによるログイン</span>\n    <span class="k">async</span> <span class="nx">fbGoogleLogin</span><span class="p">()</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="p">{</span> <span class="nx">user</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">firebaseApp</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">signInWithPopup</span><span class="p">(</span><span class="nx">googleProvider</span><span class="p">);</span><span class="err">　</span><span class="c1">//③-1</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">//③-2</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">/protected</span><span class="dl">"</span><span class="p">);</span>\n    <span class="p">},</span>\n    <span class="k">async</span> <span class="nx">fbGoogleLogout</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">logout</span><span class="p">();</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n//略\n</pre></div>\n</div>\n\n<p>ここで利用しているのはfirebaseApp.auth().signInWithPopup(googleProvider)。<br>\n戻り値は先程のcreateUserWithEmailAndPassword(email: string, password: string)と同じPromiseですね。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>signInWithPopup(provider: AuthProvider): Promise&lt;UserCredential&gt;\n</pre></div></div>\n\n<p><a href="https://firebase.google.com/docs/reference/js/firebase.auth.Auth.html?hl=ja#signinwithpopup" rel="nofollow noopener" target="_blank">公式レファレンス</a></p>\n\n<h5>\n<span id="-1-firebaseappauthsigninwithpopup" class="fragment"></span><a href="#-1-firebaseappauthsigninwithpopup"><i class="fa fa-link"></i></a>③-1 firebaseApp.auth().signInWithPopup</h5>\n\n<p>引数で渡しているgoogleProviderはあらかじめ~/firebase/appでexportしてあるものを読み込んでいます。SDKから簡単に作れます。</p>\n\n<h5>\n<span id="-2-login" class="fragment"></span><a href="#-2-login"><i class="fa fa-link"></i></a>③-2 login</h5>\n\n<p>③-1で取得したUserCredentialのデータをuserに格納し、先のEmail認証と同じくlogin処理をstoreに投げてログインを完了させています。</p>\n\n<h4>\n<span id="login処理" class="fragment"></span><a href="#login%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>login処理</h4>\n\n<p>ここまでくれば、上記sumit()によるログイン処理もなんとなく想像がつくと思います。再度抜粋します。</p>\n\n<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span class="nx">submit</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//既存ユーザーのlogin処理</span>\n  <span class="nx">firebaseApp</span>\n    <span class="p">.</span><span class="nx">auth</span><span class="p">()</span>\n    <span class="p">.</span><span class="nx">signInWithEmailAndPassword</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>  <span class="c1">//tokenの取得</span>\n    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">firebaseUser</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">firebaseUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">);</span>  <span class="c1">//store・cookieへの登録</span>\n    <span class="p">})</span>\n    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">/protected</span><span class="dl">"</span><span class="p">);</span>  <span class="c1">//リダイレクト</span>\n    <span class="p">})</span>\n    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>\n    <span class="p">});</span>\n</pre></div></div>\n\n<h2>\n<span id="section4nuxtserverinitによる自動認証" class="fragment"></span><a href="#section4nuxtserverinit%E3%81%AB%E3%82%88%E3%82%8B%E8%87%AA%E5%8B%95%E8%AA%8D%E8%A8%BC"><i class="fa fa-link"></i></a>section4.nuxtServerInitによる自動認証</h2>\n\n<p>ここまでで認証関連はほとんど説明しました。</p>\n\n<p>最後に、cookieを利用したログインしっぱなしの状態の実現を見てみます。<br>\n以下の記事にもあるように、storeのデータは簡単に飛んでしまいます。</p>\n\n<blockquote>\n<ul>\n<li>window.location や href でページ遷移すると、Storeに格納にした状態が飛ぶ。理由としてはページが初回ロード扱いとなるため。nuxtServerInitアクションで状態を復元するコードを書かなくてはならない。</li>\n<li>NuxtLink や this.$router.pushを使用してページ遷移すると、ページが初期化されないため状態が維持される。</li>\n</ul>\n</blockquote>\n\n<p><a href="https://qiita.com/shintarogit/items/c14cf6156201e0b8667a" id="reference-1ba60630844f054b1aa9">Nuxt.js 状態管理でハマった件 Qiita</a></p>\n\n<p>ログイン状態を維持するためには欠かせない処理ですね。</p>\n\n<p>まずは、store/index.jsを見てみます。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">store/index.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span><span class="nx">getUserFromCookie</span><span class="p">,</span> <span class="nx">getUserFromSession</span><span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/helpers</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>\n\n  <span class="k">async</span> <span class="nx">nuxtServerInit</span> <span class="p">({</span> <span class="nx">dispatch</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">req</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">getUserFromCookie</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">modules/user/setUSER</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="na">avatar</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">picture</span><span class="p">,</span> <span class="na">uid</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">user_id</span><span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>nuxtServerInitで/helpers/index.jsのgetUserFromCookie()を呼び出しています。</p>\n\n<p>getUserFromCookie()のソースは</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">/helpers/index.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">jwtDecode</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">jwt-decode</span><span class="dl">\'</span>\n<span class="kd">var</span> <span class="nx">cookieparser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">cookieparser</span><span class="dl">\'</span><span class="p">)</span>\n\n<span class="k">export</span> <span class="kd">function</span> <span class="nx">getUserFromCookie</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">server</span> <span class="o">&amp;&amp;</span> <span class="nx">process</span><span class="p">.</span><span class="kd">static</span><span class="p">)</span> <span class="k">return</span> <span class="c1">//①</span>\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span> <span class="k">return</span> <span class="c1">//②</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">parsed</span> <span class="o">=</span> <span class="nx">cookieparser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">accessTokenCookie</span> <span class="o">=</span> <span class="nx">parsed</span><span class="p">.</span><span class="nx">access_token</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">accessTokenCookie</span><span class="p">)</span> <span class="k">return</span>\n\n    <span class="kd">const</span> <span class="nx">decodedToken</span> <span class="o">=</span> <span class="nx">jwtDecode</span><span class="p">(</span><span class="nx">accessTokenCookie</span><span class="p">)</span> <span class="c1">//③</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">decodedToken</span><span class="p">)</span> <span class="k">return</span>\n\n    <span class="k">return</span> <span class="nx">decodedToken</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="c1">// 略</span>\n</pre></div>\n</div>\n\n<p>getUserFromCookieで行っているのは、cookieからアクセストークンを取り出して、jwtDecodeにかけて返すところまでですね。</p>\n\n<h3>\n<span id="でチェックしているのは" class="fragment"></span><a href="#%E3%81%A7%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%AF"><i class="fa fa-link"></i></a>①でチェックしているのは、</h3>\n\n<ul>\n<li>サーバーサイドの処理であるか否か</li>\n<li>nuxt genrateで作られた静的サイトであるか否か</li>\n</ul>\n\n<p>ページがサーバでレンダリングされている時にcookieを探しても意味はないので、どちらかがtrueの場合は処理しません。</p>\n\n<p><a href="https://ja.nuxtjs.org/guide/plugins/#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E9%99%90%E5%AE%9A%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E5%88%A9%E7%94%A8" rel="nofollow noopener" target="_blank">プラグイン利用 nuxt.js公式</a></p>\n\n<h3>\n<span id="cookieが無い場合は処理しません" class="fragment"></span><a href="#cookie%E3%81%8C%E7%84%A1%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AF%E5%87%A6%E7%90%86%E3%81%97%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>②cookieが無い場合は処理しません。</h3>\n\n<h3>\n<span id="jwtをデコード" class="fragment"></span><a href="#jwt%E3%82%92%E3%83%87%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>③JWTをデコード。</h3>\n\n<p>JWTをデコード。その後、store/index.jsに戻って、デコードされたデータから、ユーザーの名前やemailアドレス、idを取り出しstoreにdispatchしています。</p>\n\n<p>こうしてserverinitが完了した後、トップページのindex.vueにレンダリングが行われます。下記のソースgettersでuidを取得できるのでSigninではなく、Logoutのリンクが表示されることがわかります。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/index.vue</span></div>\n<div class="highlight"><pre>//略\n<span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;section&gt;</span>\n    <span class="nt">&lt;div&gt;</span>\n      <span class="nt">&lt;div&gt;</span>\n        <span class="nt">&lt;nuxt-link</span> <span class="na">to=</span><span class="s">"/protected"</span><span class="nt">&gt;</span>Protected<span class="nt">&lt;/nuxt-link&gt;</span>\n        <span class="nt">&lt;nuxt-link</span> <span class="na">v-if=</span><span class="s">"uid"</span> <span class="na">to=</span><span class="s">"/auth/signin"</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/nuxt-link&gt;</span>\n        <span class="nt">&lt;nuxt-link</span> <span class="na">v-else</span> <span class="na">to=</span><span class="s">"/auth/signin"</span><span class="nt">&gt;</span>Sign In<span class="nt">&lt;/nuxt-link&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n      <span class="nt">&lt;h2&gt;</span>Updated with Cookie check in nuxt server init<span class="nt">&lt;/h2&gt;</span>\n      <span class="nt">&lt;p&gt;</span>\n        Unprotected page --- anyone can see this\n      <span class="nt">&lt;/p&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/section&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n  <span class="k">import</span> <span class="p">{</span> <span class="nx">mapGetters</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuex</span><span class="dl">\'</span>\n\n  <span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n    <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>\n      <span class="p">...</span><span class="nx">mapGetters</span><span class="p">(</span><span class="dl">\'</span><span class="s1">modules/user</span><span class="dl">\'</span><span class="p">,</span> <span class="p">[</span>\n        <span class="dl">\'</span><span class="s1">uid</span><span class="dl">\'</span>\n      <span class="p">])</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="c1">//略</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>\n\n<p>以上です。<br>\n間違いなどありましたらご指摘いただけるとありがたいです。</p>\n',body:'davidroyerさんの[nuxt-ssr-firebase-auth.v2](https://github.com/davidroyer/nuxt-ssr-firebase-auth.v2)というリポジトリをベースに解説していきます。\n\n# はじめに\n\nこの記事では\n\nsection1.未認証ユーザーをはじく実装\nsection2.新規登録(Email)の実装\nsection3.新規登録(Googleアカウント)の実装\nsection4.nuxtServerInitによる自動認証\n\nの順でソースを読んで行きます。\n\n## 認証方式\n認証の実装はGoogleアカウントorEmailの2種類。\nFirebase認証のソリューションは2つありますが、今回利用するのはFirebase SDK Authenticationです。後で詳しく触れます。\n大まかな流れは、\nクライアントのEmail・パスワードからJWTを取得 ⇒ storeとcookieに保存 ⇒ 認証です。sessionは利用しません。\n\n認証におけるJWT(Json Web Token)の利用について下記がわかりやすいと思います。「JWT」と「cookieのsessionによる認証」の2つを比較した記事ですが、JWTをlocalStrageやcookieに保存する点での注意事項も記載されています。\n[JWT・Cookieそれぞれの認証方式のメリデメ比較](https://qiita.com/doyaaaaaken/items/02357c2ebca994160804)\n\n簡単に説明すると、JSON Web Tokenとは、ユーザー識別用のIDと有効期限が含まれた改ざん検証が可能なデータです。「ログイン済みです」という証をクライアント側が保持しているんですね。見た目はドット区切りで　{base64エンコードしたuserデータ}.{base64エンコードした有効期限}.{署名}　というフォーマットです。別のユーザーになりすまそうとして改ざんしたり、有効期限を改ざんしても署名による検証でひっかかります。\n\n## ディレクトリ構造\nこの記事の説明に関連するディレクトリの構造は下記です。\n\n\n```\n  ├firebase/\n  |  └app.js\n  ├helpers/\n  |  └index.js\n  ├layouts/\n  |  ├default.vue\n  |  └protected.vue\n  ├middleware/\n  |  ├authenticated.js\n  |  ├check-auth.js\n  |  └handle-login-route.js\n  ├page/\n  |  ├index.vue  //topページ\n  |  ├auth/\n  |  |  ├signin.vue\n  |  |  └signup.vue\n  |  └protected/\n  |     └index.vue //認証済みのユーザーのみ閲覧可能。\n  └store\n     ├modules/\n     |  └user.js\n     └index.js\n```\n\n# リーディング\nまずは認証されていないユーザーがどのようにはじかれているのかを確認するところからはじめます！\n## section1.未認証ユーザーをはじく\n未認証のユーザーをはじく機能はlayoutsとmiddleware、そしてstoreが担っています。\n\npage -- > layouts --\x3e middleware -- >storeの順でソースを見てみましょう。\n\n### page/protected/index.vue\n\n- page/index.vueは認証不要なトップページ\n- page/protected/index.vueは認証済みユーザーのみアクセスできるページです。\n\n今回の実装の場合、「認証不要なページ」と「認証済みユーザーのみアクセスできるページ」の違いはlayoutにprotectedを指定しているか否かだけです。\n新たにページを作る際も、これを指定するだけで未認証ユーザーをはじくことができます。\n\npageにおける実装のコードもたったの1行。\n\n```javascript:page/protected/index.vue\n//...略\n<script>\n  import { mapGetters } from \'vuex\'\n  import firebaseApp from \'~/firebase/app.js\'\n\n  export default {\n    layout: \'protected\', //ここでlayoutを指定しています。\n    data () {\n//...略\n```\n\nでは次にこのlayoutでは何を行っているのかを見てみます。\n\n### layoutsは以下の2つ\nリポジトリを見るとlayoutsは2つのみです。それぞれの役割は下記。\n\n```\n--|layouts/\n----|default.vue   //誰でも見れるページ用\n----|protected.vue //認証済みユーザーのみのページ用\n```\n\nもちろん、default.vueでは特別な処理は行いません。肝心なのはprotected.vueの方です。コードは以下。\n\n\n```javascript:layouts/protected.vue\n\n//...略\n<script>\n  import { mapActions } from \'vuex\'\n\n  export default {\n    middleware: \'authenticated\', //ここでmiddlewareを指定しています。\n    methods: {\n//...略\n```\n\nNuxt.jsにおけるmiddlewareの適用方法をここで改めて整理しておきます。全部で3つあります。\n\n1. nuxt.config.jsで指定\n2. layoutでミドルウェアを指定 --\x3e pageでlayoutを読み込む\n3. 各ページでミドルウェアを指定。\n\n今回はlayoutで指定する2番ですね。\nmiddlewareはページがレンダリングされる前に実行されます。\n\n今回の実装では、レンダリング前に「認証済みか否かをチェックして未認証の場合はリダイレクトする」ことで未認証ユーザーを弾いていることがわかります。ではmiddlewareのコードを見てみましょう。\n\n### middlewareのソース\n\n```\n--|middleware/\n----|authenticated.js //上記で呼び出されていたmiddleware\n----|check-auth.js\n----|handle-login-route.js \n```\nそれぞれの役割は以下です。\n\n| 名前     | 役割     |\n| ---------- | ---------- |\n| authenticated.js      | 認証済みかチェック。未認証ならsign inページへリダイレクト。未認証ユーザーがprotectedページへ遷移しようとしたときに実行されます。      |\n| check-auth.js      | ご自由に使えます。中身はstore/index.jsと似ています。      |\n|handle-login-route.js       |認証済みかチェック。認証済みならprotectedへリダイレクト。認証済みユーザーがログインページへ遷移しようとしたときに実行されます。      |\n\nlayouts/protected.vueで呼び出されていたauthenticated.jsのコードは次のようになっています。\n\n```javascript:authenticated.js\nexport default function ({ store, redirect }) {\n  if (!store.getters[\'modules/user/isAuthenticated\']) {\n    return redirect(\'/auth/signin\')\n  }\n}\n```\ngettersでstoreからisAuthenticatedを取得していますね。\nこのisAuthenticatedで認証済/未認証チェックを行い、falseの場合はsigninページへリダイレクトしています。\n\n\nちなみに、Nuxt.js公式のmiddlewareの解説もほとんど同じコードです。公式の場合はpageに直接middlewareを指定している例ですね。[API: middleware プロパティ 公式](https://ja.nuxtjs.org/api/pages-middleware/)\n\n### 最後にstoreです\n\n```\n--|store/\n----|index.js\n----|modules/\n------|user.js  //上記で呼び出していたstore\n```\nそれぞれの役割は下記\n\n| 名前     | 役割     |\n| ---------- | ---------- |\n| index.js       | nuxtServerInitでcookieをチェック。認証データがあれば自動ログインさせます。       |\n| user.js       | userデータを保持。login/logout/cookieへのデータ登録を行います。認証済みかチェックするためには、userデータが存在するかどうかをチェックします。       |\n\n\nuser.jsのソースを見てみます。\n\n\n```javascript:store/modules/user.js\nimport firebaseApp from \'~/firebase/app\'\nimport Cookies from \'js-cookie\'\n// state\nexport const state = () => ({\n  uid: null,  //userのID\n  user: null  //userのデータ\n})\n\n\n// getters\nexport const getters = {\n  uid(state) {\n    if (state.user && state.user.uid) return state.user.uid\n    else return null\n  },\n  user(state) {\n    return state.user\n  },\n  \n  //上記middlewareで呼び出されていた認証チェック\n  isAuthenticated(state) {\n    return !!state.user && !!state.user.uid\n  }\n}\n\nexport const actions = {\n//略\n```\nisAuthenticatedではuserのidが存在するかをチェックしていることがわかりますね。省略しましたが、先述の通りuser.jsはlogin/logoutの機能も担っています。新規登録の実装を見ながらlogin/logoutの機能にも触れていきます。\n\n\n## section2.新規登録(Email)の実装\nこのセクションではfirebaseAppの機能も参照しながら、新規登録の実装を読んでいきます。\n\n### 前提の確認\n1. 上記の認証の流れから、新規登録時にはuser.jsのstate.userにデータを格納しているのだろうというのはわかっています。\n2. 新規登録はGoogleアカウントとEmailの2つが利用できます。\n\n改めてpagesの構造です。役割も追記しました。\n\n```\n--|page/\n----|index.vue  //topページ\n----|auth/\n------|signin.vue //次のsectionで扱う。Googleアカウントによる新規登録を担う。\n------|signup.vue //このsectionで扱う。Emailによる新規登録を担う。\n----|protected/\n------|index.vue //前section1。認証済みのユーザーのみ閲覧可能。\n```\n\nGoogleアカウントとEmailでそれぞれ新規登録のpageが異なりますね。\nでは、まずはEmailの方から見ていきましょう。\n\n### その前に認証ソリューションもおさらい\nソースを見る前に改めてfirebaseの認証ソリューションをおさらいしておきます。\n大きく2つの方法があります。\n\n| 名前     | 解説     |\n| ---------- | ---------- |\n| FirebaseUI Auth        | FirebaseUI に備わっているドロップイン認証ソリューションは、メールアドレスとパスワード、電話番号を使用したり、Google ログインや Facebook ログインなどの一般的なフェデレーション ID プロバイダを使用したりしてユーザーをログインさせるための UI フローを処理します。        |\n| Firebase SDK Authentication       | 1つまたは複数のログイン方法を手動でアプリに統合することができる。メールアドレスとパスワードを使用した認証、Google、Facebook、Twitter、GitHub アカウントを使用した認証、電話番号認証、匿名認証など。      |\n\n[Firebase Authentication 公式](https://firebase.google.com/docs/auth?hl=ja)より一部引用。\nGoogle推奨のソリューションはFirebaseUI Authですが、今回扱っているのはFirebase SDK Authenticationです。\n\n公式のJavaScriptによる認証の解説ページは[こちら](https://firebase.google.com/docs/auth/web/password-auth?hl=ja)。\n\n\n### signup.vue（Email登録）\nさっそくコードを見ていきます。\n\n\n```pages/auth/signup.vue\n<template>\n  <section class="container">\n    <div>\n      \x3c!-- ログインページへのリンク --\x3e\n      <nuxt-link to="/auth/signin">Already a user? Sign-in</nuxt-link>\n    </div>\n    <div>\n      \x3c!-- サインアップ --\x3e\n      <form @submit.prevent="signUp">\n        <label for="usernameTxt">Username:</label>\n        <input id="usernameTxt" type="text" v-model="email">\n        <label for="passwordTxt">Password:</label>\n        <input id="passwordTxt" type="password" v-model="password">\n        <button type="submit">Sign Up</button>\n      </form>\n    </div>\n  </section>\n</template>\n\n<script>\nimport { mapActions } from \'vuex\'\nimport firebaseApp from \'~/firebase/app\'\nexport default {\n  data () {\n    return {\n      email: \'\',\n      password: \'\'\n    }\n  },\n  methods: {\n    ...mapActions(\'modules/user\', [ \'login\' ]),\n    async signUp () {\n      try {\n        const firebaseUser = await　 firebaseApp.auth().createUserWithEmailAndPassword(this.email, this.password) //①\n        \n        await this.writeUserData(firebaseUser.uid, firebaseUser.email) //この1行は一旦無視\n        await this.login(firebaseUser.uid) //②\n        this.$router.push(\'/protected\') //③\n      } catch (error) {\n        console.log(error.message)\n      }\n    },\n    writeUserData (userId, email) {\n      return firebaseApp.database().ref(\'users/\' + userId).set({\n        email: email\n      })\n    }\n  }\n}\n<\/script>\n\n<style scoped>\n//略\n```\n\n上記コメントの①②③の順で見ていきます。\n大まかに、以下の流れです。\n\n- ①でfirebaseの認証\n- ②でstoreへの登録、cookieへの登録\n- ③でリダイレクト\n\n#### ①createUserWithEmailAndPassword\nEmailとパスワードから新規アカウントを作成するには、\ncreateUserWithEmailAndPasswordを利用します。\n[公式のAPIリファレンスページはこちら。](https://firebase.google.com/docs/reference/js/firebase.auth.Auth.html?hl=ja#createuserwithemailandpassword)\n\n```\ncreateUserWithEmailAndPassword(email: string, password: string): Promise<UserCredential>\n```\n\n2つのstring（emailとpassword）を受けて、Promiseを返します。\nまた、新しいアカウントが作成されると、そのユーザーは自動的にログインされた状態になります。\nUser情報はUserCredentialから参照することができます。フェデレーション ID プロバイダ(Googleアカウント・Facebookアカウントなど）での認証時にはproviderIDなどの情報も参照できるようです。\n\n\n#### ②storeへの登録、cookieへの登録\n①で「新しいアカウントが作成されると、そのユーザーは自動的にログインされた状態になります。」と述べましたが、storeやcookieにログイン情報を登録しておかないとNuxt.jsは認証ユーザーか未認証ユーザーかの判別がつきません。\n\n②ではその処理を行っています。\n①で取得したデータ（firebaseUser）をstoreに登録するために呼び出しているthis.login(firebaseUser.uid)。\nstore/modules/user.jsでそのソースを見てみましょう。以下のコメント「ログイン処理」の部分です。\n\n```javascript:store/modules/user.js\nimport firebaseApp from \'~/firebase/app\'\nimport Cookies from \'js-cookie\'\n//略\nexport const actions = {\n  //ログイン処理\n  async login({dispatch, state}, user) {\n    console.log(\'[STORE ACTIONS] - login\')\n    const token = await firebaseApp.auth().currentUser.getIdToken(true) //②-1\n    const userInfo = {\n      name: user.displayName,\n      email: user.email,\n      avatar: user.photoURL,\n      uid: user.uid\n    }\n    Cookies.set(\'access_token\', token)  //②-2\n    await dispatch(\'setUSER\', userInfo) //②-3\n    await dispatch(\'saveUID\', userInfo.uid)\n    console.log(\'[STORE ACTIONS] - in login, response:\', status)\n\n  },\n  //ログアウト処理\n  async logout({commit, dispatch}) {\n    console.log(\'[STORE ACTIONS] - logout\')\n    await firebaseApp.auth().signOut()\n\n    Cookies.remove(\'access_token\');\n    commit(\'setUSER\', null)\n    commit(\'saveUID\', null)\n  },\n//略\n```\n##### ②-1 currentUser.getIdToken(true) \nログインしているユーザーは、firebaseApp.auth().currentUserで取得できます。\n②では、更にgetIdTokenメソッドを呼び出してJWT(JSON Web Token)を取得しています。\n\n```\ngetIdToken(forceRefresh?: boolean): Promise<string>\n```\n\n[公式レファレンス User getIdToken](https://firebase.google.com/docs/reference/js/firebase.User.html?hl=ja#getidtoken)\n\n##### ②-2 Cookies.set\n取得したJWTをcookieにセット。\n##### ②-3 dispatch(\'setUSER\', userInfo)\nuserデータをstoreに保存。\nログアウト処理を見ると、ログアウト時にcookieとstoreからuserデータを削除しているのも確認できますね。\n\n##### ③でリダイレクト\nリダイレクト時にはstoreにuserデータが保存されているので、section1で見たmiddlewareも素通りできます。\nちなみに無視した1行はデータベースへのユーザー情報の登録です。このリポジトリはログインしたユーザーがデータベースのユーザー情報を閲覧できるようなデモになっています。今回は扱わないのでpages/protected/index.vueを参照ください。\n\n## section3.新規登録(Googleアカウント)の実装\nGoogleアカウントによる認証もほとんど同じです。\n\n### pages/auth/signin.vue(Googleアカウントによる新規登録)\n既存ユーザーのログイン処理のコードが目立ちますが、fbGoogleLoginの処理を見ていきます。\n\n```pages/auth/signin.vue\n<template>\n  <section class="container">\n    <div>\n      <nuxt-link to="/auth/signup">Not a user? Sign-up</nuxt-link>\n    </div>\n    <div>\n      <form @submit.prevent="submit">//このformは既存ユーザーのログイン処理用\n        <label for="usernameTxt">Username:</label>\n        <input id="usernameTxt" type="email" v-model="email">\n        <label for="passwordTxt">Password:</label>\n        <input id="passwordTxt" type="password" v-model="password">\n        <button type="submit">Sign In</button>\n      </form>\n      //以下を見ていきます。\n      <button class="button" @click.prevent="fbGoogleLogin">Google Login</button>\n      <button class="button" @click.prevent="fbGoogleLogout">Google Logout</button>\n    </div>\n  </section>\n</template>\n\n<script>\nimport { mapActions } from "vuex";\nimport firebaseApp, { googleProvider } from "~/firebase/app";\n\nexport default {\n  data() {\n    return {\n      email: "",\n      password: ""\n    };\n  },\n  //section1で触れたようにログイン済みのユーザーはこのページにアクセスできません。middlewareでリダイレクトされます。\n  middleware: ["handle-login-route"], \n  methods: {\n    ...mapActions("modules/user", ["login"]),\n    //既存ユーザーのlogin処理\n    submit() { \n      firebaseApp\n        .auth()\n        .signInWithEmailAndPassword(this.email, this.password)\n        .then(firebaseUser => {\n          return this.login(firebaseUser.uid);\n        })\n        .then(() => {\n          this.$router.push("/protected");\n        })\n        .catch(error => {\n          console.log(error.message);\n        });\n    },\n    //Googleアカウントによるログイン\n    async fbGoogleLogin() {\n      const { user } = await firebaseApp.auth().signInWithPopup(googleProvider);　//③-1\n      await this.login(user); //③-2\n      this.$router.push("/protected");\n    },\n    async fbGoogleLogout() {\n      await this.logout();\n      this.$router.push("/");\n    }\n  }\n};\n<\/script>\n//略\n```\n\nここで利用しているのはfirebaseApp.auth().signInWithPopup(googleProvider)。\n戻り値は先程のcreateUserWithEmailAndPassword(email: string, password: string)と同じPromise<UserCredential>ですね。\n\n```\nsignInWithPopup(provider: AuthProvider): Promise<UserCredential>\n```\n[公式レファレンス](https://firebase.google.com/docs/reference/js/firebase.auth.Auth.html?hl=ja#signinwithpopup)\n\n##### ③-1 firebaseApp.auth().signInWithPopup\n引数で渡しているgoogleProviderはあらかじめ~/firebase/appでexportしてあるものを読み込んでいます。SDKから簡単に作れます。\n##### ③-2 login\n③-1で取得したUserCredentialのデータをuserに格納し、先のEmail認証と同じくlogin処理をstoreに投げてログインを完了させています。\n\n#### login処理\nここまでくれば、上記sumit()によるログイン処理もなんとなく想像がつくと思います。再度抜粋します。\n\n```javascript\nsubmit() { //既存ユーザーのlogin処理\n  firebaseApp\n    .auth()\n    .signInWithEmailAndPassword(this.email, this.password)  //tokenの取得\n    .then(firebaseUser => {\n      return this.login(firebaseUser.uid);  //store・cookieへの登録\n    })\n    .then(() => {\n      this.$router.push("/protected");  //リダイレクト\n    })\n    .catch(error => {\n      console.log(error.message);\n    });\n```\n\n## section4.nuxtServerInitによる自動認証\nここまでで認証関連はほとんど説明しました。\n\n最後に、cookieを利用したログインしっぱなしの状態の実現を見てみます。\n以下の記事にもあるように、storeのデータは簡単に飛んでしまいます。\n\n> - window.location や href でページ遷移すると、Storeに格納にした状態が飛ぶ。理由としてはページが初回ロード扱いとなるため。nuxtServerInitアクションで状態を復元するコードを書かなくてはならない。\n>- NuxtLink や this.$router.pushを使用してページ遷移すると、ページが初期化されないため状態が維持される。\n\n[Nuxt.js 状態管理でハマった件 Qiita](https://qiita.com/shintarogit/items/c14cf6156201e0b8667a)\n\nログイン状態を維持するためには欠かせない処理ですね。\n\nまずは、store/index.jsを見てみます。\n\n```javascript:store/index.js\nimport {getUserFromCookie, getUserFromSession} from \'@/helpers\'\n\nexport const actions = {\n\n  async nuxtServerInit ({ dispatch }, { req }) {\n    const user = getUserFromCookie(req)\n    if (user) {\n      await dispatch(\'modules/user/setUSER\', { name: user.name, email: user.email, avatar: user.picture, uid: user.user_id})\n    }\n  }\n}\n```\n\nnuxtServerInitで/helpers/index.jsのgetUserFromCookie()を呼び出しています。\n\ngetUserFromCookie()のソースは\n\n```javascript:/helpers/index.js\nimport jwtDecode from \'jwt-decode\'\nvar cookieparser = require(\'cookieparser\')\n\nexport function getUserFromCookie (req) {\n  if (process.server && process.static) return //①\n  if (!req.headers.cookie) return //②\n\n  if (req.headers.cookie) {\n    const parsed = cookieparser.parse(req.headers.cookie)\n    const accessTokenCookie = parsed.access_token\n    if (!accessTokenCookie) return\n\n    const decodedToken = jwtDecode(accessTokenCookie) //③\n    if (!decodedToken) return\n\n    return decodedToken\n  }\n}\n// 略\n```\ngetUserFromCookieで行っているのは、cookieからアクセストークンを取り出して、jwtDecodeにかけて返すところまでですね。\n\n### ①でチェックしているのは、\n\n- サーバーサイドの処理であるか否か\n- nuxt genrateで作られた静的サイトであるか否か\n\nページがサーバでレンダリングされている時にcookieを探しても意味はないので、どちらかがtrueの場合は処理しません。\n\n[プラグイン利用 nuxt.js公式](https://ja.nuxtjs.org/guide/plugins/#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E9%99%90%E5%AE%9A%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E5%88%A9%E7%94%A8)\n\n### ②cookieが無い場合は処理しません。\n\n### ③JWTをデコード。\nJWTをデコード。その後、store/index.jsに戻って、デコードされたデータから、ユーザーの名前やemailアドレス、idを取り出しstoreにdispatchしています。\n\nこうしてserverinitが完了した後、トップページのindex.vueにレンダリングが行われます。下記のソースgettersでuidを取得できるのでSigninではなく、Logoutのリンクが表示されることがわかります。\n\n```pages/index.vue\n//略\n<template>\n  <section>\n    <div>\n      <div>\n        <nuxt-link to="/protected">Protected</nuxt-link>\n        <nuxt-link v-if="uid" to="/auth/signin">Logout</nuxt-link>\n        <nuxt-link v-else to="/auth/signin">Sign In</nuxt-link>\n      </div>\n      <h2>Updated with Cookie check in nuxt server init</h2>\n      <p>\n        Unprotected page --- anyone can see this\n      </p>\n    </div>\n  </section>\n</template>\n\n<script>\n  import { mapGetters } from \'vuex\'\n\n  export default {\n    computed: {\n      ...mapGetters(\'modules/user\', [\n        \'uid\'\n      ])\n    }\n  }\n//略\n```\n\n# 最後に\n\n以上です。\n間違いなどありましたらご指摘いただけるとありがたいです。\n',coediting:a,comments_count:1,created_at:"2019-11-24T23:10:30+09:00",group:s,id:"acd6a17bb6e2a2f7a932",likes_count:41,private:a,reactions_count:0,tags:[{name:u,versions:[]},{name:e,versions:[]},{name:"FirebaseAuth",versions:[]}],title:"SSRモードのNuxtでのFirebase認証",updated_at:"2019-11-26T18:23:36+09:00",url:"https://qiita.com/basho/items/acd6a17bb6e2a2f7a932",user:{description:I,facebook_id:n,followees_count:15,followers_count:3,github_login_name:$,id:L,items_count:14,linkedin_id:n,location:n,name:"kom",organization:n,permanent_id:89564,profile_image_url:B,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>Nuxt.jsでFirebaseUIを使ってログイン機能を作ってみました。<br>\nソースコードはこちらにあります(<a href="https://github.com/mk422756/nuxt-firebaseui-sample" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mk422756/nuxt-firebaseui-sample</a>) </p>\n\n<h1>\n<span id="firebaseuiとは" class="fragment"></span><a href="#firebaseui%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>FirebaseUIとは？</h1>\n\n<p>FirebaseUI(<a href="https://github.com/firebase/firebaseui-web" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/firebase/firebaseui-web</a>) はFirebase Authenticationを簡単に使用するために、Firebaseがあらかじめ用意してくれているUIです。</p>\n\n<p>今回はNuxt.jsを使用してFirebaseUIのWeb版を組み込んでいきます。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2Ff2a8d220-aa1c-1bb9-2051-d82dec54ddfb.gif?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=43cb0ce54002c877f88fb936fe0f902b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2Ff2a8d220-aa1c-1bb9-2051-d82dec54ddfb.gif?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=43cb0ce54002c877f88fb936fe0f902b" alt="firebaseui.gif" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/f2a8d220-aa1c-1bb9-2051-d82dec54ddfb.gif" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2Ff2a8d220-aa1c-1bb9-2051-d82dec54ddfb.gif?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=9cc8e9423f54913d3b53007b4cd03df9 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h1>\n\n<h3>\n<span id="必要なもの" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>必要なもの</h3>\n\n<ul>\n<li>Nuxt.jsをインストールするためのNode.js環境</li>\n<li>Firebaseプロジェクトを作成するアカウント</li>\n</ul>\n\n<h3>\n<span id="firebaseのセットアップ" class="fragment"></span><a href="#firebase%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>Firebaseのセットアップ</h3>\n\n<p>Firebaseのプロジェクトを作成します。<br>\nこちらの記事(<a href="https://blog.katsubemakito.net/firebase/firebase-make-newproject" class="autolink" rel="nofollow noopener" target="_blank">https://blog.katsubemakito.net/firebase/firebase-make-newproject</a>) を参考にしてプロジェクトを作成します。<br>\nプロジェクト名は適当で構いません。</p>\n\n<p>次に、Authenticationで使用するプロバイダーを有効化します。<br>\nコンソールから [Authentication] &gt; [ログイン方法] に移動し、各プロバイダの設定を行います。<br>\nとりあえず、メールアドレスとGoogle認証を有効化します。<br>\nTwitter等の外部IDプロバイダを設定しようとすると、TwitterAPIキー等が必要になります。<br>\nAPIキーを取得するには申請が必要だったり面倒なので、今回は省略します。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F875c14fa-019d-5e65-6e14-0758537e6d01.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=8b46befaf8f84a939a45803fba14da2c" target="_blank" rel="nofollow noopener"><img width="1151" alt="Screen Shot 2019-11-24 at 11.45.52.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F875c14fa-019d-5e65-6e14-0758537e6d01.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=8b46befaf8f84a939a45803fba14da2c" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/875c14fa-019d-5e65-6e14-0758537e6d01.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F875c14fa-019d-5e65-6e14-0758537e6d01.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=6d4e2c461e62e4cc76a7a8d30af70806 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="nuxtjsのセットアップ" class="fragment"></span><a href="#nuxtjs%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>Nuxt.jsのセットアップ</h3>\n\n<p>Nuxt.jsと必要なライブラリをインストールしていきます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>npx create-nuxt-app nuxt-firebaseui-sample\n</pre></div></div>\n\n<p>Nuxt.jsのセットアップです。設定を色々聞かれますがデフォルトでOKです。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F24512b23-1d84-9884-2eec-cfdbbbd10af2.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=c10495c51f1a92d00123fd4b10f39a23" target="_blank" rel="nofollow noopener"><img width="684" alt="Screen Shot 2019-11-23 at 18.24.14.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F24512b23-1d84-9884-2eec-cfdbbbd10af2.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=c10495c51f1a92d00123fd4b10f39a23" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/24512b23-1d84-9884-2eec-cfdbbbd10af2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F24512b23-1d84-9884-2eec-cfdbbbd10af2.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=bc89e5644aafbc8ce92b93debac297be 1x" loading="lazy"></a></p>\n\n<p>セットアップが完了したら、次はライブラリをインストールしていきます。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>\n<span class="nb">cd </span>nuxt-firebaseui-sample\nnpm <span class="nb">install</span> <span class="nt">--save</span> firebase firebaseui\nnpm <span class="nb">install</span> <span class="nt">--save-dev</span> @nuxtjs/dotenv\n</pre></div></div>\n\n<p>firebaseとfirebaseuiは認証に必要です。<br>\n@nuxtjs/dotenvは.env設定ファイルから環境変数を設定するために使用します。APIキーなどの設定値をGitで管理したくない場合に便利です。</p>\n\n<p>dotenvを使用するために、nuxt.config.jsに以下の設定を追加します。</p>\n\n<div class="code-frame" data-lang="javascript"><div class="highlight"><pre>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">buildModules</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">@nuxtjs/dotenv</span><span class="dl">\'</span><span class="p">],</span>\n<span class="p">};</span>\n</pre></div></div>\n\n<p>次にプロジェクトのルートに.envを作成し、Firebaseの設定を記述します。<br>\nFirebaseの設定値は、作成したFirebaseプロジェクトの [プロジェクトの設定] &gt; [アプリの追加] でアプリを追加すると表示されます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>FB_API_KEY=AIzaxxxx-xxxxxxxxxxxxxxxx\nFB_AUTH_DOMAIN=uitest-xxxxx.firebaseapp.com\nFB_DATABASE_URL=https://uitest-xxxxx.firebaseio.com\nFB_PROJECT_ID=uitest-xxxxx\nFB_STORAGE_BUCKET=uitest-xxxxx.appspot.com\nFB_MESSAGE_SENDER_ID=3000000000\nFB_APPID=1:300000000:web:671xxxxxxxxxxxxxx\n</pre></div></div>\n\n<h1>\n<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h1>\n\n<h3>\n<span id="firebaseuiの表示" class="fragment"></span><a href="#firebaseui%E3%81%AE%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>FirebaseUIの表示</h3>\n\n<p>今回は認証画面が表示されて、ログインすることができるだけのシンプルなページを作成します。<br>\nまず、components/Auth.vue を作成し、認証用のコンポーネントを作成します。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"firebaseui-auth-container"</span><span class="nt">&gt;&lt;/div&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">firebase</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebase</span><span class="dl">"</span><span class="p">);</span>\n    <span class="kd">const</span> <span class="nx">firebaseui</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseui</span><span class="dl">"</span><span class="p">);</span>\n    <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseui/dist/firebaseui.css</span><span class="dl">"</span><span class="p">);</span>\n\n    <span class="kd">const</span> <span class="nx">uiConfig</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">signInSuccessUrl</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span>\n      <span class="na">signInOptions</span><span class="p">:</span> <span class="p">[</span>\n        <span class="nx">firebaseui</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">AnonymousAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">EmailAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">GoogleAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">FacebookAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">TwitterAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">GithubAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">PhoneAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span>\n      <span class="p">]</span>\n    <span class="p">};</span>\n    <span class="kd">const</span> <span class="nx">firebaseConfig</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_API_KEY</span><span class="p">,</span>\n      <span class="na">authDomain</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_AUTH_DOMAIN</span><span class="p">,</span>\n      <span class="na">databaseURL</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_DATABASE_URL</span><span class="p">,</span>\n      <span class="na">projectId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_PROJECT_ID</span><span class="p">,</span>\n      <span class="na">storageBucket</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_STORAGE_BUCKET</span><span class="p">,</span>\n      <span class="na">messagingSenderId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_MESSAGE_SENDER_ID</span>\n    <span class="p">};</span>\n    <span class="nx">firebase</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">(</span><span class="nx">firebaseConfig</span><span class="p">);</span>\n\n    <span class="kd">const</span> <span class="nx">ui</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">firebaseui</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">AuthUI</span><span class="p">(</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">());</span>\n    <span class="nx">ui</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="dl">"</span><span class="s2">#firebaseui-auth-container</span><span class="dl">"</span><span class="p">,</span> <span class="nx">uiConfig</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p>mountedの中でFirebaseUI等をrequireしてるのは、FirebaseUIはSSRに対応していないからです。<br>\nSPAで動かすのならimportで大丈夫だと思います。<br>\n次に、Firebaseの初期化を行いFirebaseUIをスタートします。引数で指定したidのタグにFirebaseUIが表示されます。<br>\nFirebaseの初期化は.envで設定した設定値を使用します。<br>\nFirebaseUIのパラメータで使用するプロバイダを指定します。Twitter等は有効化していないためログイン等は失敗しますが、とりあえず表示させておきます。</p>\n\n<p>次に、pages/index.vueからAuth.vueを使用します。</p>\n\n<div class="code-frame" data-lang="vuejs"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div&gt;</span>\n        <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;</span>FirebaseUI サンプル<span class="nt">&lt;/h1&gt;</span>\n        <span class="nt">&lt;auth</span> <span class="nt">/&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">Auth</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">~/components/Auth.vue</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">Auth</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">style</span><span class="nt">&gt;</span>\n<span class="nc">.container</span> <span class="p">{</span>\n  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>\n  <span class="nl">min-height</span><span class="p">:</span> <span class="m">100vh</span><span class="p">;</span>\n  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>\n  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>\n  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>\n  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nc">.title</span> <span class="p">{</span>\n  <span class="nl">font-family</span><span class="p">:</span> <span class="s1">"Quicksand"</span><span class="p">,</span> <span class="s1">"Source Sans Pro"</span><span class="p">,</span> <span class="n">-apple-system</span><span class="p">,</span> <span class="n">BlinkMacSystemFont</span><span class="p">,</span>\n    <span class="s1">"Segoe UI"</span><span class="p">,</span> <span class="n">Roboto</span><span class="p">,</span> <span class="s1">"Helvetica Neue"</span><span class="p">,</span> <span class="n">Arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>\n  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>\n  <span class="nl">font-weight</span><span class="p">:</span> <span class="m">300</span><span class="p">;</span>\n  <span class="nl">font-size</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>\n  <span class="nl">color</span><span class="p">:</span> <span class="m">#35495e</span><span class="p">;</span>\n  <span class="nl">letter-spacing</span><span class="p">:</span> <span class="m">1px</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">style</span><span class="nt">&gt;</span>\n\n</pre></div></div>\n\n<p>開発用サーバーを起動します。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>npm run dev\n</pre></div></div>\n\n<p>これでFirebaseUIが表示され、新規登録とログインができるようになります。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F11028c34-7b35-2037-1edc-e2174de32b5c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=c9d579793f4bace362da468ea80fb91b" target="_blank" rel="nofollow noopener"><img width="311" alt="Screen Shot 2019-11-24 at 17.25.32.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F11028c34-7b35-2037-1edc-e2174de32b5c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=c9d579793f4bace362da468ea80fb91b" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/11028c34-7b35-2037-1edc-e2174de32b5c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2F11028c34-7b35-2037-1edc-e2174de32b5c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=8b2114e2b09d2dd9e95055b5727f739b 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="vuexで状態管理" class="fragment"></span><a href="#vuex%E3%81%A7%E7%8A%B6%E6%85%8B%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>Vuexで状態管理</h3>\n\n<p>ここまでで作成したもので、新規登録とログインはできるようになりました。<br>\nしかし、ログイン状態を管理していないため画面表示等ができません。<br>\nですのでVuexを使用して状態を管理していきます。</p>\n\n<p>まず、store/user.jsを作成し、ログインユーザーのメールアドレスと表示名を管理します。</p>\n\n<div class="code-frame" data-lang="js"><div class="highlight"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">email</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n  <span class="na">displayName</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n<span class="p">});</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">login</span> <span class="p">({</span><span class="nx">commit</span><span class="p">},</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">commit</span> <span class="p">(</span><span class="dl">\'</span><span class="s1">setEmail</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">);</span>\n    <span class="nx">commit</span> <span class="p">(</span><span class="dl">\'</span><span class="s1">setDisplayName</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">displayName</span><span class="p">);</span>\n  <span class="p">},</span>\n  <span class="nx">logout</span><span class="p">({</span><span class="nx">commit</span><span class="p">})</span> <span class="p">{</span>\n    <span class="nx">commit</span> <span class="p">(</span><span class="dl">\'</span><span class="s1">setEmail</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'\'</span><span class="p">);</span>\n    <span class="nx">commit</span> <span class="p">(</span><span class="dl">\'</span><span class="s1">setDisplayName</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'\'</span><span class="p">);</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">setEmail</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">email</span><span class="p">;</span>\n  <span class="p">},</span>\n  <span class="nx">setDisplayName</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">displayName</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">=</span> <span class="nx">displayName</span><span class="p">;</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">getters</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">isLogin</span><span class="p">:</span> <span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="o">!!</span><span class="nx">state</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>\n  <span class="p">},</span>\n  <span class="na">displayName</span><span class="p">:</span> <span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">displayName</span><span class="p">;</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n\n</pre></div></div>\n\n<p>ログイン時と、ログアウト時のアクションを定義しています。<br>\nまた、ログイン状態と表示名を返すゲッターも定義しています。</p>\n\n<p>次に、components/Auth.vueから定義したアクションを使用します。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">v-show=</span><span class="s">"isLogin"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"login"</span><span class="nt">&gt;</span>ログイン中<span class="nt">&lt;/p&gt;</span>\n      <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"name"</span><span class="nt">&gt;</span>名前：<span class="si">{{</span> <span class="nx">displayName</span> <span class="si">}}</span><span class="nt">&lt;/p&gt;</span>\n      <span class="nt">&lt;button</span> <span class="err">@</span><span class="na">click=</span><span class="s">"logout"</span><span class="nt">&gt;</span>ログアウト<span class="nt">&lt;/button&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">v-show=</span><span class="s">"!isLogin"</span> <span class="na">id=</span><span class="s">"firebaseui-auth-container"</span><span class="nt">&gt;&lt;/div&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">isLogin</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="dl">"</span><span class="s2">user/isLogin</span><span class="dl">"</span><span class="p">];</span>\n    <span class="p">},</span>\n    <span class="nx">displayName</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="dl">"</span><span class="s2">user/displayName</span><span class="dl">"</span><span class="p">];</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">logout</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">"</span><span class="s2">user/logout</span><span class="dl">"</span><span class="p">);</span>\n      <span class="kd">const</span> <span class="nx">firebase</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebase</span><span class="dl">"</span><span class="p">);</span>\n      <span class="nx">firebase</span>\n        <span class="p">.</span><span class="nx">auth</span><span class="p">()</span>\n        <span class="p">.</span><span class="nx">signOut</span><span class="p">()</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">ログアウトしました</span><span class="dl">"</span><span class="p">);</span>\n        <span class="p">});</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">firebase</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebase</span><span class="dl">"</span><span class="p">);</span>\n    <span class="kd">const</span> <span class="nx">firebaseui</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseui</span><span class="dl">"</span><span class="p">);</span>\n    <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseui/dist/firebaseui.css</span><span class="dl">"</span><span class="p">);</span>\n\n    <span class="kd">const</span> <span class="nx">uiConfig</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">signInSuccessUrl</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span>\n      <span class="na">signInOptions</span><span class="p">:</span> <span class="p">[</span>\n        <span class="nx">firebaseui</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">AnonymousAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">EmailAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">GoogleAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">FacebookAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">TwitterAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">GithubAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span><span class="p">,</span>\n        <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">PhoneAuthProvider</span><span class="p">.</span><span class="nx">PROVIDER_ID</span>\n      <span class="p">]</span>\n    <span class="p">};</span>\n    <span class="kd">const</span> <span class="nx">firebaseConfig</span> <span class="o">=</span> <span class="p">{</span>\n      <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_API_KEY</span><span class="p">,</span>\n      <span class="na">authDomain</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_AUTH_DOMAIN</span><span class="p">,</span>\n      <span class="na">databaseURL</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_DATABASE_URL</span><span class="p">,</span>\n      <span class="na">projectId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_PROJECT_ID</span><span class="p">,</span>\n      <span class="na">storageBucket</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_STORAGE_BUCKET</span><span class="p">,</span>\n      <span class="na">messagingSenderId</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FB_MESSAGE_SENDER_ID</span>\n    <span class="p">};</span>\n    <span class="nx">firebase</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">(</span><span class="nx">firebaseConfig</span><span class="p">);</span>\n\n    <span class="kd">const</span> <span class="nx">ui</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">firebaseui</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">AuthUI</span><span class="p">(</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">());</span>\n    <span class="nx">ui</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="dl">"</span><span class="s2">#firebaseui-auth-container</span><span class="dl">"</span><span class="p">,</span> <span class="nx">uiConfig</span><span class="p">);</span>\n\n    <span class="nx">firebase</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">onAuthStateChanged</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">"</span><span class="s2">user/login</span><span class="dl">"</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>\n    <span class="p">});</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="nt">&lt;</span><span class="k">style</span> <span class="na">scoped</span><span class="nt">&gt;</span>\n<span class="nc">.login</span> <span class="p">{</span>\n  <span class="nl">font-size</span><span class="p">:</span> <span class="m">1.25rem</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nc">.name</span> <span class="p">{</span>\n  <span class="nl">font-size</span><span class="p">:</span> <span class="m">1.1rem</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">style</span><span class="nt">&gt;</span>\n\n</pre></div></div>\n\n<p>firebase.auth().onAuthStateChangedを使用すると、ログイン状態の変更をトリガーにして処理が行われます。<br>\nこれを使用して、ログイン状態をVuexに渡します。<br>\nまた、ログイン中であればユーザーの表示名とログアウトボタンを表示します。<br>\nlogoutメソッドでは、signOutメソッドを使用し、signOutに成功するとVuexの状態をリセットするアクションを呼び出しています。</p>\n\n<p>これで、Vuexを使用してログイン状態を保持し、ログイン状態に応じて画面表示を切り替えることができました。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2Ff7ea6af0-86de-081a-abe7-f62289fcf73a.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=7d137b49b033b53abe640db6d42ad62a" target="_blank" rel="nofollow noopener"><img width="315" alt="Screen Shot 2019-11-24 at 18.04.25.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2Ff7ea6af0-86de-081a-abe7-f62289fcf73a.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=7d137b49b033b53abe640db6d42ad62a" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/f7ea6af0-86de-081a-abe7-f62289fcf73a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F29504%2Ff7ea6af0-86de-081a-abe7-f62289fcf73a.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=c1de8744c16be9ab0a2faab6f6d572ae 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="firebaseuiの日本語化" class="fragment"></span><a href="#firebaseui%E3%81%AE%E6%97%A5%E6%9C%AC%E8%AA%9E%E5%8C%96"><i class="fa fa-link"></i></a>FirebaseUIの日本語化</h3>\n\n<p>各言語にローカライズするためには、自分でFirebaseUIをビルドする必要があります。<br>\nすいませんが、今回は省略します。。。<br>\nfirebaseui-ja(<a href="https://www.npmjs.com/package/firebaseui-ja" class="autolink" rel="nofollow noopener" target="_blank">https://www.npmjs.com/package/firebaseui-ja</a>) というパッケージも存在しますが、バージョンの更新が止まっているので注意が必要です。</p>\n\n<h1>\n<span id="所感" class="fragment"></span><a href="#%E6%89%80%E6%84%9F"><i class="fa fa-link"></i></a>所感</h1>\n\n<p>非常に簡単にログイン画面を作成できるのでとても便利だと思いました。<br>\n特にTwitter等のIDプロバイダとの連携を自前のUIで作成すると、IDプロパイダごとの処理とUIが必要なので、その手間が省けるのが非常に便利だと思いました。</p>\n',body:'Nuxt.jsでFirebaseUIを使ってログイン機能を作ってみました。\nソースコードはこちらにあります(https://github.com/mk422756/nuxt-firebaseui-sample) \n# FirebaseUIとは？\nFirebaseUI(https://github.com/firebase/firebaseui-web) はFirebase Authenticationを簡単に使用するために、Firebaseがあらかじめ用意してくれているUIです。\n\n今回はNuxt.jsを使用してFirebaseUIのWeb版を組み込んでいきます。\n![firebaseui.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/f2a8d220-aa1c-1bb9-2051-d82dec54ddfb.gif)\n\n#セットアップ\n### 必要なもの\n- Nuxt.jsをインストールするためのNode.js環境\n- Firebaseプロジェクトを作成するアカウント\n\n### Firebaseのセットアップ\nFirebaseのプロジェクトを作成します。\nこちらの記事(https://blog.katsubemakito.net/firebase/firebase-make-newproject) を参考にしてプロジェクトを作成します。\nプロジェクト名は適当で構いません。\n\n次に、Authenticationで使用するプロバイダーを有効化します。\nコンソールから [Authentication] > [ログイン方法] に移動し、各プロバイダの設定を行います。\nとりあえず、メールアドレスとGoogle認証を有効化します。\nTwitter等の外部IDプロバイダを設定しようとすると、TwitterAPIキー等が必要になります。\nAPIキーを取得するには申請が必要だったり面倒なので、今回は省略します。\n<img width="1151" alt="Screen Shot 2019-11-24 at 11.45.52.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/875c14fa-019d-5e65-6e14-0758537e6d01.png">\n\n\n### Nuxt.jsのセットアップ\nNuxt.jsと必要なライブラリをインストールしていきます。\n\n```\nnpx create-nuxt-app nuxt-firebaseui-sample\n```\nNuxt.jsのセットアップです。設定を色々聞かれますがデフォルトでOKです。\n<img width="684" alt="Screen Shot 2019-11-23 at 18.24.14.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/24512b23-1d84-9884-2eec-cfdbbbd10af2.png">\n\nセットアップが完了したら、次はライブラリをインストールしていきます。\n\n```bash\n\ncd nuxt-firebaseui-sample\nnpm install --save firebase firebaseui\nnpm install --save-dev @nuxtjs/dotenv\n```\n\nfirebaseとfirebaseuiは認証に必要です。\n@nuxtjs/dotenvは.env設定ファイルから環境変数を設定するために使用します。APIキーなどの設定値をGitで管理したくない場合に便利です。\n\ndotenvを使用するために、nuxt.config.jsに以下の設定を追加します。\n\n```javascript\n\nexport default {\n  buildModules: [\'@nuxtjs/dotenv\'],\n};\n```\n\n次にプロジェクトのルートに.envを作成し、Firebaseの設定を記述します。\nFirebaseの設定値は、作成したFirebaseプロジェクトの [プロジェクトの設定] > [アプリの追加] でアプリを追加すると表示されます。\n\n```\nFB_API_KEY=AIzaxxxx-xxxxxxxxxxxxxxxx\nFB_AUTH_DOMAIN=uitest-xxxxx.firebaseapp.com\nFB_DATABASE_URL=https://uitest-xxxxx.firebaseio.com\nFB_PROJECT_ID=uitest-xxxxx\nFB_STORAGE_BUCKET=uitest-xxxxx.appspot.com\nFB_MESSAGE_SENDER_ID=3000000000\nFB_APPID=1:300000000:web:671xxxxxxxxxxxxxx\n```\n\n#実装\n###FirebaseUIの表示\n今回は認証画面が表示されて、ログインすることができるだけのシンプルなページを作成します。\nまず、components/Auth.vue を作成し、認証用のコンポーネントを作成します。\n\n```vue\n<template>\n  <div>\n    <div id="firebaseui-auth-container"></div>\n  </div>\n</template>\n<script>\nexport default {\n  mounted() {\n    const firebase = require("firebase");\n    const firebaseui = require("firebaseui");\n    require("firebaseui/dist/firebaseui.css");\n\n    const uiConfig = {\n      signInSuccessUrl: "/",\n      signInOptions: [\n        firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID,\n        firebase.auth.EmailAuthProvider.PROVIDER_ID,\n        firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n        firebase.auth.FacebookAuthProvider.PROVIDER_ID,\n        firebase.auth.TwitterAuthProvider.PROVIDER_ID,\n        firebase.auth.GithubAuthProvider.PROVIDER_ID,\n        firebase.auth.PhoneAuthProvider.PROVIDER_ID\n      ]\n    };\n    const firebaseConfig = {\n      apiKey: process.env.FB_API_KEY,\n      authDomain: process.env.FB_AUTH_DOMAIN,\n      databaseURL: process.env.FB_DATABASE_URL,\n      projectId: process.env.FB_PROJECT_ID,\n      storageBucket: process.env.FB_STORAGE_BUCKET,\n      messagingSenderId: process.env.FB_MESSAGE_SENDER_ID\n    };\n    firebase.initializeApp(firebaseConfig);\n\n    const ui = new firebaseui.auth.AuthUI(firebase.auth());\n    ui.start("#firebaseui-auth-container", uiConfig);\n  }\n};\n<\/script>\n```\nmountedの中でFirebaseUI等をrequireしてるのは、FirebaseUIはSSRに対応していないからです。\nSPAで動かすのならimportで大丈夫だと思います。\n次に、Firebaseの初期化を行いFirebaseUIをスタートします。引数で指定したidのタグにFirebaseUIが表示されます。\nFirebaseの初期化は.envで設定した設定値を使用します。\nFirebaseUIのパラメータで使用するプロバイダを指定します。Twitter等は有効化していないためログイン等は失敗しますが、とりあえず表示させておきます。\n\n次に、pages/index.vueからAuth.vueを使用します。\n\n```vuejs\n<template>\n  <div>\n    <div class="container">\n      <div>\n        <h1 class="title">FirebaseUI サンプル</h1>\n        <auth />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Auth from "~/components/Auth.vue";\n\nexport default {\n  components: {\n    Auth\n  }\n};\n<\/script>\n\n<style>\n.container {\n  margin: 0 auto;\n  min-height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n}\n\n.title {\n  font-family: "Quicksand", "Source Sans Pro", -apple-system, BlinkMacSystemFont,\n    "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n  display: block;\n  font-weight: 300;\n  font-size: 30px;\n  color: #35495e;\n  letter-spacing: 1px;\n}\n</style>\n\n```\n\n開発用サーバーを起動します。\n\n```bash\nnpm run dev\n```\nこれでFirebaseUIが表示され、新規登録とログインができるようになります。\n<img width="311" alt="Screen Shot 2019-11-24 at 17.25.32.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/11028c34-7b35-2037-1edc-e2174de32b5c.png">\n\n###Vuexで状態管理\nここまでで作成したもので、新規登録とログインはできるようになりました。\nしかし、ログイン状態を管理していないため画面表示等ができません。\nですのでVuexを使用して状態を管理していきます。\n\nまず、store/user.jsを作成し、ログインユーザーのメールアドレスと表示名を管理します。\n\n```js\nexport const state = () => ({\n  email: \'\',\n  displayName: \'\',\n});\n\nexport const actions = {\n  login ({commit}, user) {\n    commit (\'setEmail\', user.email);\n    commit (\'setDisplayName\', user.displayName);\n  },\n  logout({commit}) {\n    commit (\'setEmail\', \'\');\n    commit (\'setDisplayName\', \'\');\n  },\n};\n\nexport const mutations = {\n  setEmail (state, email) {\n    state.email = email;\n  },\n  setDisplayName (state, displayName) {\n    state.displayName = displayName;\n  },\n};\n\nexport const getters = {\n  isLogin: state => {\n    return !!state.email;\n  },\n  displayName: state => {\n    return state.displayName;\n  },\n};\n\n```\nログイン時と、ログアウト時のアクションを定義しています。\nまた、ログイン状態と表示名を返すゲッターも定義しています。\n\n次に、components/Auth.vueから定義したアクションを使用します。\n\n```vue\n<template>\n  <div>\n    <div v-show="isLogin">\n      <p class="login">ログイン中</p>\n      <p class="name">名前：{{ displayName }}</p>\n      <button @click="logout">ログアウト</button>\n    </div>\n    <div v-show="!isLogin" id="firebaseui-auth-container"></div>\n  </div>\n</template>\n<script>\nexport default {\n  computed: {\n    isLogin() {\n      return this.$store.getters["user/isLogin"];\n    },\n    displayName() {\n      return this.$store.getters["user/displayName"];\n    }\n  },\n  methods: {\n    logout() {\n      this.$store.dispatch("user/logout");\n      const firebase = require("firebase");\n      firebase\n        .auth()\n        .signOut()\n        .then(() => {\n          console.log("ログアウトしました");\n        });\n    }\n  },\n  mounted() {\n    const firebase = require("firebase");\n    const firebaseui = require("firebaseui");\n    require("firebaseui/dist/firebaseui.css");\n\n    const uiConfig = {\n      signInSuccessUrl: "/",\n      signInOptions: [\n        firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID,\n        firebase.auth.EmailAuthProvider.PROVIDER_ID,\n        firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n        firebase.auth.FacebookAuthProvider.PROVIDER_ID,\n        firebase.auth.TwitterAuthProvider.PROVIDER_ID,\n        firebase.auth.GithubAuthProvider.PROVIDER_ID,\n        firebase.auth.PhoneAuthProvider.PROVIDER_ID\n      ]\n    };\n    const firebaseConfig = {\n      apiKey: process.env.FB_API_KEY,\n      authDomain: process.env.FB_AUTH_DOMAIN,\n      databaseURL: process.env.FB_DATABASE_URL,\n      projectId: process.env.FB_PROJECT_ID,\n      storageBucket: process.env.FB_STORAGE_BUCKET,\n      messagingSenderId: process.env.FB_MESSAGE_SENDER_ID\n    };\n    firebase.initializeApp(firebaseConfig);\n\n    const ui = new firebaseui.auth.AuthUI(firebase.auth());\n    ui.start("#firebaseui-auth-container", uiConfig);\n\n    firebase.auth().onAuthStateChanged(user => {\n      this.$store.dispatch("user/login", user);\n    });\n  }\n};\n<\/script>\n<style scoped>\n.login {\n  font-size: 1.25rem;\n}\n.name {\n  font-size: 1.1rem;\n}\n</style>\n\n```\nfirebase.auth().onAuthStateChangedを使用すると、ログイン状態の変更をトリガーにして処理が行われます。\nこれを使用して、ログイン状態をVuexに渡します。\nまた、ログイン中であればユーザーの表示名とログアウトボタンを表示します。\nlogoutメソッドでは、signOutメソッドを使用し、signOutに成功するとVuexの状態をリセットするアクションを呼び出しています。\n\nこれで、Vuexを使用してログイン状態を保持し、ログイン状態に応じて画面表示を切り替えることができました。\n<img width="315" alt="Screen Shot 2019-11-24 at 18.04.25.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/29504/f7ea6af0-86de-081a-abe7-f62289fcf73a.png">\n\n\n###FirebaseUIの日本語化\n各言語にローカライズするためには、自分でFirebaseUIをビルドする必要があります。\nすいませんが、今回は省略します。。。\nfirebaseui-ja(https://www.npmjs.com/package/firebaseui-ja) というパッケージも存在しますが、バージョンの更新が止まっているので注意が必要です。\n\n\n#所感\n非常に簡単にログイン画面を作成できるのでとても便利だと思いました。\n特にTwitter等のIDプロバイダとの連携を自前のUIで作成すると、IDプロパイダごとの処理とUIが必要なので、その手間が省けるのが非常に便利だと思いました。\n',coediting:a,comments_count:0,created_at:"2019-11-24T17:56:53+09:00",group:s,id:"ec171aff67bdf583cf46",likes_count:5,private:a,reactions_count:0,tags:[{name:c,versions:[]},{name:u,versions:[]},{name:e,versions:[]}],title:"Nuxt.jsでFirebaseUIを使ってログイン機能を作る",updated_at:"2019-11-25T08:01:45+09:00",url:"https://qiita.com/GIGU/items/ec171aff67bdf583cf46",user:{description:"渋谷でエンジニアしてます。",facebook_id:n,followees_count:0,followers_count:0,github_login_name:"k422756",id:"GIGU",items_count:1,linkedin_id:n,location:n,name:n,organization:n,permanent_id:29504,profile_image_url:"https://2.gravatar.com/avatar/ea25f67e2f5aa31944eb49bf646331d5?d=https%3A%2F%2Fidenticons.github.com%2F54952ac36fb9abb8a11abb3ab3c21e85.png",team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="vue-i18nとnuxt-i18nがあるけど" class="fragment"></span><a href="#vue-i18n%E3%81%A8nuxt-i18n%E3%81%8C%E3%81%82%E3%82%8B%E3%81%91%E3%81%A9"><i class="fa fa-link"></i></a>vue-i18nとnuxt-i18nがあるけど...</h1>\n\n<h3>\n<span id="nuxt-i18n-を使用します" class="fragment"></span><a href="#nuxt-i18n-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a><font color="red">nuxt-i18n</font> を使用します</h3>\n\n<ul>\n<li>nuxt-i18nの方が更新が活発なのでこちらを使っていこうという単純な理由です。</li>\n<li>もう1つ、<a href="https://github.com/nuxt-community/nuxt-i18n" rel="nofollow noopener" target="_blank">nuxt-community/nuxt-i18n</a>のREADMEの通りにやってもいいのですが<font color="salmon">メンテがしにくい</font>と思い、<code>プラグインとして登録</code>し、メッセージを定義したjsonファイルを読み込むようにします。（+ 言語として日本語を設定）</li>\n</ul>\n\n<h1>\n<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h1>\n\n<ul>\n<li>2019年11月23日現在の最新6.4.0をインストール</li>\n</ul>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>npm install --save nuxt-i18n@6.4.0\n</pre></div></div>\n\n<ul>\n<li>package.json確認</li>\n</ul>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="c1">//省略</span>\n<span class="dl">"</span><span class="s2">dependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="c1">//省略</span>\n    <span class="dl">"</span><span class="s2">nuxt-i18n</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^6.4.0</span><span class="dl">"</span><span class="p">,</span>\n    <span class="c1">//省略</span>\n  <span class="p">},</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="プラグインを作成する" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>プラグインを作成する</h1>\n\n<ul>\n<li>\n<a href="https://github.com/nuxt-community/nuxt-i18n" rel="nofollow noopener" target="_blank">nuxt-community/nuxt-i18n</a>のREADMEの通りにやってもいいのですが、メンテがしにくいと思い<code>プラグインとして登録</code>し、メッセージを定義したjsonファイルを読み込むようにします。（+ 言語として日本語を設定）</li>\n<li>\n<code>plugins/nuxt-i18n.ts</code>を作成。<code>locales/ja.json</code>に定義されているメッセージを読み込む設定。</li>\n</ul>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt-i18n.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">VueI18n</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-i18n</span><span class="dl">\'</span>\n\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">VueI18n</span><span class="p">)</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">({</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">store</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// Set i18n instance on app</span>\n  <span class="c1">// This way we can use it in middleware and pages asyncData/fetch</span>\n  <span class="nx">app</span><span class="p">.</span><span class="nx">i18n</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VueI18n</span><span class="p">({</span>\n    <span class="na">locale</span><span class="p">:</span> <span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">locale</span><span class="p">,</span>\n    <span class="na">fallbackLocale</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">ja</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">messages</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">ja</span><span class="p">:</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">~/locales/ja.json</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">})</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">i18n</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VueI18n</span><span class="p">({</span>\n  <span class="na">locale</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">ja</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="na">messages</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">ja</span><span class="p">:</span> <span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">~/locales/ja.json</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n\n</pre></div>\n</div>\n\n<h1>\n<span id="メッセージ定義ファイルjajsonを作成" class="fragment"></span><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E5%AE%9A%E7%BE%A9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%ABjajson%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>メッセージ定義ファイル（<code>ja.json</code>）を作成</h1>\n\n<ul>\n<li>一部抜粋してますが、<code>error</code>、<code>info</code>などでIDのprefixを分けるとメンテがしやすいと思います。</li>\n</ul>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">ja.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"E-0001"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] の参照権限がありません。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"E-0002"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] の編集権限がありません。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"E-0003"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] は入力必須です。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"E-0004"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] は選択必須です。"</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="nl">"warn"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"W-0001"</span><span class="p">:</span><span class="w"> </span><span class="s2">"表示対象[0] が[1] 以上存在します。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"W-0002"</span><span class="p">:</span><span class="w"> </span><span class="s2">"メール通知に失敗しました。自ら通知メールを送ってください。"</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="nl">"info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"I-0001"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] が完了しました。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"I-0002"</span><span class="p">:</span><span class="w"> </span><span class="s2">"メール通知に成功しました。"</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="nl">"confirm"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"C-0001"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] します。よろしいですか。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"C-0002"</span><span class="p">:</span><span class="w"> </span><span class="s2">"編集内容は保存されていません。編集内容を破棄してよろしいですか。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"C-0003"</span><span class="p">:</span><span class="w"> </span><span class="s2">"同一名の[0]が存在します。更新してもよろしいですか。"</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="nl">"placeHolder"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"P-0001"</span><span class="p">:</span><span class="w"> </span><span class="s2">"パスワード"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"P-0002"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E-mail"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"P-0003"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10文字以上で入力下さい。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"P-0004"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100文字以内で入力下さい。"</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="nl">"tooltip"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n\n</span></pre></div>\n</div>\n\n<h1>\n<span id="nuxtconfigtsの編集" class="fragment"></span><a href="#nuxtconfigts%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>nuxt.config.tsの編集</h1>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.ts</span></div>\n<div class="highlight"><pre><span class="nx">plugins</span><span class="p">:</span> <span class="p">[</span>\n    <span class="dl">\'</span><span class="s1">@/plugins/nuxt-i18n.ts</span><span class="dl">\'</span>\n  <span class="p">],</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="使用する" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>使用する</h1>\n\n<ul>\n<li>importして<code>i18n.tc</code>で対象のメッセージを指定するだけ。</li>\n<li>例えばユーザ登録後にログイン画面に遷移させた際のメッセージの出力を例にすると...以下の通り。</li>\n</ul>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">login.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Mixins</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span>\n<span class="c1">//省略</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">i18n</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/plugins/nuxt-i18n</span><span class="dl">\'</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">Login</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="c1">//省略</span>\n  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">CommonModule</span><span class="p">.</span><span class="nx">SignUpJobDone</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">i18n</span><span class="p">.</span><span class="nx">tc</span><span class="p">(</span><span class="dl">\'</span><span class="s1">info.I-0003</span><span class="dl">\'</span><span class="p">)</span>  <span class="c1">//ココ</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="結果の確認" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>結果の確認</h1>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F303093%2Ff9bdec9a-ced8-8082-8737-06161d94046b.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=49de30ca63020f8870dea7971d42d7dd" target="_blank" rel="nofollow noopener"><img width="1128" alt="スクリーンショット 2019-11-24 9.31.15.jpg" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F303093%2Ff9bdec9a-ced8-8082-8737-06161d94046b.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=49de30ca63020f8870dea7971d42d7dd" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/303093/f9bdec9a-ced8-8082-8737-06161d94046b.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F303093%2Ff9bdec9a-ced8-8082-8737-06161d94046b.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=6f8e4d2203b548ccfaaa39826ab0d5b1 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="パラメータがあるとき" class="fragment"></span><a href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%8C%E3%81%82%E3%82%8B%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>パラメータがあるとき</h1>\n\n<ul>\n<li>メッセージの動的部分を文字配列の値で置き換え、置き換えた後のメッセージを返却する関数を自作します。</li>\n</ul>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">common-message.ts</span></div>\n<div class="highlight"><pre>\n<span class="cm">/**\n * @param baseMessage メッセージ\n * @param args 文字配列\n * @param original メッセージ返却フラグ\n * @example baseMessage："[0]しました。", args["ログイン"] ＝＞ "ログインしました。"\n * @returns 置き換えた後のメッセージ\n */</span>\n<span class="k">export</span> <span class="kd">function</span> <span class="nx">editMessage</span><span class="p">(</span>\n  <span class="nx">baseMessage</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>\n  <span class="nx">args</span><span class="p">:</span> <span class="nx">string</span><span class="p">[],</span>\n  <span class="nx">original</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="kc">false</span>\n<span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>\n  <span class="k">if</span> <span class="p">(</span><span class="nx">isNotParam</span><span class="p">(</span><span class="nx">baseMessage</span><span class="p">))</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="dl">\'\'</span>\n  <span class="p">}</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="nx">isNotParam</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">||</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="nx">baseMessage</span>\n    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="dl">\'\'</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n\n  <span class="kd">let</span> <span class="nx">rtnMessage</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">baseMessage</span>\n  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">rtnMessage</span> <span class="o">=</span> <span class="nx">rtnMessage</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">\'</span><span class="s1">[</span><span class="dl">\'</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="dl">\'</span><span class="s1">]</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>\n  <span class="p">}</span>\n\n  <span class="k">return</span> <span class="nx">rtnMessage</span>\n<span class="p">}</span>\n\n<span class="cm">/**\n * 引数に値が設定されていないかの判定。\n *\n * @param value チェック対象\n * @returns 結果(true:設定なし、false：設定あり)\n */</span>\n<span class="kd">function</span> <span class="nx">isNotParam</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">any</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>\n  <span class="kd">let</span> <span class="nx">rtn</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="kc">false</span>\n\n  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">\'\'</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">rtn</span> <span class="o">=</span> <span class="kc">true</span>\n  <span class="p">}</span>\n  <span class="k">return</span> <span class="nx">rtn</span>\n<span class="p">}</span>\n\n</pre></div>\n</div>\n\n<ul>\n<li>lacaleのjsonの方は以下のようになります。</li>\n</ul>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">ja.json</span></div>\n<div class="highlight"><pre><span class="nl">"info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"I-0001"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0] が完了しました。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"I-0002"</span><span class="p">:</span><span class="w"> </span><span class="s2">"メール通知に成功しました。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"I-0003"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ユーザの登録が完了しました。[0]してください。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"I-0004"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ログインしました。"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"I-0005"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[0]しました。"</span><span class="w">\n  </span><span class="p">}</span><span class="err">,</span><span class="w">\n</span></pre></div>\n</div>\n\n<h3>\n<span id="pagesで使う" class="fragment"></span><a href="#pages%E3%81%A7%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>pagesで使う</h3>\n\n<ul>\n<li>importして使います。</li>\n</ul>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">login.vue</span></div>\n<div class="highlight"><pre><span class="c1">//template省略</span>\n<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">CommonMessage</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/utils/common-message</span><span class="dl">\'</span>\n\n\n<span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">isAlert</span> <span class="o">=</span> <span class="kc">false</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">CommonModule</span><span class="p">.</span><span class="nx">SignUpJobDone</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">isAlert</span> <span class="o">=</span> <span class="kc">true</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">success</span><span class="dl">\'</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">CommonMessage</span><span class="p">.</span><span class="nx">editMessage</span><span class="p">(</span><span class="nx">i18n</span><span class="p">.</span><span class="nx">tc</span><span class="p">(</span><span class="dl">\'</span><span class="s1">info.I-0005</span><span class="dl">\'</span><span class="p">),</span> <span class="p">[</span>\n        <span class="dl">\'</span><span class="s1">ログイン</span><span class="dl">\'</span>\n      <span class="p">])</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="結果確認" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>結果確認</h3>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F303093%2Fc602ed75-94fe-221d-454f-a88ffa1daa89.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=acb4f592a0ebc21029d208a65bd5d26c" target="_blank" rel="nofollow noopener"><img width="1680" alt="スクリーンショット 2019-11-26 23.36.37.jpg" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F303093%2Fc602ed75-94fe-221d-454f-a88ffa1daa89.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=acb4f592a0ebc21029d208a65bd5d26c" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/303093/c602ed75-94fe-221d-454f-a88ffa1daa89.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F303093%2Fc602ed75-94fe-221d-454f-a88ffa1daa89.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=23a41a3ce66e5b4ce80d13ea2a216afa 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="ok以上" class="fragment"></span><a href="#ok%E4%BB%A5%E4%B8%8A"><i class="fa fa-link"></i></a>OK!!以上！！</h1>\n',body:'# vue-i18nとnuxt-i18nがあるけど...\n### <font color="red">nuxt-i18n</font> を使用します\n- nuxt-i18nの方が更新が活発なのでこちらを使っていこうという単純な理由です。\n- もう1つ、[nuxt-community/nuxt-i18n](https://github.com/nuxt-community/nuxt-i18n)のREADMEの通りにやってもいいのですが<font color="salmon">メンテがしにくい</font>と思い、`プラグインとして登録`し、メッセージを定義したjsonファイルを読み込むようにします。（+ 言語として日本語を設定）\n\n# インストール\n- 2019年11月23日現在の最新6.4.0をインストール\n\n```\nnpm install --save nuxt-i18n@6.4.0\n```\n- package.json確認\n\n```javascript:package.json\n//省略\n"dependencies": {\n    //省略\n    "nuxt-i18n": "^6.4.0",\n    //省略\n  },\n```\n\n#プラグインを作成する\n- [nuxt-community/nuxt-i18n](https://github.com/nuxt-community/nuxt-i18n)のREADMEの通りにやってもいいのですが、メンテがしにくいと思い`プラグインとして登録`し、メッセージを定義したjsonファイルを読み込むようにします。（+ 言語として日本語を設定）\n- `plugins/nuxt-i18n.ts`を作成。`locales/ja.json`に定義されているメッセージを読み込む設定。\n\n```javascript:nuxt-i18n.ts\nimport Vue from \'vue\'\nimport VueI18n from \'vue-i18n\'\n\nVue.use(VueI18n)\n\nexport default ({ app, store }) => {\n  // Set i18n instance on app\n  // This way we can use it in middleware and pages asyncData/fetch\n  app.i18n = new VueI18n({\n    locale: store.state.locale,\n    fallbackLocale: \'ja\',\n    messages: {\n      ja: require(\'~/locales/ja.json\')\n    }\n  })\n}\n\nexport const i18n = new VueI18n({\n  locale: \'ja\',\n  messages: {\n    ja: require(\'~/locales/ja.json\')\n  }\n})\n\n```\n\n# メッセージ定義ファイル（`ja.json`）を作成\n- 一部抜粋してますが、`error`、`info`などでIDのprefixを分けるとメンテがしやすいと思います。\n\n```json:ja.json\n{\n  "error": {\n    "E-0001": "[0] の参照権限がありません。",\n    "E-0002": "[0] の編集権限がありません。",\n    "E-0003": "[0] は入力必須です。",\n    "E-0004": "[0] は選択必須です。"\n  },\n  "warn": {\n    "W-0001": "表示対象[0] が[1] 以上存在します。",\n    "W-0002": "メール通知に失敗しました。自ら通知メールを送ってください。"\n  },\n  "info": {\n    "I-0001": "[0] が完了しました。",\n    "I-0002": "メール通知に成功しました。"\n  },\n  "confirm": {\n    "C-0001": "[0] します。よろしいですか。",\n    "C-0002": "編集内容は保存されていません。編集内容を破棄してよろしいですか。",\n    "C-0003": "同一名の[0]が存在します。更新してもよろしいですか。"\n  },\n  "placeHolder": {\n    "P-0001": "パスワード",\n    "P-0002": "E-mail",\n    "P-0003": "10文字以上で入力下さい。",\n    "P-0004": "100文字以内で入力下さい。"\n  },\n  "tooltip": {}\n}\n\n```\n\n# nuxt.config.tsの編集\n\n```javascript:nuxt.config.ts\nplugins: [\n    \'@/plugins/nuxt-i18n.ts\'\n  ],\n```\n\n# 使用する\n- importして`i18n.tc`で対象のメッセージを指定するだけ。\n- 例えばユーザ登録後にログイン画面に遷移させた際のメッセージの出力を例にすると...以下の通り。\n\n```vue:login.vue\n<script lang="ts">\nimport { Component, Mixins } from \'vue-property-decorator\'\n//省略\nimport { i18n } from \'~/plugins/nuxt-i18n\'\n\n@Component({})\nexport default class Login extends Vue {\n  //省略\n  created() {\n    if (CommonModule.SignUpJobDone) {\n      this.message = i18n.tc(\'info.I-0003\')  //ココ\n    }\n  }\n}\n```\n\n# 結果の確認\n<img width="1128" alt="スクリーンショット 2019-11-24 9.31.15.jpg" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/303093/f9bdec9a-ced8-8082-8737-06161d94046b.jpeg">\n\n# パラメータがあるとき\n- メッセージの動的部分を文字配列の値で置き換え、置き換えた後のメッセージを返却する関数を自作します。\n\n```typescript:common-message.ts\n\n/**\n * @param baseMessage メッセージ\n * @param args 文字配列\n * @param original メッセージ返却フラグ\n * @example baseMessage："[0]しました。", args["ログイン"] ＝＞ "ログインしました。"\n * @returns 置き換えた後のメッセージ\n */\nexport function editMessage(\n  baseMessage: string,\n  args: string[],\n  original: boolean = false\n): string {\n  if (isNotParam(baseMessage)) {\n    return \'\'\n  }\n\n  if (isNotParam(args) || args.length === 0) {\n    if (original) {\n      return baseMessage\n    } else {\n      return \'\'\n    }\n  }\n\n  let rtnMessage: string = baseMessage\n  for (let i = 0; i < args.length; i++) {\n    rtnMessage = rtnMessage.replace(\'[\' + i + \']\', args[i])\n  }\n\n  return rtnMessage\n}\n\n/**\n * 引数に値が設定されていないかの判定。\n *\n * @param value チェック対象\n * @returns 結果(true:設定なし、false：設定あり)\n */\nfunction isNotParam(value: any): boolean {\n  let rtn: boolean = false\n\n  if (value === null || value === \'\') {\n    rtn = true\n  }\n  return rtn\n}\n\n```\n\n- lacaleのjsonの方は以下のようになります。\n\n```json:ja.json\n"info": {\n    "I-0001": "[0] が完了しました。",\n    "I-0002": "メール通知に成功しました。",\n    "I-0003": "ユーザの登録が完了しました。[0]してください。",\n    "I-0004": "ログインしました。",\n    "I-0005": "[0]しました。"\n  },\n```\n\n### pagesで使う\n- importして使います。\n\n```javascript:login.vue\n//template省略\nimport * as CommonMessage from \'~/utils/common-message\'\n\n\ncreated() {\n    this.isAlert = false\n    if (CommonModule.SignUpJobDone) {\n      this.isAlert = true\n      this.type = \'success\'\n      this.message = CommonMessage.editMessage(i18n.tc(\'info.I-0005\'), [\n        \'ログイン\'\n      ])\n    }\n  }\n```\n\n### 結果確認\n<img width="1680" alt="スクリーンショット 2019-11-26 23.36.37.jpg" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/303093/c602ed75-94fe-221d-454f-a88ffa1daa89.jpeg">\n\n# OK!!以上！！\n',coediting:a,comments_count:0,created_at:"2019-11-24T09:39:30+09:00",group:s,id:"4ab9f3ba19f9d0baed13",likes_count:2,private:a,reactions_count:0,tags:[{name:"国際化",versions:[]},{name:c,versions:[]},{name:e,versions:[]},{name:"nuxt-i18n",versions:[]}],title:"Nuxt.jsでメッセージの外出し＆国際化対応",updated_at:"2019-11-26T23:39:48+09:00",url:"https://qiita.com/sukezane/items/4ab9f3ba19f9d0baed13",user:{description:"2019年より開始。\r\n都内SES2年目です。現在はNuxt.js案件。\r\nはてブ（実績管理用）：https://yosuke0517.hatenablog.com/archive\r\ntwitter:https://twitter.com/yosuke_takeuchi\r\nWeb系へのスキルチェンジを実施中。\r\n来年は「Go」触りたい。\r\n目標：月2件の投稿（継続中）",facebook_id:n,followees_count:4,followers_count:8,github_login_name:s,id:"sukezane",items_count:24,linkedin_id:n,location:"東京",name:"竹内 陽祐",organization:n,permanent_id:303093,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/303093/profile-images/1550586640",team_only:a,twitter_screen_name:"yosuke_takeuchi",website_url:"https://yosuke0517.hatenablog.com/archive"},page_views_count:s},{rendered_body:'\n<h2>\n<span id="nuxtjsで開発したアプリのimageからdockerコンテナを起動" class="fragment"></span><a href="#nuxtjs%E3%81%A7%E9%96%8B%E7%99%BA%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AEimage%E3%81%8B%E3%82%89docker%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>Nuxt.jsで開発したアプリのImageからDockerコンテナを起動</h2>\n\n<p>前提として、<code>Nuxt.js</code>で開発したアプリのImage(<code>イメージ名：test</code>)をビルドしたこととします。</p>\n\n<p><code>Dockerfile</code>を作成して、Imageをビルドする方法は下の記事にまとめているので、参考にしていただけると幸いです。</p>\n\n<p>参考：<a href="https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38" class="autolink" id="reference-f17403ba46cebd0ecda5">https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38</a></p>\n\n<p>早速、<code>docker run</code>で作成したImageからコンテナを起動しましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker run <span class="nt">--rm</span> <span class="nt">-p</span> 3000:3000 <span class="nb">test</span>\n<span class="go">yarn run v1.13.0\n</span><span class="gp">$</span> nuxt start\n<span class="go">ℹ Listening on: http://localhost:3000/\n</span></pre></div></div>\n\n<h2>\n<span id="localhostにアクセスするとerr_empty_responseのエラーが起きる" class="fragment"></span><a href="#localhost%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B%E3%81%A8err_empty_response%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E8%B5%B7%E3%81%8D%E3%82%8B"><i class="fa fa-link"></i></a>localhostにアクセスするとERR_EMPTY_RESPONSEのエラーが起きる</h2>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F307395%2Ffff780ba-80d7-e54e-3ac6-c87946ad1052.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f0d0d5f77c671432afecf7aeedc61d6a" target="_blank" rel="nofollow noopener"><img width="1536" alt="スクリーンショット 2019-11-24 2.43.58.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F307395%2Ffff780ba-80d7-e54e-3ac6-c87946ad1052.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=f0d0d5f77c671432afecf7aeedc61d6a" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/307395/fff780ba-80d7-e54e-3ac6-c87946ad1052.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F307395%2Ffff780ba-80d7-e54e-3ac6-c87946ad1052.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=c2025747efefdccecc066bce5e51914d 1x" loading="lazy"></a></p>\n\n<p>localhostでアクセスしましたが、<code>ERR_EMPTY_RESPONSE</code>のエラーが出てしまいました。</p>\n\n<h3>\n<span id="nuxtjsでerr_empty_responseが出る原因" class="fragment"></span><a href="#nuxtjs%E3%81%A7err_empty_response%E3%81%8C%E5%87%BA%E3%82%8B%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>Nuxt.jsでERR_EMPTY_RESPONSEが出る原因</h3>\n\n<p>本エラーの原因としては、ホストマシンとDockerコンテナのlocalhostは異なっているため、Dockerコンテナ内のサーバーを<code>yarn dev</code>等で、localhostでアクセス出来る状態にすると、ホストマシンからlocalhostへアクセスした場合にエラーが起きました。</p>\n\n<p>補足すると、Dockerコンテナもホストマシン(自分のPC)同様、以下のような使い方をしています。</p>\n\n<blockquote>\n<p>Docker コンテナは localhost:8000 や 0.0.0.0:8376 のような一般的なポートを割り当てて使います。<br>\n引用：<a href="http://docs.docker.jp/v1.11/engine/installation/mac.html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.docker.jp/v1.11/engine/installation/mac.html</a></p>\n</blockquote>\n\n<p>原因における厳密な解説は、下の記事にしっかりまとめられているので非常に参考になりました。<br>\n参考：<a href="https://qiita.com/amuyikam/items/01a8c16e3ddbcc734a46" class="autolink" id="reference-a71f65df5195d72766db">https://qiita.com/amuyikam/items/01a8c16e3ddbcc734a46</a></p>\n\n<p>※本記事では、Nuxt.jsをDockerコンテナ上のサーバーにlocalhostでアクセス出来る状態に出来ることが目的なのと、既に原因を調査されている方がいたので、この辺の説明は割愛させていただきました。(本記事で起きた問題の原因への理解については、上記記事で補完出来るかと思います。)</p>\n\n<p>また、Docker上のアプリに対して、localhostでアクセス出来ないもう1つの原因としては以下の引用のママですね。</p>\n\n<blockquote>\n<p>デフォルトでは、Nuxt の開発サーバーのホストは localhost（ホストマシン内からのみアクセスが可能）です。<br>\n引用：<a href="https://ja.nuxtjs.org/faq/host-port/" class="autolink" rel="nofollow noopener" target="_blank">https://ja.nuxtjs.org/faq/host-port/</a></p>\n</blockquote>\n\n<h3>\n<span id="nuxtjsでerr_empty_responseを解決する方法" class="fragment"></span><a href="#nuxtjs%E3%81%A7err_empty_response%E3%82%92%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>Nuxt.jsでERR_EMPTY_RESPONSEを解決する方法</h3>\n\n<blockquote>\n<p>ホストの 0.0.0.0 は、ホストマシンの 外部 の接続（例えば LAN）にアクセス可能なホストアドレスを解決するよう Nuxt に伝えるためにデザインされています。<br>\n引用：<a href="https://ja.nuxtjs.org/faq/host-port/" class="autolink" rel="nofollow noopener" target="_blank">https://ja.nuxtjs.org/faq/host-port/</a></p>\n</blockquote>\n\n<p><code>package.json</code>や<code>nuxt.config.js</code>に、上記の設定を追記することで、ホストマシンからDockerコンテナ上のサーバーにlocalhostでアクセスすることが出来ます。</p>\n\n<p>以下が設定のソースコードです。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">server</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">host</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">0.0.0.0</span><span class="dl">\'</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n  </span><span class="nl">"nuxt"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.0.0"</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>他にも設定方法は色々ありますが、公式ドキュメントを参考にするといいかと思います。</p>\n\n<p>参考：<a href="https://ja.nuxtjs.org/faq/host-port/" class="autolink" rel="nofollow noopener" target="_blank">https://ja.nuxtjs.org/faq/host-port/</a></p>\n\n<h2>\n<span id="imageを再構築してdockerコンテナを起動してlocalhostに再度アクセスする" class="fragment"></span><a href="#image%E3%82%92%E5%86%8D%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6docker%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6localhost%E3%81%AB%E5%86%8D%E5%BA%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Imageを再構築してDockerコンテナを起動してlocalhostに再度アクセスする</h2>\n\n<p><code>test2</code>というImage名でビルドしたという前提で話を進めます。</p>\n\n<p>実際に、そのImageからDockerコンテナを起動しましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker run <span class="nt">--rm</span> <span class="nt">-p</span> 3000:3000 test2\n<span class="go">yarn run v1.13.0\n</span><span class="gp">$</span> nuxt start\n<span class="go">ℹ Listening on: http://172.17.0.2:3000/\n</span></pre></div></div>\n\n<p>これで、localhostにアクセスしても、<code>ERR_EMPTY_RESPONSE</code>のエラーは出なくなりました。</p>\n',body:'## Nuxt.jsで開発したアプリのImageからDockerコンテナを起動\n\n前提として、`Nuxt.js`で開発したアプリのImage(`イメージ名：test`)をビルドしたこととします。\n\n`Dockerfile`を作成して、Imageをビルドする方法は下の記事にまとめているので、参考にしていただけると幸いです。\n\n参考：https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38\n\n早速、`docker run`で作成したImageからコンテナを起動しましょう。\n\n```terminal\n$ docker run --rm -p 3000:3000 test\nyarn run v1.13.0\n$ nuxt start\nℹ Listening on: http://localhost:3000/\n```\n\n## localhostにアクセスするとERR_EMPTY_RESPONSEのエラーが起きる\n\n<img width="1536" alt="スクリーンショット 2019-11-24 2.43.58.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/307395/fff780ba-80d7-e54e-3ac6-c87946ad1052.png">\n\nlocalhostでアクセスしましたが、`ERR_EMPTY_RESPONSE`のエラーが出てしまいました。\n\n### Nuxt.jsでERR_EMPTY_RESPONSEが出る原因\n\n本エラーの原因としては、ホストマシンとDockerコンテナのlocalhostは異なっているため、Dockerコンテナ内のサーバーを`yarn dev`等で、localhostでアクセス出来る状態にすると、ホストマシンからlocalhostへアクセスした場合にエラーが起きました。\n\n補足すると、Dockerコンテナもホストマシン(自分のPC)同様、以下のような使い方をしています。\n\n>Docker コンテナは localhost:8000 や 0.0.0.0:8376 のような一般的なポートを割り当てて使います。\n引用：http://docs.docker.jp/v1.11/engine/installation/mac.html\n\n原因における厳密な解説は、下の記事にしっかりまとめられているので非常に参考になりました。\n参考：https://qiita.com/amuyikam/items/01a8c16e3ddbcc734a46\n\n※本記事では、Nuxt.jsをDockerコンテナ上のサーバーにlocalhostでアクセス出来る状態に出来ることが目的なのと、既に原因を調査されている方がいたので、この辺の説明は割愛させていただきました。(本記事で起きた問題の原因への理解については、上記記事で補完出来るかと思います。)\n\nまた、Docker上のアプリに対して、localhostでアクセス出来ないもう1つの原因としては以下の引用のママですね。\n\n>デフォルトでは、Nuxt の開発サーバーのホストは localhost（ホストマシン内からのみアクセスが可能）です。\n引用：https://ja.nuxtjs.org/faq/host-port/\n\n### Nuxt.jsでERR_EMPTY_RESPONSEを解決する方法\n\n>ホストの 0.0.0.0 は、ホストマシンの 外部 の接続（例えば LAN）にアクセス可能なホストアドレスを解決するよう Nuxt に伝えるためにデザインされています。\n引用：https://ja.nuxtjs.org/faq/host-port/\n\n`package.json`や`nuxt.config.js`に、上記の設定を追記することで、ホストマシンからDockerコンテナ上のサーバーにlocalhostでアクセスすることが出来ます。\n\n以下が設定のソースコードです。\n\n```nuxt.config.js\nexport default {\n  server: {\n    host: \'0.0.0.0\'\n  }\n}\n```\n\n```package.json\n"config": {\n  "nuxt": {\n    "host": "0.0.0.0"\n  }\n}\n```\n\n他にも設定方法は色々ありますが、公式ドキュメントを参考にするといいかと思います。\n\n参考：https://ja.nuxtjs.org/faq/host-port/\n\n## Imageを再構築してDockerコンテナを起動してlocalhostに再度アクセスする\n\n`test2`というImage名でビルドしたという前提で話を進めます。\n\n実際に、そのImageからDockerコンテナを起動しましょう。\n\n```terminal\n$ docker run --rm -p 3000:3000 test2\nyarn run v1.13.0\n$ nuxt start\nℹ Listening on: http://172.17.0.2:3000/\n```\n\nこれで、localhostにアクセスしても、`ERR_EMPTY_RESPONSE`のエラーは出なくなりました。\n',coediting:a,comments_count:0,created_at:"2019-11-24T04:53:32+09:00",group:s,id:"bc87c9b66e7ea9710c6b",likes_count:1,private:a,reactions_count:0,tags:[{name:"localhost",versions:[]},{name:m,versions:[]},{name:e,versions:[]}],title:"【Nuxt.js】Dockerコンテナ上のサーバーにlocalhostでアクセスした時に出るERR_EMPTY_RESPONSEを解決する方法",updated_at:"2019-11-24T14:45:16+09:00",url:"https://qiita.com/arthur_foreign/items/bc87c9b66e7ea9710c6b",user:{description:x,facebook_id:n,followees_count:36,followers_count:o,github_login_name:E,id:i,items_count:19,linkedin_id:n,location:n,name:n,organization:A,permanent_id:y,profile_image_url:w,team_only:a,twitter_screen_name:i,website_url:j},page_views_count:s},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p><a href="https://typescript.nuxtjs.org/" rel="nofollow noopener" target="_blank">Nuxt TypeScript</a> でセットアップの手順は公式にて公開しているが、docker-composeを用いた構築の情報が少なかったので纏めてみた。</p>\n\n<p>また、Ver.2.9以降からTypeScriptへの導入手順が変わり、個人的に少し躓いた部分もあったのでその点も踏まえて共有しようと思う。</p>\n\n<h1>\n<span id="1-実行環境" class="fragment"></span><a href="#1-%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>1. 実行環境</h1>\n\n<ul>\n<li>macOS Catalina Ver.10.15.1</li>\n<li>Docker version 19.03.4, build 9013bf5</li>\n<li>docker-compose version 1.24.1, build 4667896b</li>\n<li>Nuxt.js Ver.2.10.2</li>\n<li>node.js 12.13.0-alpine</li>\n</ul>\n\n<h1>\n<span id="2-前提条件" class="fragment"></span><a href="#2-%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>2. 前提条件</h1>\n\n<ul>\n<li>Nuxt.js のバージョンが 2.9 以上である事。</li>\n<li>PC内に docker, docker-compose, node.js がインストールされている事。</li>\n</ul>\n\n<p>docker , docker-compose , node.js がインストールされていない場合は下記を実行すると良い。</p>\n\n<h2>\n<span id="21-docker-のインストール" class="fragment"></span><a href="#21-docker-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2.1. Docker のインストール</h2>\n\n<p>Docker をインストールする為に <a href="https://hub.docker.com/editions/community/docker-ce-desktop-mac" rel="nofollow noopener" target="_blank">DockerHub</a> にアクセスし、<code>Docker.dmg</code>をダウンロードする。<br>\n※ DockerHubを初めて利用する場合はアカウント作成が必要である。</p>\n\n<p><code>Docker.dmg</code>を起動すると、Dockerのインストールが行われるので、インストール完了後に Docker を Applications にコピーする。</p>\n\n<p>また、他の方法として<a href="https://brew.sh/index_ja" rel="nofollow noopener" target="_blank">Homebrew</a>と呼ばれるパッケージ管理システムを用いてインストールする事ができる。以下にインストール手順を示す。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">#</span> Homebrew をインストール\n<span class="gp">$</span> /usr/bin/ruby <span class="nt">-e</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/master/install<span class="si">)</span><span class="s2">"</span>\n<span class="go">\n</span><span class="gp">#</span> Homebrew が正しくインストールされているかどうか確認する\n<span class="gp">$</span> brew doctor\n<span class="go">\n</span><span class="gp">#</span> Docker をインストールする\n<span class="gp">$</span> brew <span class="nb">install </span>docker\n<span class="gp">$</span> brew cask <span class="nb">install </span>docker\n</pre></div></div>\n\n<p>docker, Homebrew のバージョンの確認は以下のコマンドを実行する事で確認できる。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">#</span> Docker\n<span class="gp">$</span> docker <span class="nt">--version</span>                                                                                                                                                                             \n<span class="go">Docker version 19.03.4, build 9013bf5\n\n</span><span class="gp">#</span> Homebrew\n<span class="gp">$</span> brew <span class="nt">--version</span>                                                                                                                                                                               \n<span class="go">Homebrew 2.1.16\n</span><span class="gp">Homebrew/homebrew-core (git revision 00c2c;</span> last commit XXXX-XX-XX<span class="o">)</span>\n<span class="gp">Homebrew/homebrew-cask (git revision 9e283;</span> last commit XXXX-XX-XX<span class="o">)</span>\n</pre></div></div>\n\n<h2>\n<span id="22-docker-compose-のインストール" class="fragment"></span><a href="#22-docker-compose-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2.2. docker-compose のインストール</h2>\n\n<p>docker-compose のインストールは以下のコマンドを実行すると良い。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> curl <span class="nt">-L</span> https://github.com/docker/compose/releases/download/1.3.1/docker-compose-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-s</span><span class="sb">`</span>-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-m</span><span class="sb">`</span> <span class="o">&gt;</span> /usr/local/bin/docker-compose\n<span class="go">\n</span><span class="gp">#</span> docker-compose コマンドを実行できるように、権限を設定する。\n<span class="gp">$</span> <span class="nb">chmod</span> +x /usr/local/bin/docker-compose\n</pre></div></div>\n\n<p>補足：実行中、<code>Permission denied</code> エラーが表示された場合、<code>/usr/local/bin</code> ディレクトリが書き込み可能が許可されていない可能性がある。その際、Compose のインストールをスーパーユーザで行う必要がある。<code>sudo -i</code> を実行してから、上記の2つのコマンドを実行し、<code>exit</code>する。</p>\n\n<h1>\n<span id="3-nuxtjs-環境構築" class="fragment"></span><a href="#3-nuxtjs-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>3. Nuxt.js 環境構築</h1>\n\n<p>TypeScript に変換する前に、まず Nuxt.js のプロジェクトを作成する必要があるので作成手順に関して説明する。</p>\n\n<h2>\n<span id="31-ファイル構成" class="fragment"></span><a href="#31-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>3.1. ファイル構成</h2>\n\n<p>今回のファイル構成は以下の通りである。1つのディレクトリに異なるファイルが複数混同する事を避けるため、project ディレクトリを新規し、その中に<code>Dockerfile</code>を作成する。</p>\n\n<p>また、Nuxt.js のプロジェクト内のファイル階層も綺麗にしたかったので、<code>src</code>ディレクトリを新規作成し、その中に纏めている。</p>\n\n<p>以下に、ファイル構成を示す。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="c">.\n</span><span class="go">├── README.md\n├── docker-compose.yml\n└── project\n    ├── Dockerfile\n    ├── README.md\n    ├── node_modules\n    ├── nuxt.config.ts\n    ├── package.json\n    ├── src\n    │   ├── assets\n    │   ├── components\n    │   ├── layouts\n    │   ├── middleware\n    │   ├── pages\n    │   ├── plugins\n    │   ├── static\n    │   ├── store\n    │   └── vue-shim.d.ts\n    ├── tsconfig.json\n    ├── yarn-error.log\n    └── yarn.lock\n</span></pre></div></div>\n\n<h2>\n<span id="32-dockerfile" class="fragment"></span><a href="#32-dockerfile"><i class="fa fa-link"></i></a>3.2. Dockerfile</h2>\n\n<p>はじめに、Dockerfileを作成する。<code>node.js</code>に関しては、<a href="https://hub.docker.com/_/node/" rel="nofollow noopener" target="_blank">DockerHub</a> にイメージが公開されているのでそれを使用する。</p>\n\n<div class="code-frame" data-lang="docker">\n<div class="code-lang"><span class="bold">Dockerfile</span></div>\n<div class="highlight"><pre>\n<span class="c"># イメージ指定</span>\n<span class="k">FROM</span><span class="s"> node:12.13.0-alpine</span>\n\n<span class="c"># コマンド実行</span>\n<span class="k">RUN </span>apk update <span class="o">&amp;&amp;</span> <span class="se">\\\n</span>    apk add git <span class="o">&amp;&amp;</span> <span class="se">\\\n</span>    npm <span class="nb">install</span> <span class="nt">-g</span> @vue/cli nuxt create-nuxt-app <span class="o">&amp;&amp;</span> <span class="se">\\\n</span>\n</pre></div>\n</div>\n\n<p>今回はイメージの軽量化の為に、<code>alpine</code>を使用した。</p>\n\n<p>※ <strong>alpine</strong> : Alpine Linuxと呼ばれる、<code>BusyBox</code>と<code>musl</code>をベースにしたLinuxディストリビューションを指す</p>\n\n<h2>\n<span id="33-docker-composeyml" class="fragment"></span><a href="#33-docker-composeyml"><i class="fa fa-link"></i></a>3.3. docker-compose.yml</h2>\n\n<p>次に、docker-compose.ymlを作成する。</p>\n\n<div class="code-frame" data-lang="docker">\n<div class="code-lang"><span class="bold">docker-compose.yml</span></div>\n<div class="highlight"><pre>version: \'3\'\nservices:\n  node:\n    # Dockerfileの場所\n    build: \n        context: ./\n        dockerfile: ./project/Dockerfile\n    working_dir: /home/node/app/project\n    <span class="c"># ホストOSとコンテナ内でソースコードを共有する</span>\n    volumes:\n      - ./:/home/node/app\n    <span class="c"># コンテナ内部の3000を外部から5000でアクセスする</span>\n    ports:\n      - 5000:3000\n    environment:\n      - HOST=0.0.0.0\n</pre></div>\n</div>\n\n<h2>\n<span id="34-dockerイメージ作成" class="fragment"></span><a href="#34-docker%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>3.4. dockerイメージ作成</h2>\n\n<p>Dockerfile, docker-compose.ymlを作成後、以下のコマンドを実行し docker イメージを作成する。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker-compose build\n</pre></div></div>\n\n<p>実行後、イメージができているかどうかは以下のコマンドで確認できる。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker images\n<span class="go">REPOSITORY                    TAG              IMAGE ID        CREATED       SIZE\ndocker-nuxt-typescript_node   latest           7f8324973b48    3 days ago    434MB\nnode                          12.13.0-alpine   5d187500daae    3 weeks ago   80.1MB\n</span></pre></div></div>\n\n<h2>\n<span id="35-nuxtjsの起動" class="fragment"></span><a href="#35-nuxtjs%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>3.5. Nuxt.jsの起動</h2>\n\n<p>コンテナ内で<code>npm</code>、<code>yarn</code>コマンドを実行したい場合は下記の様に指定する。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker-compose run <span class="nt">--rm</span> &lt;Container Name&gt; &lt;Command&gt;\n</pre></div></div>\n\n<p>以下のコマンドを実行し、Nuxt.jsを起動させセットアップを行う。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker-compose run <span class="nt">--rm</span> nuxt npx create-nuxt-app ./project\n<span class="go">Project name (your-title)\nProject description (My wicked Nuxt.js project)\nAuthor name (author-name)\nChoose the package manager \n</span><span class="gp">&gt;</span> Yarn\n<span class="go">  Npm\nChoose UI framework (Use arrow keys)\n</span><span class="gp">&gt;</span> None\n<span class="go">  Ant Design Vue\n  Bootstrap Vue\n  Buefy\n  Bulma\n  Element\n  Framevuerk\n  iView\n  Tachyons\n  Tailwind CSS\n  Vuetify.js\nChoose custom server framework (Use arrow keys)\n</span><span class="gp">&gt;</span> None <span class="o">(</span>Recommended<span class="o">)</span>\n<span class="go">  AdonisJs\n  Express\n  Fastify\n  Feathers\n  hapi\n  Koa\n  Micro\n</span><span class="gp">#</span> スペースで選択する事ができる。<span class="o">(</span>Enterキーではないので注意<span class="o">)</span>\n<span class="go">Choose Nuxt.js modules\n</span><span class="gp">&gt;</span><span class="o">(</span><span class="k">*</span><span class="o">)</span> Axios\n<span class="go"> ( ) Progressive Web App (PWA) Support\nChoose linting tools \n</span><span class="gp">&gt;</span><span class="o">(</span><span class="k">*</span><span class="o">)</span> ESLint\n<span class="go"> ( ) Prettier\n ( ) Lint staged files\nChoose test framework \n</span><span class="gp">&gt;</span> None\n<span class="go">  Jest\n  AVA\nChoose rendering mode (Use arrow keys)\n  Universal (SSR) // WEB SITE\n</span><span class="gp">&gt;</span> Single Page App // WEB APPLICATION\n<span class="go">Choose development tools\n</span><span class="gp">&gt;</span><span class="o">(</span><span class="k">*</span><span class="o">)</span> jsconfig.json <span class="o">(</span>Recommended <span class="k">for </span>VS Code<span class="o">)</span>\n</pre></div></div>\n\n<p>上記の設定は、筆者がセットアップに選択したものである。設定に関しては各々で必要なものを導入すると良い。</p>\n\n<h2>\n<span id="36-コンテナの立ち上げ" class="fragment"></span><a href="#36-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92"><i class="fa fa-link"></i></a>3.6. コンテナの立ち上げ</h2>\n\n<p>以下のコマンドを実行し、コンテナを起動させる。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker-compose run node npm run dev\n<span class="gp">#</span> OR\n<span class="gp">$</span> docker-compose run node yarn run dev\n</pre></div></div>\n\n<p>起動後、<a href="http://localhost:5000/" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:5000/</a> にアクセスし、サンプルアプリ画面が確認できれば一旦完了である。</p>\n\n<h1>\n<span id="4-typescript化" class="fragment"></span><a href="#4-typescript%E5%8C%96"><i class="fa fa-link"></i></a>4. TypeScript化</h1>\n\n<p>最後に、Nuxt.js を TypeScript に変更する手順について説明する。</p>\n\n<h2>\n<span id="41-nuxttypescript-build-nuxttypescript-runtime-のインストール" class="fragment"></span><a href="#41-nuxttypescript-build-nuxttypescript-runtime-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>4.1. @nuxt/typescript-build, @nuxt/typescript-runtime のインストール</h2>\n\n<p>TypeScript化を進める前に、まずはじめに<code>@nuxt/typescript-build</code>、<code>@nuxt/typescript-runtime</code>の2つを以下のコマンドを実行してインストールする。<br>\n(どちらか一方でも動くが、今回は両方インストールしておく)</p>\n\n<p>※ <strong>@nuxt/typescript-build</strong> : <code>nuxt build</code>で TypeScript を扱うためのもの。<br>\n※ <strong>@nuxt/typescript-runtime</strong> : Node.js 環境下で TypeScript を処理するためのもの。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker-compose run node npm <span class="nb">install</span> <span class="nt">--save-dev</span> @nuxt/typescript-build\n<span class="gp">$</span> docker-compose run node npm <span class="nb">install</span> @nuxt/typescript-runtime\n<span class="gp">#</span> OR\n<span class="gp">$</span> docker-compose run node yarn add <span class="nt">--dev</span> @nuxt/typescript-build\n<span class="gp">$</span> docker-compose run node yarn add @nuxt/typescript-runtime\n</pre></div></div>\n\n<p><code>@nuxt/types</code>に関しては、上記の2つに内包されているのでインストールをする必要は無い。</p>\n\n<h2>\n<span id="42-tsconfigjson-の作成" class="fragment"></span><a href="#42-tsconfigjson-%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>4.2. tsconfig.json の作成</h2>\n\n<p>Nuxt.js で作成されている<code>jsconfig.json</code>を削除し、<code>tsconfig.json</code>を新規作成する。<br>\n<code>tsconfig.json</code>のソースは以下の通りである。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">tsconfig.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n    </span><span class="s2">"./src/**/*"</span><span class="w">\n  </span><span class="p">],</span><span class="w">\n  </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"esnext"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"esnext"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"moduleResolution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"lib"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n      </span><span class="s2">"esnext"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"esnext.asynciterable"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"dom"</span><span class="w">\n    </span><span class="p">],</span><span class="w">\n    </span><span class="nl">"esModuleInterop"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"experimentalDecorators"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"allowJs"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"sourceMap"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"strict"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"noEmit"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"baseUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"."</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n      </span><span class="nl">"~/*"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n        </span><span class="s2">"./src/*"</span><span class="w">\n      </span><span class="p">],</span><span class="w">\n      </span><span class="nl">"@/*"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n        </span><span class="s2">"./src/*"</span><span class="w">\n      </span><span class="p">]</span><span class="w">\n    </span><span class="p">},</span><span class="w">\n    </span><span class="nl">"types"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n      </span><span class="s2">"@types/node"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"@nuxt/types"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"@nuxtjs/axios"</span><span class="w">\n    </span><span class="p">]</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="nl">"exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n    </span><span class="s2">"node_modules"</span><span class="w">\n  </span><span class="p">]</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>今回は、プロジェクト内のディレクトリを<code>src</code>ディレクトリに移動させているので、<code>include</code>、<code>paths</code>などの設定を変更している。</p>\n\n<h2>\n<span id="43-nuxtconfigts-の作成" class="fragment"></span><a href="#43-nuxtconfigts-%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>4.3. nuxt.config.ts の作成</h2>\n\n<p>次に、<code>nuxt.config.js</code>を削除し、<code>nuxt.config.ts</code>を新規作成する。<br>\n<code>nuxt.config.ts</code>のソースは以下の通りである。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">nuxt.config.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Configuration</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/types</span><span class="dl">\'</span>\n\n<span class="kd">const</span> <span class="nx">nuxtConfig</span><span class="p">:</span> <span class="nx">Configuration</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">mode</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">universal</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="na">buildModules</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">@nuxt/typescript-build</span><span class="dl">\'</span><span class="p">],</span>\n  <span class="na">server</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">port</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>\n    <span class="na">host</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">localhost</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">head</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">title</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">npm_package_name</span> <span class="o">||</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="na">meta</span><span class="p">:</span> <span class="p">[</span>\n      <span class="p">{</span> <span class="na">charset</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">utf-8</span><span class="dl">\'</span> <span class="p">},</span>\n      <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">viewport</span><span class="dl">\'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">width=device-width, initial-scale=1</span><span class="dl">\'</span> <span class="p">},</span>\n      <span class="p">{</span> <span class="na">hid</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">description</span><span class="dl">\'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">description</span><span class="dl">\'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">npm_package_description</span> <span class="o">||</span> <span class="dl">\'\'</span> <span class="p">}</span>\n    <span class="p">],</span>\n    <span class="na">link</span><span class="p">:</span> <span class="p">[</span>\n      <span class="p">{</span> <span class="na">rel</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">icon</span><span class="dl">\'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">image/x-icon</span><span class="dl">\'</span><span class="p">,</span> <span class="na">href</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/favicon.ico</span><span class="dl">\'</span> <span class="p">}</span>\n    <span class="p">]</span>\n  <span class="p">},</span>\n  <span class="na">loading</span><span class="p">:</span> <span class="p">{</span> <span class="na">color</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">#fff</span><span class="dl">\'</span> <span class="p">},</span>\n  <span class="na">css</span><span class="p">:</span> <span class="p">[</span>\n  <span class="p">],</span>\n  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>\n  <span class="p">],</span>\n  <span class="na">typescript</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">typeCheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="na">ignoreNotFoundWarnings</span><span class="p">:</span> <span class="kc">true</span>\n  <span class="p">},</span>\n  <span class="na">modules</span><span class="p">:</span> <span class="p">[</span>\n    <span class="dl">\'</span><span class="s1">@nuxtjs/axios</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="dl">\'</span><span class="s1">@nuxtjs/eslint-module</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">],</span>\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">srcDir</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">src/</span><span class="dl">\'</span>\n<span class="p">}</span>\n<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">nuxtConfig</span>\n</pre></div>\n</div>\n\n<p>Ver.2.9からは、<code>nuxt.config.ts</code>内の Configuration の型定義が<code>@nuxt/types</code>からExportされるようになった為、はじめに Import している。<br>\nまた、追加された <a href="https://nuxtjs.org/api/configuration-modules#-code-buildmodules-code-" rel="nofollow noopener" target="_blank">buildModules</a> に<code>@nuxt/typescript-build</code>を指定している。<code>buildModules</code>に変更になった事で、<code>build</code>内で使用する<code>module</code>を<code>devDependencies</code>に指定できるようになった。</p>\n\n<h2>\n<span id="44-vue-shimdts-の作成" class="fragment"></span><a href="#44-vue-shimdts-%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>4.4. vue-shim.d.ts の作成</h2>\n\n<p><code>vue-shim.d.ts</code>は、記述されているコードを TypeScript として認識させる為に必要となるファイルである。しかし、<code>.vue</code>ファイル中にインポート等をする必要は無く、<code>src</code>ディレクトリ内にあれば問題ない。<br>\n<code>vue-shim.d.ts</code>のソースは以下の通りである。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">vue-shim.d.ts</span></div>\n<div class="highlight"><pre><span class="nx">declare</span> <span class="nx">module</span> <span class="dl">"</span><span class="s2">*.vue</span><span class="dl">"</span> <span class="p">{</span>\n  <span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">vue</span><span class="dl">"</span><span class="p">;</span>\n  <span class="k">export</span> <span class="k">default</span> <span class="nx">Vue</span><span class="p">;</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="45-packagejson-の修正" class="fragment"></span><a href="#45-packagejson-%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>4.5. package.json の修正</h2>\n\n<p><code>package.json</code>は、Nuxt.js のセットアップ時に作成されるが、TypeScript が適用されていないのでその点を修正する。修正する部分としては<code>package.json</code>内の<code>scripts</code>が、nuxt コマンドなので、そこを<code>nuxt-ts</code>コマンドに変更する。<br>\n修正後のソースは以下の通りである。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="err">#</span><span class="w"> </span><span class="err">一部省略</span><span class="w">\n</span><span class="p">{</span><span class="w">\n  </span><span class="err">...</span><span class="w">\n  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-ts"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-ts build"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-ts start"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"generate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-ts generate"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eslint --ext .js,.vue --ignore-path .gitignore ."</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n  </span><span class="err">...</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<h2>\n<span id="46-nuxt-typescript-の実行" class="fragment"></span><a href="#46-nuxt-typescript-%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>4.6. Nuxt TypeScript の実行</h2>\n\n<p>変更を踏まえ、再度 Nuxt.js を起動する。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker-compose run node yarn run dev                                                                                                                 \n<span class="go">yarn run v1.19.1\n</span><span class="gp">$</span> nuxt-ts\n<span class="go">\n   ╭─────────────────────────────────────────────╮\n   │                                             │\n   │   Nuxt.js v2.10.2                           │\n   │   Running in development mode (universal)   │\n   │                                             │\n   │   Listening on: http://localhost:5000/      │\n   │                                             │\n   ╰─────────────────────────────────────────────╯\n\nℹ Preparing project for development\nℹ Initial build may take a while\n✔ Builder initialized\n✔ Nuxt files generated\nℹ Starting type checking service...\nℹ Using 1 worker with 2048MB memory limit                                                                                                                                         \n\n✔ Client\n  Compiled successfully in 13.16s\n\n✔ Server\n  Compiled successfully in 11.98s\n\nℹ No type errors found\nℹ Version: typescript 3.6.4 \nℹ Time: 11648ms\nℹ Waiting for file changes\nℹ Memory usage: 254 MB (RSS: 315 MB)\n</span></pre></div></div>\n\n<p>上記を見て貰うと、<code>nuxt-ts</code>コマンドで実行している事が確認できる。<br>\n実行後、先程と同じく <a href="http://localhost:5000/" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:5000/</a> にアクセスし画面が表示する事を確認する。</p>\n\n<p>以上で、TypeScript化は完了である。</p>\n\n<h1>\n<span id="5-まとめ" class="fragment"></span><a href="#5-%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>5. まとめ</h1>\n\n<p>今回は、Nuxt TypeScript を docker-comnpose で構築した。Ver.2.9 からの変更で docker-compose 下で動かなくなった人を少しでもサポートできるなら幸いである。</p>\n\n<p>また、今回のサンプルは <a href="https://github.com/t4i5uKE/docker-nuxt-typescript" rel="nofollow noopener" target="_blank">GitHub</a> に公開しているので、何か不明点や修正点があれば随時対応していこうと思う。</p>\n\n<p>◆追記◆<br>\n11/24 : Githubの<code>project/README.md</code>を英語翻訳化しました。</p>\n',body:'# はじめに\n[Nuxt TypeScript](https://typescript.nuxtjs.org/) でセットアップの手順は公式にて公開しているが、docker-composeを用いた構築の情報が少なかったので纏めてみた。\n\nまた、Ver.2.9以降からTypeScriptへの導入手順が変わり、個人的に少し躓いた部分もあったのでその点も踏まえて共有しようと思う。\n\n# 1. 実行環境\n* macOS Catalina Ver.10.15.1\n* Docker version 19.03.4, build 9013bf5\n* docker-compose version 1.24.1, build 4667896b\n* Nuxt.js Ver.2.10.2\n* node.js 12.13.0-alpine\n\n# 2. 前提条件\n* Nuxt.js のバージョンが 2.9 以上である事。\n* PC内に docker, docker-compose, node.js がインストールされている事。\n\ndocker , docker-compose , node.js がインストールされていない場合は下記を実行すると良い。\n\n## 2.1. Docker のインストール\nDocker をインストールする為に [DockerHub](https://hub.docker.com/editions/community/docker-ce-desktop-mac) にアクセスし、`Docker.dmg`をダウンロードする。\n※ DockerHubを初めて利用する場合はアカウント作成が必要である。\n\n`Docker.dmg`を起動すると、Dockerのインストールが行われるので、インストール完了後に Docker を Applications にコピーする。\n\nまた、他の方法として[Homebrew](https://brew.sh/index_ja)と呼ばれるパッケージ管理システムを用いてインストールする事ができる。以下にインストール手順を示す。\n\n```terminal\n# Homebrew をインストール\n$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"\n\n# Homebrew が正しくインストールされているかどうか確認する\n$ brew doctor\n\n# Docker をインストールする\n$ brew install docker\n$ brew cask install docker\n```\n\ndocker, Homebrew のバージョンの確認は以下のコマンドを実行する事で確認できる。\n\n```terminal\n# Docker\n$ docker --version                                                                                                                                                                             \nDocker version 19.03.4, build 9013bf5\n\n# Homebrew\n$ brew --version                                                                                                                                                                               \nHomebrew 2.1.16\nHomebrew/homebrew-core (git revision 00c2c; last commit XXXX-XX-XX)\nHomebrew/homebrew-cask (git revision 9e283; last commit XXXX-XX-XX)\n```\n\n## 2.2. docker-compose のインストール\ndocker-compose のインストールは以下のコマンドを実行すると良い。\n\n```terminal\n$ curl -L https://github.com/docker/compose/releases/download/1.3.1/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n\n# docker-compose コマンドを実行できるように、権限を設定する。\n$ chmod +x /usr/local/bin/docker-compose\n```\n\n補足：実行中、`Permission denied` エラーが表示された場合、`/usr/local/bin` ディレクトリが書き込み可能が許可されていない可能性がある。その際、Compose のインストールをスーパーユーザで行う必要がある。`sudo -i` を実行してから、上記の2つのコマンドを実行し、`exit`する。\n\n# 3. Nuxt.js 環境構築\nTypeScript に変換する前に、まず Nuxt.js のプロジェクトを作成する必要があるので作成手順に関して説明する。\n\n## 3.1. ファイル構成\n今回のファイル構成は以下の通りである。1つのディレクトリに異なるファイルが複数混同する事を避けるため、project ディレクトリを新規し、その中に`Dockerfile`を作成する。\n\nまた、Nuxt.js のプロジェクト内のファイル階層も綺麗にしたかったので、`src`ディレクトリを新規作成し、その中に纏めている。\n\n以下に、ファイル構成を示す。\n\n```terminal\n.\n├── README.md\n├── docker-compose.yml\n└── project\n    ├── Dockerfile\n    ├── README.md\n    ├── node_modules\n    ├── nuxt.config.ts\n    ├── package.json\n    ├── src\n    │   ├── assets\n    │   ├── components\n    │   ├── layouts\n    │   ├── middleware\n    │   ├── pages\n    │   ├── plugins\n    │   ├── static\n    │   ├── store\n    │   └── vue-shim.d.ts\n    ├── tsconfig.json\n    ├── yarn-error.log\n    └── yarn.lock\n```\n\n## 3.2. Dockerfile\nはじめに、Dockerfileを作成する。`node.js`に関しては、[DockerHub](https://hub.docker.com/_/node/) にイメージが公開されているのでそれを使用する。\n\n```docker:Dockerfile\n\n# イメージ指定\nFROM node:12.13.0-alpine\n\n# コマンド実行\nRUN apk update && \\\n    apk add git && \\\n    npm install -g @vue/cli nuxt create-nuxt-app && \\\n\n```\n\n今回はイメージの軽量化の為に、`alpine`を使用した。\n\n※ **alpine** : Alpine Linuxと呼ばれる、`BusyBox`と`musl`をベースにしたLinuxディストリビューションを指す\n\n## 3.3. docker-compose.yml \n次に、docker-compose.ymlを作成する。\n\n```docker:docker-compose.yml\nversion: \'3\'\nservices:\n  node:\n    # Dockerfileの場所\n    build: \n        context: ./\n        dockerfile: ./project/Dockerfile\n    working_dir: /home/node/app/project\n    # ホストOSとコンテナ内でソースコードを共有する\n    volumes:\n      - ./:/home/node/app\n    # コンテナ内部の3000を外部から5000でアクセスする\n    ports:\n      - 5000:3000\n    environment:\n      - HOST=0.0.0.0\n```\n\n## 3.4. dockerイメージ作成\nDockerfile, docker-compose.ymlを作成後、以下のコマンドを実行し docker イメージを作成する。\n\n```terminal\n$ docker-compose build\n```\n\n実行後、イメージができているかどうかは以下のコマンドで確認できる。\n\n```terminal\n$ docker images\nREPOSITORY                    TAG              IMAGE ID        CREATED       SIZE\ndocker-nuxt-typescript_node   latest           7f8324973b48    3 days ago    434MB\nnode                          12.13.0-alpine   5d187500daae    3 weeks ago   80.1MB\n```\n\n## 3.5. Nuxt.jsの起動\nコンテナ内で`npm`、`yarn`コマンドを実行したい場合は下記の様に指定する。\n\n```terminal\n$ docker-compose run --rm <Container Name> <Command>\n```\n\n以下のコマンドを実行し、Nuxt.jsを起動させセットアップを行う。\n\n```terminal\n$ docker-compose run --rm nuxt npx create-nuxt-app ./project\nProject name (your-title)\nProject description (My wicked Nuxt.js project)\nAuthor name (author-name)\nChoose the package manager \n> Yarn\n  Npm\nChoose UI framework (Use arrow keys)\n> None\n  Ant Design Vue\n  Bootstrap Vue\n  Buefy\n  Bulma\n  Element\n  Framevuerk\n  iView\n  Tachyons\n  Tailwind CSS\n  Vuetify.js\nChoose custom server framework (Use arrow keys)\n> None (Recommended)\n  AdonisJs\n  Express\n  Fastify\n  Feathers\n  hapi\n  Koa\n  Micro\n# スペースで選択する事ができる。(Enterキーではないので注意)\nChoose Nuxt.js modules\n>(*) Axios\n ( ) Progressive Web App (PWA) Support\nChoose linting tools \n>(*) ESLint\n ( ) Prettier\n ( ) Lint staged files\nChoose test framework \n> None\n  Jest\n  AVA\nChoose rendering mode (Use arrow keys)\n  Universal (SSR) // WEB SITE\n> Single Page App // WEB APPLICATION\nChoose development tools\n>(*) jsconfig.json (Recommended for VS Code)\n```\n\n上記の設定は、筆者がセットアップに選択したものである。設定に関しては各々で必要なものを導入すると良い。\n\n## 3.6. コンテナの立ち上げ\n以下のコマンドを実行し、コンテナを起動させる。\n\n```terminal\n$ docker-compose run node npm run dev\n# OR\n$ docker-compose run node yarn run dev\n```\n\n起動後、http://localhost:5000/ にアクセスし、サンプルアプリ画面が確認できれば一旦完了である。\n\n# 4. TypeScript化\n最後に、Nuxt.js を TypeScript に変更する手順について説明する。\n\n## 4.1. @nuxt/typescript-build, @nuxt/typescript-runtime のインストール\nTypeScript化を進める前に、まずはじめに`@nuxt/typescript-build`、`@nuxt/typescript-runtime`の2つを以下のコマンドを実行してインストールする。\n(どちらか一方でも動くが、今回は両方インストールしておく)\n\n※ **@nuxt/typescript-build** : `nuxt build`で TypeScript を扱うためのもの。\n※ **@nuxt/typescript-runtime** : Node.js 環境下で TypeScript を処理するためのもの。\n\n```terminal\n$ docker-compose run node npm install --save-dev @nuxt/typescript-build\n$ docker-compose run node npm install @nuxt/typescript-runtime\n# OR\n$ docker-compose run node yarn add --dev @nuxt/typescript-build\n$ docker-compose run node yarn add @nuxt/typescript-runtime\n```\n\n`@nuxt/types`に関しては、上記の2つに内包されているのでインストールをする必要は無い。\n\n## 4.2. tsconfig.json の作成\nNuxt.js で作成されている`jsconfig.json`を削除し、`tsconfig.json`を新規作成する。\n`tsconfig.json`のソースは以下の通りである。\n\n```json:tsconfig.json\n{\n  "include": [\n    "./src/**/*"\n  ],\n  "compilerOptions": {\n    "target": "esnext",\n    "module": "esnext",\n    "moduleResolution": "node",\n    "lib": [\n      "esnext",\n      "esnext.asynciterable",\n      "dom"\n    ],\n    "esModuleInterop": true,\n    "experimentalDecorators": true,\n    "allowJs": true,\n    "sourceMap": true,\n    "strict": true,\n    "noEmit": true,\n    "baseUrl": ".",\n    "paths": {\n      "~/*": [\n        "./src/*"\n      ],\n      "@/*": [\n        "./src/*"\n      ]\n    },\n    "types": [\n      "@types/node",\n      "@nuxt/types",\n      "@nuxtjs/axios"\n    ]\n  },\n  "exclude": [\n    "node_modules"\n  ]\n}\n```\n\n今回は、プロジェクト内のディレクトリを`src`ディレクトリに移動させているので、`include`、`paths`などの設定を変更している。\n\n## 4.3. nuxt.config.ts の作成\n次に、`nuxt.config.js`を削除し、`nuxt.config.ts`を新規作成する。\n`nuxt.config.ts`のソースは以下の通りである。\n\n```ts:nuxt.config.ts\nimport { Configuration } from \'@nuxt/types\'\n \nconst nuxtConfig: Configuration = {\n  mode: \'universal\',\n  buildModules: [\'@nuxt/typescript-build\'],\n  server: {\n    port: 5000,\n    host: \'localhost\',\n  },\n  head: {\n    title: process.env.npm_package_name || \'\',\n    meta: [\n      { charset: \'utf-8\' },\n      { name: \'viewport\', content: \'width=device-width, initial-scale=1\' },\n      { hid: \'description\', name: \'description\', content: process.env.npm_package_description || \'\' }\n    ],\n    link: [\n      { rel: \'icon\', type: \'image/x-icon\', href: \'/favicon.ico\' }\n    ]\n  },\n  loading: { color: \'#fff\' },\n  css: [\n  ],\n  plugins: [\n  ],\n  typescript: {\n    typeCheck: true,\n    ignoreNotFoundWarnings: true\n  },\n  modules: [\n    \'@nuxtjs/axios\',\n    \'@nuxtjs/eslint-module\',\n  ],\n  build: {\n    extend(config, ctx) {\n    }\n  },\n  srcDir: \'src/\'\n}\nmodule.exports = nuxtConfig\n```\n\nVer.2.9からは、`nuxt.config.ts`内の Configuration の型定義が`@nuxt/types`からExportされるようになった為、はじめに Import している。\nまた、追加された [buildModules](https://nuxtjs.org/api/configuration-modules#-code-buildmodules-code-) に`@nuxt/typescript-build`を指定している。`buildModules`に変更になった事で、`build`内で使用する`module`を`devDependencies`に指定できるようになった。\n\n## 4.4. vue-shim.d.ts の作成\n`vue-shim.d.ts`は、記述されているコードを TypeScript として認識させる為に必要となるファイルである。しかし、`.vue`ファイル中にインポート等をする必要は無く、`src`ディレクトリ内にあれば問題ない。\n`vue-shim.d.ts`のソースは以下の通りである。\n\n```ts:vue-shim.d.ts\ndeclare module "*.vue" {\n  import Vue from "vue";\n  export default Vue;\n}\n```\n\n## 4.5. package.json の修正\n`package.json`は、Nuxt.js のセットアップ時に作成されるが、TypeScript が適用されていないのでその点を修正する。修正する部分としては`package.json`内の`scripts`が、nuxt コマンドなので、そこを`nuxt-ts`コマンドに変更する。\n修正後のソースは以下の通りである。\n\n```json:package.json\n# 一部省略\n{\n  ...\n  "scripts": {\n    "dev": "nuxt-ts",\n    "build": "nuxt-ts build",\n    "start": "nuxt-ts start",\n    "generate": "nuxt-ts generate",\n    "lint": "eslint --ext .js,.vue --ignore-path .gitignore ."\n  }\n  ...\n}\n```\n\n## 4.6. Nuxt TypeScript の実行\n変更を踏まえ、再度 Nuxt.js を起動する。\n\n```terminal\n$ docker-compose run node yarn run dev                                                                                                                 \nyarn run v1.19.1\n$ nuxt-ts\n\n   ╭─────────────────────────────────────────────╮\n   │                                             │\n   │   Nuxt.js v2.10.2                           │\n   │   Running in development mode (universal)   │\n   │                                             │\n   │   Listening on: http://localhost:5000/      │\n   │                                             │\n   ╰─────────────────────────────────────────────╯\n\nℹ Preparing project for development\nℹ Initial build may take a while\n✔ Builder initialized\n✔ Nuxt files generated\nℹ Starting type checking service...\nℹ Using 1 worker with 2048MB memory limit                                                                                                                                         \n\n✔ Client\n  Compiled successfully in 13.16s\n\n✔ Server\n  Compiled successfully in 11.98s\n\nℹ No type errors found\nℹ Version: typescript 3.6.4 \nℹ Time: 11648ms\nℹ Waiting for file changes\nℹ Memory usage: 254 MB (RSS: 315 MB)\n```\n\n上記を見て貰うと、`nuxt-ts`コマンドで実行している事が確認できる。\n実行後、先程と同じく http://localhost:5000/ にアクセスし画面が表示する事を確認する。\n\n以上で、TypeScript化は完了である。\n\n# 5. まとめ\n今回は、Nuxt TypeScript を docker-comnpose で構築した。Ver.2.9 からの変更で docker-compose 下で動かなくなった人を少しでもサポートできるなら幸いである。\n\nまた、今回のサンプルは [GitHub](https://github.com/t4i5uKE/docker-nuxt-typescript) に公開しているので、何か不明点や修正点があれば随時対応していこうと思う。\n\n◆追記◆\n11/24 : Githubの`project/README.md`を英語翻訳化しました。\n',coediting:a,comments_count:0,created_at:"2019-11-24T01:00:30+09:00",group:s,id:"7a6abd4f9402aa345107",likes_count:44,private:a,reactions_count:0,tags:[{name:q,versions:[]},{name:m,versions:[]},{name:c,versions:[]},{name:"docker-compose",versions:[]},{name:e,versions:[]}],title:"Nuxt TypeScript を docker-compose で構築する",updated_at:"2019-11-25T10:21:35+09:00",url:"https://qiita.com/Morero/items/7a6abd4f9402aa345107",user:{description:"1年目エンジニア.。趣味でDJしてます\r\n\r\n業務 / バックエンド。",facebook_id:"tai.okamoto1202",followees_count:6,followers_count:1,github_login_name:"t4i5uKE",id:"Morero",items_count:1,linkedin_id:"taisuke-okamoto-793a53187/",location:S,name:"Taisuke Okamoto",organization:"動画配信サービスの中の人",permanent_id:223371,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/223371/profile-images/1574272896",team_only:a,twitter_screen_name:"taisuke_1202",website_url:n},page_views_count:s},{rendered_body:'\n<h2>\n<span id="dockerfileのmulti-stage-buildの概要" class="fragment"></span><a href="#dockerfile%E3%81%AEmulti-stage-build%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>Dockerfileのmulti-stage buildの概要</h2>\n\n<p><code>Dockerfile</code>の<code>multi-stage build</code>は、「<strong>1つのDockerfileでビルド用のImageと実行用のImageを分ける</strong>」ということをやってくれます。</p>\n\n<p><code>Nuxt.js</code>の場合で例えるとより分かりやすいかなと思いました。</p>\n\n<p><code>yarn build</code>等のアプリケーションのビルドする用のImageを作成して、<code>yarn start</code>等のアプリケーション実行用のImageを作成するといったところでしょうか。</p>\n\n<p><code>Nuxt.js</code>のコマンドは以下の公式ドキュメントを読みましょう。<br>\n参考：<a href="https://ja.nuxtjs.org/guide/commands/" class="autolink" rel="nofollow noopener" target="_blank">https://ja.nuxtjs.org/guide/commands/</a></p>\n\n<p>また、ビルドされたアプリケーションの成果物をアプリケーション実行用のImageでコピーして、ビルド環境と実行環境を切り離してくれるという感じで使います。</p>\n\n<p>図にすると以下のような感じでしょうか。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F307395%2F203761bb-a771-5216-4fdc-1baf97bda505.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=c11f6620d7a0f02852e6230ea6acd7b3" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F307395%2F203761bb-a771-5216-4fdc-1baf97bda505.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=c11f6620d7a0f02852e6230ea6acd7b3" alt="Dockerfileについて.001.jpeg" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/307395/203761bb-a771-5216-4fdc-1baf97bda505.jpeg" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F307395%2F203761bb-a771-5216-4fdc-1baf97bda505.jpeg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=8a8698ccf21aae4d5b701c77f2c9910a 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="dockerfileでmulti-stage-buildをしておきたい理由" class="fragment"></span><a href="#dockerfile%E3%81%A7multi-stage-build%E3%82%92%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8D%E3%81%9F%E3%81%84%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>Dockerfileでmulti-stage buildをしておきたい理由</h2>\n\n<p><code>Dockerfile</code>で<code>multi-stage build</code>をしておきたい理由は以下かなと思ってます。</p>\n\n<ul>\n<li>Dockerコンテナをビルドする際のコスト(時間・お金)削減</li>\n<li>ビルド用のDockerイメージ(中間Image)をキャッシュしてビルドを高速化する</li>\n</ul>\n\n<p>これから、<code>Dockerfile</code>で<code>multi-stage build</code>をしておきたい理由の詳細をまとめていきますね。</p>\n\n<h3>\n<span id="dockerコンテナをビルドする際のコスト時間お金削減" class="fragment"></span><a href="#docker%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E3%82%B3%E3%82%B9%E3%83%88%E6%99%82%E9%96%93%E3%81%8A%E9%87%91%E5%89%8A%E6%B8%9B"><i class="fa fa-link"></i></a>Dockerコンテナをビルドする際のコスト(時間・お金)削減</h3>\n\n<blockquote>\n<p>アプリケーションをコンテナ化する際に、ビルド時の依存関係や中間ファイルといった、ランタイムに不要なファイルが誤ってコンテナ イメージに含まれることがあります。こうした不要なファイルによってコンテナ イメージのサイズが拡大し、コンテナ イメージ レジストリとコンテナのランタイムとの間でイメージを移動するときに余計な時間と費用がかかる可能性があります。<br>\n引用：<a href="https://cloud.google.com/cloud-build/docs/speeding-up-builds" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.google.com/cloud-build/docs/speeding-up-builds</a></p>\n</blockquote>\n\n<p>1つ目は引用のママですね。</p>\n\n<p><strong>余計なコスト(時間・お金)</strong>がかかってしまうので、ビルド用と実行用でImageを分けておきたいなというところです。</p>\n\n<p>ちなみに、ビルド用と実行用でImageを分けなかった場合と分けた場合で、Imageサイズの比較をしてみました。</p>\n\n<h4>\n<span id="ビルド用と実行用でimageを分けなかった場合のdockerfileのimageサイズ" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E7%94%A8%E3%81%A8%E5%AE%9F%E8%A1%8C%E7%94%A8%E3%81%A7image%E3%82%92%E5%88%86%E3%81%91%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AEdockerfile%E3%81%AEimage%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>ビルド用と実行用でImageを分けなかった場合のDockerfileのImageサイズ</h4>\n\n<p>以下が、ビルド用と実行用でImageを分けなかった場合の<code>Dockerfile</code>です。</p>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:10.15.1-alpine</span>\n<span class="k">WORKDIR</span><span class="s"> /app_name</span>\n<span class="k">COPY</span><span class="s"> . /app_name</span>\n<span class="k">RUN </span>yarn <span class="nb">install</span> <span class="nt">--production</span>\n<span class="k">RUN </span>yarn build\n<span class="k">CMD</span><span class="s"> ["yarn", "start"]</span>\n</pre></div></div>\n\n<p>また、<code>docker build</code>して作成されたImageサイズは以下の通りです。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker images\n<span class="go">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\nnot-devide                  latest              4b3ab63c75d3        18 seconds ago      474MB\n</span></pre></div></div>\n\n<p>Imageサイズは<code>474MB</code>ですね。</p>\n\n<h4>\n<span id="ビルド用と実行用でimageを分けた場合のdockerfileのimageサイズ" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E7%94%A8%E3%81%A8%E5%AE%9F%E8%A1%8C%E7%94%A8%E3%81%A7image%E3%82%92%E5%88%86%E3%81%91%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AEdockerfile%E3%81%AEimage%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>ビルド用と実行用でImageを分けた場合のDockerfileのImageサイズ</h4>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:10.15.1-alpine as builder</span>\n<span class="k">WORKDIR</span><span class="s"> /app_name</span>\n<span class="k">COPY</span><span class="s"> . /app_name</span>\n<span class="k">RUN </span>yarn <span class="nb">install</span> <span class="nt">--production</span>\n<span class="k">RUN </span>yarn build\n\n<span class="k">FROM</span><span class="s"> node:10.15.1-alpine</span>\n<span class="k">WORKDIR</span><span class="s"> /app_name</span>\n<span class="k">COPY</span><span class="s"> --from=builder /app_name /app_name</span>\n<span class="k">CMD</span><span class="s"> ["yarn", "start"]</span>\n</pre></div></div>\n\n<p>また、<code>docker build</code>して作成されたImageサイズは以下の通りです。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker images\n<span class="go">REPOSITORY    TAG                 IMAGE ID            CREATED             SIZE\ndevide        latest              d3748247c4d9        23 seconds ago      175MB\n</span><span class="gp">&lt;none&gt;</span>        &lt;none&gt;              af58b23cc0c5        32 seconds ago      474MB\n</pre></div></div>\n\n<p><code>REPOSITORY</code>名が<code>devide</code>のImageが実行用のImageですね。</p>\n\n<p>Imageサイズを<code>175MB</code>まで落とすことが出来ました。</p>\n\n<p>大体、3分の1くらいのサイズに落とせたという感じですかね。</p>\n\n<p>それと、<code>Dockerfile</code>の<code>FROM</code>で<code>alpine</code>をつけてあげなかった場合は、Imageサイズが<code>1.33GB</code>まで肥大化していました。</p>\n\n<p>つまり、<code>1.33GB</code>から<code>175MB</code>までImageサイズを落とせたということになりますね。</p>\n\n<h3>\n<span id="ビルド用のdockerイメージ中間imageをキャッシュしてビルドを高速化する" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E7%94%A8%E3%81%AEdocker%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E4%B8%AD%E9%96%93image%E3%82%92%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%97%E3%81%A6%E3%83%93%E3%83%AB%E3%83%89%E3%82%92%E9%AB%98%E9%80%9F%E5%8C%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ビルド用のDockerイメージ(中間Image)をキャッシュしてビルドを高速化する</h3>\n\n<blockquote>\n<p>Docker イメージビルドの速度を上げる最も簡単な方法は、後続のビルドに使用できるようにキャッシュ イメージを指定することです。<br>\n引用：<a href="https://cloud.google.com/cloud-build/docs/speeding-up-builds" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.google.com/cloud-build/docs/speeding-up-builds</a></p>\n</blockquote>\n\n<p>また、ビルド用のDockerのImage(中間イメージ)についてもキャッシュで高速化出来るようです。</p>\n\n<p>GoogleのCloudを利用する場合は、kanikoでキャッシュをするとよさそうですね。</p>\n\n<p>以下がkanikoの概要となります。</p>\n\n<blockquote>\n<p>Kaniko キャッシュは、Cloud Build の機能の 1 つであり、コンテナビルドのアーティファクトをキャッシュに保存します。キャッシュ保存の際は、コンテナ イメージ レジストリ（Google 独自の Container Registry など）内に中間レイヤが保存され、インデックス付けされます。レジストリ内のレイヤは、以降のビルドに利用できます。詳しくは、<a href="https://cloud.google.com/cloud-build/docs/kaniko-cache" rel="nofollow noopener" target="_blank">Kaniko キャッシュの使用</a>をご覧ください。<br>\n引用：<a href="https://cloud.google.com/cloud-build/docs/speeding-up-builds" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.google.com/cloud-build/docs/speeding-up-builds</a></p>\n</blockquote>\n\n<p>kanikoキャッシュについては、別の記事でまとめます。</p>\n\n<h2>\n<span id="ビルド用のdockerfileのimage中間イメージにtag名をつけて管理する" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E7%94%A8%E3%81%AEdockerfile%E3%81%AEimage%E4%B8%AD%E9%96%93%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%ABtag%E5%90%8D%E3%82%92%E3%81%A4%E3%81%91%E3%81%A6%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ビルド用のDockerfileのImage(中間イメージ)にTag名をつけて管理する</h2>\n\n<p>先ほどのビルド用のImageのTagが、以下のように<code>&lt;none&gt;</code>となっていました。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker images\n<span class="go">REPOSITORY    TAG                 IMAGE ID            CREATED             SIZE\ndevide        latest              d3748247c4d9        23 seconds ago      175MB\n</span><span class="gp">&lt;none&gt;</span>        &lt;none&gt;              af58b23cc0c5        32 seconds ago      474MB\n</pre></div></div>\n\n<p>ビルド用のImageにもTag名をつけてあげて管理しやすくしてあげましょう。</p>\n\n<p>先ほど載せた<code>Dockerfile</code>のソースコードを鑑みると、以下のようにコマンドを入力すると、ビルド用のImageが管理しやすくなるかと思います。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker build <span class="nt">--target</span> <span class="o">{</span>asで指定したビルド用Imageの名前<span class="o">(</span>ステージ名<span class="o">)}</span> <span class="nt">-t</span> <span class="o">{</span>docker imagesで表示されているREPOSITORY名<span class="o">(</span>Image名<span class="o">)}</span>:<span class="o">{</span>asで指定したビルド用Imageの名前<span class="o">(</span>ステージ名<span class="o">)}</span> <span class="nb">.</span>\n</pre></div></div>\n\n<p>具体的には、以下のコマンドになるかと思います。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker build <span class="nt">--target</span> builder <span class="nt">-t</span> devide:builder <span class="nb">.</span>\n</pre></div></div>\n\n<p><code>docker images</code>で表示を確認してみましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker images\n<span class="go">REPOSITORY    TAG                 IMAGE ID            CREATED             SIZE\ndevide        latest              d3748247c4d9        23 seconds ago      175MB\ndevide        builder             af58b23cc0c5        32 seconds ago      474MB\n</span></pre></div></div>\n\n<p>これで、管理しやすくなりましたね。</p>\n\n<h2>\n<span id="nuxtjs用のdockerfileで書いてる命令について補足" class="fragment"></span><a href="#nuxtjs%E7%94%A8%E3%81%AEdockerfile%E3%81%A7%E6%9B%B8%E3%81%84%E3%81%A6%E3%82%8B%E5%91%BD%E4%BB%A4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>Nuxt.js用のDockerfileで書いてる命令について補足</h2>\n\n<p>以下が、<code>Nuxt.js</code>用の<code>Dockerfile</code>ですね。</p>\n\n<p><strong>※ベストプラクティスが見つかれば、以下の内容は変更するかもしれません。</strong></p>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:10.15.1-alpine as builder</span>\n<span class="k">WORKDIR</span><span class="s"> /app_name</span>\n<span class="k">COPY</span><span class="s"> . /app_name</span>\n<span class="k">RUN </span>yarn <span class="nb">install</span> <span class="nt">--production</span>\n<span class="k">RUN </span>yarn build\n\n<span class="k">FROM</span><span class="s"> node:10.15.1-alpine</span>\n<span class="k">WORKDIR</span><span class="s"> /app_name</span>\n<span class="k">COPY</span><span class="s"> --from=builder /app_name /app_name</span>\n<span class="k">CMD</span><span class="s"> ["yarn", "start"]</span>\n</pre></div></div>\n\n<p><code>Dockerfile</code>の基本的な書き方等は、以下のドキュメントで補完できるはずです。<br>\n参考：<a href="http://docs.docker.jp/engine/reference/builder.html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.docker.jp/engine/reference/builder.html</a></p>\n\n<p>ただ、ドキュメントを見るだけじゃちょっと分からなかった、各命令について以下の通りに補足していきます。</p>\n\n<ul>\n<li>\n<code>yarn install --production</code>について</li>\n<li>\n<code>--from</code>について</li>\n<li>\n<code>--from</code>第一引数のコピー元ディレクトリについて</li>\n</ul>\n\n<h3>\n<span id="yarn-install---production-について" class="fragment"></span><a href="#yarn-install---production-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>yarn install --production について</h3>\n\n<blockquote>\n<p>yarn install<br>\npackage.json にリスト化されている全ての依存関係を node_modules 内にインストールします。</p>\n\n<p>yarn install --production[=true|false]<br>\nYarnは、NODE_ENV 環境変数が production に設定されている場合は、 devDependencies にあるいかなるパッケージもインストールしません。 このフラグはYarn に NODE_ENV を無視して、本番かどうかを示すこのフラグを使用するようにさせます。<br>\n引用：<a href="https://yarnpkg.com/lang/ja/docs/cli/install/" class="autolink" rel="nofollow noopener" target="_blank">https://yarnpkg.com/lang/ja/docs/cli/install/</a></p>\n</blockquote>\n\n<p>普通に<code>yarn install</code>してしまうと、開発時に使うパッケージもインストールしてしまいます。</p>\n\n<p>そのため、<code>yarn install --production</code>で、不要なパッケージを除外してしまおうというわけです。</p>\n\n<h3>\n<span id="--from-について" class="fragment"></span><a href="#--from-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>--from について</h3>\n\n<p>以下のコマンドでビルドしたアプリケーションをコピーしています。</p>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">COPY</span><span class="s"> --from=builder /app_name /app_name</span>\n</pre></div></div>\n\n<p>これらの要素を1つ1つ噛み砕くと以下のように解釈出来ました。</p>\n\n<ul>\n<li>--fromはasで指定したステージ名</li>\n<li>第一引数の<code>app_name</code>は、asで指定したステージ名のImageから引っ張ってきたコピー元ディレクトリ</li>\n<li>第二引数の<code>app_name</code>は、上記をコピーする先のディレクトリ</li>\n</ul>\n\n<p>つまり、以下の形でコマンドを入力していることになるはずです。</p>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">COPY</span><span class="s"> --from=asで指定したステージ名 コピー元ディレクトリ コピー先ディレクトリ</span>\n</pre></div></div>\n\n<p>実際に、コピー元のディレクトリかどうか証明するために、以下のように命令してみます。</p>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:10.15.1-alpine as builder</span>\n<span class="k">WORKDIR</span><span class="s"> /app_name</span>\n<span class="k">COPY</span><span class="s"> . /app_name</span>\n<span class="k">RUN </span>yarn <span class="nb">install</span> <span class="nt">--production</span>\n<span class="k">RUN </span>yarn build\n\n<span class="k">FROM</span><span class="s"> node:10.15.1-alpine</span>\n<span class="k">WORKDIR</span><span class="s"> /dir</span>\n<span class="k">COPY</span><span class="s"> --from=builder /app_name /dir</span>\n<span class="k">CMD</span><span class="s"> ["yarn", "start"]</span>\n</pre></div></div>\n\n<p>実行用のImageで<code>WORKDIR</code>を<code>/dir</code>と指定します。</p>\n\n<p>WORKDIRの役割は以下ですね。</p>\n\n<blockquote>\n<p>WORKDIR 命令セットは Dockerfile で RUN 、 CMD 、 ENTRYPOINT 、 COPY 、 ADD 命令実行時の作業ディレクトリ（working directory）を指定します。<br>\n引用：<a href="http://docs.docker.jp/engine/reference/builder.html#workdir" class="autolink" rel="nofollow noopener" target="_blank">http://docs.docker.jp/engine/reference/builder.html#workdir</a></p>\n</blockquote>\n\n<p>コピー先であろうディレクトリを<code>dir</code>と指定して、ビルドが通って実行出来れば、第二引数はコピー先ディレクトリという証明になります。</p>\n\n<p>まずはビルドしてみましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="go">docker build -t multi-stage-builder .\n// 色々省略\nSuccessfully built 1ef6166463c2\nSuccessfully tagged multi-stage-builder:latest\n</span></pre></div></div>\n\n<p>ビルドに成功しました。</p>\n\n<p>次は、実行してみましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="go">docker run --rm -p 3000:3000 multi-stage-builder\nyarn run v1.13.0\n</span><span class="gp">$</span> nuxt start\n<span class="go">ℹ Listening on: http://172.17.0.2:3000/\n</span></pre></div></div>\n\n<p>実行に成功しました。</p>\n\n<p>これで、<code>--from</code>の第二引数がコピー先のディレクトリという証明が出来ました。</p>\n\n<h3>\n<span id="--from-の第一引数のコピー元ディレクトリについて" class="fragment"></span><a href="#--from-%E3%81%AE%E7%AC%AC%E4%B8%80%E5%BC%95%E6%95%B0%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC%E5%85%83%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>--from の第一引数のコピー元ディレクトリについて</h3>\n\n<p><code>Nuxt.js</code>は、<code>SPA</code>や<code>SSR</code>等の方法でアプリケーションをデプロイすることが出来ます。</p>\n\n<p>静的ファイルのホスティングサービスにデプロイする場合は、<code>dist/</code>フォルダのみをコピー元に指定すればよいかもしれません。(検証してないので推測です。)</p>\n\n<p>しかし、今回は<code>SSR</code>を想定しているため、コピー元ディレクトリを<code>/app_name</code>そのものを指定しているというわけです。(<code>.nuxt/</code>を指定しましたが、<code>package.json</code>がねえよって怒られるので、ルートパスを指定した次第です。)(ベストプラクティスを知ってる人はやさしく教えていただけますと幸いです。)</p>\n',body:'## Dockerfileのmulti-stage buildの概要\n\n`Dockerfile`の`multi-stage build`は、「**1つのDockerfileでビルド用のImageと実行用のImageを分ける**」ということをやってくれます。\n\n`Nuxt.js`の場合で例えるとより分かりやすいかなと思いました。\n\n`yarn build`等のアプリケーションのビルドする用のImageを作成して、`yarn start`等のアプリケーション実行用のImageを作成するといったところでしょうか。\n\n`Nuxt.js`のコマンドは以下の公式ドキュメントを読みましょう。\n参考：https://ja.nuxtjs.org/guide/commands/\n\nまた、ビルドされたアプリケーションの成果物をアプリケーション実行用のImageでコピーして、ビルド環境と実行環境を切り離してくれるという感じで使います。\n\n図にすると以下のような感じでしょうか。\n\n![Dockerfileについて.001.jpeg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/307395/203761bb-a771-5216-4fdc-1baf97bda505.jpeg)\n\n## Dockerfileでmulti-stage buildをしておきたい理由\n\n`Dockerfile`で`multi-stage build`をしておきたい理由は以下かなと思ってます。\n\n- Dockerコンテナをビルドする際のコスト(時間・お金)削減\n- ビルド用のDockerイメージ(中間Image)をキャッシュしてビルドを高速化する\n\nこれから、`Dockerfile`で`multi-stage build`をしておきたい理由の詳細をまとめていきますね。\n\n### Dockerコンテナをビルドする際のコスト(時間・お金)削減\n\n>アプリケーションをコンテナ化する際に、ビルド時の依存関係や中間ファイルといった、ランタイムに不要なファイルが誤ってコンテナ イメージに含まれることがあります。こうした不要なファイルによってコンテナ イメージのサイズが拡大し、コンテナ イメージ レジストリとコンテナのランタイムとの間でイメージを移動するときに余計な時間と費用がかかる可能性があります。\n引用：https://cloud.google.com/cloud-build/docs/speeding-up-builds\n\n1つ目は引用のママですね。\n\n**余計なコスト(時間・お金)**がかかってしまうので、ビルド用と実行用でImageを分けておきたいなというところです。\n\nちなみに、ビルド用と実行用でImageを分けなかった場合と分けた場合で、Imageサイズの比較をしてみました。\n\n#### ビルド用と実行用でImageを分けなかった場合のDockerfileのImageサイズ\n\n以下が、ビルド用と実行用でImageを分けなかった場合の`Dockerfile`です。\n\n```dockerfile\nFROM node:10.15.1-alpine\nWORKDIR /app_name\nCOPY . /app_name\nRUN yarn install --production\nRUN yarn build\nCMD ["yarn", "start"]\n```\n\nまた、`docker build`して作成されたImageサイズは以下の通りです。\n\n```terminal\n$ docker images\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\nnot-devide                  latest              4b3ab63c75d3        18 seconds ago      474MB\n```\n\nImageサイズは`474MB`ですね。\n\n#### ビルド用と実行用でImageを分けた場合のDockerfileのImageサイズ\n\n```dockerfile\nFROM node:10.15.1-alpine as builder\nWORKDIR /app_name\nCOPY . /app_name\nRUN yarn install --production\nRUN yarn build\n\nFROM node:10.15.1-alpine\nWORKDIR /app_name\nCOPY --from=builder /app_name /app_name\nCMD ["yarn", "start"]\n```\n\nまた、`docker build`して作成されたImageサイズは以下の通りです。\n\n```terminal\n$ docker images\nREPOSITORY    TAG                 IMAGE ID            CREATED             SIZE\ndevide        latest              d3748247c4d9        23 seconds ago      175MB\n<none>        <none>              af58b23cc0c5        32 seconds ago      474MB\n```\n\n`REPOSITORY`名が`devide`のImageが実行用のImageですね。\n\nImageサイズを`175MB`まで落とすことが出来ました。\n\n大体、3分の1くらいのサイズに落とせたという感じですかね。\n\nそれと、`Dockerfile`の`FROM`で`alpine`をつけてあげなかった場合は、Imageサイズが`1.33GB`まで肥大化していました。\n\nつまり、`1.33GB`から`175MB`までImageサイズを落とせたということになりますね。\n\n### ビルド用のDockerイメージ(中間Image)をキャッシュしてビルドを高速化する\n\n>Docker イメージビルドの速度を上げる最も簡単な方法は、後続のビルドに使用できるようにキャッシュ イメージを指定することです。\n引用：https://cloud.google.com/cloud-build/docs/speeding-up-builds\n\nまた、ビルド用のDockerのImage(中間イメージ)についてもキャッシュで高速化出来るようです。\n\nGoogleのCloudを利用する場合は、kanikoでキャッシュをするとよさそうですね。\n\n以下がkanikoの概要となります。\n\n>Kaniko キャッシュは、Cloud Build の機能の 1 つであり、コンテナビルドのアーティファクトをキャッシュに保存します。キャッシュ保存の際は、コンテナ イメージ レジストリ（Google 独自の Container Registry など）内に中間レイヤが保存され、インデックス付けされます。レジストリ内のレイヤは、以降のビルドに利用できます。詳しくは、[Kaniko キャッシュの使用](https://cloud.google.com/cloud-build/docs/kaniko-cache)をご覧ください。\n引用：https://cloud.google.com/cloud-build/docs/speeding-up-builds\n\nkanikoキャッシュについては、別の記事でまとめます。\n\n## ビルド用のDockerfileのImage(中間イメージ)にTag名をつけて管理する\n\n先ほどのビルド用のImageのTagが、以下のように`<none>`となっていました。\n\n```terminal\n$ docker images\nREPOSITORY    TAG                 IMAGE ID            CREATED             SIZE\ndevide        latest              d3748247c4d9        23 seconds ago      175MB\n<none>        <none>              af58b23cc0c5        32 seconds ago      474MB\n```\n\nビルド用のImageにもTag名をつけてあげて管理しやすくしてあげましょう。\n\n先ほど載せた`Dockerfile`のソースコードを鑑みると、以下のようにコマンドを入力すると、ビルド用のImageが管理しやすくなるかと思います。\n\n```terminal\n$ docker build --target {asで指定したビルド用Imageの名前(ステージ名)} -t {docker imagesで表示されているREPOSITORY名(Image名)}:{asで指定したビルド用Imageの名前(ステージ名)} .\n```\n\n具体的には、以下のコマンドになるかと思います。\n\n```terminal\n$ docker build --target builder -t devide:builder .\n```\n\n`docker images`で表示を確認してみましょう。\n\n```terminal\n$ docker images\nREPOSITORY    TAG                 IMAGE ID            CREATED             SIZE\ndevide        latest              d3748247c4d9        23 seconds ago      175MB\ndevide        builder             af58b23cc0c5        32 seconds ago      474MB\n```\n\nこれで、管理しやすくなりましたね。\n\n## Nuxt.js用のDockerfileで書いてる命令について補足\n\n以下が、`Nuxt.js`用の`Dockerfile`ですね。\n\n**※ベストプラクティスが見つかれば、以下の内容は変更するかもしれません。**\n\n```dockerfile\nFROM node:10.15.1-alpine as builder\nWORKDIR /app_name\nCOPY . /app_name\nRUN yarn install --production\nRUN yarn build\n\nFROM node:10.15.1-alpine\nWORKDIR /app_name\nCOPY --from=builder /app_name /app_name\nCMD ["yarn", "start"]\n```\n\n`Dockerfile`の基本的な書き方等は、以下のドキュメントで補完できるはずです。\n参考：http://docs.docker.jp/engine/reference/builder.html\n\nただ、ドキュメントを見るだけじゃちょっと分からなかった、各命令について以下の通りに補足していきます。\n\n- `yarn install --production`について\n- `--from`について\n- `--from`第一引数のコピー元ディレクトリについて\n\n### yarn install --production について\n\n>yarn install\npackage.json にリスト化されている全ての依存関係を node_modules 内にインストールします。\n\n>yarn install --production[=true|false]\nYarnは、NODE_ENV 環境変数が production に設定されている場合は、 devDependencies にあるいかなるパッケージもインストールしません。 このフラグはYarn に NODE_ENV を無視して、本番かどうかを示すこのフラグを使用するようにさせます。\n引用：https://yarnpkg.com/lang/ja/docs/cli/install/\n\n普通に`yarn install`してしまうと、開発時に使うパッケージもインストールしてしまいます。\n\nそのため、`yarn install --production`で、不要なパッケージを除外してしまおうというわけです。\n\n### --from について\n\n以下のコマンドでビルドしたアプリケーションをコピーしています。\n\n```dockerfile\nCOPY --from=builder /app_name /app_name\n```\n\nこれらの要素を1つ1つ噛み砕くと以下のように解釈出来ました。\n\n- --fromはasで指定したステージ名\n- 第一引数の`app_name`は、asで指定したステージ名のImageから引っ張ってきたコピー元ディレクトリ\n- 第二引数の`app_name`は、上記をコピーする先のディレクトリ\n\nつまり、以下の形でコマンドを入力していることになるはずです。\n\n```dockerfile\nCOPY --from=asで指定したステージ名 コピー元ディレクトリ コピー先ディレクトリ\n```\n\n実際に、コピー元のディレクトリかどうか証明するために、以下のように命令してみます。\n\n```dockerfile\nFROM node:10.15.1-alpine as builder\nWORKDIR /app_name\nCOPY . /app_name\nRUN yarn install --production\nRUN yarn build\n\nFROM node:10.15.1-alpine\nWORKDIR /dir\nCOPY --from=builder /app_name /dir\nCMD ["yarn", "start"]\n```\n\n実行用のImageで`WORKDIR`を`/dir`と指定します。\n\nWORKDIRの役割は以下ですね。\n>WORKDIR 命令セットは Dockerfile で RUN 、 CMD 、 ENTRYPOINT 、 COPY 、 ADD 命令実行時の作業ディレクトリ（working directory）を指定します。\n引用：http://docs.docker.jp/engine/reference/builder.html#workdir\n\nコピー先であろうディレクトリを`dir`と指定して、ビルドが通って実行出来れば、第二引数はコピー先ディレクトリという証明になります。\n\nまずはビルドしてみましょう。\n\n```terminal\ndocker build -t multi-stage-builder .\n// 色々省略\nSuccessfully built 1ef6166463c2\nSuccessfully tagged multi-stage-builder:latest\n```\n\nビルドに成功しました。\n\n次は、実行してみましょう。\n\n```terminal\ndocker run --rm -p 3000:3000 multi-stage-builder\nyarn run v1.13.0\n$ nuxt start\nℹ Listening on: http://172.17.0.2:3000/\n```\n\n実行に成功しました。\n\nこれで、`--from`の第二引数がコピー先のディレクトリという証明が出来ました。\n\n### --from の第一引数のコピー元ディレクトリについて\n\n`Nuxt.js`は、`SPA`や`SSR`等の方法でアプリケーションをデプロイすることが出来ます。\n\n静的ファイルのホスティングサービスにデプロイする場合は、`dist/`フォルダのみをコピー元に指定すればよいかもしれません。(検証してないので推測です。)\n\nしかし、今回は`SSR`を想定しているため、コピー元ディレクトリを`/app_name`そのものを指定しているというわけです。(`.nuxt/`を指定しましたが、`package.json`がねえよって怒られるので、ルートパスを指定した次第です。)(ベストプラクティスを知ってる人はやさしく教えていただけますと幸いです。)\n',coediting:a,comments_count:0,created_at:"2019-11-23T03:45:03+09:00",group:s,id:"fca369c1d9bde1701e38",likes_count:2,private:a,reactions_count:0,tags:[{name:m,versions:[]},{name:c,versions:[]},{name:H,versions:[]},{name:e,versions:[]}],title:"【Nuxt.js】multi-stage buildが出来るDockerfileを作成してみた",updated_at:"2019-11-23T13:31:48+09:00",url:"https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38",user:{description:x,facebook_id:n,followees_count:36,followers_count:o,github_login_name:E,id:i,items_count:19,linkedin_id:n,location:n,name:n,organization:A,permanent_id:y,profile_image_url:w,team_only:a,twitter_screen_name:i,website_url:j},page_views_count:s},{rendered_body:'<p>下にフリックして閉じられるモーダルは、最近のアプリでは定番になりつつあるがwebではまだあまり見たことがなく、あったらいいのになぁ、と漠然と思ってた。<br>\nそんな折 「<a href="http://www.bnn.co.jp/books/9522/" rel="nofollow noopener" target="_blank">【新版】UI GRAPHICS 成功事例と思想から学ぶ、これからのインターフェイスデザインとUX</a> 」という本を読み、こういったUIが今後のトレンドに対する新たなアプローチですよ、というご意見に完全に触発され作ってみたくなった。</p>\n\n<p>ので、作ってみた。</p>\n\n<h1>\n<span id="swipeabledrawer" class="fragment"></span><a href="#swipeabledrawer"><i class="fa fa-link"></i></a>SwipeableDrawer</h1>\n\n<p><a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/390283/86b070ab-83cd-a303-356b-8217280ac716.gif" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/390283/86b070ab-83cd-a303-356b-8217280ac716.gif" width="250" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/390283/86b070ab-83cd-a303-356b-8217280ac716.gif" loading="lazy"></a></p>\n\n<p>■ デモ<br>\n<a href="https://dsflon.github.io/SwipeableDrawer/" class="autolink" rel="nofollow noopener" target="_blank">https://dsflon.github.io/SwipeableDrawer/</a><br>\n（スマホで見てください<img alt=":iphone:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f4f1.png" title=":iphone:" width="20" loading="lazy">）</p>\n\n<p>■ ソース<br>\n<a href="https://github.com/dsflon/SwipeableDrawer" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dsflon/SwipeableDrawer</a></p>\n\n<p>参考にした本では<code>ハーフモーダル</code>と表現されていますが、<a href="https://material-ui.com/api/swipeable-drawer/" rel="nofollow noopener" target="_blank">Material-UI</a>を参考に <code>SwipeableDrawer</code> というコンポーネント名にしました。</p>\n\n<h1>\n<span id="使う" class="fragment"></span><a href="#%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>使う</h1>\n\n<p>■ 本体はここ<br>\n<a href="https://github.com/dsflon/SwipeableDrawer/tree/master/components/SwipeableDrawer" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dsflon/SwipeableDrawer/tree/master/components/SwipeableDrawer</a></p>\n\n<p>nuxtで <code>typescript</code> <code>vue-property-decorator</code> を入れている場合、下記のような感じで利用します。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;button</span> <span class="err">@</span><span class="na">click=</span><span class="s">"opened = true"</span><span class="nt">&gt;</span>\n      開く\n    <span class="nt">&lt;/button&gt;</span>\n\n    <span class="nt">&lt;SwipeableDrawer</span>\n      <span class="na">:open=</span><span class="s">"opened"</span>\n      <span class="err">@</span><span class="na">close=</span><span class="s">"opened = false"</span>\n    <span class="nt">&gt;</span>\n      <span class="c">&lt;!-- ここに内容を入れます --&gt;</span>\n    <span class="nt">&lt;/SwipeableDrawer&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">import</span> <span class="p">{</span> <span class="nx">SwipeableDrawer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">~/components/SwipeableDrawer</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">SwipeableDrawer</span><span class="p">,</span>\n  <span class="p">},</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">Index</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">opened</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="詳細をそのうち書きます" class="fragment"></span><a href="#%E8%A9%B3%E7%B4%B0%E3%82%92%E3%81%9D%E3%81%AE%E3%81%86%E3%81%A1%E6%9B%B8%E3%81%8D%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>詳細を...そのうち書きます...</h1>\n\n<ul>\n<li>easingJSを自前でこしらえた件</li>\n<li>スワイプとフリックの両方で閉じられるようにした件</li>\n<li>横方向スクロールと干渉しあわないようにスワイプの角度を考慮した件</li>\n</ul>\n\n<h1>\n<span id="感想" class="fragment"></span><a href="#%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>感想</h1>\n\n<p>これをベースにしたものが会社で採用されたので嬉しい<img alt=":joy:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f602.png" title=":joy:" width="20" loading="lazy"><br>\n例）<a href="https://restaurant.ikyu.com/sd/100442" class="autolink" rel="nofollow noopener" target="_blank">https://restaurant.ikyu.com/sd/100442</a></p>\n',body:'下にフリックして閉じられるモーダルは、最近のアプリでは定番になりつつあるがwebではまだあまり見たことがなく、あったらいいのになぁ、と漠然と思ってた。\nそんな折 「[【新版】UI GRAPHICS 成功事例と思想から学ぶ、これからのインターフェイスデザインとUX](http://www.bnn.co.jp/books/9522/) 」という本を読み、こういったUIが今後のトレンドに対する新たなアプローチですよ、というご意見に完全に触発され作ってみたくなった。\n\nので、作ってみた。\n\n# SwipeableDrawer\n\n<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/390283/86b070ab-83cd-a303-356b-8217280ac716.gif" width="250">\n\n■ デモ\nhttps://dsflon.github.io/SwipeableDrawer/\n（スマホで見てください:iphone:）\n\n■ ソース\nhttps://github.com/dsflon/SwipeableDrawer\n\n参考にした本では`ハーフモーダル`と表現されていますが、[Material-UI](https://material-ui.com/api/swipeable-drawer/)を参考に `SwipeableDrawer` というコンポーネント名にしました。\n\n\n# 使う\n\n■ 本体はここ\nhttps://github.com/dsflon/SwipeableDrawer/tree/master/components/SwipeableDrawer\n\nnuxtで `typescript` `vue-property-decorator` を入れている場合、下記のような感じで利用します。\n\n```index.vue\n<template>\n  <div>\n    <button @click="opened = true">\n      開く\n    </button>\n\n    <SwipeableDrawer\n      :open="opened"\n      @close="opened = false"\n    >\n      \x3c!-- ここに内容を入れます --\x3e\n    </SwipeableDrawer>\n  </div>\n</template>\n\n<script lang="ts">\nimport { Component, Vue } from \'vue-property-decorator\';\n\nimport { SwipeableDrawer } from \'~/components/SwipeableDrawer\';\n\n@Component({\n  components: {\n    SwipeableDrawer,\n  },\n})\nexport default class Index extends Vue {\n  opened = false;\n}\n<\/script>\n```\n\n# 詳細を...そのうち書きます...\n- easingJSを自前でこしらえた件\n- スワイプとフリックの両方で閉じられるようにした件\n- 横方向スクロールと干渉しあわないようにスワイプの角度を考慮した件\n\n# 感想\n\nこれをベースにしたものが会社で採用されたので嬉しい:joy:\n例）https://restaurant.ikyu.com/sd/100442\n',coediting:a,comments_count:0,created_at:"2019-11-22T21:48:23+09:00",group:s,id:"11a7cf780b3b42d10016",likes_count:3,private:a,reactions_count:0,tags:[{name:c,versions:[]},{name:e,versions:[]}],title:"vue.js(Nuxt)で下にフリックして閉じられるモーダルコンポーネントを作ってみた",updated_at:"2019-11-27T12:35:53+09:00",url:"https://qiita.com/dsflon/items/11a7cf780b3b42d10016",user:{description:n,facebook_id:n,followees_count:0,followers_count:1,github_login_name:s,id:"dsflon",items_count:1,linkedin_id:n,location:n,name:"斎藤 大輝",organization:"株式会社一休",permanent_id:390283,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/390283/profile-images/1557193630",team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="背景" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF"><i class="fa fa-link"></i></a>背景</h1>\n\n<p>Nuxt.jsをサブディレクトリで動かして、ルートディレクトリの<code>.env</code>を読もうとすると</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>WARN  No .env file found \n</pre></div></div>\n\n<p>んなものないって警告でる。</p>\n\n<h2>\n<span id="対策" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>対策</h2>\n\n<p>dotenvのpathを設定する。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">dotenv</span><span class="dl">"</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">srcDir</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hogehoge</span><span class="dl">"</span><span class="p">,</span>\n\n  <span class="c1">// ~~略~~</span>\n  <span class="na">buildModules</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">@nuxtjs/dotenv</span><span class="dl">"</span><span class="p">],</span>\n  <span class="na">dotenv</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">path</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span>\n  <span class="p">},</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="herokuとかでも環境変数を読みたい場合" class="fragment"></span><a href="#heroku%E3%81%A8%E3%81%8B%E3%81%A7%E3%82%82%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%AA%AD%E3%81%BF%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Herokuとかでも環境変数を読みたい場合</h2>\n\n<p>envを設定する。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">dotenv</span><span class="dl">"</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">srcDir</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hogehoge</span><span class="dl">"</span><span class="p">,</span>\n\n  <span class="c1">// ~~略~~</span>\n  <span class="na">env</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">APP_ID</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">APP_ID</span><span class="p">,</span>\n    <span class="na">APP_KEY</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">APP_KEY</span><span class="p">,</span>\n  <span class="p">},</span>\n</pre></div>\n</div>\n\n<p>Herokuで環境変数を設定するのをお忘れなく。</p>\n\n<h2>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>\n\n<p><a href="https://github.com/nuxt-community/dotenv-module" rel="nofollow noopener" target="_blank">nuxt-community/dotenv-module</a><br>\n<a href="https://ja.nuxtjs.org/api/configuration-env/" rel="nofollow noopener" target="_blank">API: env プロパティ</a></p>\n',body:'# 背景\n\nNuxt.jsをサブディレクトリで動かして、ルートディレクトリの`.env`を読もうとすると\n\n```\nWARN  No .env file found \n```\n\nんなものないって警告でる。\n\n\n## 対策\n\ndotenvのpathを設定する。\n\n```nuxt.config.js\nrequire("dotenv").config();\n\nexport default {\n  srcDir: "hogehoge",\n\n  // ~~略~~\n  buildModules: ["@nuxtjs/dotenv"],\n  dotenv: {\n    path: process.cwd()\n  },\n```\n\n## Herokuとかでも環境変数を読みたい場合\n\nenvを設定する。\n\n```nuxt.config.js\nrequire("dotenv").config();\n\nexport default {\n  srcDir: "hogehoge",\n\n  // ~~略~~\n  env: {\n    APP_ID: process.env.APP_ID,\n    APP_KEY: process.env.APP_KEY,\n  },\n```\n\nHerokuで環境変数を設定するのをお忘れなく。\n\n## 参考\n\n[nuxt-community/dotenv-module](https://github.com/nuxt-community/dotenv-module)\n[API: env プロパティ](https://ja.nuxtjs.org/api/configuration-env/)\n',coediting:a,comments_count:0,created_at:U,group:s,id:"5cbb640bacaa5ff7e120",likes_count:1,private:a,reactions_count:0,tags:[{name:e,versions:[]}],title:"サブディレクトリ動かすNuxt.jsでもルートディレクトリの.envを読み込む",updated_at:U,url:"https://qiita.com/ProjectEuropa/items/5cbb640bacaa5ff7e120",user:{description:"PHPとかJavaScriptとか",facebook_id:n,followees_count:15,followers_count:o,github_login_name:s,id:"ProjectEuropa",items_count:77,linkedin_id:n,location:"埼玉県",name:"Project Europa",organization:n,permanent_id:133718,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/133718/profile-images/1554528613",team_only:a,twitter_screen_name:"M2_m_",website_url:n},page_views_count:s},{rendered_body:'\n<h2>\n<span id="nuxtjsでdocker-imageを作成時に出たエラーと解決方法をまとめた経緯と目的" class="fragment"></span><a href="#nuxtjs%E3%81%A7docker-image%E3%82%92%E4%BD%9C%E6%88%90%E6%99%82%E3%81%AB%E5%87%BA%E3%81%9F%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%9F%E7%B5%8C%E7%B7%AF%E3%81%A8%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>Nuxt.jsでDocker Imageを作成時に出たエラーと解決方法をまとめた経緯と目的</h2>\n\n<p><code>Nuxt.js</code>でアプリ開発してて、ローカルで<code>yarn dev</code>とかしたら普通にrunするのに、<code>docker build</code>でImageを作ろうとした時に、<code>Error: Nuxt build error</code>が出るみたいなことが多々ありました。</p>\n\n<p>エラーそのものは誤字脱字とか本当にしょうもないレベルのお話ですが、疲れてる時だと僕の場合は正常な思考回路でデバッグ出来なかったりします。</p>\n\n<p>そのため、<code>docker build</code>でコケた時に、まず最初にこのドキュメントを見て「<strong>疑うポイントはここだな</strong>」をあたりをつけて調べるために、備忘録を残すのが目的です。</p>\n\n<p><strong>※起きたエラーと解決方法は随時追加していく。</strong></p>\n\n<p>localhost起動時に出る<code>ERR_EMPTY_RESPONSE</code>の解決方法は、Imageビルド時に出るわけではないので、別の記事に切り出しました。<br>\n参考：<a href="https://qiita.com/arthur_foreign/items/bc87c9b66e7ea9710c6b" class="autolink" id="reference-fe9b411b5f8587221cea">https://qiita.com/arthur_foreign/items/bc87c9b66e7ea9710c6b</a></p>\n\n<h2>\n<span id="nuxtjs用に作成したdockerfile" class="fragment"></span><a href="#nuxtjs%E7%94%A8%E3%81%AB%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9Fdockerfile"><i class="fa fa-link"></i></a>Nuxt.js用に作成したDockerfile</h2>\n\n<p>以下のような、Dockerfileを作成しました。</p>\n\n<div class="code-frame" data-lang="dockerfile"><div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:10.15.1-alpine</span>\n<span class="k">WORKDIR</span><span class="s"> /app</span>\n<span class="k">COPY</span><span class="s"> . /app</span>\n<span class="k">RUN </span>yarn <span class="nb">install</span> <span class="nt">--production</span>\n<span class="k">RUN </span>yarn build\n<span class="k">EXPOSE</span><span class="s"> 3000</span>\n<span class="k">CMD</span><span class="s"> ["yarn", "start"]</span>\n</pre></div></div>\n\n<p>以下に、<code>Nuxt.js</code>用の<code>Dockerfile</code>を<code>multi-stage build</code>をする方法をまとめました。</p>\n\n<p>参考：<a href="https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38" class="autolink" id="reference-287f703bdcb471e37f40">https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38</a></p>\n\n<p>Dockerfileの作成方法について、詳しく知りたい人は参考にしていただけると幸いです。</p>\n\n<h2>\n<span id="nuxtjsでdocker-imageを作成時に出たエラーと解決方法一覧" class="fragment"></span><a href="#nuxtjs%E3%81%A7docker-image%E3%82%92%E4%BD%9C%E6%88%90%E6%99%82%E3%81%AB%E5%87%BA%E3%81%9F%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>Nuxt.jsでDocker Imageを作成時に出たエラーと解決方法一覧</h2>\n\n<p>以下、<code>Nuxt.js</code>でDocker Imageを作成時に出たエラーの目次です。</p>\n\n<ul>\n<li>ファイル名とimportで呼び出してるディレクトリで大文字小文字が違う</li>\n<li>templateで呼び出してるComponent名とexportしてるComponent名が違う</li>\n</ul>\n\n<p>これから、出たエラーと解決方法をまとめていきます。</p>\n\n<h3>\n<span id="ファイル名とimportで呼び出してるディレクトリで大文字小文字が違う" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%81%A8import%E3%81%A7%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A6%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%A7%E5%A4%A7%E6%96%87%E5%AD%97%E5%B0%8F%E6%96%87%E5%AD%97%E3%81%8C%E9%81%95%E3%81%86"><i class="fa fa-link"></i></a>ファイル名とimportで呼び出してるディレクトリで大文字小文字が違う</h3>\n\n<p>例えば、以下のように大文字と小文字をタイポしているファイルがあったとします。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>app_name\n├──app\n│  ├──components\n│  │  ├──HEaderMenu.vue\n</pre></div></div>\n\n<p>以下のように、<code>pages</code>や<code>components</code>側でタイポせずに呼び出したとします。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;HeaderMenu</span> <span class="nt">/&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">HeaderMenu</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/HeaderMenu</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">HeaderMenu</span><span class="p">,</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p><code>yarn dev</code>で実行してみましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> yarn dev\n<span class="go">\nyarn dev\nyarn run v1.15.2\n</span><span class="gp">$</span> nuxt\n<span class="go">\n   ╭───────────────────────────────────────────────╮\n   │                                               │\n   │   Nuxt.js v2.10.2                             │\n   │   Running in development mode (universal)     │\n   │                                               │\n   │   Listening on: http://192.168.100.61:3000/   │\n   │                                               │\n   ╰───────────────────────────────────────────────╯\n\nℹ Preparing project for development                                                                                                                                       14:23:14\nℹ Initial build may take a while                                                                                                                                          14:23:14\n✔ Builder initialized                                                                                                                                                     14:23:14\n✔ Nuxt files generated                                                                                                                                                    14:23:14\n\n✔ Client\n  Compiled successfully in 4.01s\n\n✔ Server\n  Compiled successfully in 3.53s\n</span></pre></div></div>\n\n<p>こんな感じで普通に起動します。</p>\n\n<p>ちなみに、<code>yarn build</code>と<code>yarn start</code>も普通に起動しました。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> yarn build\n<span class="go">\nyarn run v1.15.2\n</span><span class="gp">$</span> nuxt build\n<span class="go">ℹ Production build                                                                                                                                                        15:15:43\n✔ Builder initialized                                                                                                                                                     15:15:43\n✔ Nuxt files generated                                                                                                                                                    15:15:43\n\n✔ Client\n  Compiled successfully in 6.07s\n\n✔ Server\n  Compiled successfully in 1.42s\n\n\nHash: 2c95349a7cb8919eb052\nVersion: webpack 4.41.2\nTime: 6071ms\nBuilt at: 2019-11-22 15:15:50\n                         Asset       Size  Chunks                                Chunk Names\n../server/client.manifest.json     13 KiB          [emitted]                     \n       48963c700a8ee94b825c.js   20.2 KiB       3  [emitted] [immutable]         pages/index\n                      LICENSES  510 bytes          [emitted]                     \n       d374b0be470719effa76.js   4.77 KiB       2  [emitted] [immutable]         pages/contents/_content\n       dbaf6550e2b76662e88e.js   46.6 KiB       0  [emitted] [immutable]         app\n       e970751d6f11b4b1c332.js    162 KiB       1  [emitted] [immutable]         commons.app\n       f7bb11e1cb4f5f24a28c.js   2.33 KiB       4  [emitted] [immutable]         runtime\n               img/15cb2cf.png    320 KiB          [emitted]              [big]  \n               img/1e89dca.jpg   38.5 KiB          [emitted]                     \n               img/795c715.jpg   95.1 KiB          [emitted]                     \n               img/c5d7ccc.png   3.19 KiB          [emitted]                     \n               img/e1a9a61.jpg   55.9 KiB          [emitted]                     \n + 2 hidden assets\nEntrypoint app = f7bb11e1cb4f5f24a28c.js e970751d6f11b4b1c332.js dbaf6550e2b76662e88e.js\n\nWARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).\nThis can impact web performance.\nAssets: \n  img/15cb2cf.png (320 KiB)\n\nHash: a111472007f783f7cf2e\nVersion: webpack 4.41.2\nTime: 1421ms\nBuilt at: 2019-11-22 15:15:51\n                  Asset       Size  Chunks                         Chunk Names\n6968d594f234167797a9.js   4.89 KiB       1  [emitted] [immutable]  pages/contents/_content\na2503e19171336a65bb8.js   20.8 KiB       2  [emitted] [immutable]  pages/index\n              server.js   29.5 KiB       0  [emitted]              app\n   server.manifest.json  203 bytes          [emitted]              \nEntrypoint app = server.js\n✨  Done in 10.73s.\n</span><span class="gp">~/../app_dir/app_name:master$</span> yarn start\n<span class="go">yarn run v1.15.2\n</span><span class="gp">$</span> nuxt start\n<span class="go">\n   ╭───────────────────────────────────────────────╮\n   │                                               │\n   │   Nuxt.js v2.10.2                             │\n   │   Running in production mode (universal)      │\n   │   Memory usage: 14.3 MB (RSS: 47.7 MB)        │\n   │                                               │\n   │   Listening on: http://192.168.100.61:3000/   │\n   │                                               │\n   ╰───────────────────────────────────────────────╯\n</span></pre></div></div>\n\n<p>次は、<code>docker build</code>で実行してみましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker build <span class="nt">-t</span> <span class="nb">test</span> <span class="nb">.</span>\n<span class="go">\nERROR in ./app/pages/index.vue?vue&amp;type=script&amp;lang=js&amp; (./node_modules/babel-loader/lib??ref--2-0!./node_modules/vue-loader/lib??vue-loader-options!./app/pages/index.vue?vue&amp;type=script&amp;lang=js&amp;)\nModule not found: Error: Can\'t resolve \'@/components/HeaderMenu\' in \'/app_name/app/pages\'\n @ ./app/pages/index.vue?vue&amp;type=script&amp;lang=js&amp; (./node_modules/babel-loader/lib??ref--2-0!./node_modules/vue-loader/lib??vue-loader-options!./app/pages/index.vue?vue&amp;type=script&amp;lang=js&amp;) 18:0-63 27:21-36\n @ ./app/pages/index.vue?vue&amp;type=script&amp;lang=js&amp;\n @ ./app/pages/index.vue\n @ ./.nuxt/router.js\n @ ./.nuxt/index.js\n @ ./.nuxt/client.js\n @ multi ./.nuxt/client.js\n\n FATAL  Nuxt build error\n\n  at WebpackBundler.webpackCompile (node_modules/@nuxt/webpack/dist/webpack.js:5314:21)\n  at process._tickCallback (internal/process/next_tick.js:68:7)\n\n   ╭─────────────────────────────╮\n   │                             │\n   │   ✖ Nuxt Fatal Error        │\n   │                             │\n   │   Error: Nuxt build error   │\n   │                             │\n   ╰─────────────────────────────╯\n\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\nThe command \'/bin/sh -c yarn build\' returned a non-zero code: 1\n</span></pre></div></div>\n\n<p>build error が起きました…</p>\n\n<p>タイポしているファイル名を修正しましょう。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>app_name\n├──app\n│  ├──components\n│  │  ├──HeaderMenu.vue\n</pre></div></div>\n\n<p>次に、<code>docker build</code>を実行してみましょう。</p>\n\n<div class="code-frame" data-lang="terminal"><div class="highlight"><pre><span class="gp">$</span> docker build <span class="nt">-t</span> <span class="nb">test</span> <span class="nb">.</span>\n<span class="go">// 色々省略\nSuccessfully built 8474a08b9975\nSuccessfully tagged test:latest\n</span></pre></div></div>\n\n<p>ビルドに成功しました。</p>\n',body:"## Nuxt.jsでDocker Imageを作成時に出たエラーと解決方法をまとめた経緯と目的\n\n`Nuxt.js`でアプリ開発してて、ローカルで`yarn dev`とかしたら普通にrunするのに、`docker build`でImageを作ろうとした時に、`Error: Nuxt build error`が出るみたいなことが多々ありました。\n\nエラーそのものは誤字脱字とか本当にしょうもないレベルのお話ですが、疲れてる時だと僕の場合は正常な思考回路でデバッグ出来なかったりします。\n\nそのため、`docker build`でコケた時に、まず最初にこのドキュメントを見て「**疑うポイントはここだな**」をあたりをつけて調べるために、備忘録を残すのが目的です。\n\n**※起きたエラーと解決方法は随時追加していく。**\n\nlocalhost起動時に出る`ERR_EMPTY_RESPONSE`の解決方法は、Imageビルド時に出るわけではないので、別の記事に切り出しました。\n参考：https://qiita.com/arthur_foreign/items/bc87c9b66e7ea9710c6b\n\n## Nuxt.js用に作成したDockerfile\n\n以下のような、Dockerfileを作成しました。\n\n```dockerfile\nFROM node:10.15.1-alpine\nWORKDIR /app\nCOPY . /app\nRUN yarn install --production\nRUN yarn build\nEXPOSE 3000\nCMD [\"yarn\", \"start\"]\n```\n\n以下に、`Nuxt.js`用の`Dockerfile`を`multi-stage build`をする方法をまとめました。\n\n参考：https://qiita.com/arthur_foreign/items/fca369c1d9bde1701e38\n\nDockerfileの作成方法について、詳しく知りたい人は参考にしていただけると幸いです。\n\n## Nuxt.jsでDocker Imageを作成時に出たエラーと解決方法一覧\n\n以下、`Nuxt.js`でDocker Imageを作成時に出たエラーの目次です。\n\n- ファイル名とimportで呼び出してるディレクトリで大文字小文字が違う\n- templateで呼び出してるComponent名とexportしてるComponent名が違う\n\nこれから、出たエラーと解決方法をまとめていきます。\n\n### ファイル名とimportで呼び出してるディレクトリで大文字小文字が違う\n\n例えば、以下のように大文字と小文字をタイポしているファイルがあったとします。\n\n```\napp_name\n├──app\n│  ├──components\n│  │  ├──HEaderMenu.vue\n```\n\n以下のように、`pages`や`components`側でタイポせずに呼び出したとします。\n\n```vue\n<template>\n  <HeaderMenu />\n</template>\n\n<script>\nimport HeaderMenu from '@/components/HeaderMenu'\n\nexport default {\n  components: {\n    HeaderMenu,\n  }\n}\n<\/script>\n```\n\n`yarn dev`で実行してみましょう。\n\n```terminal\n$ yarn dev\n\nyarn dev\nyarn run v1.15.2\n$ nuxt\n\n   ╭───────────────────────────────────────────────╮\n   │                                               │\n   │   Nuxt.js v2.10.2                             │\n   │   Running in development mode (universal)     │\n   │                                               │\n   │   Listening on: http://192.168.100.61:3000/   │\n   │                                               │\n   ╰───────────────────────────────────────────────╯\n\nℹ Preparing project for development                                                                                                                                       14:23:14\nℹ Initial build may take a while                                                                                                                                          14:23:14\n✔ Builder initialized                                                                                                                                                     14:23:14\n✔ Nuxt files generated                                                                                                                                                    14:23:14\n\n✔ Client\n  Compiled successfully in 4.01s\n\n✔ Server\n  Compiled successfully in 3.53s\n```\n\nこんな感じで普通に起動します。\n\nちなみに、`yarn build`と`yarn start`も普通に起動しました。\n\n```terminal\n$ yarn build\n\nyarn run v1.15.2\n$ nuxt build\nℹ Production build                                                                                                                                                        15:15:43\n✔ Builder initialized                                                                                                                                                     15:15:43\n✔ Nuxt files generated                                                                                                                                                    15:15:43\n\n✔ Client\n  Compiled successfully in 6.07s\n\n✔ Server\n  Compiled successfully in 1.42s\n\n\nHash: 2c95349a7cb8919eb052\nVersion: webpack 4.41.2\nTime: 6071ms\nBuilt at: 2019-11-22 15:15:50\n                         Asset       Size  Chunks                                Chunk Names\n../server/client.manifest.json     13 KiB          [emitted]                     \n       48963c700a8ee94b825c.js   20.2 KiB       3  [emitted] [immutable]         pages/index\n                      LICENSES  510 bytes          [emitted]                     \n       d374b0be470719effa76.js   4.77 KiB       2  [emitted] [immutable]         pages/contents/_content\n       dbaf6550e2b76662e88e.js   46.6 KiB       0  [emitted] [immutable]         app\n       e970751d6f11b4b1c332.js    162 KiB       1  [emitted] [immutable]         commons.app\n       f7bb11e1cb4f5f24a28c.js   2.33 KiB       4  [emitted] [immutable]         runtime\n               img/15cb2cf.png    320 KiB          [emitted]              [big]  \n               img/1e89dca.jpg   38.5 KiB          [emitted]                     \n               img/795c715.jpg   95.1 KiB          [emitted]                     \n               img/c5d7ccc.png   3.19 KiB          [emitted]                     \n               img/e1a9a61.jpg   55.9 KiB          [emitted]                     \n + 2 hidden assets\nEntrypoint app = f7bb11e1cb4f5f24a28c.js e970751d6f11b4b1c332.js dbaf6550e2b76662e88e.js\n\nWARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).\nThis can impact web performance.\nAssets: \n  img/15cb2cf.png (320 KiB)\n\nHash: a111472007f783f7cf2e\nVersion: webpack 4.41.2\nTime: 1421ms\nBuilt at: 2019-11-22 15:15:51\n                  Asset       Size  Chunks                         Chunk Names\n6968d594f234167797a9.js   4.89 KiB       1  [emitted] [immutable]  pages/contents/_content\na2503e19171336a65bb8.js   20.8 KiB       2  [emitted] [immutable]  pages/index\n              server.js   29.5 KiB       0  [emitted]              app\n   server.manifest.json  203 bytes          [emitted]              \nEntrypoint app = server.js\n✨  Done in 10.73s.\n~/../app_dir/app_name:master$ yarn start\nyarn run v1.15.2\n$ nuxt start\n\n   ╭───────────────────────────────────────────────╮\n   │                                               │\n   │   Nuxt.js v2.10.2                             │\n   │   Running in production mode (universal)      │\n   │   Memory usage: 14.3 MB (RSS: 47.7 MB)        │\n   │                                               │\n   │   Listening on: http://192.168.100.61:3000/   │\n   │                                               │\n   ╰───────────────────────────────────────────────╯\n```\n\n次は、`docker build`で実行してみましょう。\n\n```terminal\n$ docker build -t test .\n\nERROR in ./app/pages/index.vue?vue&type=script&lang=js& (./node_modules/babel-loader/lib??ref--2-0!./node_modules/vue-loader/lib??vue-loader-options!./app/pages/index.vue?vue&type=script&lang=js&)\nModule not found: Error: Can't resolve '@/components/HeaderMenu' in '/app_name/app/pages'\n @ ./app/pages/index.vue?vue&type=script&lang=js& (./node_modules/babel-loader/lib??ref--2-0!./node_modules/vue-loader/lib??vue-loader-options!./app/pages/index.vue?vue&type=script&lang=js&) 18:0-63 27:21-36\n @ ./app/pages/index.vue?vue&type=script&lang=js&\n @ ./app/pages/index.vue\n @ ./.nuxt/router.js\n @ ./.nuxt/index.js\n @ ./.nuxt/client.js\n @ multi ./.nuxt/client.js\n\n FATAL  Nuxt build error\n\n  at WebpackBundler.webpackCompile (node_modules/@nuxt/webpack/dist/webpack.js:5314:21)\n  at process._tickCallback (internal/process/next_tick.js:68:7)\n\n   ╭─────────────────────────────╮\n   │                             │\n   │   ✖ Nuxt Fatal Error        │\n   │                             │\n   │   Error: Nuxt build error   │\n   │                             │\n   ╰─────────────────────────────╯\n\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\nThe command '/bin/sh -c yarn build' returned a non-zero code: 1\n```\n\nbuild error が起きました…\n\nタイポしているファイル名を修正しましょう。\n\n```\napp_name\n├──app\n│  ├──components\n│  │  ├──HeaderMenu.vue\n```\n\n次に、`docker build`を実行してみましょう。\n\n```terminal\n$ docker build -t test .\n// 色々省略\nSuccessfully built 8474a08b9975\nSuccessfully tagged test:latest\n```\n\nビルドに成功しました。\n",coediting:a,comments_count:0,created_at:"2019-11-22T14:57:22+09:00",group:s,id:"6a0227e6f53cc3104d74",likes_count:2,private:a,reactions_count:0,tags:[{name:m,versions:[]},{name:c,versions:[]},{name:H,versions:[]},{name:e,versions:[]}],title:"【Nuxt.js】Docker Imageを作成する時に出たエラーと解決方法まとめ",updated_at:"2019-11-24T05:01:50+09:00",url:"https://qiita.com/arthur_foreign/items/6a0227e6f53cc3104d74",user:{description:x,facebook_id:n,followees_count:36,followers_count:o,github_login_name:E,id:i,items_count:19,linkedin_id:n,location:n,name:n,organization:A,permanent_id:y,profile_image_url:w,team_only:a,twitter_screen_name:i,website_url:j},page_views_count:s}],users:{},userItems:{}},serverRendered:!0}}(null,"",!1,0,"nuxt.js",0,"Vue.js",0,13,"arthur_foreign",0,0,"Docker","Firebase",0,"JavaScript",0,"Flutter, Dart, Django, Python, Nuxt, Vueとかの備忘録やツールの手順あたりを書いていきます。\r\n業務でWEBとネイティブアプリを開発してます。フロントからインフラまで幅広く。アフィリエイトで結構稼いでるのでSEOも分かっちゃう。書いた記事を英語に翻訳して復習中。",0,"arthur-sorami","bellx2",0,"Snob株式会社",307395,"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/307395/profile-images/1569302035","https://medium.com/@arthur_foreign","2019-11-26T13:13:03+09:00","https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89564/profile-images/1562762088","lord_sasapple","2019-11-27T15:33:34+09:00","newt0","Tokyo","vue.js、Railsの勉強をしています。普段は広告も作っています。","sugimotosyo",0,0,"ddg171",0,"TypeScript","flowphantom","2019-11-22T15:47:55+09:00","kira_puka","qdkmk","basho","2019-11-26T13:42:59+09:00",0,0,"aramsan",0,"dockerfile")</script><script src="/nuxt-circle-ci/_nuxt/605927d4d91740a23e44.js" defer></script><script src="/nuxt-circle-ci/_nuxt/b3356641dc119feec53b.js" defer></script><script src="/nuxt-circle-ci/_nuxt/fa8b5b1668aa9cd442ea.js" defer></script><script src="/nuxt-circle-ci/_nuxt/750c8111044767f53b05.js" defer></script>
  </body>
</html>
